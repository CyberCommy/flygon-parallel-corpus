- en: Chapter 4. Installing IPCop
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that we have covered some basic networking and firewalling principles and
    are aware of the features that IPCop allows us to leverage, we can look at how
    to install the firewall. IPCop can be installed in a variety of ways, but using
    a CDROM (sometimes with an accompanying floppy disk) is the simplest and most
    common method. Therefore, we shall look at this installation method with a fairly
    detailed walk-through and in later sections we shall talk about the options we
    have for more advanced installations, such as installing over a network and debugging
    the installation procedure.
  prefs: []
  type: TYPE_NORMAL
- en: Hardware Requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: IPCop has very modest minimum hardware requirements and is designed to be used
    on common PC hardware. Our main issue generally isn't "*is this machine powerful
    enough for IPCop*" it is more a case of "*is this machine powerful enough to handle
    the bandwidth going through it*".
  prefs: []
  type: TYPE_NORMAL
- en: 'The minimum system requirements for IPCop are:'
  prefs: []
  type: TYPE_NORMAL
- en: A **386**-based **PC** or better (which means you can use a very old PC as your
    firewall)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**32MB** of **RAM**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**200MB hard drive** (or compact flash drive)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**One Network Interface Card** (**NIC**) for each interface (four maximum).
    Each card has a unique hardware or MAC address, it''s worth noting these down
    at this point for use in identifying the cards later.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Connection devices for the Red interface if it's not Ethernet
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Other Hardware Considerations
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Although as a result of the minimum requirements for IPCop it is very tempting
    to put it on an old workstation or out-of-date PC, it is worth taking a step back
    to consider how we use it. In a home environment or in a very small office, an
    old PC may provide the requisite level of reliability, but it might not if internet
    access is critical, and especially if we use more complex functionality in IPCop
    such as VPNs or complex firewall rules, which are harder to duplicate, the damage
    caused by a hardware failure may be critical, even if we have backups.
  prefs: []
  type: TYPE_NORMAL
- en: A slightly more reliable, newer host therefore may be worth considering. There
    are also considerations based on the environment the firewall will be in. In a
    home or small office environment in which the firewall may not be in a server
    room or comms cupboard, the noise of an older PSU, while minimal, may be annoying.
    The power usage by such a server may also be a consideration—removing some unnecessary
    components or downgrading the PSU to a newer, more efficient, lower wattage model
    may solve the noise and power problems.
  prefs: []
  type: TYPE_NORMAL
- en: Hardware setup is worth considering, too—the location of our server should be
    considered such that rewiring is not an issue and the box will not require relocation
    or be tripped over. As we have mentioned before, we should also enable certain
    settings in the BIOS, such as disabling the 'halt on error' function (so that
    our box does not freeze at a prompt if the keyboard is removed or a component
    is damaged, unless we want this to happen). Another common BIOS option is the
    'resume on power' option—causing our server to automatically turn back on in the
    event of a power outage.
  prefs: []
  type: TYPE_NORMAL
- en: The Installation Procedure
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before we begin installing IPCop, we have to ensure that we are fully prepared
    and have all the necessary equipment. The following is a short checklist to ensure
    we have everything we need before we begin; anything specific to IPCop such as
    CD and floppy media will be detailed during the installation walk-through.
  prefs: []
  type: TYPE_NORMAL
- en: Do we have a machine that will meet the minimum system requirements?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do we have enough resources in the machine to handle our projected bandwidth
    usage?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do we have all required NICs and their drivers, if necessary, and have we checked
    they are compatible with IPCop?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do we have all the required equipment surrounding the IPCop machine in place?
    Examples are cabling, switches and a client machine to test the configuration.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do we have a working Internet connection?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'As soon as we are sure we have all the prerequisite hardware and connections
    available, we can begin the installation. We will have to download the IPCop installation
    ISO and burn it to a CD. The latest version can be found at the SourceForge project
    page for IPCop [http://sourceforge.net/project/showfiles.php?group_id=40604](http://sourceforge.net/project/showfiles.php?group_id=40604)
    The latest version, at time of writing, is 1.4.10: [http://prdownloads.sourceforge.net/ipcop/ipcop-install-1.4.10.i386.iso?download](http://prdownloads.sourceforge.net/ipcop/ipcop-install-1.4.10.i386.iso?download)'
  prefs: []
  type: TYPE_NORMAL
- en: After downloading the ISO and burning it to a CD with your choice of CD burning
    package we can begin the install.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Installing using a floppy**'
  prefs: []
  type: TYPE_NORMAL
- en: If your IPCop machine doesn't boot from CD, you can find a floppy image on the
    CD in the `images` folder, for example `boot-1.4.0.img`, which can be copied to
    a floppy disk, using the `dd` command on Linux or by using `rawwritewin.exe` provided
    on the IPCop disk.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we can boot the machine with the IPCop disk inserted in the CD drive, and
    we should then be presented with the following screen:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Installation Procedure](img/1361_04_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As you can see there is a very prominent message that installing IPCop will
    destroy all data on the system. What this means is that the first disk that IPCop
    comes across will be wiped, repartitioned, and formatted for the IPCop system
    to install. For the safety of our data, it is very important that we verify that
    there is only one disk in the system and we are sure there is nothing of value
    stored there. Once we are sure of this we can begin the installation without fear
    of data loss.
  prefs: []
  type: TYPE_NORMAL
- en: Pressing *enter* at this point will boot us into the installation system but
    we can also supply additional parameters to the kernel. If after pressing *enter*
    the system fails to boot properly we should restart the machine and try with one
    of the options above. We can generally use the `nopcmcia` option if our machine
    doesn't have PCMCIA (commonly found on laptops) and the same goes for USB. Many
    IPCop systems run on old hardware and USB is less common on this.
  prefs: []
  type: TYPE_NORMAL
- en: After we hit *enter* we will then be presented with the language selection screen.
    Assuming we would like an English IPCop system we can go with the default option,
    otherwise choose our language of preference. You can use the arrow keys to navigate
    the menu entries. We will then see the IPCop welcome message with instructions
    to hit cancel at any time to cause a reboot, in case we change our mind about
    the install.
  prefs: []
  type: TYPE_NORMAL
- en: Installation Media
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The next stage of the installation process, as shown in the following figure,
    is the choice of installation media.
  prefs: []
  type: TYPE_NORMAL
- en: '![Installation Media](img/1361_04_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: IPCop can be installed over FTP or HTTP for machines that do not have a CDROM
    drive. In this case, we would boot the machine off a floppy disk, and then have
    the host download that the content from the Internet normally is contained on
    the CDROM. Since we have a CDROM in the box we can choose the **CDROM** option.
    We will then be prompted by a message that says **Please Insert the IPCop CDROM**
    **in the CDROM drive**. This does not mean that the installation process didn't
    pick up the CD. Up until this point we could have been booting from a CD or a
    floppy and the installation process allows for this, if we hit **OK** installation
    should continue normally.
  prefs: []
  type: TYPE_NORMAL
- en: Hard Drive Partitioning and Formatting
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We will then be warned that the system is about to partition and format the
    hard drive.
  prefs: []
  type: TYPE_NORMAL
- en: '![Hard Drive Partitioning and Formatting](img/1361_04_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This is the point of no return and pressing *Enter* here wipes the disk entirely
    and we lose any data on the drive. As mentioned previously, as long as we have
    ensured that there is only one drive in the system and that the drive is the one
    we wouldn't mind wiping, we can continue. Pressing *Enter* will begin the partition
    and formatting process. This may take a minute or two if we have a large disk.
    It's generally a good idea to put a smaller disk in IPCop as it won't use a tremendous
    amount of space, depending upon how many log files we anticipate IPCop to have.
    We must ensure to meet the minimum requirements however, which is around 200 MB,
    while anything above 10 GB or so is highly unlikely to be used, unless you end
    up using add-ons that require more space—these add-ons will likely provide you
    with their disk space requirements.
  prefs: []
  type: TYPE_NORMAL
- en: Restore Configuration from Floppy Backup
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: At this stage we can choose to restore an earlier configuration saved on a floppy,
    which is an ideal way to back up an IPCop configuration.
  prefs: []
  type: TYPE_NORMAL
- en: '![Restore Configuration from Floppy Backup](img/1361_04_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As this is our first IPCop installation, we are unlikely to have a floppy handy.
    However, if we did, we could choose to **Restore** and the rest of the system
    configuration would run automatically based on our previous installation options.
    For now we will choose to **Skip** this and carry on with a manual installation.
  prefs: []
  type: TYPE_NORMAL
- en: Green Interface Configuration
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As we discussed in previous chapters, IPCop has a color scheme for referencing
    the NICs installed in the system. This is the first point in the installation
    process where we encounter these.
  prefs: []
  type: TYPE_NORMAL
- en: '![Green Interface Configuration](img/1361_04_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The Green interface corresponds to our local network and we can select this
    interface now. The simplest method is to allow IPCop to **Probe** for the network
    card, which it completes very reliably. If, however, we know exactly which make
    and model of card we want to use, we can choose to **Select** it manually which
    will then provide us with a list of known cards to choose from. This screen also
    makes reference to **special module parameters**, which are options we could pass
    to the network drivers in the kernel if necessary. Once this stage is configured,
    we can complete the rest of the installation remotely and we are asked to configure
    other cards later.
  prefs: []
  type: TYPE_NORMAL
- en: 'A slight complication at this stage is that the first card IPCop discovers
    will be used as the Green network interface if we let IPCop probe for the network
    cards. We may have a reason for picking a specific card for a specific interface:
    for instance, we might have a 10Mbit and a 100Mbit card, and wish to use the 10Mbit
    card for our internet connection. In this instance, we can employ one of two techniques—either
    to select the driver for the specific card we want as the Green interface ourselves,
    or to put the cards into the machine in order such that the Green card is in the
    lowest-numbered PCI or ISA slot. Also note that the name IPCop gives the card
    may not be the name of the make or model of the card as it relates to the **chipset**
    in use, for example many common cards will be identified as **Digital 21x4x Tulip
    PCI …**.'
  prefs: []
  type: TYPE_NORMAL
- en: Sometimes this can take a little work, and in particular, two identical network
    cards sharing the same box can cause confusion as to which network card is assigned
    to which interface. Some cards, such as older 3Com Etherlink cards, can be very
    hard to use when there is more than one of the card in the host. In a majority
    of these instances, assistance for the problem in particular can be found via
    the IPCop community.
  prefs: []
  type: TYPE_NORMAL
- en: Finished?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Wow that was easy! It seems we have finished the installation already.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finished?](img/1361_04_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Don't get too carried away though; this message means that the base system files
    are in place and our most basic configuration has finished. We must now set up
    IPCop for our particular needs, by choosing which interface types we want to use
    and how our addressing system will work. Pressing *Enter* here will take us into
    the configuration of IPCop.
  prefs: []
  type: TYPE_NORMAL
- en: Locale Settings
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We begin with our keyboard layout options.
  prefs: []
  type: TYPE_NORMAL
- en: '![Locale Settings](img/1361_04_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: We should choose the keyboard layout we would like to use. For users with a
    standard US keyboard choose **us**, or **uk** for users with a UK layout. Choosing
    the wrong layout here could make menu navigation and commands a bit difficult
    later on, so be sure to choose the correct option. Check how your desktop system
    is configured if you are unsure.
  prefs: []
  type: TYPE_NORMAL
- en: We will also be prompted to choose our **Timezone** such as **GMT** or **EST**;
    again be careful to choose the correct option and check with your desktop system
    to see how it is configured.
  prefs: []
  type: TYPE_NORMAL
- en: Hostname
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We now have to give the IPCop machine a name.
  prefs: []
  type: TYPE_NORMAL
- en: '![Hostname](img/1361_04_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: If we already have a naming scheme on the network we can use that; other options
    might be **firewall** or the default of **ipcop**. If we use the IPCop box as
    a DNS server it will reply with its own IP address for this name, so it can be
    convenient for addressing the web front-end of IPCop.
  prefs: []
  type: TYPE_NORMAL
- en: DNS Domain Name
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The default domain name for IPCop on our local network is shown in the following
    figure:'
  prefs: []
  type: TYPE_NORMAL
- en: '![DNS Domain Name](img/1361_04_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: If we don't have one we can go with the default, although as a business network
    we may already have a domain we are using on our local segment; we should enter
    that here, being careful not to overlap internal and external DNS. For example
    if we are using **reboot-robot.net** externally, then using **lan.reboot-robot.net**
    internally may be be a better idea, to allow internal clients to reference both
    internal and external machines using DNS. Misconfiguring this, or using a domain
    name that does not belong to you, could result in that domain being inaccessible
    to clients inside the network. If we put **aol.com** in here, as an example, then
    we may have difficulty accessing AOL's website and other services.
  prefs: []
  type: TYPE_NORMAL
- en: ISDN Configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'If we have an ISDN modem we can now configure it here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![ISDN Configuration](img/1361_04_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: We will need the parameters such as the protocol in use and the phone number
    to use, all of this can be provided by the ISDN ISP. If you have to dial 9 for
    an outside line, then which should also be included and pauses can be added where
    necessary by inserting a comma. If we do not have ISDN we should choose to disable
    it; we can then set up other connection methods such as DSL in a later step.
  prefs: []
  type: TYPE_NORMAL
- en: Network Configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We should now be presented with the **Network configuration menu**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Network Configuration](img/1361_04_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This is an important part of the setup process and directly relates to the network
    topologies we discussed in the previous chapter.
  prefs: []
  type: TYPE_NORMAL
- en: We first decide on our **Network configuration type**. There are many to choose
    from, and in the previous chapter we looked at an overview of a few of them. In
    this example, we will be running through the installation process for the **GREEN
    + RED** topology.
  prefs: []
  type: TYPE_NORMAL
- en: When we choose the appropriate option depending on the topology we decided upon
    in the previous chapter we can move on to the second item in the network configuration
    menu.
  prefs: []
  type: TYPE_NORMAL
- en: Drivers and Card Assignment
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'For each network interface card found in the system we will be prompted by
    a menu as shown in the following image:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Drivers and Card Assignment](img/1361_04_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: If we chose a topology with more interfaces, such as with Orange or Blue, we
    could assign the card to the interface we'd like it to be designated as. In the
    example shown above, we have one card and are assigning it to the **RED** interface;
    this will make it our Internet connection.
  prefs: []
  type: TYPE_NORMAL
- en: Address Settings
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The next option in the network configuration menu is **Address Settings**. Here
    we can define which addresses we want to use on the server.
  prefs: []
  type: TYPE_NORMAL
- en: '![Address Settings](img/1361_04_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: We always want the Green, Orange, and Blue interfaces to be static with a differing
    subnet for each interface. The Red interface will depend on our ISP, who will
    provide the configuration information. For Static, PPPOE, and PPTP, the addresses
    and configuration information should be configured as per your ISPs instructions.
    If we are using DHCP, however, all that is required is to click the **DHCP** option
    and leave all other settings at their defaults (unless instructed otherwise by
    your ISP). The majority of cable connections will use DHCP, while ADSL connections
    will vary depending upon what sort of ADSL router, modem, or interface card is
    used.
  prefs: []
  type: TYPE_NORMAL
- en: DNS and Default Gateway
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We should also provide DNS and default gateway servers for use.
  prefs: []
  type: TYPE_NORMAL
- en: '![DNS and Default Gateway](img/1361_04_14.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As noted, this is not always necessary for DHCP and is usually not a good idea
    as it will override the settings provided in DHCP by your ISP.
  prefs: []
  type: TYPE_NORMAL
- en: DHCP Server
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If we decide to use IPCop for our DHCP, then we have to configure the various
    DHCP options.
  prefs: []
  type: TYPE_NORMAL
- en: '![DHCP Server](img/1361_04_15.jpg)'
  prefs: []
  type: TYPE_IMG
- en: If we have a simple network with a couple of clients, we may want our IPCop
    to handle DHCP. In a larger network we may have a dedicated DHCP server in use
    already; if so we should disable the DHCP server.
  prefs: []
  type: TYPE_NORMAL
- en: DHCP requires a range of addresses to hand out to clients. We begin with providing
    this range, defined by a **Start address** and **End address**. In the case of
    the example above we have chosen **10.0.0.100** to **10.0.0.200\. Default lease**
    and **Max lease** time is the duration we will allow DHCP clients to *lease* an
    IP address. There is generally no real reason to alter these unless your network
    has specific requirements for leases of a specified time.
  prefs: []
  type: TYPE_NORMAL
- en: Generally, as we've discussed earlier, we can pick any internal addressing scheme
    (as long as we use internal addresses) we want. As long as we are consistent in
    what we use, and configure everything sanely, this will all work, and the defaults
    from this example installation (apart from the domain name suffix, as we mentioned
    earlier) will work. Again, as we've discussed before, the only minor exception
    to this is if we have an ISP that uses these (RFC1918) addresses itself—this information
    can be obtained from your ISP.
  prefs: []
  type: TYPE_NORMAL
- en: Domain name suffix should be pre-populated with the information we provided
    earlier in the configuration and generally the suffix should go with other clients
    on the network to ensure that all clients are configured with identical settings,
    which also match the IPCop machine.
  prefs: []
  type: TYPE_NORMAL
- en: Finished!
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now we can get excited! We have finished the installation process of IPCop.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finished!](img/1361_04_16.jpg)'
  prefs: []
  type: TYPE_IMG
- en: After pressing *Enter* here, the system will reboot into our IPCop installation
    for the first time.
  prefs: []
  type: TYPE_NORMAL
- en: First Boot
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When the IPCop system boots up we will be shown the following screen, which
    is the boot loader installed as part of IPCop (Grub). We can now choose the boot
    option we want to use and optionally add any parameters to the kernel prior to
    boot. After a few seconds, the default entry should boot.
  prefs: []
  type: TYPE_NORMAL
- en: '![First Boot](img/1361_04_17.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Grub**'
  prefs: []
  type: TYPE_NORMAL
- en: Grub is one of the commonly used boot loaders for Linux, and it essentially
    intermediates between the computer's BIOS and the operating system, letting us
    choose multiple operating systems or just specify options for one (such as picking
    SMP or ACPI support rather than the standard kernel, as in the menu shown in the
    previous screenshot).
  prefs: []
  type: TYPE_NORMAL
- en: More information on Grub can be found on the FSF website.
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.gnu.org/software/grub/](http://www.gnu.org/software/grub/)'
  prefs: []
  type: TYPE_NORMAL
- en: 'We should then see some boot information output on the screen, which should
    last for a few seconds, followed by a satisfying set of happy beeps and finally
    the following output:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: This is the Linux login prompt and signifies that we have now installed and
    successfully booted the IPCop system. IPCop will now function as a basic NAT firewall
    for us, without the need for further configuration.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter we covered getting an IPCop system up and running with the configurations
    and topologies we covered previously. We also saw that NAT should be passing through
    the firewall; clients should be able to obtain IP addresses, use DNS, and access
    the Internet. We can now go on to customize the system and enable features and
    services that aren't available by default. In the next few chapters we will cover
    basic configuration and then look at more advanced options such as Intrusion Detection
    and VPNs.
  prefs: []
  type: TYPE_NORMAL
