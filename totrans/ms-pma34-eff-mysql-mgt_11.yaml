- en: Chapter 11. Entering SQL Statements
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This chapter explains how we can enter our own SQL statements (queries) into
    phpMyAdmin, and how we can keep a history of those queries. Traditionally, one
    would interact with a MySQL server via the "mysql" command-line client by entering
    SQL statements and watching the server's response. Official MySQL training still
    involves directly typing statements to such a client.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: The SQL query box
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'phpMyAdmin allows us to accomplish many database operations via its graphical
    interface. However, there will be times when we have to rely on SQL query input
    to achieve operations that are not directly supported by the interface. Following
    are two examples of such queries:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-4
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: To enter such queries, the SQL query box is available from a number of places
    within phpMyAdmin.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: The Database view
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We encounter our first SQL query box when going to the **SQL** menu available
    in the `Database` view.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: '![The Database view](img/7782_11_01.jpg)'
  id: totrans-8
  prefs: []
  type: TYPE_IMG
- en: This box is simple—we type in some valid (hopefully) MySQL statement and click
    on **Go**. Under the query text area, there are bookmark-related choices (explained
    later in [Chapter 14)](ch14.html "Chapter 14. Using Query Bookmarks"). Usually,
    we don't have to change the standard SQL delimiter, which is a semicolon. However,
    there is a **Delimiter** dialog in case we need it (refer to [Chapter 17)](ch17.html
    "Chapter 17. Supporting Features Added in MySQL 5").
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: For a default query to appear in this box, we can set it with the `$cfg['DefaultQueryDatabase']`
    configuration directive, which is empty by default. We could put a query such
    as `SHOW TABLES FROM @DATABASE@` in this directive. The `@DATABASE@` placeholder
    in this query would be replaced by the current database name, resulting in `SHOW
    TABLES FROM `marc_book`` in the query box.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: The Table view
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A slightly different box is available in the `Table` view of the `book` table
    from the **SQL** menu.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: '![The Table view](img/7782_11_02.jpg)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
- en: 'The box already has a default query as seen in the previous screenshot. This
    default query is generated from the `$cfg[''DefaultQueryTable'']` configuration
    directive, which contains `SELECT * FROM @TABLE@ WHERE 1`. Here, the `@TABLE@`
    is replaced by the current table name. Another placeholder available in `$cfg[''DefaultQueryTable'']`
    is `@FIELDS@`. This placeholder would be replaced by the complete column''s list
    of this table, thus producing the following query:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '`WHERE 1` is a condition that is always true. Therefore, the query can be executed
    as it is. We can replace **1** with the condition we want, or we can type a completely
    different query.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: Because this SQL box appears in the `Table` view, the table name is known; therefore,
    phpMyAdmin shows buttons below the query box, which permit to quickly create common
    SQL queries which contain this table name. Most of the queries generated by these
    buttons contain the full column list.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: The Columns selector
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The **Columns** selector is a way to speed up query generation. By choosing
    a column and clicking on the arrows**<<**, this column name is copied at the current
    cursor position in the query box. Here, we select the **author_id** column, remove
    the digit **1**, and click on**<<**. Then we add the condition **= 2** as shown
    in the following screenshot:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: '![The Columns selector](img/7782_11_03.jpg)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
- en: The **Show this query here again** option (checked by default) ensures that
    the query stays in the box after its execution if we are still on the same page.
    This can be seen more easily for a query like an `UPDATE` or `DELETE`, which affects
    a table, but does not produce a separate results page.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: Clicking into the query box
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We might want to change the behavior of a click inside the query box with the
    `$cfg['TextareaAutoSelect']` configuration directive. Its default value is `FALSE`,
    which means that no automatic selection of the contents is done upon a click.
    Should you change this directive to `TRUE`, the first click inside this box will
    select all its contents. (This is a way to quickly copy the contents elsewhere
    or delete them from the box.) The next click would put the cursor at the click
    position.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: The Query window
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In [Chapter 3](ch03.html "Chapter 3. Over Viewing the Interface"), we discussed
    the purpose of this window, and the procedure for changing some parameters (such
    as dimensions). This window can easily be opened from the navigation panel using
    the **SQL** icon or the **Query window** link, as shown in the following screenshot,
    and is very convenient for entering a query and testing it:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: '![The Query window](img/7782_11_04.jpg)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
- en: 'The following screenshot shows the Query window that appears over the main
    panel:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: '![The Query window](img/7782_11_05.jpg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
- en: The window seen in the screenshot contains the same **Columns** selector and**<<**
    button as that used in a `Table` view context. This distinct Query window is a
    feature supported only on JavaScript-enabled browsers.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: Query window options
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The **SQL** tab is the default active tab in this window. This comes from the
    configuration directive `$cfg['QueryWindowDefTab']`, which contains `sql` by default.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: If we want another tab to be the default active tab, we can replace `sql` with
    `files` or `history`. Another value, `full`, shows the contents of all the three
    tabs at once.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: In the Query window, we see a checkbox for the **Do not overwrite this query
    from outside the window** choice. Normally, this checkbox is selected. If we deselect
    it, the changes we make while generating queries are reflected in the Query window.
    This is called **synchronization**. For example, choosing a different database
    or table from the navigation or main panel would update the Query window accordingly.
    However, if we start to type a query directly in this window, the checkbox will
    get checked in order to protect its contents and remove synchronization. This
    way, the query composed here will be locked and protected.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: Session-based SQL history
  id: totrans-34
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This feature collects all the successful SQL queries we execute as PHP session
    data, and modifies the Query window to make them available. This default type
    of history is temporary, as `$cfg['QueryHistoryDB']` is set to `FALSE` by default.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: Database-based SQL history (permanent)
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As we installed the phpMyAdmin configuration storage (refer to [Chapter 1)](ch01.html
    "Chapter 1. Getting Started with phpMyAdmin"), a more powerful history mechanism
    is available. We should now enable this mechanism by setting `$cfg['QueryHistoryDB']`
    to `TRUE`.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: 'After we try some queries from one of the query boxes, a history is built,
    visible only from the Query window as shown in the following screenshot:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: '![Database-based SQL history (permanent)](img/7782_11_06.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
- en: We see (in the reverse order) the last successful queries and the database on
    which they were made. Queries typed only from the query box are kept in this history,
    along with queries generated by phpMyAdmin (such as those generated by clicking
    on **Browse)**.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: They are clickable for immediate execution, and the **Change** icon is available
    to insert a recorded query into the query box for editing.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: The number of queries that will be kept is controlled by `$cfg['QueryHistoryMax']`,
    which is set to `25` by default. This limit is not kept for performance reasons,
    but as a practical limit in order to achieve a visually unencumbered view. Extra
    queries are eliminated at login time in a process traditionally called **garbage
    collection**. The queries are stored in the table configured in `$cfg['Servers'][$i]['history']`.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Editing queries
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'On the results page of a successful query, a header containing the executed
    query appears as shown in the following screenshot:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在成功查询的结果页面上，会显示包含执行查询的标题，如下截图所示：
- en: '![Editing queries](img/7782_11_07.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![编辑查询](img/7782_11_07.jpg)'
- en: 'Clicking on **Edit** opens the Query window''s **SQL** tab, with this query
    ready to be modified. This happens because of the following default setting for
    this parameter:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 单击**编辑**会打开查询窗口的**SQL**选项卡，并准备修改此查询。这是因为该参数的默认设置如下：
- en: '[PRE2]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: When it is set to `FALSE`, a click on **Edit** will not open the Query window;
    instead, the query will appear inside the query box of the **SQL** page.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 当它设置为“FALSE”时，单击**编辑**将不会打开查询窗口；相反，查询将出现在**SQL**页面的查询框内。
- en: Clicking on **Inline** replaces the displayed query by a text area where it's
    possible to edit and submit this query, without leaving the current results page.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 单击**内联**会将显示的查询替换为文本区域，在这里可以编辑和提交此查询，而不离开当前结果页面。
- en: Multi-statement queries
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多语句查询
- en: 'In PHP and MySQL programming, we can send only one query at a time using the
    `mysql_query()` function call. phpMyAdmin allows us to send many queries in one
    transmission, using a semicolon as a separator. Suppose we type the following
    query in the query box:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在PHP和MySQL编程中，我们可以使用`mysql_query()`函数调用一次只发送一个查询。phpMyAdmin允许我们使用分号作为分隔符，在一次传输中发送多个查询。假设我们在查询框中输入以下查询：
- en: '[PRE3]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'We will receive the following results screen:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将收到以下结果屏幕：
- en: '![Multi-statement queries](img/7782_11_08.jpg)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![多语句查询](img/7782_11_08.jpg)'
- en: We see the number of affected rows through comments because `$cfg['VerboseMultiSubmit']`
    is set to `TRUE`.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过注释看到受影响的行数，因为`$cfg['VerboseMultiSubmit']`设置为`TRUE`。
- en: 'Let us send the same list of queries again and watch the results:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们再次发送相同的查询列表并观看结果：
- en: '![Multi-statement queries](img/7782_11_09.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![多语句查询](img/7782_11_09.jpg)'
- en: It is normal to receive a **Duplicate entry** error message that says the value
    **100** exists already. We are seeing the results of the first **INSERT** statement;
    but what happens to the next one? Execution stops at the first error because `$cfg['IgnoreMultiSubmitErrors']`
    is set to `FALSE` telling phpMyAdmin not to ignore errors in multiple statements.
    If it is set to `TRUE`, the program successively tries all the statements, and
    we see two **Duplicate entry** errors.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 收到“重复条目”错误消息是正常的，该消息表示值**100**已经存在。我们看到第一个**INSERT**语句的结果；但是下一个会发生什么？由于`$cfg['IgnoreMultiSubmitErrors']`设置为`FALSE`，告诉phpMyAdmin不要忽略多个语句中的错误，因此执行在第一个错误处停止。如果设置为`TRUE`，程序将依次尝试所有语句，我们会看到两个**重复条目**错误。
- en: This feature would not work as expected, if we tried more than one `SELECT`
    statement. We would see the results of only the last `SELECT` statement.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们尝试多个`SELECT`语句，此功能将无法按预期工作。我们将只看到最后一个`SELECT`语句的结果。
- en: Pretty printing (syntax highlighting)
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 漂亮打印（语法高亮）
- en: By default, phpMyAdmin parses and highlights the various elements of any MySQL
    statement it processes. This is controlled by `$cfg['SQP']['fmtType']`, which
    is set to`'html'` by default. This mode uses a specific color for each different
    element (a reserved word, a variable, a comment, and so on) as described in the
    `$cfg['SQP']['fmtColor']` array located in the theme-specific `layout.inc.php`
    file.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，phpMyAdmin解析和突出显示其处理的任何MySQL语句的各个元素。这由`$cfg['SQP']['fmtType']`控制，默认设置为`'html'`。此模式对每个不同的元素（保留字、变量、注释等）使用特定颜色，如`$cfg['SQP']['fmtColor']`数组中所描述的那样，该数组位于特定主题的`layout.inc.php`文件中。
- en: Setting `fmtType` to`'text'` would remove all color formatting, inserting line
    breaks at logical points inside a MySQL statement. Finally, setting `fmtType`
    to`'none'` removes every kind of formatting, leaving our syntax intact.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 将`fmtType`设置为`'text'`将删除所有颜色格式，将换行符插入到MySQL语句中的逻辑点。最后，将`fmtType`设置为`'none'`将删除所有格式，保留我们的语法不变。
- en: The SQL Validator
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SQL验证器
- en: Each time phpMyAdmin transmits a query, the MySQL server interprets it and provides
    feedback. The syntax of the query must follow MySQL rules, which are not the same
    as the SQL Standard. However, conforming to SQL Standard ensures that our queries
    are usable on other SQL implementations.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 每次phpMyAdmin传输查询时，MySQL服务器会解释它并提供反馈。查询的语法必须遵循MySQL规则，这与SQL标准不同。但是，遵循SQL标准可以确保我们的查询在其他SQL实现上可用。
- en: A free external service, the **Mimer SQL Validator**, is available to us, thanks
    to Mimer Information Technology AB. It validates our query according to the Core
    SQL-99 rules and generates a report. The Validator is available directly from
    phpMyAdmin, and its home page is located at [http://developer.mimer.com/validator/index.htm](http://developer.mimer.com/validator/index.htm).
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 一个免费的外部服务，**Mimer SQL验证器**，由Mimer Information Technology AB提供。它根据Core SQL-99规则验证我们的查询并生成报告。验证器可以直接从phpMyAdmin使用，并且其主页位于[http://developer.mimer.com/validator/index.htm](http://developer.mimer.com/validator/index.htm)。
- en: Note
  id: totrans-66
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: For statistical purposes, this service anonymously stores on its server, the
    queries it receives. When storing the queries, it replaces database, table, and
    column names with generic names. Strings and numbers that are part of the query
    are replaced with generic values so as to protect the original information.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 出于统计目的，此服务会匿名存储接收到的查询。在存储查询时，它会用通用名称替换数据库、表和列名称。查询中的字符串和数字将被替换为通用值，以保护原始信息。
- en: System requirements
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 系统要求
- en: 'This Validator is available as a SOAP service. Our PHP server must have XML,
    PCRE, and SOAP support. SOAP support is offered by either a PHP extension or by
    a PEAR module. If we choose the PEAR way, the following command (executed on the
    server by the system administrator) installs the modules we need:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 此验证器作为SOAP服务提供。我们的PHP服务器必须具有XML、PCRE和SOAP支持。SOAP支持由PHP扩展或PEAR模块提供。如果选择PEAR方式，系统管理员在服务器上执行以下命令安装我们需要的模块：
- en: '[PRE4]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'If we have problems with this command due to some of the modules being in a
    beta state, we can execute the following command, which installs SOAP and other
    dependent modules:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Making the Validator available
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Some parameters must be configured in `config.inc.php`. Setting `$cfg['SQLQuery']['Validate']`
    to `TRUE` enables the **Validate SQL** link.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: We should also enable the Validator itself (as other validators might be available
    on future phpMyAdmin versions). This is done by setting `$cfg['SQLValidator']['use']`
    to `TRUE`.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: 'The Validator is accessed with an anonymous Validator account by default, as
    configured using the following commands:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Instead, if Mimer Information Technology has provided us with an account, we
    can use that account information here.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: Validator results
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There are two kinds of reports returned by the Validator—one if the query conforms
    to the standard, and the other if it does not conform.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: Standard-conforming queries
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We will try a simple query: `SELECT COUNT(*) FROM book`. As usual, we enter
    this query in the query box and send it. On the results page, we now see an additional
    link— **Validate SQL** as shown in the following screenshot:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: '![Standard-conforming queries](img/7782_11_10.jpg)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
- en: 'Clicking on **Validate SQL** produces a report as shown in the following screenshot:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: '![Standard-conforming queries](img/7782_11_11.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
- en: We have the option of clicking on **Skip Validate SQL** to see our original
    query.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: Non standard-conforming queries
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Let us try another query, which works correctly in MySQL: `SELECT * FROM book
    WHERE language = ''en''`. Sending it to the Validator produces a report as shown
    in the following screenshot:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: '![Non standard-conforming queries](img/7782_11_12.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
- en: 'Each time the Validator finds a problem, it adds a message such as **{error:
    1}** at the point of the error and adds a footnote in the report. In this query,
    the **language** column name is non-standard. Hence, the Validator tells us that
    it was expecting an identifier at this point. Another non-standard error is reported
    about the use of a `LIMIT` clause, which was added to the query by phpMyAdmin.'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: Another case is that of the backquote. If we just click on **Browse** for the
    `book` table, phpMyAdmin generates `SELECT * FROM `book``, enclosing the table
    name with backquote. This is MySQL's way of protecting identifiers, which might
    contain special characters, such as spaces, international characters, or reserved
    words. However, sending this query to the Validator shows us that the backquotes
    do not conform to standard SQL. We may even get two errors, one for each backquote.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This chapter helped us understand the purpose of query boxes and showed us where
    to find them. It also gave us an overview of how to use the column selector, the
    Query window options, how to get a history of the typed commands, multi-statement
    queries, and finally, how to use the SQL Validator.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: The next chapter will show how to produce multi-table queries without typing
    much, thanks to phpMyAdmin's query generator.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
