- en: Chapter 3. Stalking Prey Through Target Recon
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第3章。通过目标侦察追踪猎物
- en: The American President Abraham Lincoln, quotable as he may have been, is often
    (incorrectly) heldÂ to have once said,
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 美国总统亚伯拉罕·林肯，尽管他可能曾经被引用，但通常（错误地）被认为曾经说过，
- en: '*"Give me six hours to chop down a tree and I will spend the first four sharpening
    the axe."*'
  id: totrans-2
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “给我六个小时砍倒一棵树，我将花前四个小时磨削斧头。”
- en: Regardless of where the quote truly came from, weÂ can certainly relate this
    withÂ hacking. Much success in web penetration testing is determined by what we
    uncover here, how we sift through the information, and how we couple it with tools
    covered later in this book. A thorough and methodical approach here will save
    time, focus efforts, and aid in planning our attacks. The methodologies from the
    various frameworks and organizations we discussed in [Chapter 2](000.html#), *Guidelines
    for Preparation and Testing*, all include some aspects of information gathering,
    and the tools available in Kali Linux should be familiar to you.Â
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 无论这句话真正来自何处，我们肯定可以将其与黑客联系起来。在网站渗透测试中的许多成功取决于我们在这里发现了什么，我们如何筛选信息，以及我们如何将其与本书后面介绍的工具相结合。在这里进行彻底和系统的方法将节省时间，集中精力，并有助于规划我们的攻击。我们在[第2章](000.html#)中讨论的各种框架和组织的方法都包括一些信息收集方面，Kali
    Linux中可用的工具应该对您来说是熟悉的。
- en: Note
  id: totrans-4
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'In this book, we''ll be following along with the Pen Test Kill Chain discussed
    in *Penetration Testing with the Raspberry Pi â�� Second Edition* (by *Jason Beltrame*
    and *Mike McPhee*, available atÂ [https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition](https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition))
    shown in the following figure:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们将跟随*Penetration Testing with the Raspberry Pi â�� Second Edition*（由*Jason
    Beltrame*和*Mike McPhee*讨论的Pen Test Kill Chain）的讨论，该书可在[https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition](https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition)上找到，如下图所示：
- en: '![](img/B03918_03_01-1.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_01-1.png)'
- en: The Pen Test Kill Chain helps to understand what tools are involved when. Build
    your own version to help visualize the workflow.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Pen Test Kill Chain有助于了解涉及何种工具。构建您自己的版本以帮助可视化工作流程。
- en: This information gathering takes many forms, but as a practicing hacker, you
    have probably developed your own preferences and routines. A healthy mix of open
    source information gathering, passive reconnaissance of the target itself, and
    subtle, focused scanning and *spidering* can go a long way toward laying out the
    rest of your project's game plan. The challenge is to expose as much as possible
    without triggering defensive awareness (also known as **paranoia**) in our target's
    operators. My hope is that I can help provide some tweaks to your processes that
    can help you get further into your discovery without getting caught.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 这种信息收集有多种形式，但作为一名实践黑客，您可能已经形成了自己的偏好和惯例。开源信息收集、对目标本身进行被动侦察以及微妙、专注的扫描和*蜘蛛*的健康混合可以在很大程度上帮助制定项目的游戏计划的其余部分。挑战在于尽可能暴露更多信息，而不引起目标操作者的防御意识（也称为**偏执狂**）。我希望我能帮助提供一些调整您的流程的建议，这样您就可以在不被发现的情况下更深入地进行发现。
- en: The universal vulnerability of all systems is the user, and web applications
    present their developers with an outlet to express themselves and show what they
    are made of. Effective social engineering can often short-circuit a tremendous
    amount of technical engineering to obtain credentials and other key elements of
    the web application's architecture. We'll look at how to exploit trust and pride
    to encourage the target's users and developers to squeeze as much out of this
    approach as possible.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 所有系统的普遍漏洞是用户，而Web应用程序为其开发人员提供了一个表达自己并展示他们的机会。有效的社会工程学往往可以绕过大量的技术工程，以获取Web应用程序架构的凭据和其他关键元素。我们将看看如何利用信任和自豪感来鼓励目标用户和开发人员，尽可能多地利用这种方法。
- en: 'Let''s not forget that artifacts themselves can help the customer understand
    their information exposure. Keenly aware cyber security initiatives will not only
    drawÂ attention to what is publicly available with respect to their organizations,
    but they may even engage in misinformation. In your discovery, catalog your findings:
    customers should be commended for reducing their public exposure.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们不要忘记，文物本身可以帮助客户了解他们的信息曝光。敏锐的网络安全举措不仅会引起对其组织公开可用信息的关注，甚至可能会进行误导。在您的发现中，编目您的发现：客户应该因减少其公开曝光而受到赞扬。
- en: 'In this chapter, we''ll discuss the following:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下内容：
- en: Gathering and using offline archives of websites
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 收集和使用网站的离线存档
- en: Reconnaisance of yourÂ target using public resources and a fancy old browser
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用公共资源和一个时髦的旧浏览器对您的目标进行侦察
- en: Using social engineering to hack the users
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用社会工程学来黑客用户
- en: Automating open source information gathering to map and characterize the target
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动化开源信息收集以绘制和描述目标
- en: Identifying key aspects of our target and focusing later efforts through active
    scanning
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过主动扫描识别目标的关键方面，并通过后续努力进行聚焦
- en: The imitation game
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模拟游戏
- en: '* * *'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: If one challenge in the recon phase of the attack gets your blood pumping, it'll
    be trying to find out every last detail about a site without getting caught looking
    too curious. Casual, normal users crawl websites randomly with a focus on certain
    high-traffic transactions, and anything more methodical than this may arouse suspicion.
    Inefficient workflows may also raise flags, so being able to surf the site and
    game plan attacks is an incredibly useful trick to learn. In this section, we'll
    look at how to create a mirror of a site (without waking the defenders) for a
    risk-free simulation. They do say that imitation is the best form of flattery.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 如果攻击的侦察阶段中的一个挑战让你的血液沸腾，那就是试图在不被发现的情况下找出关于一个网站的每一个细节。普通用户随机浏览网站，重点关注某些高流量交易，任何比这更有条理的行为可能引起怀疑。低效的工作流也可能引起警觉，因此能够浏览网站并制定攻击计划是一个非常有用的技巧。在这一部分，我们将看看如何创建一个网站的镜像（而不会惊动防御者），进行无风险的模拟。他们说模仿是最好的恭维方式。
- en: We'll also find that there are limitations to the site's mirror. Back-end data,
    higher-level scripting, and intelligence all fail to replicate without the same
    infrastructures at the application and data tiers. The business logic that we
    may be counting on to actually exploit the application doesn't replicate over,
    and the vast array of data that is our end goal cannot be pulled in this fashion.
    We'll need to better understand how to surf safely. We'll discuss some better
    poking and prodding techniques for the actual site with stealth in this section
    as well.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还会发现网站镜像存在一些限制。后端数据、高级脚本和智能都无法在应用程序和数据层没有相同基础设施的情况下复制。我们可能依赖的业务逻辑无法复制，我们的最终目标——大量数据也无法以这种方式获取。我们需要更好地了解如何安全地浏览。在本节中，我们还将讨论一些更好的探测技术，以便在实际网站上进行隐蔽操作。
- en: Making (then smashing) a mirror with HTTrack
  id: totrans-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用HTTrack创建（然后破坏）镜像
- en: Military operations, sports teams, and business proposal teams operating at
    their best will rehearse or perfect their tactics and overall strategyÂ against
    a mock opponent or in an environment that is an authentic copy of what they will
    be up against. The benefits of this are many, but chief among them is that these
    rehearsal environmentsÂ provide a safe environment to build confidence and competenceÂ without
    the risk of losing the actual battle, game, or project. In the movieÂ *Ocean's
    Eleven*, they actually mocked up a complete copy of the vault they were breaching
    to rehearse their plan (and more, but I won't spoil the fun if you haven't seen
    it yet â��go rent or stream it if you can). The point is that the more accurate
    and realistic the simulation, the greater theÂ chance of success when the real
    deal is happening.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 军事行动、体育队伍和商业提案团队在最佳状态下将对他们的战术和整体战略进行排练或完善，对抗一个模拟对手或在一个真实复制的环境中进行。这样做的好处很多，但其中最重要的是，这些排练环境提供了一个安全的环境，可以在不失去实际战斗、比赛或项目的风险的情况下建立信心和能力。在电影《奥斯汀大冒险》中，他们实际上模拟了他们要攻破的金库的完整副本来排练他们的计划。这一点是，模拟的越准确和真实，当真正的情况发生时成功的机会就越大。
- en: Now that my movie reference is over, think about our role as pen testers. If
    you can pull down a copy of the HTML, JavaScript, CGI, and CSS code for a full
    website and a hierarchy intact, then wouldn't that be a great way to explore the
    site without tripping alarms at the real target? All of the brainstorming you
    and your team engage in can now be used on a replica, and because there is no
    target organization monitoring the dashboard, we can test a bunch of vectors rather
    than fretting over just one.Â  In training along with the pen test, this is also
    a useful method of creating local, travel-ready copies of sites that can be used
    without fear of retribution or dependence on actual network connectivity.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我的电影参考结束了，想想我们作为渗透测试人员的角色。如果你可以下载一个完整网站的HTML、JavaScript、CGI和CSS代码以及层次结构，那么这不是一个探索网站的好方法吗？你和你的团队进行的所有头脑风暴现在可以用在一个复制品上，因为没有目标组织监控仪表板，我们可以测试一堆向量，而不是只担心一个。在渗透测试中，这也是一个创建本地、便于旅行的网站副本的有用方法，可以在不依赖实际网络连接的情况下使用。
- en: These archives can also form the basis of a spoof attack, allowing us to take
    the actual web pages and modify them before hosting them in a rogue honeypot using
    **Browser Exploitation Framework** (**BeEF**) or a credential skimmer using **Social
    Engineering Toolkit** (**SET**).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 这些存档也可以成为欺骗攻击的基础，让我们可以在使用**浏览器利用框架**（**BeEF**）或**社会工程工具包**（**SET**）的流氓蜜罐中托管实际的网页并进行修改。
- en: Several site mirroring utilities such as`wget` and `w3af` can do archives, but
    **HTTrack** is the most fully-featured tool in Kali that can create a mirror.
    You may already use it for base archives, but with a few tweaks, it can do so
    much more. Let's take a look at some of the most useful CLI options for recon
    and their equivalent **Graphical User Interface** (**GUI**) versions wherever
    applicable.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 诸如`wget`和`w3af`之类的多个网站镜像工具可以进行存档，但**HTTrack**是Kali中最全面的工具，可以创建一个镜像。你可能已经用它来创建基本存档，但通过一些调整，它可以做得更多。让我们来看看一些最有用的侦察CLI选项及其相应的**图形用户界面**（**GUI**）版本。
- en: Making a stealthy initial archive
  id: totrans-26
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 创建一个隐秘的初始存档。
- en: 'Â As a refresher, you can create an archive of a website by doing the following:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个提醒，你可以通过以下步骤创建一个网站的存档：
- en: '[PRE0]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The `â��O` points to the output location (some locally accessible drive where
    you plan to access the mirror from). Â While help may prove useful (Â `hattrack
    --help`Â orÂ `man help`), you'll get more out of the manual volunteered by Fred
    Cohen on the HTTrack website ([https://www.httrack.com/html/fcguide.html](https://www.httrack.com/html/fcguide.html)).
    As *Mr. Cohen* reveals, there are a ton of switches in the CLI, and understanding
    the defaults for many of those is useful in crafting your own go-to mirror operation.
    More sophisticated sites will take measures to prevent mirroring from utilities
    such asÂ HTTrack, including recursive links and directory structures, domain splitting,
    and obfuscating links using scripts to impair your ability to mirror them. Drastic
    measures such as IP blacklisting or throttling may also be employed, so it is
    best to only employ these tools with care, tuning, and respect for the website's
    owners.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '`â��O`指向输出位置（一些本地可访问的驱动器，您计划从中访问镜像）。虽然帮助可能会很有用（`hattrack --help`或`man help`），但您可以从HTTrack网站上Fred
    Cohen提供的手册中获得更多信息（[https://www.httrack.com/html/fcguide.html](https://www.httrack.com/html/fcguide.html)）。正如*Mr.
    Cohen*所透露的，CLI中有大量开关，了解其中许多的默认值对于制定自己的镜像操作非常有用。更复杂的网站将采取措施防止从诸如HTTrack的实用程序进行镜像，包括递归链接和目录结构，域拆分以及使用脚本混淆链接以损害您镜像它们的能力。还可能采取极端措施，如IP黑名单或限速，因此最好谨慎使用这些工具，并尊重网站所有者。'
- en: Tuning stealthier archives
  id: totrans-30
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 调整更隐秘的存档
- en: Conducting a stealthier mirror is certainly worth learning about, but we have
    some trade-offs to consider. Throttling and threadÂ limits help keep us off their
    radar, but that means a mirror operation will take that much longer. We can limit
    what we are looking for through filters and directory restrictions, which is something
    that social engineering and our own experience can assist with. Are there efficiencies
    to be gained elsewhere?
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 进行更隐秘的镜像操作当然值得学习，但我们需要考虑一些权衡。限制带宽和线程数量有助于使我们不被发现，但这意味着镜像操作将需要更长时间。我们可以通过过滤器和目录限制来限制我们的搜索范围，这是社会工程和我们自己的经验可以帮助解决的问题。还有其他地方可以提高效率吗？
- en: 'There is considerable overhead as HTTrack processes queries, and a big factor
    in the time and compute power consumed is the parsing ofÂ **Multipurpose Internet
    Mail Extensions** (**MIME**) types on sites. There are many customizable features
    of HTTrack that can be leveraged through modification to the `.httrackrc` file,
    but the most useful one I picked up was the addition of the followingÂ line, which
    drastically cut my mirror time from hours to minutes. This line speeds up transfers
    by telling HTTrack to assume that HTML, PHP, CGI, DAT, and MPG files correspond
    to a standard MIME type and can be resolved to their usual end-state, avoiding
    all of the churn. Simply add this in its entirety (after modifying it to your
    liking) to the `.httrackrc` file using your favorite editor and save the file:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: HTTrack处理查询时存在相当大的开销，时间和计算资源的消耗的一个重要因素是在网站上解析**多用途互联网邮件扩展**（**MIME**）类型。HTTrack有许多可定制的功能，可以通过修改`.httrackrc`文件来利用，但我学到的最有用的一个是添加以下行，这大大缩短了我的镜像时间，从几小时缩短到几分钟。通过使用您喜欢的编辑器将这一行完整地添加到`.httrackrc`文件中，并保存文件：
- en: '[PRE1]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Once I've made this modification to my defaults, the stealthier command string
    that I find useful will do a bunch of non-default things. Â Keep in mind, once
    you've honed your own switches, you can save them in the `.httrackrc` file as
    well. Here is the command I used:Â
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我对默认设置进行了修改，我发现有用的隐秘命令字符串将执行一系列非默认操作。请记住，一旦你磨练出自己的开关，你也可以将它们保存在`.httrackrc`文件中。这是我使用的命令：
- en: '[PRE2]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Here is aÂ brief description of the options I used. *N*Â denotes a variable:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是我使用的选项的简要描述。*N*表示一个变量：
- en: '`-cN`: This limits the number of simultaneous downloads or file handles to
    avoid overwhelming our target'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-cN`：这限制了同时下载的数量或文件句柄，以避免过度压倒我们的目标'
- en: '`-AN`: This throttles the bandwidth to stay under the radar'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-AN`：这限制了带宽以保持低调'
- en: '`-mN` and `â��mN''`: These limit total downloads for the non-HTML and HTML
    file sizes respectively to ensure we do not overrun our disk'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-mN`和`â��mN''`：这些分别限制了非HTML和HTML文件大小的总下载量，以确保我们不会超出磁盘空间'
- en: '`-M`: This sets the overall mirror size limit â�� again keeping the disk size
    manageable'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-M`：这设置了整体镜像大小限制，再次保持磁盘大小可管理'
- en: '`-rN`: This puts a safety on recursion depth so we don''t get into a loop'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: -rN：这会对递归深度进行安全设置，以免陷入循环
- en: '`-H2`: This stops the download if slow traffic is detected'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: -H2：如果检测到慢速流量，将停止下载
- en: '`-<path>/*`: This skips a path (in this case, I didn''t want to pull down their
    extensive forums or user profiles)'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-<path>/*`：这跳过了一个路径（在这种情况下，我不想下载他们庞大的论坛或用户资料）'
- en: 'You can also use the GUI version, **WebHTTrack**, which is handy for learning
    how to tweak your favorite filters and options:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用GUI版本的**WebHTTrack**，这对学习如何调整您喜欢的过滤器和选项非常方便：
- en: '![](img/B03918_03_02-1.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_02-1.png)'
- en: WebHTTrack offers an intuitive way to master filters and tunings, and also enables
    the saving scan settings for repeat use.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: WebHTTrack提供了一个直观的方式来掌握过滤器和调整，并且还可以保存扫描设置以供重复使用。
- en: 'This command against the [https://www.hackthissite.org/](https://www.hackthissite.org/)Â website
    took a little over an hour to pull down 200 MB of information. I omitted the forums
    and users in this example, but I could just as easily have omitted other directories
    to focus on a specific area of the site or to avoid violating the boundaries established
    by my customer. If you press *Enter* while the command line is running, you''ll
    get a rundown of how long it has run, the number of links found, and the total
    download size to that point in time:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令对[https://www.hackthissite.org/](https://www.hackthissite.org/)网站的攻击花了一小时多一点的时间，下载了200MB的信息。在这个例子中，我省略了论坛和用户，但我也可以省略其他目录，以便专注于网站的特定区域，或者避免违反客户设定的界限。如果在命令行运行时按下*Enter*，你将得到一个关于运行时间、找到的链接数量以及到目前为止的总下载大小的摘要：
- en: '![](img/B03918_03_03-1.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_03-1.png)'
- en: The status screen is an easy way to see your progress. Pressing Ctrl + C will
    quit the mirror should you decide to end it early.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 状态屏幕是一个简单的方式来查看你的进展。如果你决定提前结束，按下Ctrl + C将退出镜像。
- en: '![](img/B03918_03_04-1.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_04-1.png)'
- en: WebHTTrack's other advantage is that you can interact to skip files live in
    the archival process.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: WebHTTrack的另一个优势是，你可以与存档过程中的文件进行交互以跳过文件。
- en: 'When the archive is complete, you can surf it as if it was the live web by
    visiting the local path in your browser: `file:///tmp/hackthissite/www.hackthissite.org/index.html`.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 当存档完成时，你可以通过在浏览器中访问本地路径来像访问实时网络一样浏览它：`file:///tmp/hackthissite/www.hackthissite.org/index.html`。
- en: 'You''ll see in the following screenshot that we''ve successfully captured the
    dynamic advertising banner content([http://infosecaddicts.com/](_wp_link_placeholder)),
    which may be worth filtering as well:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 你将在下面的截图中看到，我们成功捕获了动态广告横幅内容([http://infosecaddicts.com/](_wp_link_placeholder))，这也值得过滤：
- en: '![](img/B03918_03_05.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_05.png)'
- en: Use theÂ local mirror created by HTTrack to interact with and surf the website,
    which is critical in identifying potential vectors.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 使用HTTrack创建的本地镜像与网站进行交互和浏览，这对于识别潜在的向量至关重要。
- en: Is the mirror complete and up-to-date?
  id: totrans-56
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 镜像是否完整并且是最新的？
- en: There is a plethora of switches out there that I would encourage you to explore,
    but one in particular that I find useful helps to mirror even those places on
    the site that the developer tells Google, Yahoo, and other crawlers to omit.Â 
    `robots.txt` files or meta tags are used to tell browsers to skip archival or
    search scans. They usually do this to avoid allowing something to be searchable,
    which is certainly of interest in a pen test. Appending the `â��s0` option ensures
    we won't miss anything in our scans.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多开关可以让你去探索，但有一个特别有用的开关可以帮助我们镜像网站上开发者告诉Google、Yahoo和其他爬虫忽略的地方。`robots.txt`文件或元标记用于告诉浏览器跳过存档或搜索扫描。他们通常这样做是为了避免允许某些东西被搜索，这在渗透测试中肯定是有趣的。添加`â��s0`选项可以确保我们在扫描中不会漏掉任何东西。
- en: Updating our mirror is a pretty simple process.Â  Assuming you are storing it
    in a non-volatile location (`/tmp` goes away on reboots), you can manually gather
    or even assign a **cron** job to automatically update your mirror's content and
    links. A prompt will ensure that you mean to update the cache; and assuming this
    is the case, it will remove the lock file and perform an update. I would recommend
    exploring archival switches that can allow you to keep older files or perform
    incremental updates to make better use of your time. Some older copies may hold
    content that was removed to cover an inadvertent disclosure, so it is well worth
    hoarding some historical files until they have been scanned.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 更新我们的镜像是一个非常简单的过程。假设你将它存储在一个非易失性位置（`/tmp`在重新启动时会消失），你可以手动收集，甚至分配一个**cron**任务来自动更新你的镜像内容和链接。一个提示将确保你的意思是更新缓存；假设是这样，它将删除锁定文件并执行更新。我建议探索存档开关，可以让你保留旧文件或执行增量更新，以更好地利用你的时间。一些旧的副本可能包含被删除以掩盖无意中披露的内容，因此值得保存一些历史文件，直到它们被扫描。
- en: Note
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Before we leave the HTTrack discussion, it is worth mentioning that tailoring
    your options and settings while practicing on known sites can make your mirroring
    process more efficient and useful. Be sure to take notes and documentÂ your favorite
    alternatives!
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在离开HTTrack讨论之前，值得一提的是，在练习已知网站时，调整你的选项和设置可以使你的镜像过程更加高效和有用。一定要做笔记和记录你喜欢的替代方案！
- en: '![](img/B03918_03_06.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_06.png)'
- en: HTTrack provides intelligent updates, and this saves bandwidth and time. CLI
    options forÂ multiple copies and versions if needed.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: HTTrack提供智能更新，这可以节省带宽和时间。如果需要，还可以使用CLI选项进行多个副本和版本。
- en: Touring the target environment
  id: totrans-63
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 参观目标环境
- en: Local copies allow us to scope out the site in a safe manner, but where do we
    start? Manual hands-on scanning will help us understand the flow and give us some
    hints as to the next steps. I would first recommend getting a feel for the site's
    hierarchy and where various dynamic content portals may reside. Where can users
    log into the applications hosted there, query for information, or provide or view
    feedback? We should also be making note of entity information that we can use
    later to enumerate names, e-mail addresses, and organization information, and
    better understand inter-entity relationships. If we are repurposing this mirror
    for MITM or honeypot duties, we'll want to be able to replicate not only the look
    and feel, but also the workflow.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 本地副本允许我们以安全的方式审查网站，但我们从哪里开始呢？手动的实际扫描将帮助我们了解流程，并给我们一些关于下一步的提示。我首先建议了解网站的层次结构以及各种动态内容门户可能存在的位置。用户可以在哪里登录托管的应用程序，查询信息，或提供/查看反馈？我们还应该记录我们可以在以后用来枚举名称、电子邮件地址和组织信息，并更好地理解实体关系的实体信息。如果我们要重新利用这个镜像进行MITM或蜜罐任务，我们希望能够复制不仅外观和感觉，还有工作流程。
- en: Several tools exist that can assist with these walk-throughs, such as those
    that reveal the underlying HTML and JavaScript elements.Â Viewing the page source
    through the **Developer Tools** in **Firefox**, using a plugin from the **OWASP
    Mantra** add-on bundle, **HackBar**, or another HTML viewer. To save time, I would
    recommend that anything more than initial familiarization with the application
    or website be done with the use of a full proxy toolset such asÂ **Burp** or **Firebug**.
    Using a web application testing suite (covered in the next couple of chapters)
    helps you to efficiently pivot from the Recon stage to activities in the **weaponize**,
    **exploit**, or **install** stages.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: Open source awesomeness
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: The first thing I do before accepting a task or job is to figure out what I
    am up against. It wasn't always this way. As a young engineer working on communications
    systems, I was once asked to lead the development of a specification for a subsystem
    that sounded cool. Woo hoo â�� a time to shine! I committed based on the sales
    pitch that the team lead provided. Reality hit me sometime around the second week
    in the task, as it was only then that I could look up from my keyboard to envision
    the remaining path ahead of me. Had I done that research ahead of my commitment,
    I could have avoided the trouble that was ahead of me. Needless to say, the job
    got done, but I always look back and wonder how much better it could have been
    and how much happier and better rested I would have been had I researched the
    process, constraints, and expectations before accepting the task.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: Penetration testing is no different. While some testers (and black hats, for
    that matter) may accept a job before researching the target, the most experienced
    professionals take a different approach and do their homework. We're all Google
    search experts, but there are ways we can all improve these queries and leverage
    additional tools to complete the picture of what our target looks like. We need
    to take advantage of the many links between search engines, social media, forums
    and boards, and other public domain information. The followingÂ figure shows usÂ how
    raw **Open Source Intelligence** (**OSINT**) comes from many sources, and it can
    be accessed through search engines and Kali's own toolsets alike. An efficient
    use of OSINT helps to better understand *the ask* of a project and can help us
    develop the strategies, uncover vulnerabilities, harvest user information, and
    gain details that can help us map out the infrastructure. We'll take a look at
    a couple of tools that are likely familiar, but we will see if we can unlock some
    more of their potential.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_03_07-2.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
- en: Browsers and Kali's toolsets can help access the massive amount of OSINT available.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: Open source Intel with Google and the Google hacking database
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Search engines are now so integral to our hyper-connected global society that
    it is easy to overlook each engine's strengths and capabilities. Google, Bing,
    and to a lesser degree, Yahoo have dominated the market in the United States,
    but given that our role as a pen tester may cross borders, it is useful to work
    with engines and their localizations to ensure we are getting the most up-to-date
    information.Â  The **Search Engine Colossus** ([https://www.searchenginecolossus.com](https://www.searchenginecolossus.com))
    provides the leading options in each of the countries, including those that are
    embargoed. General information searches, especially those in non-technical realms,
    should include search engines local to the target or their partner organizations.
    Google's search engine, however, provides excellent coverage and extensive syntax
    all its own that can take those general engine findings and use them with great
    efficacy to unearth architectural details, sensitive files, and potential ways
    into our target's servers.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: Tuning your Google search skills
  id: totrans-74
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'There are books written specifically on advancing Google search skills, but
    for web penetration testing, we can focus on some tips and practices that can
    better leverage the engine and eliminate useless search hits, commonly referred
    to as noise. We can use some operators to filter or focus our results, while others
    will perform logical combinations or modify the engine''s behavior. Let''s take
    a look at the most effective modifiers and options, filtering or focusing first,
    followed by logical operators:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: '**The site: operator**: Using the site: operator tells Google''s engine to
    only accept files hosted on a particular domain. When we''re looking for legitimate
    contact information, exposed files, and content, we''ll want to use this operator
    to allow us to focus purely on that domain''s results, rather than on a full dump
    of links in page-hit order that may spamÂ many other sites. Take, for instance,
    a search on Cisco ASA documentation, both before (left) the site: operator and
    after (right):'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/B03918_03_08-1.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
- en: 'The Site: Operator is a great first filter to ensure results focused on your
    target.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: '**TheÂ credentials operators**: Using keywords such as `username`, `password`,
    `userid`, `pwd`, `passcode`, credentials, or any other variant can help us locate
    password or username recovery details. A quick targeted search on these terms
    can not only point you to portal entries you will likely target, but may, in fact,
    provide the keys to unlock them. We''ll discuss using default credentials against
    the results of these queries later in this book:'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![](img/B03918_03_09.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
- en: Credential search may not yield credentials itself, but may point to the next
    best thing â�� recovery!
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: '**The inurl: operator**: An early recon of a target, including lessons learned
    from social engineering, may provide us with clues as to the platform used, developers
    involved, or points of interest in a web application. We can combine the inurl:
    operator with the site: operator to probe those specific points of interest:'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](img/B03918_03_10.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
- en: 'Inurl: can help eliminate thousands of potential locations and focus.'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: '**The file handle (ext:) operator**: Using standard file handles allows us
    to call out and include (or exclude) file extensions of interest. Using typical
    file extensions, you can invoke each of them using the ext: operator. For instance,
    we''d search for all PHP files in [www.hackthissite.org](http://www.hackthissite.org)
    with the word index in the URL using the following string:'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '**The filetype: operator:** If we''re looking for a file type that may not
    be displayed but linked to or archived on a site, we''d instead use the filetype:
    operator. Invoking `filetype:xls` in your search, for instance, would scour your
    search area for Excel spreadsheets:'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '**The intitle: operator**: When we want a specific file, we can use the intitle:
    operator. This is very useful to locate platform-specific configuration files,
    or it can help to expose the `robots.txt` file. As you may recall from our HTTrack
    use, the utility''s default behavior is to avoid spidering the sections of the
    website identified in the `robots.txt` file. This was envisioned to allow web
    developers to preventÂ certain necessary but sensitive locations from being searchable
    by reputable browsers. If other precautions aren''t followed, `robots.txt` can
    provide a hacker with a list of files and folders they may want to see. Well,
    forÂ hackers, there is a good chance that there are some juicy details in there
    that would be very helpful.Â  To see what is in the `robots.txt` files, you can
    simply enter this:'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Each of the preceding operators can help narrow searches alone or in combination,
    but learning more about the processing engine of Google''s search can also help
    us eliminate extraneous information and understand the results. Here are some
    quick tip highlights:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: Using the logical operator **OR**Â is helpful (**AND**Â is assumed). If written
    out, OR must always be all caps to be considered the logical OR, lest it is considered
    part of the search phrase itself. You can also use the **|**Â operator, commonly
    referred to as the **pipe**Â operator.
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Google search will focus on the first 10 non-trivial words of a search phrase.
    UsingÂ *****Â in the place of optional or throw-away words in a search phrase
    won't count against the ten-word limit but effectively extends the phrase for
    more complex searches.
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can use **-**Â before an operator or filter to exclude (negate) the effect
    of that filter or operation. An example might be where we want to determine what,
    other than web servers, a particular domain may be presenting:'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](img/B03918_03_11.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
- en: Using the "-" modifier excludes a filter from the result set.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: 'This is not the same as the keyword **NOT**, which is actually only useful
    to exclude a word from the search but has no effect on the special operators.
    If we were to run the following, it would yield plenty of **www** results, unlike
    the search with **-** used as a modifier:'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](img/B03918_03_12.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
- en: Using the NOT only excludes that string â�� not useful if you don't anticipate
    it.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: Work smarter with the Google hacking DB and Netcraft
  id: totrans-104
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Google search skills will always be useful, but a lot of the most useful strings
    for hackers are captured in the **Google hacking database** (also known as **The
    Exploit DB**), a project hosted by the Offensive Security folks ([https://www.exploit-db.com/google-hacking-database/](https://www.exploit-db.com/google-hacking-database/)).
    While it is fun to browse, the best use of it is to seed your search queries,
    combining the strings they have catalogued with your own modifiers from the previous
    section.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: 'The bulk of their categories are useful for web penetration testing, but I
    would start with the **Web Server Detection** queries:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_03_13.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
- en: The Google Hacking DB is ripe with awesome search queries you can repurpose.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: These queries and others from categories such asÂ **vulnerable servers**, **sensitive
    directories**, and so on, coupled with the `inurl:` and `site:` modifiers can
    prove quite useful in getting a high-level look at the exposure in an environment.
    If you get lucky and unearth credentials or vulnerabilities, this information
    should be disclosed immediately to your sponsoring customer. These searches are
    in use continuously on both sides of the hacking landscape, and this sort of information
    should not wait until the debrief.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: '**Netcraft**, a company based in Bath, England, offers many services, but their
    free web scan tool ([https://searchdns.netcraft.com](https://searchdns.netcraft.com))
    is a great quick-and-dirty scanner that can help focus more detailed efforts.
    You can search on a domain name and burrow down into a report of all of the technologies
    and versions that can be publicly analyzed based on responses to harmless queries.
    A quick search of [https://www.packtpub.com/](https://www.packtpub.com/)Â on their
    site reveals that they have two mail IP addresses currently hosting a Packt platform
    on FreeBSD.Â  What else does the report tell us?'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_03_14.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
- en: Netcraft's online web scanner gives us a great peek at what we have in store
    for future phases.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: We can see that there are two trackers in place (Google and Amazon). XML and
    SSL are in use server-side while JavaScript is in use on the clients, Drupal is
    used both as the **Content Management System** (**CMS**) and PHP scripting engine,
    and HTML5 and CSS sheets are in also use. All of these are useful in refining
    our pen testing approaches.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: Mastering your own domain
  id: totrans-114
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Search engines are easy and accessible, but we also need to understand what
    a network's domain structure, addressing plan, and supporting services are, as
    that perspective is vital to our efforts in probing the application. Domains hosting
    applications can have intricate domain structures that can be exploited. The hosts,
    network IP addresses and blocks, nameservers, and related elements can help identify
    target entities, pivots to adjacent hosts, underlying services and daemons, and
    open ports and protocols that are in use as well. We'll look at some tools that
    incorporate some of these into a larger solution, but mastering **dig**, **fierce**,
    **dnsenum**, **dnsmap**, **WHOIS**, and **DNSRecon** will go a long way toward
    improving accuracy and efficacy.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 搜索引擎易于访问，但我们还需要了解网络的域结构、寻址计划和支持服务，因为这种视角对我们探测应用程序至关重要。托管应用程序的域可能具有复杂的域结构，可以被利用。主机、网络IP地址和块、名称服务器以及相关元素可以帮助识别目标实体、转移到相邻主机、底层服务和守护程序，以及正在使用的开放端口和协议。我们将研究一些工具，这些工具将其中一些工具整合到一个更大的解决方案中，但是精通**dig**、**fierce**、**dnsenum**、**dnsmap**、**WHOIS**和**DNSRecon**将大大提高准确性和效力。
- en: The WHOIS database has been in use since the early days of the Internet, and
    while the intricate service provider and hosting paradigms mean WHOIS rarely contains
    the end user of the domain and their contact information, it is this information
    that can start an investigation. We've all used it in our experience, so we'll
    hop into the next-level tools.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: WHOIS数据库自互联网早期以来就已经在使用，尽管复杂的服务提供商和托管范式意味着WHOIS很少包含域的最终用户及其联系信息，但正是这些信息可以启动调查。我们在经验中都使用过它，因此我们将进入下一级工具。
- en: Digging up the dirt
  id: totrans-117
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 挖掘信息
- en: DNS records provide human-relatable aliases for IP addresses associated with
    the various functions of a domain. I would encourage a good review of DNS operations
    and the associated record types at periodic intervals to ensure you are always
    up to speed on any new trends in DNS use and to jog your memory. It is not uncommon
    to find new applications and protocols borrowing DNS record space for their own
    use. Keeping DNS knowledge fresh ensures you are well prepared to leverage those
    new applications.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: DNS记录为与域的各种功能相关联的IP地址提供了人类可关联的别名。我建议定期对DNS操作和相关记录类型进行全面审查，以确保您始终了解DNS使用中的任何新趋势，并唤起您的记忆。发现新的应用程序和协议借用DNS记录空间是很常见的。保持DNS知识的新鲜确保您能够充分利用这些新应用程序。
- en: The utility `dig` has been a stalwart of the pen testing community for DNS enumeration;
    chances are you've used it and have some favorite switches you like to employ.
    When it comes to web pen testing, we'll be concentrating on the answer field,
    and with the various switches that dig offers, we can use it to map out other
    related record types as well.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 实用程序`dig`一直是DNS枚举的渗透测试社区的中流砥柱；很可能你已经使用过它，并且有一些你喜欢使用的开关。在进行网络渗透测试时，我们将集中在答案字段上，并且利用`dig`提供的各种开关，我们可以使用它来映射其他相关的记录类型。
- en: Digging record types
  id: totrans-120
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 挖掘记录类型
- en: 'Dig can be used to query for and map out the associated record types for **A**,
    **MX**, **NS**, **SOA**, or other records quickly and easily. The default is A
    records, which indicate the domain''s main IPv4 addresses, but you may only want
    to locate the associated name servers (NS records), for instance, to attempt MITM
    attacks. MX records and pointers to the mail servers on a domain can be useful
    in crafting phishing campaigns to target users. If we want to see all of the record
    types associated with a domain, we could use the `ANY` keyword:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '`dig`可以用于快速而轻松地查询和映射与**A**、**MX**、**NS**、**SOA**或其他记录相关的记录类型。默认是A记录，表示域的主要IPv4地址，但您可能只想定位相关的名称服务器（NS记录），例如尝试进行中间人攻击。例如，域的MX记录和指向域上的邮件服务器的指针可以用于制定钓鱼攻击以针对用户。如果我们想查看与域相关的所有记录类型，我们可以使用`ANY`关键字：'
- en: '[PRE10]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](img/B03918_03_15.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_15.png)'
- en: Basic dig output - useful, but could be more succinct.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 基本的`dig`输出-有用，但可以更简洁。
- en: In order to find the mail servers associated with Packt Publishing, we would
    merely enter the MX keyword to filter just those record types.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 为了找到与Packt Publishing相关的邮件服务器，我们只需输入MX关键字来过滤那些记录类型。
- en: 'Each of the subsections in the basic `dig` output can be filtered, either by
    naming the specific section, such as `+nocomments`, `+noquestion`, `+noauthority`,
    `+noadditional`, or `+nostats` for instance. To turn all of these sections off,
    you can use the `+noall` shortcut and then turn on your desired section (for example
    `+answer`) to the end, as follows:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 基本`dig`输出中的每个子部分都可以通过命名特定部分来过滤，例如`+nocomments`，`+noquestion`，`+noauthority`，`+noadditional`或`+nostats`。要关闭所有这些部分，您可以使用`+noall`快捷方式，然后在末尾打开所需的部分（例如`+answer`），如下所示：
- en: '[PRE11]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](img/B03918_03_16.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_16.png)'
- en: The dig output shortened to focus only on records of interest to us
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 将`dig`输出缩短，只关注我们感兴趣的记录
- en: The `+short` modifier can eliminate a lot of superfluous information as well
    and is well worth appending to your standard queries to help shorten outputs.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '`+short`修饰符也可以消除大量多余的信息，并且值得附加到您的标准查询中，以帮助缩短输出。'
- en: '`dig` also offers the ability to do a **zone transfer**, which, if the target
    is not protected against it, allows an attacker to pull down the entire forwarding
    zone of a domain. Something that is only supposed to happen between legitimate
    nameservers on the domain, a successful zone transfer is a windfall to the attacker
    and is something we should always test and look for. To demonstrate a zone transfer,
    we''ll use the wonderful training site Diji Ninja''s own domain ([https://digi.ninja/projects/zonetransferme.php](https://digi.ninja/projects/zonetransferme.php))
    and type this:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '`dig`还提供了执行**区域传输**的能力，如果目标没有受到保护，允许攻击者下载域的整个转发区域。这只应该发生在域上的合法域名服务器之间，成功的区域传输对攻击者来说是一笔意外之财，我们应该始终测试和寻找。为了演示区域传输，我们将使用出色的培训网站Diji
    Ninja自己的域名（[https://digi.ninja/projects/zonetransferme.php](https://digi.ninja/projects/zonetransferme.php)）并输入以下内容：'
- en: '[PRE12]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](img/B03918_03_17.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
- en: Conducting a zone transfer is quite a coup, when it works.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: '`dig` offers a clean and easy toolset, but often, the target environment is
    larger than what `dig` can present on well, or we are looking for more in-depth
    results. This is where `dnsrecon` comes in. I would recommend repeating the same
    sorts of exercises with `dnsrecon` to see how it compares with dig and help you
    determine which tool is to be your primary effort.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: Getting fierce
  id: totrans-136
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: '`dig` and `dnsrecon` are fantastic tools, but wouldn''t it be nice if we could
    go a little further and have a tool that tries to connect to the site''s address
    blocks, automates the zone transfer, and does it all while logging? **Fierce**
    (written in Perl by Robert *RSnake* Hansen) can do just that. There are many options
    and modifiers that can be used when invoking Fierce, but in most cases, I do initial
    discovery using dig, move to Fierce for an attempted zone transfer and some connection
    probing, and then move into a more graphical and organized tool such as Maltego
    to build my network maps and enumerate relationships. To use Fierce to attempt
    a zone transfer and send the logs to a file, you can simply invoke the tool and
    it will do so automatically:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Because this site allows zone transfers, I''ll see the results in the running
    output and the `txt` file I designated:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_03_18.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
- en: Fierce automates what it takes several dig or dnsrecon queries to do.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: 'Fierce also allows you to attempt to connect to open ports on any public IPs
    using the `â��connect` switch. You''ll need to provide `wordlist` so that Fierce
    has some potential credentials to try, and you''ll want to run this on a dedicated
    machine or overnight, as the process can be lengthy, depending on the size of
    the domain. We can kick this off using the following:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Next steps with Nikto
  id: totrans-144
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Once we have a full array of DNS records and other relevant intelligence, we
    typically shift into scanning for vulnerabilities (also known as **vulns**). **Nikto**
    is my preferred scanner and I'll usually keep these results for tuning tools that
    scan vulnerabilities but also pivot into later phases. Nikto exports into several
    file types, including HTML, XML, TXT, and CSV, and using it begins the active
    recon phase.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Because it is an active tool, its use constitutes a legally provoking act, and
    as such, it is advised to only use it in practice against lab machines and for
    systems where you have explicit permission to test. I don't have enough collateral
    for posting bail on your behalf.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: 'To use Nikto, we''ll need to identify the host or host list (the latter defined
    in a host file) and a location for our output logs, but there is an extensive
    list of menu items worth considering to tailor our scans. Besides the output file
    and logging parameters, there are actually predefined tunings that are available
    to run some common, best-practice test sets against the specified hosts. These
    options are a great shortcut to making the best use of Nikto in your scans, and
    are detailed in the main page:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'A default scan will run all tests, but if there are restrictions as to what
    is permitted, these tunings can help keep the test compliant. When you require
    anonymity, it may also be desired to leverage an intentional proxy (either one
    you have established or one of many free ones (for example those on [http://proxy-list.org](http://proxy-list.org)),
    or better yet, a host you''ve already compromised for the purpose). To do so,
    you would specify the proxy server in `config.txt` (or an explicitly called alternative)
    using your favorite editor. **Nano** is my first choice, but **vim** or **emacs**
    works just fine:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Scroll down to the **`P`****`roxy settings`** section and enter the appropriate
    details:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'We can then launch our scans using the configured proxy as follows:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![](img/B03918_03_19.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
- en: Nikto is a versatile and powerful scanner - practice in a closed environment
    makes a huge difference.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: As with any tool, it is sometimes important to realize which switches to avoid.
    For black-box testing (pen testing with a more realistic covert charter, where
    the tester tries to emulate an attacker and is provided with no advantageous access),
    it is essential to avoid options that cause excessive queries and chatty scans,
    and most of the time the `+mutate` switch is not worth the trouble. If you are
    white-box testing (known to the operators, not focused on stealth, and just exploring
    in the open), then it can make sense to provide greater coverage.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
- en: Employing Maltego to organize
  id: totrans-159
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Maltego** is one of my favorite recon tools in that it helps visualize the
    many links and relationships between disparate data sources. *Jason Beltrame*
    and I covered it in the *Penetration Testing with Raspberry Pi â�� Second Edition*
    ([https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition](https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition)),
    but since then, I have begun to use it in use cases I could not have imagined.
    As fun as it has been to plunge into this, there are certainly some best-practices
    that have assisted in avoiding information overload. The most recent version available
    in Kali''s distribution, 4.0.11, includes new footprinting techniques such as
    **Company Stalker**, **Find Wikipedia Edits**, **Twitter Digger**, and **Monitor**.
    All of the transforms can be of use in web pen testing, but these new social-focused
    starting points stress the move by **Paterva** to make Maltego indispensable to
    all hacking communities.'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: 'I tend toward using it as a graphical documentation of information gleaned
    from social engineering, LinkedIn/email searches, and pinning them on domains.
    The ability to pivot and transform against an entity has even helped me to uncover
    multiple domains across multiple hosting companies that through two or three layers
    of obfuscation are actually run by the same network of scammers. Recursion through
    transforms can help find additional users that may have local accounts or indicate
    relatives or friends whose names and information could populate our dictionaries.
    A quick example would be to do a Company Stalker machine against Packt Publishing''s
    web domain:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_03_20.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
- en: This Maltego graph is zoomed out to protect the innocent, but also to show the
    relational nature of information it tracks.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, there are several documents found in the base machine's process
    (orange dots) and each of those files has associated metadata, such as people
    (green), certificates (yellow), and locations (red). If we burrow down into a
    person, we can ask for transforms that search for all potential email addresses
    (blue). I find Maltego to be very helpful when you provide it with additional
    seed information from other OSINT sources to help focus, or nudge the model towards
    linking the original machine and other information. You can add any form of identity,
    but additional web domains or e-mail addresses, social networking usernames, or
    IP blocks and interfaces can greatly improve the fidelity and usefulness of Maltego
    graphs.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: Being social with your target
  id: totrans-165
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: 'If you are not using **Social-Engineer Toolkit** (**SET**, [https://www.trustedsec.com/social-engineer-toolkit/](https://www.trustedsec.com/social-engineer-toolkit/)),
    you are missing out on something important. We can certainly use it to spoof Google,
    Facebook, and Twitter to attract victims and launch attacks or scrape their credentials,
    but we can also use it in spoofing our target web application so as to hijack
    sessions and map user behaviors. As victims unknowingly browse these duplicate
    websites from the comfort of a coffee shop chair, attackers can gather the victims''
    passwords or even inject a command shell that gives them full access to the victims''
    systems. It is a great tool for security professionals to demonstrate how users
    more often than not will not pay attention to the location where they enter sensitive
    information as long as the page looks legit. Let''s take a look at how to use
    SET against the mirror that we pulled down from [www.hackthissite.org.](http://www.hackthissite.org.)
    Here is a diagram we can use to help envision what this attack looks like:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_03_21-2.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
- en: SET can be used for many attacks, but who doesn't like a classic MITM?
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: 'My typical use for SET is to select option **`1) Social Engineering Attacks`**,
    then select **`2) Website Attack Vectors`**. What I''m looking for is in **`3)
    Credential Harvester Attack Method`**, so we can grab our poor target users''
    login credentials. We can use the built-in templates or import custom sites (useful
    for corporate portals or lesser-used web applications); but why wouldn''t we want
    to just use the mirror we already captured? We''ll choose option **`3) Custom
    Import`**. This will turn our Kali Linux VM into a malicious front-end for [www.hackthissite.org](http://www.hackthissite.org),
    presenting itself as the real deal and scraping credentials or any other HTML-based
    information fields:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: '`**`![](img/B03918_03_22.png)`**'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: SET configuration using a previous mirror - modify and tweak to make it even
    more convincing.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: A quick check of our mirror shows it is now up-and-running; our task now is
    to persuade users to direct their initial sessions to here.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_03_23.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
- en: A quick check pointing to my copy of the site shows our MITM clone is ready
    to roll.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: Entering some credentials in the **`Login`** fields and submitting them, I can
    see that they are captured live and recorded in a log file.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_03_24.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
- en: Any HTTP messages that arriveÂ are captured, so credentials or personal information
    is ours to own.`  `## Summary
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
- en: As I mentioned in the beginning of this chapter, the recon phase can make or
    break the subsequent phases. The information gathering will feed your cracking
    and fuzzing operations, narrowing search fields to something significantly more
    manageable. The work saved in focusing the testing translates into tighter test
    criteria, more successful testing approaches, less churn and trial and error,
    and much more salient reports. Customers often learn as much about what we find
    in this phase as they will in the remaining phases, and this brings up a crucial
    point. The quality and quantity of information available online about their systems
    and the people using them can have dramatic consequences in the future. Proactive
    actions to limit or reduce this exposure improves their security posture and should
    be both encouraged and coached.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we explored some deeper uses of the most popular OSINT gathering
    tools. We saw how we can quickly map the various network and domain components
    in a web application's hosting architecture, and even began to scan that infrastructure
    with tighter command line options that yield more succinct and useful data than
    the defaults. We also delved into better uses of search engines and leveraged
    some popular online resources that have documented some truly scary query strings.
    Social engineering in many forms were discussed, and we built our own MITM attack
    to capture credentials based on our mirrored website. Wrapping up, we looked at
    how Maltego begins to unravel the target environment's layers and aid in visualizing
    our adversary.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, you'll learn how to crawl web applications more effectively
    for quick scans using the Arachni framework. As an intercepting proxy to interact
    with the conversation between the server and client, we'll see how Arachni can
    go further to automate some attacks to provide additional test vectors, launch
    scans, trace flows on DOM, and JavaScript environments. As a bonus, you'll learn
    to use Arachni to mimic mobile platforms and even produce higher quality reports,
    either as stand-alone or as the basis for a multi-tool pen test deliverable. The
    work in this chapter is about to pay off, folks!`
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
