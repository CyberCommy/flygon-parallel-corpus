- en: Chapter 2. Setting Up Your Machine with Kali Linux
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following topics to set up your laptop for
    wireless penetration testing:'
  prefs: []
  type: TYPE_NORMAL
- en: Introduction to the Kali Linux distribution
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing Kali Linux
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Wireless adapter setup and configuration
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction to the Kali Linux distribution
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Kali Linux is the most popular and used distribution for penetration testing
    and security auditing. It is developed and maintained by Offensive Security and
    it replaces Backtrack Linux being the first release of Kali Linux, the successor
    of Backtrack 5 release 3.
  prefs: []
  type: TYPE_NORMAL
- en: Kali Linux has been completely re-built and now it is based on Debian. It includes
    a wide range of tools for reconnaissance and information gathering, sniffing,
    and spoofing, vulnerability assessment, password cracking, exploitation, reverse
    engineering, hardware hacking, forensics investigation, incident handling, and
    reporting. For wireless penetration testing, there is a dedicated set (the `kali-linux-wireless`
    metapackage) of the most known open source tools, such as the Aircrack-ng suite,
    Kismet, Fern Wifi Cracker, Wifite, and Reaver, among others.
  prefs: []
  type: TYPE_NORMAL
- en: In this book, we will mainly use the Aircrack-ng suite, developed by Thomas
    d'Otreppe, because it is the most complete and popular set of tools for auditing
    wireless networks. More information about the Aircrack-ng project is available
    on its website, [http://www.aircrack-ng.org/](http://www.aircrack-ng.org/), which
    is often referenced in this book. Furthermore, Kali Linux supports a large variety
    of wireless adapters and its kernel is constantly updated with the latest wireless
    injection patches.
  prefs: []
  type: TYPE_NORMAL
- en: For all these reasons, Kali Linux is the optimal choice for our purposes. The
    next section demonstrates how to install it on our laptops.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Kali Linux
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are three methods to install Kali Linux, on the hard disk (on the single
    boot or multiboot), on a USB thumb drive to use it as a live system, or on a virtual
    machine using software such as Oracle VirtualBox and VMware Workstation or Player.
  prefs: []
  type: TYPE_NORMAL
- en: The installation requires at least 10 GB of hard disk space and at least 1,024
    MB of RAM is recommended, although Kali Linux can run over only 512 MB of RAM.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Kali Linux on the hard drive is better regarding the performances
    but it has the drawback of dedicating all the hard disk space to it or partitioning
    the hard drive and using a partition to install it, while the installation on
    a virtual machine provides us a lightly slower system but also much more flexibility
    and we don't have to modify the configuration of the hard disk.
  prefs: []
  type: TYPE_NORMAL
- en: We can either install Kali Linux on a virtual machine with the downloadable
    ISO or directly use the VMware or VirtualBox prebuilt images. The 32 or 64 bits
    ISOs can be downloaded from [https://www.kali.org/downloads/](https://www.kali.org/downloads/),
    and the VMware and VirtualBox images can be downloaded from [https://www.offensive-security.com/kali-linux-vmware-arm-image-download/](https://www.offensive-security.com/kali-linux-vmware-arm-image-download/).
    It is interesting to notice that Kali Linux can also be installed on ARM devices,
    such as the Raspberry Pi and similar.
  prefs: []
  type: TYPE_NORMAL
- en: The rest of this chapter is concerned with the installation and configuration
    of Kali Linux on a virtual machine, a process that is very similar to installing
    it on the hard disk directly.
  prefs: []
  type: TYPE_NORMAL
- en: Installation on a virtual machine
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To create a new virtual machine and install Kali Linux on it, we need to use
    the virtualization software.
  prefs: []
  type: TYPE_NORMAL
- en: In this book, we will use Oracle VirtualBox, which is a free and open source
    virtualization software available for various platforms, such as Windows, Linux,
    Mac OS X, and Solaris. To download and get information on how to install it, take
    a look at the references in the [Appendix](apa.html "Appendix A. References"),
    *References*.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a new virtual machine
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To create a new virtual machine (VM), follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Click on the **New** button on the toolbar menu and the wizard will start. We
    assign the VM a name and select the operating system type and version, which,
    in our case, are Linux and Debian respectively (the architecture, 32 or 64 bit,
    depends on your machine):![Creating a new virtual machine](img/B04527_02_01.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We assign the amount of RAM dedicated to the VM; here the recommended size is
    512 MB but for our purposes at least 1,024 MB would be a better choice:![Creating
    a new virtual machine](img/B04527_02_02.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Then, we have to create a new virtual hard disk for our installation:![Creating
    a new virtual machine](img/B04527_02_03.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We choose **VDI (VirtualBox Disk Image)** as the virtual disk format:![Creating
    a new virtual machine](img/B04527_02_04.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We select the **Dynamically allocated** option, which only uses the space on
    the physical drive as the virtual disk file grows, up to the fixed maximum size:![Creating
    a new virtual machine](img/B04527_02_05.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We set up the virtual disk file location and the maximum size; then we click
    on the **Create** button and the VM is ready!![Creating a new virtual machine](img/B04527_02_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Installation steps
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'At this point, the virtual machine is created and we are ready to install the
    Kali Linux operating system on it. To do so, we follow the subsequent steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'We select the newly created Kali Linux VM in the left pane of the Oracle VM
    VirtualBox Manager, and next, we click on **Settings** on the toolbar menu and
    then on **Storage**. We select the **Controller: IDE** entry associated with the
    **CD/DVD Drive** field, and in the **Attributes** section, we choose the Kali
    Linux ISO on the hard drive. This is analogous to inserting a Kali Linux installation
    DVD in the physical drive when installing it on the hard disk directly, so that
    the machine can boot from it:![Installation steps](img/B04527_02_07.jpg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, we start the VM clicking on the **Start** button on the toolbar menu. The
    VM boots from the ISO and the installation boot menu is shown in the following
    screenshot:![Installation steps](img/B04527_02_08.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We follow the steps of the installation wizard, selecting in succession the
    language (default is English), the country, the locale setting, the keyboard layout,
    the hostname, and the domain name. Then, we need to set up the password of the
    root account. Root is the default and the most privileged account in the system,
    which has the full administrative rights:![Installation steps](img/B04527_02_09.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We select the time zone and then we need to choose the disk partitioning method.
    We can choose the guided methods (using three different schemes) or the manual
    one if we desire to partition the disk. In our case, we are going to select the
    first method and use the entire virtual disk associated with the VM:![Installation
    steps](img/B04527_02_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Then, the installer asks which disk to use for installing the system (in our
    case, it is unique), and in the following window, whether we want to use a single
    partition or create separate partitions for different mount points (for example,
    `/home`, `/usr/local`, `/opt`, and so on):![Installation steps](img/B04527_02_11.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The installer creates the root (`/`) and the swap partitions and asks to confirm
    it, writing the changes on the virtual disk:![Installation steps](img/B04527_02_12.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After all the data is copied to the disk, the installer asks whether we want
    to use a network mirror to install the software that is not included in the installation
    ISO or to update the installed software. Then, we need to choose whether or not
    to install the GRUB boot loader on the **Master Boot Record** (**MBR**) of the
    virtual disk. We are going to install it:![Installation steps](img/B04527_02_13.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: One step more and the installation is complete. Now we have a brand new Kali
    Linux system on our VM! We can restart the VM to boot it up, after having removed
    the installation ISO from the virtual CD/DVD drive:![Installation steps](img/B04527_02_14.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Wireless adapter setup and configuration
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that we have installed Kali Linux on our VM, it is time to talk about the
    wireless adapter configuration. However, first let's take a look at its requirements.
  prefs: []
  type: TYPE_NORMAL
- en: Requirements of the wireless adapter
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The main requirements that a wireless adapter must meet to be suitable for
    wireless penetration testing are:'
  prefs: []
  type: TYPE_NORMAL
- en: Compatibility with the IEEE 802.11b/g/n Wi-Fi standards and possibly also with
    802.11a, which operates on the 5 GHz band (dual-band support).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The capability to put the card in the so-called *monitor mode*, which allows
    to sniff all the wireless traffic. The monitor mode is equivalent to the promiscuous
    mode in wired networks.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The capability to support *packet injection* to actively inject traffic into
    the network.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To verify that our Wi-Fi adapter satisfies these requirements, we first need
    to determine its chipset and verify that its Linux drivers support both monitor
    mode and packet injection. We will see how to practically test whether our adapter
    meets these requirements later in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Verifying the adapter chipset compatibility**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Great resources to determine the chipset and verify its compatibility are the
    *Tutorial: Is My Wireless Card Compatible?* and the *Compatibility_drivers* sections
    on the Aircrack-ng documentation wiki (see the reference section of *Chapter 2*,
    *Setting Up Your Machine with Kali Linux*, in [Appendix](apa.html "Appendix A. References"),
    *References*).'
  prefs: []
  type: TYPE_NORMAL
- en: They provide a detailed list of chipsets and their levels of support for wireless
    penetration testing.
  prefs: []
  type: TYPE_NORMAL
- en: If our laptop isn't very old, it is almost certainly equipped with an internal
    Wi-Fi card. Internal cards are usually not the best choice for wireless penetration
    testing because most of their chipsets are not supported on Kali Linux for this
    purpose. Moreover, we can't use an internal card within a virtual machine because
    we need direct access to the device for it to work and virtual machines allow
    direct access to USB devices only. Thus, if Kali Linux is running on a virtual
    machine, we can only use USB wireless adapters.
  prefs: []
  type: TYPE_NORMAL
- en: For these reasons, the recommended choice is to use an USB wireless adapter
    with an external high-gain antenna, which has more transmit power and sensitivity
    than integrated antennas and thus allows long range signal receiving and transmitting.
  prefs: []
  type: TYPE_NORMAL
- en: An adapter that has these features, is well supported by Kali Linux, is cheap,
    and therefore very popular among wireless penetration testers is the Alfa Networks
    AWUS036NH USB card. This card has a Ralink chipset. Other chipsets that are well
    supported under Linux are the Atheros and the Realtek RTL8187L chipsets.
  prefs: []
  type: TYPE_NORMAL
- en: Through the rest of the book, we will assume that you are using an USB wireless
    adapter.
  prefs: []
  type: TYPE_NORMAL
- en: Wireless card configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After connecting our adapter to the USB port, we have to configure it to be
    used within our virtual machine with Kali Linux installed.
  prefs: []
  type: TYPE_NORMAL
- en: We start the VirtualBox VM Manager, select our Kali Linux VM on the left pane,
    and navigate to **Settings** | **USB**. First, we should enable the USB 2.0 controller,
    if we haven't enabled it already. This requires having the VirtualBox Extension
    Pack installed (for more information, see the *Installing the VirtualBox Extension
    Pack* information box).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We click on the add a new USB device filter (the green plus icon) on the right
    and select the device that corresponds to our wireless adapter:![Wireless card
    configuration](img/B04527_02_15.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Installing the VirtualBox Extension Pack**'
  prefs: []
  type: TYPE_NORMAL
- en: We can download the Extension Pack from [https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads)
    selecting the appropriate file according to the installed VirtualBox version.
  prefs: []
  type: TYPE_NORMAL
- en: Information about the VirtualBox Extension Pack and how to install it is available
    at [https://www.virtualbox.org/manual/ch01.html#intro-installing](https://www.virtualbox.org/manual/ch01.html#intro-installing).
  prefs: []
  type: TYPE_NORMAL
- en: We start our VM that should now be able to use our wireless adapter via its
    USB pass-through capability. After the Kali Linux within the VM has booted, we
    log in to the system as root and open the terminal emulator. We type the `iwconfig`
    command to list all the wireless interfaces available on our system:![Wireless
    card configuration](img/B04527_02_16.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The system has assigned our adapter the `wlan0` interface, but it is still
    not active, as we can see from the `ifconfig` output:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Wireless card configuration](img/B04527_02_17.jpg)'
  prefs: []
  type: TYPE_IMG
- en: To bring the `wlan0` interface up, we execute the `ifconfig wlan0 up` command
    and then `ifconfig` to verify that it has been activated. Now, our wireless interface
    is up and running, as we can notice in the following screenshot:![Wireless card
    configuration](img/B04527_02_18.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Testing the adapter for wireless penetration testing
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now that we have set up the adapter, we can run a little test to verify that
    it is really suitable for wireless penetration testing, that is, it can be put
    in monitor mode and it supports packet injection. To do so, we use two programs
    from the Aircrack-ng suite that will also be extensively used through the rest
    of the book.
  prefs: []
  type: TYPE_NORMAL
- en: First, we execute `airmon-ng start wlan0` to put the interface in monitor mode.
  prefs: []
  type: TYPE_NORMAL
- en: If the command completes successfully and the monitor mode is enabled on the
    newly created interface `mon0`, it means that it has passed this test!
  prefs: []
  type: TYPE_NORMAL
- en: '![Testing the adapter for wireless penetration testing](img/B04527_02_19.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, we run the `aireplay-ng -9 wlan0` command, where the `-9` option means
    that it is an injection test (the full form is `--test`):'
  prefs: []
  type: TYPE_NORMAL
- en: '![Testing the adapter for wireless penetration testing](img/B04527_02_20.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Aireplay-ng is a tool designed to generate and inject frames and we will use
    it to conduct many of the attacks that we will cover in the book.
  prefs: []
  type: TYPE_NORMAL
- en: If the `Injection is working!` string appears in the output, then the test is
    successful and our adapter supports packet injection!
  prefs: []
  type: TYPE_NORMAL
- en: The test provides other valuable information as well; it tells us the channel
    that the wireless interface is using and the access points that it found through
    responses to the broadcast probes or received beacons and the relative connection
    qualities (we will treat these topics in [Chapter 3](ch03.html "Chapter 3. WLAN
    Reconnaissance"), *WLAN Reconnaissance*).
  prefs: []
  type: TYPE_NORMAL
- en: More information about the injection test can be found at [http://www.aircrack-ng.org/doku.php?id=injection_test](http://www.aircrack-ng.org/doku.php?id=injection_test).
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As we have seen, the Kali Linux distribution supports a wide range of wireless
    adapters and we should not have any problems in configuring our wireless adapter.
  prefs: []
  type: TYPE_NORMAL
- en: However, sometimes our adapter does not show up on the `iwconfig` output. In
    this case, we could check the output of the `lsusb` or `lspci` tools (depending
    on the interface type) to see if the device has been detected by the operating
    system and the output of `dmesg` to check whether the relative drivers have been
    loaded correctly.
  prefs: []
  type: TYPE_NORMAL
- en: 'At other times, it could happen that the wireless adapter is recognized but
    the `ifconfig wlan0 up` command fails to bring the interface up, with the error
    message `''SIOCSIFFLAGS : No such file or directory''`. This error usually indicates
    that the driver could not load the adapter firmware because it is missing or not
    correctly installed.'
  prefs: []
  type: TYPE_NORMAL
- en: We can solve this issue by installing the correct firmware that could be identified
    on the documentation of the adapter driver.
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, to install the firmware package for a Ralink chipset adapter,
    we execute the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: For more detailed information about wireless adapter configuration troubleshooting,
    some useful references can be found in [Appendix](apa.html "Appendix A. References"),
    *References*.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we have seen how to create a virtual machine using Virtual
    Box and how to install Kali Linux on it. After covering the wireless adapter's
    requirements for wireless penetration testing, we have configured the USB wireless
    adapter to work with Kali Linux and tested it for the requirements that we analyzed
    earlier.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we are going to cover the wireless penetration testing's
    discovery and information gathering phase.
  prefs: []
  type: TYPE_NORMAL
