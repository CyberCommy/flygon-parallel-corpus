- en: Chapter 4. Scanning for Vulnerabilities with Arachni
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第4章。使用Arachni扫描漏洞
- en: 'Web application vulnerability scanners are big businesses. A quick research
    into alternatives will show you that there are literally hundreds of open source
    and commercial scanners, and all of them offer varying coverage of the vuln space
    as well as functions that extend into the different phases of the Pen Test Kill
    chain. As is the case with any trend in security, this explosion in the market
    is a symptom of something else entirely: web applications are, by their very nature,
    easy to access and popular for hackers to exploit. The payoff for a successful
    breach or compromise is massive.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Web应用程序漏洞扫描器是一个大生意。 快速研究替代方案将告诉你，有数百种开源和商业扫描器，它们提供不同程度的漏洞覆盖，并且具有延伸到渗透测试Kill链的不同阶段的功能。
    与安全领域的任何趋势一样，市场的爆炸是完全不同的东西的症状：Web应用程序本质上易于访问，也是黑客利用的热门目标。 成功入侵或妥协的回报是巨大的。
- en: Most major companies involved in cyber security solutions publish annual reports
    that summarize the past year's events and make predictions of the expected trends
    that will shape the business in the years to come. Verizon, Dell, Cisco, FireEye,
    Symantec, and HP are just some of the more anticipated releases each year. While
    they do not usually deal in technical details and **Tactics,** the **Techniques
    and Procedures** (**TTPs**) of specific threats, they do help shedÂ the light
    on prevailing threat areas, high-level delivery modes, and the perceived motivation
    for any of these changes. A consensus of reports in 2016 and 2017 has noted the
    shift on the part of attackers towards the exploits of user browsers and plugins,
    as well as the advent of *malvertizing*, embedded ads, and frames that contain
    malware or link to sites that do.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 参与网络安全解决方案的大公司都会发布年度报告，总结过去一年的事件，并预测未来几年将塑造业务的预期趋势。 Verizon、戴尔、思科、FireEye、赛门铁克和惠普只是每年更受期待的发布之一。
    虽然它们通常不涉及特定威胁的技术细节和**战术**，但它们确实有助于阐明当前的威胁领域、高级交付模式以及对任何这些变化的感知动机。 2016年和2017年的多份报告一致指出，攻击者转向利用用户浏览器和插件的漏洞，以及*恶意广告*、嵌入式广告和包含恶意软件或链接到恶意网站的框架。
- en: 'These trends point to a couple of things. Firstly, users and by extension their
    end-user devices (mobile, laptop, home) are the weakest link in our security story.
    Second, as the same users demand access anytime and anywhere, it becomes difficult
    to secure the elastic perimeter, as there is no longer a perimeter to defend but
    a very fluid environment. Hackers, by their very nature, are going to exploit
    the trust we all put in these new shifts in behavior and corresponding weaknesses;
    hacking the enterprise is more involved and delicate at this point in time, so
    depending on their motivation, the get-rich-quick set is going to shift to the
    path of least resistance: web applications and the application-client paradigm.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 这些趋势指向了一些事情。 首先，用户及其终端设备（移动设备、笔记本电脑、家庭设备）是我们安全故事中最薄弱的环节。 其次，随着同一用户要求随时随地访问，保护弹性边界变得困难，因为不再有需要防御的边界，而是一个非常灵活的环境。
    黑客本质上会利用我们对这些新行为转变和相应弱点的信任；此时黑客企图入侵企业更加复杂和微妙，因此根据他们的动机，寻求快速致富的人会转向最易攻击的路径：Web应用程序和应用-客户端范式。
- en: So, what are our customers doing in response? They are starting to purchase
    tools that can help them begin to secure their environment, but only if they are
    wielded correctly. In Kali Linux, we have some fantastic, well-regarded scanners
    that we can use to help our customers better understand their exposure to vulnerabilities
    and better understand their architecture. While we have some great options, it
    is helpful to mix them to ensure that we are covering vectors with multiple tools
    that can complement each other and reduce our blind spots. One of the best such
    tools, and one I am sure you have used in the past if you have conducted web application
    vulnerability scans, is **Arachni**.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，我们的客户做出了什么样的回应？ 他们开始购买可以帮助他们开始保护其环境的工具，但前提是这些工具必须被正确使用。 在Kali Linux中，我们有一些出色的、备受推崇的扫描器，可以帮助我们的客户更好地了解他们面临的漏洞和更好地了解他们的架构。
    虽然我们有一些很好的选择，但混合它们以确保我们覆盖多个工具的矢量是有帮助的，这些工具可以相互补充，减少我们的盲点。 其中一个最好的工具，我相信你过去使用过，如果你进行过Web应用程序漏洞扫描，那就是**Arachni**。
- en: 'In this chapter, we''re going to see how we can use Arachni for the following:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将看到如何使用Arachni来实现以下目标：
- en: Crawling web applications effectively for quick initial scans
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有效地爬行Web应用程序进行快速初始扫描
- en: Using active scanning techniques to probe further and uncover more vectors
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用主动扫描技术进一步探测并发现更多矢量
- en: Launching scans and trace flows on DOM and JavaScript environments
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在DOM和JavaScript环境中启动扫描和跟踪流
- en: Mimicking browser constraints of mobile platforms
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模仿移动平台的浏览器约束
- en: Producing high-quality reports, either as a standalone or as the basis for a
    multi-tool pen test deliverable
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 生成高质量的报告，可以作为独立报告或多工具渗透测试交付的基础
- en: Walking intoÂ spider webs
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 走进蜘蛛网
- en: '* * *'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Arachni is an open source scanner that focuses on the recon phase of our penetration
    testing in a different manner than any other tool out there. If you've used Arachni
    without paying attention to what makes it different (just like me), then you may
    find that changing your workflow will greatly improve results. The creator of
    the tool, *Tasos Laskos*, developed the tool to address a couple of opposed goals.
    First, scans can take an excessive amount of time (many hours to even weeks),
    and this makes these scans less than helpful. The time is lost and makes testing
    a more drawn-out process. Second, more data and coverage is a good thing, as it
    enhances accuracy, but it also adds additional time to the test process to complete
    the necessary transactions.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: Laskos developed Arachni to reduce the amount of time for a scan while allowing
    the tool to scale such that it is able to process more test vectors efficiently.
    Its timing was improved by employing asynchronous HTTP requests to do the tool's
    bidding and by allowing Arachni to scale across a cluster of systems so that they
    are all processing in parallel. The accuracy goal was enhanced by open sourcing
    the tool and using a Ruby framework that can allow anyone to add new or better
    optimized tests to the tool. The timing, accuracy, and coverage of the testing
    are further improved by machine learning techniques that allow the scanner to
    hone testing vectors used through the results from earlier vectors in the test
    battery. Together, these enhancements make Arachni a formidable scan tool that
    we will explore more deeply for improved testing efficacy and timing.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: Optimal Arachni deployment tips
  id: totrans-15
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When we are just practicing with Arachni, we would likely invoke a single serverÂ 
    and client hosted on the same Kali Box. The **Web UI Client** executable should
    be running to ensure that Arachni is being operated in the same manner as it would
    be in a real testing scenario. A command-line option is available, but it tends
    to be limited in scale and works best in single-server deployments.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: 'The Arachni high-level architecture can be seenÂ here:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_01-1.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
- en: Arachni's architecture is its secret sauce â�� it helps with scale and speed
    alike.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: The brain of the operation here is the **Web UI Client** (**arachni_web**).
    It provides the single point of contact that will contact its grid of **Dispatch
    Servers** (**dispatchers**) with initial scan requests. The dispatchers then spawns
    a new **instance** on theÂ **server**.Â  At this point, the Web UI Client will
    be able to communicate directly with the spawned Instance to configure it for
    the appropriate scanning jobs. When an instance is done with its task, The Web
    UI client pulls the data and stores it, while the instance simply goes away, returning
    the resources it consumed to the operating system for future instances or other
    software tasks altogether.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: As we move into production testing, we can scale the deployment to take advantage
    ofÂ additional resources on other servers in our grid, and this will not only
    allow us to run multiple scans, but also accommodate teams of users while consolidating
    the data gathered in a central database on the Web UI Client. **SQLite3** is the
    default option, but if you will ever turn this installation into a grid or large-scale
    installation, it is highly recommended you start with PostgreSQL instead. The
    documentation for how to do this is located here:Â [https://github.com/Arachni/arachni-ui-web/wiki/database](https://github.com/Arachni/arachni-ui-web/wiki/database).
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once you have selected one database or the other, you are locked in; and changing
    your mind means losing all of your prior data. It is worth the effort to build
    out the PostgreSQL environment up front if you think it will go that way.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: Arachni differs from other black-box **Dynamic Application Security Test** (**DAST**)
    scanners, in that it makes heavy use of asynchronous HTTP to conduct its scans.
    This allows each Instance to send HTTP requests to targets in parallel. Because
    you can have multiple scans in progress at the same time, it greatly improves
    the speed with which we can go from initiationÂ to completion. Most scanners spend
    considerable time waiting on scan threads to finish. This is made moreÂ egregiousÂ given
    that these scanners often run a set array of scans and do not tailor their scan
    list on-the-fly like Arachni.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: The number of instances that can be supported is really going to depend on the
    number of servers available, their resource availability, and the bandwidth available
    outbound to initiate scans. I would caution that if you are worried about bandwidth,
    it is likely that the generated traffic exceeds non-trivial amounts and should
    be throttled down to avoid impairing the application's performance for real users
    or alerting the security operations folks. Nothing says *I'm here to damage your
    application*Â like a **Distributed Denial of Service** (**DDoS**) attack from
    your application scanner. As they say, with great power comes great responsibility!
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: An encore for stacks and frameworks
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: Our first step in any active recon could very well just be to attempt a scan,
    but it's a good idea before taking on any job or task to simply browse to the
    site's main page first. Using browser plugins such asÂ **Wappalyzer** ([https://wappalyzer.com](https://wappalyzer.com)),
    we can easily see an initial footprint of the website and discover the platform
    or framework a web application is built on (as discussed in [Chapter 1](000.html#)*,
    Common Web Applications and Architectures)*. We'll start our detailed Arachni
    best practices using the **Damn Vulnerable Web Application** (**DVWA**), so let's
    see what the browser and Wappalyzer can tell us before we dive into a scan!
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: As seen in following screenshot, DVWA is apparently running on a Linux operating
    system, employs Apache as the web server, MySQL as the database, and a mix of
    scripting languages are employed (Python, Perl, Ruby, and PHP). This very much
    looks like your typical **LAMP** stack, and we'll craft a scan that realizes these
    details and helps to narrow the scan time. Other traditional stacks hosted on
    Windows and Linux/Unix alike using languages such as PHP or ASP.NET are giving
    way to newer stacks based on Ruby, Java, JavaScript, and Python that specialize
    in mobile services, super-scalable architectures, and other modern concerns have
    sprung up such that there are too many to mention. To add to the fun, web stack
    or framework means something different to everybody. The days of HTML being statically
    coded are giving way to a new approach centered around an elementÂ calledÂ the
    **Document Object Model** (**DOM**), where the scripting languages (JavaScript,
    Python, and so on) dynamically build the HTML or XML presented in the browser.Â No
    matter what vintage of stack is in use, beingÂ able to quickly ascertain what
    is running, can point us in the right direction for **Common Vulnerabilities and
    Exploits (CVEs)** and other characteristics we can leverage in our testing.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_02.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
- en: Scans are more productive when we let our browser help with a quick footprint
    of the target.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: DVWA also uses OpenSSL, which, after the last two or three years, is well worth
    a careful look, as it has been subjected to several high-profile vulnerabilities
    such asÂ **Heartbleed** and others ([https://www.openssl.org/news/vulnerabilities.html](https://www.openssl.org/news/vulnerabilities.html))
    that dominated news outlets worldwide. It is always pretty impressive for something
    so technical to capture headlines, but we're after even the small stuff â�� those
    are just as easy to exploit and often go unaddressed in favor of higher-profile
    vulnerabilities. The previous screenshot in Firefox with the Wappalyzer plugin
    showed us all of these interesting nuggets of information.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-33
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: For a good insight into the stacks running on popular sites, you can learn more
    about it atÂ [https://stackshare.io](https://stackshare.io/). If you want to see
    just how many stacks and perspectives there are, this Reddit thread is educational,
    impressive, and available atÂ [https://www.reddit.com/r/webdev/comments/2les4x/what_frameworks_do_you_use_and_why_are_they/](https://www.reddit.com/r/webdev/comments/2les4x/what_frameworks_do_you_use_and_why_are_they/)Â .
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: The Arachni test scenario
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: The DVWA we're using is included in the **OWASP BWA** image, which is located
    in my lab at the addressÂ `https://172.16.30.131/dvwa/`. Our Kali box is on the
    same subnet (`172.16.30.133`), and we're interested in shortening the scan time
    over the default profile. We'll use this very simple topology in figure followingÂ to
    show off some of the advanced moves Arachni can make with a little bit of additional
    effort and input over a base scan.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_03a.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
- en: Simple Arachni Test Scenario
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: Profiles for efficiency
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Most pen tester's early experience with Arachni usually involves running scans
    with the default settings, which run a comprehensive list of threat vectors past
    the target environment. This is a great way to see what Arachni can do, but the
    OSINT gathered in the recon phase or even through browsing, as we've just seen,
    gives us some great information that can help us narrow the search field. We can
    leverage this information to craft a custom profile, which, as far as Arachni
    is concerned, is where most of the bells and whistles are located.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: Why should we do this? Eliminating vectors we know not to be of interest (unused
    database tests, operating system vectors, and so on) can both reduce the scan
    times and avoid crushing the target with excessive requests. This information
    can also steer us toward a deeper investigation at lower speeds as well. We'll
    walk through this process together and identify some options worth considering.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Creating a new profile
  id: totrans-43
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Let''s build a profile for systems running one of the most common stacks. The
    LAMP stack we see running on the DVWA site still runs theÂ majority of web applications
    with **Windows/IIS/SQL/ASP.NET** (**WISA**) being a close second, so this is a
    good profile to have on hand. We''ll want to click on the **`+`**Â button in the
    **`Profiles`** menu at the top, as seenÂ here:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_03.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
- en: Most Arachni's is on by default â�� we can tailor or focus based on Recon &
    OSINT using Profiles.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: This will start us at the **`Top`** of the **`Profiles`** navigation menu in
    figure following, located at the left of the browser window (1). We'll want to
    decide on a profile name (2), enter a description to help track the intent (3,
    a good idea for teams and large production grids), and the users (4) who can access
    it; selected **`Global`**. It is important to note that these profiles are local
    to the Web UI Client, so your teammates will need to be able to reach the portal
    from their location.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_04.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
- en: Not the most exciting part, but the naming conventions and documentation make
    life easier.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: Scoping and auditing options
  id: totrans-50
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The **scope** Section customizes things a little too finely to be used in a
    profile that is meant to fit multiple applications. This section includes options
    to scan HTTPS only, set path and subdomain limits, exclude paths based on strings,
    or limit the DOM tree depth. If you are conducting a white-box test or doing an
    internal penetration testing of the same application as a part of the SDLC, these
    options are a fantastic way to help focus the testing on the impacted areas rather
    than cast so large a net that the scan is prolonged and contains extraneous results.
    Keeping this in mind, let's move on.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**范围**部分定制得太细致，以至于无法用于适用于多个应用程序的配置文件。该部分包括仅扫描HTTPS、设置路径和子域限制、根据字符串排除路径或限制DOM树深度的选项。如果您正在进行白盒测试或作为SDLC的一部分对同一应用程序进行内部渗透测试，这些选项是帮助将测试重点放在受影响的区域而不是扫描过大范围和包含多余结果的绝佳方式。牢记这一点，让我们继续。'
- en: We'll set our high-level scanning strategy with theÂ **audit** options in figure
    following. When we are testing a server, our scanning can be made much more efficient
    if we omit resource-intensive elements that delay our progress unnecessarily.
    If we have a site we know to be using HTTP **GETs** and **POSTs** equally, we
    can just test with one of those queries. Testing processes are different for all
    of us â�� we may overlap our Arachni scans with Burp Suite or OWASP ZAP scans
    and no longer need to scan headers or process cookies; we'll be covering this
    in [Chapter 5](000.html#), *Proxy Operations with OWASP ZAP and Burp Suite.*Â To
    follow, we'll uncheck the box here as well.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在接下来的图中使用**审计**选项来设置我们的高级扫描策略。当我们测试服务器时，如果我们省略了那些不必要地延迟我们进度的资源密集型元素，我们的扫描可以变得更加高效。如果我们知道一个网站同时使用HTTP的**GET**和**POST**，我们可以只测试其中一个查询。测试过程对我们每个人来说都是不同的
    - 我们可能会将我们的Arachni扫描与Burp Suite或OWASP ZAP扫描重叠，并且不再需要扫描标头或处理Cookie；我们将在[第5章](000.html#)中介绍这一点，*使用OWASP
    ZAP和Burp Suite进行代理操作*。接下来，我们也将取消这里的复选框。
- en: '![](img/B03918_04_05-1.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_04_05-1.png)'
- en: The Audit Section is where we decide how many aspects of the web server get
    tested.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 审计部分是我们决定对Web服务器进行测试的方面。
- en: Converting social engineering into user input and mobile platform emulation
  id: totrans-55
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 将社会工程转化为用户输入和移动平台模拟
- en: Depending on our success in the Recon phase, some of our OSINT may include credentials
    for a web user.Â  These can often be scraped in a MITM attack similar to what
    we discussed using SET in [Chapter 3](000.html#), *Stalking Prey Through Target
    Recon*. While it is certainly acceptable to scan sites without credentials, the
    revelations that may come with a scan as a logged-in user never disappoint. Without
    the credentials, you'll likely see a majority of static content and much less
    sensitive information exposed in black-box tests. White-box tests can better serve
    to secure data in the event of compromised credentials and thus input strings
    here are just as valuable if they are available. The HTTP section followingÂ likewise
    can help tailor HTTP requests to better mimic a legitimate client, work through
    any proxy in the path, and also throttle some of the request rates and file sizes
    to ensure neither the scanner nor the target are overwhelmed, or in their case,
    alerted to our presence. In the event you need to emulate a different browser
    and platform combination, you can provide those modifications here (the website
    at [http://www.useragentstring.com/pages/useragentstring.php](http://www.useragentstring.com/pages/useragentstring.php)
    provides an exhaustive list). As we'll see, the simple fields entered here in
    the **`Input`** fields will result in a much greater scanned area as we delve
    deeper into the application.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们在侦察阶段的成功，我们的一些OSINT可能包括网页用户的凭据。这些凭据通常可以在类似于我们在[第3章](000.html#)中讨论的使用SET的MITM攻击中被获取。虽然在没有凭据的情况下扫描网站是可以接受的，但作为登录用户进行扫描可能会带来一些意想不到的发现。没有凭据的话，你可能只能看到大部分静态内容，以及在黑盒测试中暴露的更少的敏感信息。白盒测试可以更好地保护数据，以防凭据被泄露，因此如果这些凭据可用的话，输入字符串在这里同样具有价值。接下来的HTTP部分同样可以帮助定制HTTP请求，更好地模仿合法的客户端，处理路径中的任何代理，并限制一些请求速率和文件大小，以确保扫描器和目标都不会被压垮，或者在他们的情况下，察觉到我们的存在。如果你需要模拟不同的浏览器和平台组合，你可以在这里提供这些修改（网站[http://www.useragentstring.com/pages/useragentstring.php](http://www.useragentstring.com/pages/useragentstring.php)提供了详尽的列表）。正如我们将看到的，输入字段中输入的简单内容将导致我们在应用程序中深入挖掘时扫描的范围更广。
- en: There are a host of other fields in figure following*Â *thatÂ we may need to
    be aware of as well. Addresses, names, and other static information are popular,
    but more dynamic input processes such as CAPTCHAÂ fields are built specifically
    to prevent non-human form fills. This can limit the scanner's reach, but rest
    assured that there are many other ways to overcome this obstacle so that we can
    test to ensure the target is truly protected.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的图中，还有一系列其他字段*，*我们可能也需要注意。地址、姓名和其他静态信息很受欢迎，但更动态的输入过程，如CAPTCHA字段，专门设计用于防止非人类填写表单。这可能会限制扫描器的范围，但请放心，还有许多其他方法可以克服这一障碍，以便我们可以测试以确保目标真正受到保护。
- en: '![](img/B03918_04_06-1.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_04_06-1.png)'
- en: The Input section is very handy when we have a user's potential credentials
    to leverage
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们有用户潜在的凭据可以利用时，输入部分非常方便
- en: Fingerprinting and determining platforms
  id: totrans-60
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 指纹识别和确定平台
- en: 'The **fingerprinting** section is one of the most impactful ways we can focus
    our scans and win back time in our schedule. Fingerprinting itself is a fantastic
    tool if you don''t already know your target''s stack. As we discovered earlier
    with our browser, we''re running LAMP and can omit the fingerprinting while selecting
    tests that only pertain to that framework. Note that in figure following*,*Â I
    am attempting to test against all 4 detected languages (Perl, PHP, Python, and
    Ruby):'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 指纹识别部分是我们可以集中扫描并在日程表中节省时间的最有影响力的方式之一。如果您还不知道目标的堆栈，指纹识别本身就是一个很棒的工具。正如我们之前在浏览器中发现的那样，我们正在运行LAMP，并且可以在选择只与该框架相关的测试时省略指纹识别。请注意，在下面的图中，我正在尝试针对检测到的所有4种语言（Perl、PHP、Python和Ruby）进行测试：
- en: '![](img/B03918_04_07.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_04_07.png)'
- en: Fingerprinting allows us to explicitly select tests â�� no sense using them
    all if we don't have to.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 指纹识别允许我们明确选择测试——如果我们不必使用所有测试，那就没有意义。
- en: Checks (please)
  id: totrans-64
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 检查（请）
- en: The **Checks** section is where the nitty-gritty details of what vulnerabilities
    we'll test against are offered. Each of the checks is either an active or a passive
    check, and we can enable all or some of them depending on the need. In this case,
    we have plenty of information on the DVWA's framework, but we have no clue as
    to what they will be subjected to. If this was truly a black-box scan, and we
    were trying to stay covert, I mightÂ omit all active checks (seen in following
    figure) in earlier scans and wait until I am able to conduct this from a less-suspicious
    host closer to the web server.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**检查**部分提供了我们将测试的漏洞的细节。每个检查都是主动检查或被动检查，我们可以根据需要启用所有或部分检查。在这种情况下，我们对DVWA的框架有大量信息，但我们不知道它们将受到什么样的影响。如果这真的是一个黑盒扫描，并且我们试图保持隐蔽，我可能会在早期的扫描中省略所有主动检查（见下图），并等到我能够从一个不那么可疑的主机更接近Web服务器时再进行扫描。'
- en: '![](img/B03918_04_08.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_04_08.png)'
- en: Active checks dictate what vulnerabilities Arachni will interact with the target
    proactively to discover.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 主动检查决定了Arachni将主动与目标进行交互以发现的漏洞。
- en: The passive scanning section is much less obtrusive and while these tests canÂ add
    some time, they are well worth using, especially in earlier recon efforts. This
    can be seen in following figure, and for more details, you can click on the name
    of each type for additional information.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 被动扫描部分要少得多，虽然这些测试可能需要一些时间，但在早期的侦察工作中非常值得使用。这可以在下图中看到，要获取更多详细信息，您可以单击每种类型的名称以获取额外信息。
- en: '![](img/B03918_04_09-1.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_04_09-1.png)'
- en: Passive checks are collected without interacting with input fields on the application.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 被动检查是在不与应用程序的输入字段进行交互的情况下收集的。
- en: Plugging into Arachni extensions and third-party add-ons
  id: totrans-71
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 连接到Arachni扩展和第三方插件
- en: Arachni's Ruby-based framework (because, surprise, Arachni is a web application
    too!) isÂ an easy tool for anyone to build additional capabilities for. Widely
    accepted plugins, when meeting the developer's high standards, even make it into
    the Web UI Client in the **`Plugins`**Â section. In this version of Arachni, we
    have several plugins that have been integrated into Arachni and can help our scan
    reduce its impact on the target (Auto-Throttle or Rate-Limiter) or add functionality
    to scan for additional quirks and vulnerabilities.Â It even allows modification
    of fields and test parameters on the fly. Some of these are simply checked (see
    the following screenshot*)*, others require additional configuration after expanding
    them (simply click on the hyperlinked name of each plugin for details).
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: Arachni的基于Ruby的框架（因为，惊喜，Arachni也是一个Web应用程序！）是任何人都可以构建额外功能的简单工具。广泛接受的插件，当满足开发人员的高标准时，甚至会进入**`插件`**部分的Web
    UI客户端。在这个版本的Arachni中，我们已经集成了几个插件，可以帮助我们的扫描减少对目标的影响（自动节流阀或速率限制器），或者添加功能来扫描其他怪癖和漏洞。甚至可以在运行时修改字段和测试参数。其中一些只是被检查了（见下图*），其他需要在展开它们后进行额外配置（只需单击每个插件的超链接名称以获取详细信息）。
- en: 'I selected **`AutoThrottle`** and **`WAF Detector`** for this profile:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我为此配置选择了**`AutoThrottle`**和**`WAF Detector`**：
- en: '![](img/B03918_04_10-1.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_04_10-1.png)'
- en: Plugins modify any profile to allow on-the-fly parameter fuzzing, rate limiting,
    or other special tests.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 插件修改任何配置文件，以允许即时参数模糊、速率限制或其他特殊测试。
- en: 'An alternative way to conduct WAF detection is to use our trusty **Nmap**Â tool.
    Nmap includes a couple of scripts for this purpose. One simply detects the presence
    of a WAF, while the other, if a WAF is found, will typically tell us what brand
    or version is in use. Confirming through multiple scripts and tools can often
    increase confidence in the overall test fidelity. To use these scripts, enter
    the following commands:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 进行WAF检测的另一种方法是使用我们可靠的**Nmap**工具。Nmap包括了一些用于此目的的脚本。一个脚本仅检测WAF的存在，而另一个脚本则在发现WAF时通常会告诉我们正在使用的品牌或版本。通过多个脚本和工具进行确认通常可以增加整体测试的可信度。要使用这些脚本，请输入以下命令：
- en: '[PRE0]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Browser clusters
  id: totrans-78
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 浏览器集群
- en: All of these scans and tests are conducted as if the Instances are actually
    browser sessions interacting with the web application and user. We can actually
    modify the browser's emulated behavior, time limits, size, and even the number
    of independent browsers in use in the **`Browser Cluster`**Â section. For quick
    scans, I advise checking the box that allows the scanner to omit images.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些扫描和测试都是作为实例实际上是与Web应用程序和用户进行交互的浏览器会话进行的。我们实际上可以修改浏览器的模拟行为、时间限制、大小，甚至是**`浏览器集群`**中使用的独立浏览器的数量。对于快速扫描，我建议勾选允许扫描程序省略图像的复选框。
- en: Session checking is also a potentially valuable capability, and its options
    are shown in figure following. There is nothing worse than scanning an application
    just to find out that the logic behind that application has shunted your sessions,
    scans, or traffic to a linked domain outside the target's control. We can enter
    confirmation pages here to ensure that we periodically check back in with an anchor
    page to determine our state and ensure we're still scanning insideÂ the targetÂ application's
    structure, and not following a tangent into a linked application.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_11.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
- en: Browser and Session settings ensure we present our best side to the right site.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: After we've made all of our profile changes, we can select the **`Create Profile`**
    button at the bottom, and we should be good to go! If you run into issues, a top-center
    error box will steer you right to where the issues lie and tell you what must
    be revised before the profile can be accepted.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: Kicking off our custom scan
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once we've made our custom profile, we can invoke it, schedule it, or put it
    away for safe keeping.Â  To run the scan, simply initiate a scan and select **`LAMP
    Profile`****`Â (Global)`** (or whatever name you used) in the **`Configuration
    Profile to use`**Â field, as seen in following figure. We can control the number
    of instances, how the workload is provisioned (direct to a local computer running
    one or more instances, to a remote server, or using a grid of computers), and
    schedule it if so desired.Â  Here, we'll just run it with two instances now and
    see how it performs.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_12.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
- en: Running a scan with a custom profile is straightforward.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: While the scan is running, we can observe the summary and see just how well
    our custom profile is working. As seen in following figure, our scan is already
    far beyond what we saw with the default profile, with more pages discovered, more
    requests attempted, and better overall coverage while keeping a lower profile.
    This results in greater time to complete, but the automation should allow us to
    fire and forget while we work on other things. Â
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: I recommend that you find places in your own workflow where you can kick off
    automated tasks, while personally working on more labor-intensive efforts, such
    as Maltego graph building, social engineering, or the setup for follow-on tasks.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_13.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
- en: The LAMP profile is slower, but revealings more and at lower burden to the target
    server.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: Reviewing the results
  id: totrans-92
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The results of our tailored scan are that we see 34 issues versus the 29 identified
    onesÂ in the wide-open scan before, but that our scan was 28 minutes versus 34
    seconds. We also managed to unearth over 90 pages versus 27 (some as a result
    of our user input) and did so at a much lower request rate than the default, thus
    protecting the DVWA from a mini **Denial of Service** (**DoS**) and staying under
    the radar of any defenses that may have been on the way. Arachni archives scan
    until we run out of space or tell it to delete them, so we'll always have both
    to compare and contrast. In practice, I would recommend running a single-targeted
    scan when the risk is acceptable and running smaller subscans for more covert
    phases of your work.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is a summary of these results:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: '| Â  | **LAMP profile** | **Default profile** |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
- en: '| Time to complete | 38 minutes | 36 seconds |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
- en: '| Pages found | 90 | 27 |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
- en: '| High severity | 3 | 0 |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
- en: '| Medium severity | 8 | 7 |'
  id: totrans-99
  prefs: []
  type: TYPE_TB
- en: '| Low severity | 6 | 6 |'
  id: totrans-100
  prefs: []
  type: TYPE_TB
- en: '| Informational | 17 | 16 |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
- en: '| Total issues | 34 | 29 |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
- en: 'The reports can be exported in a variety of useful formats with HTML, JSON,
    XML, Marshal, YAMR, and AFR available. As with all of them, the HTML reports are
    data-rich and near-presentation ready as in following figure:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_14.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
- en: Arachni's report formats are production-ready and a great start on building
    your deliverables to the customer.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: For the more technical customers, it is helpful to provide follow-up or immediate
    actions (see following figure) that they can take. Your value as a pen tester
    will be much greater if you not only identify problems, but also offer recommendations
    based on best practices that can help the customer's target network be remediated
    and made more secure.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B03918_04_15.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
- en: Detailed vulnerability information can help quickly educate the customer or
    set up the next phases.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: Effective penetration testing is contingent on many things, but the best results
    come with a well-educated set of scans that can both educate as well as prepare
    the table for the later phases of the test. As recent events and continuous headlines
    have demonstrated, there is a staggering number and variety of vectors available
    for attackers to leverage. The volume and importance of these potential holes
    demand comprehensive test suites that automate scans and help us quickly ascertain
    the risk exposure of a target. Almost as important is the ability to process the
    copious amounts of raw data and turn them around as actionable intelligence.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: Arachni is a fantastic tool when it comes to providing these scan, and as an
    added bonus, you can form the basis of our detailed reports or deliverables. Because
    Arachni is an open source and extensible product, it is well supported by the
    community and offers a Ruby framework, on which anyone can graft their own extensions
    or plugins. There are literally thousands of options in Arachni, but hopefully,
    our immersion in the profile builder offers some insight as to how to better employ
    Arachni and other complementary tools in your browser or nmap to scope out your
    target systems efficiently. The depth to which Arachni investigates a target's
    vulnerabilities allows it to uncover potential vectors in detail rivaling or exceeding
    many commercial alternatives.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we discussed ways we could scale Arachni's deployment and tips
    for how to tailor scan profiles to reveal more and remain inconspicuous. We looked
    at how we could better profile our targets, custom craft our scanning behavior,
    and load and focus on the target's attributes gained from the Recon phase of the
    test. We also saw how these tweaks went a long way towards getting deeper page
    discovery and vulnerability identification. The reporting elements were also briefly
    discussed; if anything, this area is ripe with possibilities, and depending on
    your workflows your processes will greatly accelerate report generation and support
    long-term continuous improvement that we should all hope becomes standard in the
    SDLC.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we'll take a look at two more tools that overlap with Arachni
    but take the pen test further into the Kill Chain--**Burp Suite** and **OWASP
    ZAP**. These tools replicate some of Arachni's functions, but can also leverage
    what we have learned here to begin actually exploiting these holes and confirm
    the impact. After seeing what the DVWA has to worry about, I am sure we'll see
    some interesting results!
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
