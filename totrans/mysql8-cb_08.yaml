- en: Restoring Data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  prefs: []
  type: TYPE_NORMAL
- en: Recovering from mysqldump and mysqlpump
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Recovering from mydumper using myloader
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Recovering from flat file backup
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Performing point-in-time recovery
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, you will learn about various backup restoration methods. Assume
    that the backups and binary logs are available on the  server.
  prefs: []
  type: TYPE_NORMAL
- en: Recovering from mysqldump and mysqlpump
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The logical backup tools `mysqldump` and `mysqlpump` write data to a single
    file.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Log in to the server where the backups are available:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'To restore on the remote server, you can mention the `-h <hostname>` option:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'When you are restoring a backup, the backup statements will be logged to the
    binary log, which can slow down the restoration process. If you do not want the
    restoration process to write to the binary log, you can disable it at the session
    level using the `SET SQL_LOG_BIN=0;` option:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Or using:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: There's more...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Since backup restoration takes a very long time, it is recommended to start
    the restoration process inside a screen session so that even if you lose connectivity
    to the server, the restoration will continue.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Sometimes, there can be failures during restoration. If you pass the `--force`
    option to MySQL, restoration will continue:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: Recovering from mydumper using myloader
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '`myloader` is a tool used for multi-threaded restoration of backups taken using
    `mydumper`. `myloader` comes along with `mydumper` and you don''t need to install
    it separately. In this section, you will learn the various ways to restore a backup.'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The common options for `myloader` are the hostname of the MySQL server to connect
    to (the default is `localhost`), username, password, and port.
  prefs: []
  type: TYPE_NORMAL
- en: Recovering full database
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'The options are explained as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '`--overwrite-tables`: This option drops the tables if they already exist'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`--compress-protocol` : This option uses compression on the MySQL connection'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`--threads` : This option specifies the number of threads to use; the default
    is `4`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`--queries-per-transaction` : This specifies the number of queries per transaction;
    the default is `1000`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`--directory`: This specifies the directory of the dump to import'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Recover a single database
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can specify `--source-db <db_name>` to restore only a single database.
  prefs: []
  type: TYPE_NORMAL
- en: 'Suppose you want to restore the `company` database:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Recovering a single table
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '`mydumper` writes the backup of each table to a separate `.sql` file. You can
    pick up the `.sql` file and restore:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: If the table is split into chunks, you can copy all the chunks and information
    related to the table to a directory and specify the location.
  prefs: []
  type: TYPE_NORMAL
- en: 'Copy the required files:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'Use `myloader` to load; it will automatically detect the chunks and load them:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Recovering from flat file backup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Recovering from flat files requires you to stop the MySQL server, replace all
    the files, change the permissions, and start MySQL.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Stop the MySQL server:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'Move the files to the `data directory`:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Change the ownership to `mysql`:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'Start MySQL:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'To minimize the downtime, if you have enough space on disk, you can copy to
    the backup to `/var/lib/mysql2`. Then stop MySQL, rename the directory, and start
    the server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: Performing point-in-time recovery
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Once the full backup is restored, you need to restore binary logs to get point-in-time
    recovery. The backups provide the binary log coordinates up to which the backups
    are available.
  prefs: []
  type: TYPE_NORMAL
- en: As explained in [Chapter 7](part0250.html#7EDCK0-faa69fe6f4c04957afca3568dcd9cd83),
    *Backups*,  in the *Locking instance for backup* section, you should choose the
    binary log backup from the right server, based on the `--dump-slave` or `--master-data`
    option specified in `mysqldump`.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let's get into the details of doing it. There's a lot to learn here though.
  prefs: []
  type: TYPE_NORMAL
- en: mysqldump or mysqlpump
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The binary log information is stored in the SQL file as the `CHANGE MASTER TO`
    command based on the options you passed to `mysqldump`/`mysqlpump`.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you have used `--master-data`, you should use the binary logs of the slave:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: In this case, you should start the restore from the `server1.000008` file at
    position `154` on the slave.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'If you have used `--dump-slave`, you should use the binary logs of the master:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: In this case, you should start the restore from the `centos7-bin.000001` file at
    position `463` located from the master.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: mydumper
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The binary log information is available in the metadata:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'If you have taken the binary log backup from the slave, you should start the
    restore from the `server1.000012` file at position `154` (`SHOW MASTER STATUS`):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'If you have a binary log backup from the master, you should start the restore
    from `centos7-bin.000001` at position `463` (`SHOW SLAVE STATUS`):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
