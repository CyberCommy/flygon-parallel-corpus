- en: 'Chapter 2: Getting Started with the Azure Cloud'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the first chapter, we covered the history of, and the ideas behind, virtualization
    and cloud computing. After that, you read about the Microsoft Azure cloud. This
    chapter will help you take your first steps into the world of Azure, get access
    to Azure, explore the different Linux offerings, and deploy your first Linux virtual
    machine.
  prefs: []
  type: TYPE_NORMAL
- en: After deployment, you will need access to your virtual machine using **Secure
    Shell** (**SSH**) with password authentication or using an SSH key pair.
  prefs: []
  type: TYPE_NORMAL
- en: 'To take the first steps on your journey into the Azure cloud, it is important
    to complete all the exercises and examine the outcomes. In this chapter, we will
    be using PowerShell as well as the Azure CLI. Feel free to follow whichever you''re
    comfortable with; however, learning both won''t hurt. The key objectives of this
    chapter are:'
  prefs: []
  type: TYPE_NORMAL
- en: Setting up your Azure account.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Logging in to Azure using the Azure CLI and PowerShell.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Interacting with **Azure Resource Manager** (**ARM**) to create network and
    storage resources.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Understanding Linux distributions and Microsoft-endorsed distributions.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Deploying your first Linux virtual machine.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Everything in this chapter is tested on macOS, Windows Subsystem for Linux,
    and the latest versions of CentOS and openSUSE LEAP.
  prefs: []
  type: TYPE_NORMAL
- en: Technical Requirements
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'If you want to try all the examples in this chapter, you''ll need a browser
    at the very least. For stability reasons, it''s important to use a very recent
    version of a browser. Microsoft offers a list of supported browsers in the official
    Azure documentation:'
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Edge (latest version)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Internet Explorer 11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Safari (latest version, Mac only)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Chrome (latest version)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Firefox (latest version)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Based on personal experience, we recommend using Google Chrome or a browser
    based on a recent version of its engine, such as Vivaldi.
  prefs: []
  type: TYPE_NORMAL
- en: You can do all the exercises in your browser, even the exercises involving the
    command line. In practice, it's a good idea to use a local installation of the
    Azure CLI or PowerShell; it's faster, it's easier to copy and paste code, and
    you can save history and the output from the commands.
  prefs: []
  type: TYPE_NORMAL
- en: Getting Access to Azure
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To start with Azure, the first thing you'll need is an account. Go to [https://azure.microsoft.com](https://azure.microsoft.com)
    and get yourself a free account to get started, or use the corporate account that
    is already in use. Another possibility is to use Azure with a Visual Studio Professional
    or Enterprise subscription, which will give you **Microsoft Developer Network**
    (**MSDN**) credits for Azure. If your organization already has an Enterprise Agreement
    with Microsoft, you can use your Enterprise subscription, or you can sign up for
    a pay-as-you-go subscription (if you have already used your free trial).
  prefs: []
  type: TYPE_NORMAL
- en: If you are using a free account, you'll get some credits to start, some of the
    popular services for a limited time, and some services that will stay free always,
    such as the container service. You can find the most recent list of free services
    at [https://azure.microsoft.com/en-us/free](https://azure.microsoft.com/en-us/free).
    You won't be charged during the trial period, except for virtual machines that
    need additional licensing, but you do need a credit card to identify yourself.
  prefs: []
  type: TYPE_NORMAL
- en: Logging in Using the Azure portal
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Point your browser to [https://portal.azure.com](https://portal.azure.com) and
    use your credentials to log in. You are ready to start using Azure, or, in other
    words, to start using your subscription. In Azure, a subscription permits you
    to create and deploy resources using the Azure portal/the Azure CLI/PowerShell
    with your account. It is also used for accounting and billing.
  prefs: []
  type: TYPE_NORMAL
- en: 'The Azure portal takes you to a dashboard that you can modify to meet your
    monitoring needs. You can now:'
  prefs: []
  type: TYPE_NORMAL
- en: Inspect your resources.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Create new resources.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Visit the Marketplace, which is an online store where you can purchase and deploy
    applications or services that are built for the Azure cloud.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Get insights into your billing.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can use the web interface, doing everything graphically, or use Azure Cloud
    Shell via the web interface, which provides a Bash or PowerShell interface.
  prefs: []
  type: TYPE_NORMAL
- en: Getting Command-line Access to Azure
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'There are several good reasons to use the command line. That''s why, in this
    book, we''ll mostly cover Azure command-line access:'
  prefs: []
  type: TYPE_NORMAL
- en: It can help you to understand the architecture of Azure. In the graphical interface,
    often you can do many things in one configuration window without understanding
    the relationships between the different fields and components.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It is the first step in automation and orchestration.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The web interface is still in active development; the web interface can, and
    will, change over time:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Some features and options are not available yet.
  prefs: []
  type: TYPE_NORMAL
- en: It is possible that Microsoft will relocate features and options in the web
    interface.
  prefs: []
  type: TYPE_NORMAL
- en: The command-line interface, on the other hand, is very stable in syntax and
    output.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this book, we will use both the Azure CLI in the Bash shell and PowerShell
    with the PowerShell Az module. Both are well-suited, platform-agnostic, and there
    is, besides one or two exceptions, no difference between them in terms of features.
    Choose your favorite because you're already familiar with it, or give both interfaces
    a try and choose afterward.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Please note that copying and pasting commands from this book might give you
    some errors due to spaces and indentations. For better results, always type in
    commands. Also, this will help you get used to the commands.
  prefs: []
  type: TYPE_NORMAL
- en: Installing the Azure CLI
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you use the Bash interface within Azure Cloud Shell, there is a pretty complete
    Linux environment Azure command-line interface installing available to play with.
    It also provides Azure-specific commands, such as the `az` command.
  prefs: []
  type: TYPE_NORMAL
- en: You can also install this utility on Windows, macOS, and Linux. A Docker container
    is available as well. You can find detailed installation instructions for all
    these platforms at [https://docs.microsoft.com/en-us/cli/azure](https://docs.microsoft.com/en-us/cli/azure).
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s use CentOS/ **Red Hat Enterprise Linux** (**RHEL**) 7 as an example
    to install the Azure CLI:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Import the Microsoft repository''s **GNU Privacy Guard** (**GPG**) key:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Add the repository:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Install the software:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'To install the Azure CLI on an Ubuntu- or Debian-based system, use this:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: On macOS, you have to install Homebrew first, a free and open-source package
    management system that simplifies the installation of, mostly, open-source software.
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a Terminal and execute the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Update Homebrew and install the Azure CLI:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'After installing the Azure CLI, you can verify the version installed using
    this:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Logging in with the Azure CLI
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The Azure CLI is a command-line tool that''s used to access or manage Azure
    resources, and the good thing is that it''s available for macOS, Linux, and Windows
    platforms. Before you can use the CLI, you have to log in:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: This command will open a browser and requires you to log in with your Microsoft
    account. If you are getting an error stating that the shell was not able to open
    the interactive browser, use `az login –use-device-code`. This will generate a
    code, and you can use it in [https://www.microsoft.com/devicelogin](https://www.microsoft.com/devicelogin)
    to complete the authentication.
  prefs: []
  type: TYPE_NORMAL
- en: 'If this is successful, it will give you some output in JSON format regarding
    your subscription, such as your username:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'To get this information again, type the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: You can always format the output in JSON, JSONC, TABLE, or TSV formats by using
    extra parameters.
  prefs: []
  type: TYPE_NORMAL
- en: 'JSON (or JSONC, the colored variant) format is easier to parse in programming
    and scripting languages:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The output showing the subscription details on the command prompt in JSON
    format](img/B15455_02_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.1: Subscription details in JSONC format'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: '**Tab-Separated Values** (**TSV**) is a good idea if the output is a single
    value, if you want to use text-filtering utilities such as AWK, or if you want
    to export the output to a spreadsheet:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The output showing the subscription details on the command prompt separated
    by Tabs](img/B15455_02_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.2: Tab-separated subscription details'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'The table output is very human-readable, but is more limited than the default
    output:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The output showing the subscription details on the command prompt in table
    format](img/B15455_02_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.3: Subscription details in tabular format'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'To get a list of subscriptions that the logged-in account has access to in
    a table format, execute the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'To make reading the JSON output easier, you can also query for specific fields:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: If you already have a lot of resources or accounts, going through the entire
    list will be very hard. Luckily, there is a way to drill down the output and get
    just the info that you need. Chaining the command with the `--query` parameter
    will help you do this, using a powerful query language called JMESPATH ([http://jmespath.org](http://jmespath.org)).
    Look at the JSON output of the `az account list` command again. This query is
    searching for the `user` field and the `name` property.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s go back to the login procedure. Doing this every time, again and again,
    may not be the most user-friendly procedure. A better way to do it is by creating
    a service principal, also known as an app registration, to provide a credential
    for a specific application:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'You can provide a name for your application, but certain special characters
    are not allowed. The reason is that `APP_NAME` will create a URL, so all the characters
    that are forbidden in URLs cannot be added to `APP_NAME` (for example, @ and %).
    The output, again in JSON format, will provide an application ID (the `appID`
    parameter):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'Please note down the output on a notepad because we will be using these values
    for authentication. An application or service principal represents an object in
    the Azure tenant. A tenant refers to an organization, often denoted as <yourcompany/yourname>.onmicrosoft.com,
    which manages and owns an instance of Microsoft cloud services. If we look from
    an Azure perspective, all services deployed will be associated with a subscription,
    and the subscription will be mapped to a tenant. A tenant can have multiple subscriptions
    hosting different services. From the preceding output, we''ll get the following
    values:'
  prefs: []
  type: TYPE_NORMAL
- en: '`appID`: The application ID is similar to the username of the application.
    We will be using this ID as our username when logging in.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`displayName`: A friendly name given to the application when we created the
    app. We set the name via the `name` parameter.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`name`: A URL based on the name we have given.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`password`: This is the password of the service principal we created. When
    logging in, we''ll use this value in the password field.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`tenant`: The tenant ID; we discussed tenants in the previous paragraph.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An application that requires access must be represented by a security principal.
    The security principal defines the access policy and permissions for the user/application
    in the tenant. This enables the authentication of the user/application during
    sign-in and role-based authorization during resource access. To summarize, you
    can use `appID` to sign in.
  prefs: []
  type: TYPE_NORMAL
- en: 'List the roles that are assigned to the newly created `appID`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: By default, the contributor role is used. This role has full permissions to
    read and write to your Azure account.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, it''s a good idea to test this and log out:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'Now, log in again using `appID`. You can use the values you copied earlier
    to complete the authentication:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'Unfortunately, there is no way to store the username, `appID`, or `tenant id`
    in a configuration file. Optionally, you can add `--password` to the command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: 'Instead of typing complete commands using the `az` command, you can also open
    it in interactive shell mode:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: One of the greatest features of this shell is that it splits the terminal into
    two windows. In the upper screen, you can type your commands; in the lower screen,
    you'll get help while typing commands. There is also auto-complete support for
    commands, parameters, and often parameter values.
  prefs: []
  type: TYPE_NORMAL
- en: PowerShell
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'PowerShell is a Microsoft-developed scripting language that is integrated into
    .NET Framework. It was designed by Jeffrey Snover, Bruce Payette, and James Truher
    in 2006\. PowerShell is not only available for Windows, but also for Linux and
    macOS. You can find detailed instructions for using PowerShell with these operating
    systems on the GitHub repository for PowerShell: [https://github.com/PowerShell](https://github.com/PowerShell).'
  prefs: []
  type: TYPE_NORMAL
- en: 'For instance, to install it in RHEL or CentOS, follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Import the Microsoft repository''s GPG key if you didn''t do so while following
    the installation procedure for the Azure CLI:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'Add the repository:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'Install the software:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: Use `pwsh -v` to show the installed version.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Enter PowerShell:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: 'On macOS, you''ll need Homebrew and Homebrew Cask. Cask extends Homebrew to
    install more and bigger applications:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Install Homebrew Cask:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: 'Install PowerShell:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: Use `pwsh -v` to show the installed version.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To enter PowerShell:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 'After the installation of PowerShell, you''re ready to install the Az module.
    Downloading the module may take some time, depending upon your internet speed.
    You''ll be able to see the progress of the download in the shell:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: 'PowerShell uses the `PowerShellGet` cmdlet to download the module and its dependencies
    from the PowerShell Gallery, an online repository that hosts many modules. Please
    note that you''ll need administrator privileges in Windows and Linux to do this.
    The PowerShell Gallery isn''t configured as a trusted repository:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: Answer the question in the listing with `[A] Yes to All`.
  prefs: []
  type: TYPE_NORMAL
- en: 'It is possible now, due to the `force` parameter, that you have multiple versions
    of the Az module installed. You can verify the existence of multiple versions
    with the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: The latest version will be used by default, unless you use the `-RequiredVersion`
    parameter when importing the module.
  prefs: []
  type: TYPE_NORMAL
- en: Logging in with PowerShell
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'After the installation is complete, import the module:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: If you don't create a PowerShell script and only execute commands within the
    PowerShell environment when playing with Azure, you'll need to execute this command
    again. But, if you want, you can automatically load the modules.
  prefs: []
  type: TYPE_NORMAL
- en: 'First, find out where your PowerShell profile is on your filesystem by executing
    the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: 'Open or create this file in a text editor and add the following line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: Note
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: It may be necessary to create the directory structure before you can actually
    create this file.
  prefs: []
  type: TYPE_NORMAL
- en: Now you can execute all the available commands for Azure.
  prefs: []
  type: TYPE_NORMAL
- en: 'Log in using the following cmdlet:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: 'This will open an interactive browser window, where you can use your credentials
    to authenticate. If the result doesn''t show you a tenant ID, execute this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: 'And now, log in again using the tenant ID you have found:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: 'If you have multiple subscriptions, you can add the `-Subscription` parameter
    and the subscription ID as well. As discussed before, it''s maybe a good idea
    to create a service principal:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: 'If you don''t mention `DisplayName`, which is the friendly name for the service
    principal, Azure will generate a name in the format azure-powershell-MM-dd-yyyy-HH-mm-ss.
    Next, you need to retrieve the application ID for the newly created service principal:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: 'And the password can be stored to a variable, which will be encrypted, and
    we must decrypt it:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: The `$UnsecureSecret` variable contains the password for your service principal.
  prefs: []
  type: TYPE_NORMAL
- en: 'To be able to authenticate, we need the credentials of the service principal:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: 'Provide the `ApplicationID` and the password, which are stored in the `$newsp.ApplicationId`
    and `$UnsecureSecret` variables respectively. Now we have everything we need to
    connect to Azure using these credentials:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: 'Now, save the context:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: 'Overwrite the existing content if necessary. Exit the PowerShell environment
    and execute PowerShell. Make sure that you are logged into Azure and verify the
    context using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: Azure Resource Manager
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Before you can start the deployment of your first Linux virtual machine, it's
    important to know more about **Azure Resource Manager** (**ARM**).
  prefs: []
  type: TYPE_NORMAL
- en: Basically, ARM enables you to work with resources such as storage and virtual
    machines. To do so, you have to create one or more resource groups so you can
    execute life cycle operations, such as deploying, updating, and deleting all the
    resources in a resource group, in a single operation.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: A resource group must be created in a region, also known as a location. Please
    notice that there may be differences between the services offered in different
    regions. To find out more about these differences, please visit [https://azure.microsoft.com/en-us/global-infrastructure/services/](https://azure.microsoft.com/en-us/global-infrastructure/services/).
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure has more than 54 regions. If a location is not available, it needs to
    be whitelisted for your account. For that, you can reach out to Microsoft Support.
    To get a list of the available locations and supported resource providers for
    your account, execute the following command in PowerShell:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: 'You can also execute the following in Bash:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, create a resource group in one of the regions:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE44]'
  prefs: []
  type: TYPE_PRE
- en: 'Now, verify the result:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE45]'
  prefs: []
  type: TYPE_PRE
- en: 'This is the Bash version of the preceding command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE46]'
  prefs: []
  type: TYPE_PRE
- en: 'To verify the result of **Azure Resource Manager (ARM)** this command, execute
    the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE47]'
  prefs: []
  type: TYPE_PRE
- en: 'Besides working with regions and resource groups, you have to understand the
    concept of storage redundancy. The available replication options are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Standard_LRS: Locally redundant storage'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Premium_LRS: Same as LRS, but it supports File Storage as well.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Standard_GRS: Geo-redundant storage'
  prefs: []
  type: TYPE_NORMAL
- en: 'Standard_RAGRS: Read-access geo-redundant storage'
  prefs: []
  type: TYPE_NORMAL
- en: 'Standard_ZRS: Zone-redundant storage; ZRS doesn''t support Blob storage'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'More information is available on the Microsoft website: [https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy](https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy).'
  prefs: []
  type: TYPE_NORMAL
- en: 'Understanding this concept is important because, together with your resource
    group, a storage account is needed in a region. A storage account provides a unique
    namespace in Azure to store data (such as diagnostics) and the possibility to
    use services such as Azure Files. To configure redundancy for this data, you have
    to specify the SKU that stands for the redundancy option in this context:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  prefs: []
  type: TYPE_PRE
- en: 'Or you can do it via the Azure CLI:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE49]'
  prefs: []
  type: TYPE_PRE
- en: The storage account name must be unique across Azure, be between 3 and 24 characters
    in length, and use numbers and lowercase letters only.
  prefs: []
  type: TYPE_NORMAL
- en: Linux and Azure
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Linux is almost everywhere, on many different devices, and in many different
    environments. There are many different flavors, and the choice of what to use
    is yours. So, what do you choose? There are many questions, and many different
    answers are possible. But one thing''s for sure: in corporate environments, support
    is important.'
  prefs: []
  type: TYPE_NORMAL
- en: Linux distributions
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'As noted earlier, there are many different Linux distributions around. But
    there are reasons why there are so many options:'
  prefs: []
  type: TYPE_NORMAL
- en: A Linux distribution is a collection of software. Some collections are there
    for a specific objective. A good example of such a distribution is Kali Linux,
    which is an advanced penetration testing Linux distribution.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Linux is a multi-purpose operating system. Thanks to the large number of customization
    options we have for Linux, if you don't want a particular package or feature on
    your operating system, you can remove it and add your own. This is one of the
    primary reasons why there are so many distributions.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Open source is Darwinian by nature. Sometimes, a project is forked, for instance,
    because some other developers don't like the goal of the project or think they
    can do better and patches of the project are not accepted. Only the strongest
    projects will survive.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It is a matter of taste. Different people have different tastes and opinions.
    Some people like the Debian `apt` package manager; other people may like SUSE's
    Zypper tool.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Another big difference is that some distributions are collected and supported
    by vendors such as Red Hat, SUSE, and Canonical, whereas others, such as Debian,
    are community-driven.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'In production environments, support is important. Before pushing their production
    workloads to a distribution, organizations will be concerned with certain factors,
    such as SLA, downtime, and security updates, and the following questions might
    arise:'
  prefs: []
  type: TYPE_NORMAL
- en: Who is responsible for the updates, and what kind of information comes with
    the updates?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Who is responsible for support, and who am I going to call if there is a problem?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Who is going to advise me if there are legal problems with the software licensing?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft-endorsed Linux Distributions
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In the Azure Marketplace, there are Linux images provided by third parties,
    also called Microsoft partners. These are Microsoft-endorsed Linux distributions.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft works Microsoft-endorsed Linux distributions together with these partners
    and the Linux community to make sure that these Linux distributions work well
    on Azure.
  prefs: []
  type: TYPE_NORMAL
- en: It is possible to import your own image, or even your own Linux distribution,
    into Azure. Microsoft contributes directly to the Linux kernel, providing Linux
    Integration Services for Hyper-V and Azure, and because of this you can run every
    Linux distribution on Azure as long as support is compiled into the kernel. Also,
    on every Linux image in the Azure Marketplace, the Azure Linux Agent is installed,
    and the source code of this agent is available on GitHub as well, so you can install
    it in your image. Microsoft is even willing to guide you if you have issues with
    Linux; just buy a support plan!
  prefs: []
  type: TYPE_NORMAL
- en: 'For some commercial Linux distributions, there are great support options available:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Red Hat: Microsoft Support will help you to use the Azure platform or services,
    and will also support issues within Red Hat, but this requires a support plan.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Oracle Linux: Microsoft offers a support plan; additional commercial support
    can be bought from Oracle.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'SUSE: There are premium images supported by Microsoft; if needed, they will
    call SUSE for you. This SUSE premium image includes all software, updates, and
    patches.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Other vendors: There are Microsoft support plans to cover other vendors; you
    don''t have to buy a separate plan for this. Microsoft plan details are available
    at [https://azure.microsoft.com/en-us/support/plans/](https://azure.microsoft.com/en-us/support/plans/).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Please visit the Microsoft website for a recent list of endorsed distributions
    and versions, as well as details about the support that is available for a distribution:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://docs.microsoft.com/en-us/azure/virtual-machines/linux/endorsed-distros](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/endorsed-distros
    )'
  prefs: []
  type: TYPE_NORMAL
- en: Deploying a Linux Virtual Machine
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We've covered the Linux distributions available in Azure and the level of support
    you can get. In the previous section, we set up the initial environment by creating
    the resource group and storage; now it's time to deploy our first virtual machine.
  prefs: []
  type: TYPE_NORMAL
- en: Your First Virtual Machine
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The resource group has been created, a storage account has been created in this
    resource group, and now you are ready to create your first Linux virtual machine
    in Azure.
  prefs: []
  type: TYPE_NORMAL
- en: 'In PowerShell, use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE50]'
  prefs: []
  type: TYPE_PRE
- en: 'The cmdlet will prompt you to provide a username and password for your virtual
    machine:'
  prefs: []
  type: TYPE_NORMAL
- en: '![To provide username and password in Powershell for your virtual machine](img/B15455_02_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.4: Providing user credentials for your virtual machine'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'In Bash, you can use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE51]'
  prefs: []
  type: TYPE_PRE
- en: This was very easy, but if you create a virtual machine instance this way, the
    number of options you can set is very limited. This process will create multiple
    resources required by the virtual machine, such as the disk, NIC, and public IP,
    using default settings.
  prefs: []
  type: TYPE_NORMAL
- en: Let's dive a little bit further into the details and get some information about
    the choices made.
  prefs: []
  type: TYPE_NORMAL
- en: Images
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'In our example, we deployed a virtual machine with the image name `UbuntuLTS`.
    You can choose between several Linux images:'
  prefs: []
  type: TYPE_NORMAL
- en: CentOS
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Debian
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: RHEL
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: UbuntuLTS
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: CoreOS
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: openSUSE
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SUSE Linux Enterprise
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: But there are many more images offered by different vendors, called publishers.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s get a list of these publishers. In PowerShell, use this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE52]'
  prefs: []
  type: TYPE_PRE
- en: 'As you can see in the following screenshot, Azure has a lot of publishers,
    and we''ll pick one of these for the demonstration:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The list of various image publishers and their location in Powershell](img/B15455_02_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.5: Listing image publishers in PowerShell'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'In Bash, you can run the following command to get the list of publishers:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE53]'
  prefs: []
  type: TYPE_PRE
- en: 'The list is the same:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The list of various image publishers and their location in Bash](img/B15455_02_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.6: Listing image publishers in Bash'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Now you know the publishers, you can get a list of images provided by a publisher
    using:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE54]'
  prefs: []
  type: TYPE_PRE
- en: 'We have selected `Canonical` as the publisher, and now we are trying to get
    the list of offers available. `UbuntuServer` is one of the offers, and we will
    be using this one:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Selecting Canonical as the publisher and selecting offers for it in Powershell](img/B15455_02_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.7: Listing offers for Canonical publisher'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Alternatively, in the Azure CLI, run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE55]'
  prefs: []
  type: TYPE_PRE
- en: The output is a list of so-called *offers*. An offer is the name of a group
    of related images created by a publisher.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we need to know what SKUs are available for the image. SKU refers to the
    major release of a distribution. Here is an example using Ubuntu:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE56]'
  prefs: []
  type: TYPE_PRE
- en: 'Now that we have the values for the publisher and offer, let''s go ahead and
    see the major distributions (SKUs) that are available for `UbuntuServer` published
    by `Canonical`:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The list of various SKUs offered by Canonical publisher for UbuntuServer](img/B15455_02_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.8: Listing SKUs for UbuntuServer published by Canonical'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Alternatively, in the Azure CLI, run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE57]'
  prefs: []
  type: TYPE_PRE
- en: 'Query for a specific instance within this offer:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE58]'
  prefs: []
  type: TYPE_PRE
- en: 'Let''s again go through the values we have. So, using the publisher name, offer,
    and SKU, we''re going to get the version that''s available. In the following screenshot,
    you can see that image version `19.10.201912170` is available. Let''s take this
    image for our virtual machine:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Version detail of the available image using publisher''s name, offer and
    SKUs in Azure CLI](img/B15455_02_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.9: Selecting available image version in Azure CLI'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: This was the latest version available at the time of writing this chapter. If
    there are any new releases, you might see another version number.
  prefs: []
  type: TYPE_NORMAL
- en: 'Alternatively, in the Azure CLI, use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE59]'
  prefs: []
  type: TYPE_PRE
- en: 'To reduce the output to the latest version, parameters were added to select
    the last line. The information collected contains parameters for the `Set-AzVMSourceImage`
    cmdlet; however, before using this command, we need to create a new virtual machine
    configuration using `New-AzVMConfig`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE60]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally, we are creating a new virtual machine with a size of `Standard_A1`,
    and we''re instructing PowerShell to use image version `19.10.201912170` of the
    major `19_10-daily-gen2` distribution in the `UbuntuServer` offer published by
    `Canonical`:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a new virtual machine with a size of Standard_A1 by instructing
    Powershell to use image version](img/B15455_02_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.10: Creating a virtual machine of Standard_A1 size'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'In Bash, the collected information contains parameters for the `az vm create`
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE61]'
  prefs: []
  type: TYPE_PRE
- en: Note
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: In both Bash and PowerShell, it's possible to use the word *latest* instead
    of a specific version. The collected information is not sufficient to create the
    virtual machine, though. More parameters are needed.
  prefs: []
  type: TYPE_NORMAL
- en: Virtual Machine Sizing
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Another thing you have to take care of is a decision regarding the virtual machine's
    size based on your needs and costs. More information on the available sizes and
    the pricing is available at [https://azure.microsoft.com/en-us/pricing/details/virtual-machines/linux](https://azure.microsoft.com/en-us/pricing/details/virtual-machines/linux).
  prefs: []
  type: TYPE_NORMAL
- en: 'The list on this website, which includes the prices of the instances, changes
    often! You can get a list (without displaying the costs) on the command line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE62]'
  prefs: []
  type: TYPE_PRE
- en: A small virtual machine is enough to execute the exercises in this book. At
    the time of writing, `Standard_B1ls` is ideal for the necessary base-level performance.
    But it's a good idea to recheck the virtual machine sizing/pricing list, as mentioned
    earlier on.
  prefs: []
  type: TYPE_NORMAL
- en: 'In PowerShell, the `New-AzVM` cmdlet can take the `-size` parameter, or you
    can use it in the `New-AzVMConfig` cmdlet:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE63]'
  prefs: []
  type: TYPE_PRE
- en: In Bash, add the `--size` parameter of the `az vm create` command.
  prefs: []
  type: TYPE_NORMAL
- en: Virtual Machine Networking
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Azure virtual networks allow communication between virtual machines, the internet,
    and other Azure services over a secure network. When we created the first virtual
    machine at the beginning of this chapter, several items regarding networking were
    created automatically:'
  prefs: []
  type: TYPE_NORMAL
- en: Virtual network
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Virtual subnet
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Virtual network interface attached to the virtual machine and plugged into the
    virtual network
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Private IP address configured on the virtual network interface
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Public IP address
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The network resources will be covered in *Chapter 4, Managing Azure*; for now,
    we''re just going to query the private and public IP addresses of the virtual
    machines. Use this command to get the list of public IP addresses:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE64]'
  prefs: []
  type: TYPE_PRE
- en: 'To get the list of private IP addresses of all your virtual machines, use this
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE65]'
  prefs: []
  type: TYPE_PRE
- en: 'The preceding command may look a little complicated, but it is a handy script
    for getting the list of private IPs. If you want to get the private IP address
    of virtual machines in a resource group, you can use this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE66]'
  prefs: []
  type: TYPE_PRE
- en: 'The output obtained will be in JSON format, and you can see the private IP
    address under `IpConfigurations`:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The output displaying private IP address of virtual machines in a resource
    group in JSON format](img/B15455_02_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.11: Private IP address of virtual machines in the resource group'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'This can be also accomplished using the Azure CLI. To get a list of the private
    IP addresses of virtual machines, use this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE67]'
  prefs: []
  type: TYPE_PRE
- en: The public IP address is the IP address that makes the virtual machine accessible
    via the internet. The incoming traffic virtual machine networking on this IP address
    undergoes **network address translation** (**NAT**) to the private IP address
    configured on the network interface of the Linux virtual machine.
  prefs: []
  type: TYPE_NORMAL
- en: Virtual Machine Information
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'After the deployment of the virtual machine, all the information attached to
    the virtual machine is available using PowerShell and Bash, such as the state.
    Querying the state is important; there are several states:'
  prefs: []
  type: TYPE_NORMAL
- en: Running
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Stopped
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Failed
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Deallocated
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'If a virtual machine is not deallocated, Microsoft will charge you for it.
    The `Failed` state means that the virtual machine is not able to boot. To query
    the state, execute the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE68]'
  prefs: []
  type: TYPE_PRE
- en: 'In Bash, it is possible to receive the state of the deployed virtual machines,
    but if we need to narrow down the output to a single instance, it''s not possible
    without using complex queries:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE69]'
  prefs: []
  type: TYPE_PRE
- en: 'To deallocate a virtual machine, first stop it:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE70]'
  prefs: []
  type: TYPE_PRE
- en: 'Now you are able to deallocate it:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE71]'
  prefs: []
  type: TYPE_PRE
- en: 'You can get much more information about the deployed virtual machines. In PowerShell,
    it''s quite difficult to receive the properties of the virtual machine. First,
    create a variable:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE72]'
  prefs: []
  type: TYPE_PRE
- en: 'Now ask for the properties and methods of this `MYVM` object:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE73]'
  prefs: []
  type: TYPE_PRE
- en: 'View the `HardwareProfile` property to see the size of this instance:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE74]'
  prefs: []
  type: TYPE_PRE
- en: 'Or, to be more virtual machine information precise, use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE75]'
  prefs: []
  type: TYPE_PRE
- en: You can also try `NetworkProfile`, `OSProfile`, and `StorageProfile.ImageReference`.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want to use the `az` command in Bash, the first command you may want
    to try is this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE76]'
  prefs: []
  type: TYPE_PRE
- en: 'The only problem here is that it shows all the information about all the virtual
    machines at the same time; luckily, there is a `show` command as well, which reduces
    the output to a single virtual machine:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE77]'
  prefs: []
  type: TYPE_PRE
- en: 'And it''s a good idea to limit the output by using queries. For example, if
    you want to see the storage profile of a particular virtual machine, you can query
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE78]'
  prefs: []
  type: TYPE_PRE
- en: 'The preceding command should give you the following output:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Command to see the storage profile of SUSE virtual machine](img/B15455_02_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.12: Storage profile of the SUSE virtual machine'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Connecting to Linux
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The virtual machine is running, ready for you to log in remotely using the credentials
    (username and password) you provided during the deployment of your first virtual
    machine. Another, more secure method to connect to your Linux virtual machine
    is by using SSH key pairs. SSH keys are more secure due to their complexity and
    length. On top of this, Linux on Azure supports sign-in using **Azure Active Directory**
    (**Azure AD**), where users will be able to authenticate using their AD credentials.
  prefs: []
  type: TYPE_NORMAL
- en: Logging into Your Linux virtual machine Using Password Authentication
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In the *Virtual Machine Networking* section, the public IP address of a virtual
    machine was queried. We will be using this public IP to connect to the virtual
    machine via SSH using an SSH client installed locally.
  prefs: []
  type: TYPE_NORMAL
- en: '**SSH**, or **Secure Shell**, is an encrypted network protocol used to manage
    and communicate with servers. Linux, macOS, **Windows Subsystem for Linux** (**WSL**),
    and the recent update of Windows 10 come with the command-line-based OpenSSH client,
    but there are more advanced clients available. Here are a few examples:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Windows: PuTTY, MobaXterm, and Bitvise Tunnelier'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Linux: PuTTY, Remmina, and Pac Manager'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'macOS: PuTTY, Termius, and RBrowser'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Using the OpenSSH command-line client, connect to the virtual machine:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE79]'
  prefs: []
  type: TYPE_PRE
- en: Logging into your Linux Virtual Machine with an SSH private key
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Using a username and password is not the best way to log into a remote machine.
    It is not a completely insecure operation, but you're still sending your username
    and password over the connection. It's also difficult to use if you want to execute
    scripts remotely, perform back-up operations, and so forth.
  prefs: []
  type: TYPE_NORMAL
- en: 'An alternative and more secure way to log into your system is by using SSH
    key pairs. This is a pair of two cryptographically secured keys: a private and
    a public key.'
  prefs: []
  type: TYPE_NORMAL
- en: The private key is retained by the client and should not be copied to any other
    computer. It should be kept absolutely secret. And it is a good idea, during the
    creation of the key pair, to protect the private key with a passphrase.
  prefs: []
  type: TYPE_NORMAL
- en: The public key, on the other hand, can be copied to all the remote computers
    you want to administer. This public key is used to encrypt the messages that only
    the private key can decrypt. When you try to log in, the server verifies that
    the client owns the private key using this property of working with keys. No password
    is sent over the connection.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are multiple ways to create an SSH key pair; for instance, PuTTY and
    MobaXterm both provide tooling to create them. You have to do this from every
    workstation that needs access to the remote machine. In this book, we are using
    `ssh-keygen` because it''s available for every operating system:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE80]'
  prefs: []
  type: TYPE_PRE
- en: 'The output of the preceding command should look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Creation of SSH key pair using ssh-keygen command](img/B15455_02_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2.13: Using ssh-keygen to create SSH key pair'
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Don't forget to enter a passphrase!
  prefs: []
  type: TYPE_NORMAL
- en: 'To understand how to use the SSH key pair to access your virtual machines,
    let''s create a new virtual machine. If you recall, when we created the Linux
    machine earlier, we used the `az vm create` command and `authentication-type`
    as password, but in the following command, we are using a `--generate-ssh-keys`
    parameter. This will generate an SSH key pair and will be added to the `.ssh`
    directory in your home folder, which can be used to access the virtual machine:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE81]'
  prefs: []
  type: TYPE_PRE
- en: If you want to do it in PowerShell, use the `Add-AzVMSshPublicKey` cmdlet. For
    more information on the command, refer to [https://docs.microsoft.com/en-us/powershell/module/azurerm.compute/add-azurermvmsshpublickey?view=azurermps-6.13.0](https://docs.microsoft.com/en-us/powershell/module/azurerm.compute/add-azurermvmsshpublickey?view=azurermps-6.13.0).
  prefs: []
  type: TYPE_NORMAL
- en: 'Once the virtual machine has been created, you will be able to access it using
    this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE82]'
  prefs: []
  type: TYPE_PRE
- en: Summary
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This chapter covered the first steps into Microsoft Azure. The first step always
    involves creating a new account or using an existing company account. With an
    account, you're able to log in and start discovering the Azure cloud.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, the discovery of the Azure cloud was done using the Azure
    CLI command `az`, or via PowerShell; example by example, you learned about the
    following:'
  prefs: []
  type: TYPE_NORMAL
- en: The Azure login process
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Regions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The storage account
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Images provided by publishers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The creation of virtual machines
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Querying information attached to a virtual machine
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What Linux is and the support available for Linux virtual machines
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Accessing your Linux virtual machine using SSH and an SSH keypair
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The next chapter starts here, with a new journey: the Linux operating system.'
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: What are the advantages of using the command line to access Microsoft Azure?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is the purpose of a storage account?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Can you think of a reason why you would get the following error message?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE83]'
  prefs: []
  type: TYPE_PRE
- en: What is the difference between an offer and an image?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is the difference between a stopped and a deallocated virtual machine?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is the advantage of using the private SSH key for authentication to your
    Linux virtual machine?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The `az vm create` command has a `--generate-ssh-keys` parameter. Which keys
    are created, and where are they stored?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Further Reading
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'By no means is this chapter a tutorial on using PowerShell. But if you want
    a better understanding of the examples, or want to learn more about PowerShell,
    we can recommend you read *Mastering Windows PowerShell Scripting – Second Edition*
    (ISBN: 9781787126305), by Packt Publishing. We suggest that you start with the
    second chapter, *Working with PowerShell*, and continue until at least the fourth
    chapter, *Working with Objects in PowerShell*.'
  prefs: []
  type: TYPE_NORMAL
- en: 'You can find plenty of online documentation about using SSH. A very good place
    to start is this wikibook: [https://en.wikibooks.org/wiki/OpenSSH](https://en.wikibooks.org/wiki/OpenSSH).'
  prefs: []
  type: TYPE_NORMAL
- en: If you wish to explore more about Linux administration, *Linux Administration
    Cookbook* by Packt Publishing is a good resource, especially for system engineers.
  prefs: []
  type: TYPE_NORMAL
- en: 'To dive deep into security and admin tasks, this is a good read: *Mastering
    Linux Security and Hardening*, written by Donald A. Tevault and published by Packt
    Publishing.'
  prefs: []
  type: TYPE_NORMAL
