- en: The Power of Sudo
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, you will learn how to give permissions to non-root users on
    the system so they can run privileged commands. In real life, the system administrator
    should not give the root password to any user on the system. However, some users
    on the system may need to run privileged commands; now, the question is: *how
    can non-root users run privileged commands without getting root access to the
    system?* Well, let me show you!'
  prefs: []
  type: TYPE_NORMAL
- en: Examples of privileged commands
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You would find most of the commands that require root privileges in the directories
    `/sbin` and `/usr/sbin`. Let’s switch to user `smurf`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Now let’s see if `smurf` can add a new user to the system:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'User `smurf` gets a permission denied error. That’s because the `useradd` command
    is a privileged command. OK fine! Let’s try installing the `terminator` package,
    which is a pretty cool Terminal emulator I must say:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Again! User `smurf` is getting an error. Life is not fun without root, I hear
    you saying.
  prefs: []
  type: TYPE_NORMAL
- en: Granting access with sudo
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: User `smurf` is now very sad as he can’t add user `bob` or install the `terminator`
    package on the system. You can use the `visudo` command to grant user `smurf`
    the permissions to run the two privileged commands he wants.
  prefs: []
  type: TYPE_NORMAL
- en: 'Run the `visudo` command as the root user:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'This will open up the file `/etc/sudoers` so you can edit it:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'All the lines that begin with the hash characters are comments, so only focus
    on these lines:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: The first line `root ALL=(ALL:ALL) ALL` is a rule that grants user `root` the
    permission to run all the commands on the system.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can now add a rule to grant user `smurf` the permission to run the `useradd`
    command. The syntax specification for a rule in the `/etc/sudoers` file is as
    follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'Now add the following rule to the `/etc/sudoers` file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'The `ALL` keyword means no restrictions. Notice that you also have to include
    the full path of the commands. Now, save and exit the file then switch to user
    `smurf`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'Now precede the `useradd` command with `sudo` as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'It will prompt user `smurf` for his password; enter it, and just like that!
    User `bob` is added:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'Cool! So `smurf` can now add users to the system; however, he still can’t install
    any packages on the system:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Now let’s fix that. Switch back to the root user and run the `visudo` command
    to edit the `sudo` rule for user `smurf`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'Notice that I also added `NOPASSWD` so that `smurf` doesn’t get prompted to
    enter his password. I also added the command to install the `terminator` package.
    Now, save and exit then switch back to user `smurf` and try to install the `terminator`
    package:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'Success! Notice that the `sudo` rule grants `smurf` permission only to install
    the `terminator` package. He will get an error if he tries to install any other
    package:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: User and command aliases
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can use user aliases to reference multiple users in the `/etc/sudoers`
    file. For example, you can create a user alias `MANAGERS` that includes `userssmurf`
    and `bob` as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'You can use a command alias to group multiple commands together. For example,
    you can create a command alias `USER_CMDS` that includes the commands `useradd`,
    `userdel`, and `usermod`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'Now you can use both aliases:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: to grant users `smurf` and `bob` the permission to run the commands `useradd`,
    `userdel`, and `usermod`.
  prefs: []
  type: TYPE_NORMAL
- en: Group privileges
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can also specify groups in the `/etc/sudoers` file. The group name is preceded
    by the percentage character as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'The following rule will grant the `developers` group permission to install
    any package on the system:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'The following rule will grant the `developers` group permission to run any
    command on the system:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: Listing user privileges
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can use the command `sudo -lU` to display a list of the `sudo` commands
    a user can run:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'For example, you can run the command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: to list all the `sudo` commands that can be run by user `smurf`.
  prefs: []
  type: TYPE_NORMAL
- en: 'If a user is not allowed to run any `sudo` commands, the output of the command
    `sudo-lU` will be as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: visudo versus /etc/sudoers
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You may have noticed that I used the command `visudo` to edit the file `/etc/sudoers`,
    and you might ask yourself a very valid question: why not just edit the file `/etc/sudoers`
    directly without using `visudo`? Well, I will answer your question in a practical
    way.'
  prefs: []
  type: TYPE_NORMAL
- en: 'First, run the `visudo` command and add the following line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: 'Now try to save and exit:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: As you can see, the `visudo` command detects an error, and it specifies the
    line number where the error has occurred.
  prefs: []
  type: TYPE_NORMAL
- en: 'Why is this important? Well, if you saved the file with an error in it, all
    the `sudo` rules in `/etc/sudoers` will not work! Let’s hit `Q` to save the changes
    and then try to list the `sudo` commands that can be run by user `smurf`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: We get an error, and all the `sudo` rules are now broken! Go back and run the
    `visudo` command to remove the line that contains the error.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you directly edit the file `/etc/sudoers` without using the `visudo` command,
    it will not check for syntax errors and this may lead to catastrophic consequences,
    as you saw. So the rule of thumb here: always use `visudo` when editing the `/etc/sudoers`
    file.'
  prefs: []
  type: TYPE_NORMAL
- en: Knowledge check
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'For the following exercises, open up your Terminal and try to solve the following
    tasks:'
  prefs: []
  type: TYPE_NORMAL
- en: Add a `sudo` rule so that user `smurf` can run the `fdisk` command.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Add a `sudo` rule so that the `developers` group can run the `apt-get` command.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: List all the `sudo` commands of user `smurf`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
