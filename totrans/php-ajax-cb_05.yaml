- en: Chapter 5. Debugging and Troubleshooting
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Debugging with Firebug and FirePHP
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Debugging with the IE developer toolbar
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Avoiding the framework $ conflict
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using the Anonymous function of JavaScript
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fixing memory leaks in JavaScript
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fixing Memory leaks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Sequencing Ajax requests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Debugging and troubleshooting can be a big hassle for you if you don't know
    how to do this effectively when you use Ajax. In this chapter, we will be learning
    about a few tools and techniques to debug and troubleshoot Ajax applications.
  prefs: []
  type: TYPE_NORMAL
- en: First of all, we will be looking at the awesome tools built for the Mozilla
    Firefox browser—Firebug, and FirePHP. These two tools are probably the most popular
    for debugging Ajax requests and responses. In the next section, we will be looking
    at another important but less sophisticated tool for Internet Explorer—the IE
    developer toolbar.
  prefs: []
  type: TYPE_NORMAL
- en: After that, we will be looking at a technique to avoid the common dollar (`$`)
    conflict between frameworks such as jQuery and Mootools while using them together
    in a single web page.
  prefs: []
  type: TYPE_NORMAL
- en: We will be also looking at how to sequence the Ajax requests for an Ajax application
    that requires periodic update of data. Then, later on, we will be looking at tools
    for beautifying JavaScript that was compressed using tools such as Douglas Crockford's
    JSMin or Dean Edward's Packer tool. Finally, in this chapter, we will be looking
    at tips for cross-browser implementations of Ajax.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Mozilla Firefox takes a bit more memory than normal when Firebug and FirePHP
    are installed on it; so, it can make your system unstable if you have a low memory
    computer. In that case, it is advisable to install Firebug and FirePHP in a different
    profile of Firefox, which you can use specifically during web development.
  prefs: []
  type: TYPE_NORMAL
- en: Debugging with Firebug and FirePHP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When Ajax technology is used extensively in complex web applications, debugging
    of such applications becomes a headache for developers, if they don't have the
    right tools for it. This is the where Firebug and FirePHP become handy. **Firebug**
    is an elegant, easy, and powerful add-on for Mozilla Firefox for debugging an
    Ajax-based application. It allows you to get a clear overview of Ajax requests,
    responses, and data sent to the server via the POST or GET methods. Furthermore,
    you can even edit the HTML and CSS code and preview the changes in real time,
    in the browser. Apart from this, Firebug also shows the entire HTTP request made
    by the web page. It also lets you profile JavaScript code. **FirePHP** is an extension
    of Firebug that extends the functionalities of Firebug by logging in information
    or messages on the Firebug console.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Please note that CSS or HTML code edited in Firebug is temporary and it doesn't
    affect the real code. The changes go away when Mozilla Firefox is refreshed.
  prefs: []
  type: TYPE_NORMAL
- en: Debugging with Firebug
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Firebug** is probably one of the most popular add-ons for the Mozilla Firefox
    browser among web developers. It allows debugging, monitoring, and editing of
    CSS, HTML, and JavaScript, as well as the DOM. It has a lot of features but, among
    them, we''ll be talking more about how to use the JavaScript console for logging
    values or errors.'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: So, let's first install Firebug to start debugging an Ajax/PHP application with
    Firebug.
  prefs: []
  type: TYPE_NORMAL
- en: Firebug can be downloaded from [http://getfirebug.com/](http://getfirebug.com/).
    Once you click on the **Install Firebug** button and follow the steps on the website,
    you will see the following pop up to start the installation. Once you click the
    **Install Now** button, Firebug gets installed in Firefox. After installation,
    you might have to restart your Mozilla Firefox browser to finish the installation
    of Firebug.
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](graphics/3081_05_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Once Firebug is installed, you can enable it by hitting *F12* or clicking the
    Firebug icon on the bottom right-hand side of the Firefox window. The following
    screenshot shows how Firebug looks when it is enabled:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](graphics/3081_05_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'As you can see in the preceding screenshot, there are six different panels
    in Firebug. Let''s discuss each of the panels in brief:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Console:** This is the most useful panel of Firebug to debug Ajax-rich applications.
    You can log different messages, information, or warnings in this tab, from JavaScript
    and PHP (using FirePHP). Here, you have an option called **Profile** that lets
    the user record the JavaScript activity in a specified period. Furthermore, you
    can also execute your own code on this panel.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**HTML:** Normally, any HTML elements that are added or appended to the web
    page can''t be viewed by the **View Source** option of the web browser. However,
    the **HTML** pane shows the real-time HTML elements of a web page that might have
    been added by the executed JavaScript code. This panel can also be used for editing
    HTML/CSS code dynamically within the browser and viewing the output in real time.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**CSS:** In this panel, you can see the list of **CSS** scripts used for the
    web page. Furthermore, you can edit CSS scripts from this panel virtually and
    see the output of changed properties directly in the browser.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Script:** Using this panel, you can find out that what scripts the current
    web page is using. This panel also lets you debug the JavaScript code by allowing
    to you to set a breakpoint and watch the expression or variable while debugging.
    You can always continue the script execution using *F8* after breakpoints, and
    you can use the *F10* key for step-by-step script execution. This is one of the
    important features you''ll find in Firebug, which is normally present in many
    a programming language **IDE(Integrated Development Environment)**.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**DOM:** Using this panel, you can explore the **Document Object Model (DOM)**
    of a web page. DOM is a hierarchy of objects and functions that can be called
    or handled by JavaScript. This panel lets you explore and modify DOM objects easily.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Net:** This panel is known the as the **Network activity monitoring** panel
    of the web page. When enabled, this panel shows you each HTTP request the page
    has made and how much time it took to load the objects, such as CSS files, images,
    or JavaScript files. Apart from this, you can also examine the HTTP header of
    each HTTP request and response. In addition to this, the details of `XMLHttpRequest`
    can also be found in this panel and the Console panel, along with the other information,
    such as Ajax request, response, HTTP method, and supplied data via GET or POST
    methods.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The Firebug API provides a very powerful object called **console** to log the
    data to the **Console** panel directly. It can log any kind of JavaScript data
    and object to the console. You can easily write data to the console with the popular
    `console.log()` functions, which look like `console.log(''testing'')`;. You can
    pass as many arguments as you want to this function, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: When you log an object in the Firebug console using `console.log(document.location)`;,
    you can see the object list in the **Console** panel with a link to its property
    and methods. You can click on the objects to explore the details of properties
    and methods. Along with `console.log()`, there are other functions to show messages
    in the Firebug console, with different visual effects. Some of these are `console.debug(),
    console.info(), console.warn()`, and `console.error()`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s see how this logging of information works with a simple example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The preceding code snippet is a simple example using the jQuery framework of
    JavaScript.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can find more information about jQuery in [Chapter 2](ch02.html "Chapter 2. Basic
    Utilities"), *Basic Utilities*, in this book. More information about jQuery can
    be found at [http://www.jquery.com](http://www.jquery.com).
  prefs: []
  type: TYPE_NORMAL
- en: 'All the different functions of the console get executed and are shown in the
    **Console** panel of **Firebug**, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](graphics/3081_05_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: You can see that execution of the preceding code produces the different types
    of messages in the console with the different colors. You may also notice that
    `console.log(document.location)`; produced the hyperlinks of the different properties
    of this object.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you're using `console.log()` or any other console functions in the development
    environment in your JavaScript code, then make sure Firebug is activated; otherwise,
    the JavaScript code's execution might get halted, leading to unexpected results
    when these functions are encountered in code. The same thing can happen in Internet
    Explorer 7 or older versions. Please make sure that all the console functions
    are removed while moving the website to the production environment.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now, let's look at how Firebug can help you with debugging `XMLHttpRequest`,
    using another example where the Ajax response from the PHP script is unpredictable.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following JavaScript code makes the Ajax request:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'The preceding code is jQuery JavaScript code. We''re making an Ajax request
    (POST method) to `test.php` with POST data `start` and `end` with values of `1`
    and `200`, respectively. Now, let''s look at the server-side script in PHP:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: The server-side code just picks a random number between the `start` and `end`
    parameters, which are available in PHP as POST data.
  prefs: []
  type: TYPE_NORMAL
- en: Now, let's go back and look at the `success` function of Ajax in the preceding
    JavaScript code. It first logs the number returned from server-side script to
    the Firebug console. Then, this number is converted strictly into integer type
    using the `parseInt()` function. The number returned from Ajax is basically `String`
    data type and it can't be subjected to mathematical operations; so, it is first
    converted into an integer.
  prefs: []
  type: TYPE_NORMAL
- en: 'After that, this number is checked with a modulus operator to see whether it
    is an odd number or even number and information is displayed accordingly, in the
    **Firebug** console. Let''s look at the result in the Firebug console:'
  prefs: []
  type: TYPE_NORMAL
- en: '![There''s more...](graphics/3081_05_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The log and message are displayed accordingly, as you can see in the screenshot.
    These are trivial but you can see something new in the first line in the console,
    and you can easily guess this is the Ajax request, which has a **+** symbol on
    the left.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s try to explore the details of the Ajax request and response by clicking
    on the **+** symbol. The result is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![There''s more...](graphics/3081_05_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As you can see in the in the preceding screenshot, the first tab is **Headers**;
    it shows the HTTP headers of the request and response too.
  prefs: []
  type: TYPE_NORMAL
- en: The **Post** section shows what data was posted to the server via the POST method.
  prefs: []
  type: TYPE_NORMAL
- en: The **Response** tab shows the response of the Ajax request.
  prefs: []
  type: TYPE_NORMAL
- en: Furthermore, the last tab shows data in HTML format, if the response is in HTML
    format. This last tab can be XML, JSON or HTML depending on the response of the
    data from the server-side script.
  prefs: []
  type: TYPE_NORMAL
- en: Debugging with FirePHP
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Firebug lets you to log the debugging messages to console from JavaScript. However,
    in a very complex server-side script on an Ajax application, it might get very
    tough to debug the application if we log all the messages as a single string using
    the `console.log()` function. FirePHP comes in handy when we need to debug Ajax-rich
    applications that have very complex PHP scripts involved with them. FirePHP is
    an extension of Firebug, which itself is a popular add-on for the Mozilla Firefox
    browser. FirePHP lets you log debugging messages and information to the Firebug
    console with the help of the FirePHP library.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You might be wondering if passing JSON or XML data from PHP code as an Ajax
    response and parsing it with JavaScript and then FirePHP might break your application,
    if you log some message to the console. It won't; FirePHP sends a debugging message
    to the browser via special HTTP Response headers so logged messages to FirePHP
    don't break the application at all.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To install FirePHP you need to have FireBug installed in your Mozilla Firefox
    browser. You can get FirePHP installed from its official website [http://www.firephp.org/](http://www.firephp.org/).
    You need to click on the **Get FirePHP** button and follow the steps to install
    FirePHP. Once you've got FirePHP installed, you need to download PHP library to
    use with FirePHP. You can download the PHP library from [http://www.firephp.org/HQ/Install.htm](http://www.firephp.org/HQ/Install.htm).
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, FirePHP is installed and enabled and you''ve also downloaded the PHP library
    of FirePHP. Let''s see how to use it:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](graphics/3081_05_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get started with FirePHP, first of all you need to include the core FirePHP
    class in your PHP code, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Once you''ve included your library, you need to start the output buffering,
    since logged-in messages are sent as an HTTP Response header:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You don't need to call the `ob_start()` function explicitly, if output buffering
    is turned on in the`php.ini` directive. More information about **output buffering**
    configuration can be found at [http://us.php.net/manual/en/outcontrol.configuration.php#ini.output-buffering](http://us.php.net/manual/en/outcontrol.configuration.php#ini.output-buffering).
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, after this, let''s create the instance of the FirePHP object:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'After this, let''s log some messages to the FireBug console using FirePHP:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '![How it works...](graphics/3081_05_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As you can see in the preceding screenshot, arrays are displayed in a detailed
    format in the Firebug console. Now, let's try to log more variables in a fancy
    manner.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The variable viewer (refer to the preceding screenshot) of FirePHP is displayed
    when your mouse cursor is moved over the logged-in variable, in the console.
  prefs: []
  type: TYPE_NORMAL
- en: 'Furthermore, let''s try to log different types of debug messages to the FireBug
    console using different functions, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'The preceding functions are quite similar to the console functions of Firebug.
    The output for these functions looks like the following in the Firebug console:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](graphics/3081_05_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As you can see in the preceding screenshot, the `info(), warn()`, or `error()`
    functions of the FirePHP library help to log messages in different styles, to
    debug the PHP code.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Please make sure that you disable FirePHP logging while using the website in
    production mode, because otherwise anyone who has FirePHP and Firebug can view
    sensitive information in the website easily. You can disable FirePHP logging by
    calling the function `$fp->setEnabled(false)`; instantly after creating the instance
    of the FirePHP object.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'FirePHP also has the **Procedural API**. To use the Procedural API of FirePHP,
    you need to include `fb.php` in your code (which is provided with the FirePHP
    PHP library), as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, you can simply call the message to the Firebug console by using the `fb()`
    function. For example, you can use the following code to log messages to the console:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When you have included `fb.php` in the code, you can call the `info(), warn(),
    error()`, or `log()` functions, using the `fb` class directly. For example, you
    can use `FB::info($var,'Info Message')`; to display the `info` message to the
    console.
  prefs: []
  type: TYPE_NORMAL
- en: Debugging with the IE developer toolbar
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Like Firebug, Internet Explorer also contains a developer toolbar, which is
    used for debugging and editing HTML, CSS, and JavaScript code for a web page.
    The **IE developer toolbar** comes built-in with Internet Explorer 8\. In previous
    versions, it can be used as an add-on to Internet Explorer. If you're using Internet
    Explorer 7 or below, the IE developer toolbar can be downloaded from the Microsoft
    website, using the URL [http://www.microsoft.com/downloads/en/details.aspx?familyid=95E06CBE-4940-4218-B75D-B8856FCED535&displaylang=en](http://www.microsoft.com/downloads/en/details.aspx?familyid=95E06CBE-4940-4218-B75D-B8856FCED535&displaylang=en).
    But, in this topic, we will be discussing the IE developer toolbar available in
    Internet Explorer 8.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'You can always use Firebug Lite in any browser except Firefox. Here are the
    instructions about how Firebug Lite can be used in any browser: [http://getfirebug.com/firebuglite](http://getfirebug.com/firebuglite).'
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Internet Explorer **Developer Tools** consists mainly of four different
    panels for debugging and editing HTML, CSS, and JavaScript.
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](graphics/3081_05_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'They are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**HTML** panel: This panel is used to view the HTML code of the website. Using
    this panel, you can see the outline of individual HTML elements, change their
    attributes and CSS properties, and preview the output in real time, in the browser.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**CSS** panel: This is very similar to the CSS panel of Firebug. Here, you
    view and edit the CSS properties underlying the different stylesheets associated
    with the web page. You can also preview the changes in CSS properties in real
    time.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Script** panel: This panel allows you to debug the JavaScript code of the
    web page. Furthermore, you can put breakpoints on the JavaScript code and step
    through the code and watch the variables.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Profiler** panel: The **Profiler** panel of the IE developer toolbar allows
    you to analyze the performance of the JavaScript functions that are used within
    the web page. It records the time taken to execute those functions and how many
    times they are called; so, it becomes easy to debug those functions if some of
    them are coded poorly.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The **Script** Panel of the developer toolbar allows debugging of the script
    by allowing placing of break points, stepping through the code, and also watching
    of the variables. Furthermore, like Firebug, you can also log messages to the
    console with console functions.
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, the following JavaScript console functions will send log, info,
    warning, and error messages, respectively, to the console of the IE developer
    tool:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'The output of the code looks like the following screenshot in the console of
    the IE Developer Tool:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](graphics/3081_05_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: You can see the message is displayed in the console in quite similar a fashion
    to how it was in Firebug. But, unfortunately, there are no add-ons such as FirePHP
    for Internet Explorer till date.
  prefs: []
  type: TYPE_NORMAL
- en: Avoiding the framework $ conflict
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '`$` is very commonly used in many JavaScript frameworks as a function name
    or variable name. When two different JavaScript libraries are used together, there
    is high chance of conflict in use of the $ symbol, as they might use it for different
    purposes. Let''s suppose two frameworks are used in a page and these are jQuery
    and `prototype.js:`'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: When two frameworks are used together and both frameworks use the `$` symbol,
    the result can be unpredictable and may break as jQuery considers `$` as a jQuery
    object, while in `prototype.js`, it's a DOM accessing function. The code `$('mydiv').hide()`;
    might not work properly in the web page containing the preceding JavaScript framework's
    usages. This is because, jQuery is included in the last line but the code `$('mydiv').hide()`;
    is code from the `prototype.js` framework, which leads to an unexpected result.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you're using jQuery with other frameworks, there is no problem. JQuery has
    a magic `noConflict()` function, which allows you to use jQuery with other frameworks.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now, let''s try use the preceding code using jQuery''s `noConflict()` function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As you can see in the preceding code, we've create another alias, `$jq` instead
    of `$`, to reference the jQuery object. Now in the remaining code, `$jq` can be
    used to reference the jQuery object. The `$` can be used by the `prototype.js`
    library, for this purpose, in the rest of the code.
  prefs: []
  type: TYPE_NORMAL
- en: Using the anonymous function of JavaScript
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The **Anonymous function** of JavaScript is very useful for avoiding conflicts
    in the JavaScript library.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let''s first understand the Anonymous function with an example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'When we execute the preceding code in a browser, it will display the alert
    `Hello world`. Now, that''s interesting! A function is defined and also executed!
    Let''s simplify the same code snippet and see how it works:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: If you see the equivalent code, it's straightforward. The only difference is
    that this simplified code has the variable name `t` associated with the function
    while, in the other code, the function name is anonymous. The Anonymous function
    gets executed instantly after declaring it.
  prefs: []
  type: TYPE_NORMAL
- en: Anonymous functions are very useful while creating the plugins of JavaScript
    frameworks, as you don't have to worry about conflicts with other plugins that
    have the same name as their functions. Remember, using a similar name for two
    functions will always lead to JavaScript errors and might break the application.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, let''s see how we can use Anonymous functions with jQuery to avoid the
    `$` conflict:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the preceding function, the jQuery object is passed to the function as a
    `$` parameter. Now, `$` has a local scope within Anonymous functions so, `$` can
    be used freely inside the anonymous function, to avoid conflicts. This technique
    is often used for creating jQuery plugins and using the `$` symbol inside the
    plugin's code.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now, let's use the Anonymous function similarly in a Mootools framework to avoid
    the `$` conflict. The `$` symbol in a Mootools framework refers to the `document.id`
    object.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: Now, in the preceding function, `$` can be used locally where it refers to the
    `document.id` object of the Mootools framework.
  prefs: []
  type: TYPE_NORMAL
- en: Fixing memory leaks in JavaScript
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Memory leaks can be one of the tedious problems in JavaScript, if JavaScript
    code is not written properly, considering memory usage. Such code might make your
    browser unstable by overloading memory.
  prefs: []
  type: TYPE_NORMAL
- en: What is a memory leak?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Memory leaks** occur when memory allocated by JavaScript consumes physical
    memory but can''t release the memory. JavaScript is a language that does garbage
    collection. Memory is assigned to an object when created and later on memory is
    returned once the object has no more references.'
  prefs: []
  type: TYPE_NORMAL
- en: What might cause a memory leak?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'There might be a lot of reasons behind memory leaks, but let''s explore two
    major possibilities:'
  prefs: []
  type: TYPE_NORMAL
- en: You're creating a lot of elements or JavaScript objects without cleaning up
    the unused ones.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You're using a circular reference in your JavaScript code. Circular reference
    occurs when a DOM object and JavaScript Object refer to each other circularly.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fixing memory leaks
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'First of all, let''s understand how to find out whether unwanted elements are
    getting generated from the script; we can use the Firebug console to do it. You
    can put the following code into the console of Firebug, as shown in the screenshot
    following it:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: '![Fixing memory leaks](graphics/3081_05_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The preceding code will log all counts of the elements in the DOM. So, if you
    see the count is increasing exponentially in the subsequent usages of the page,
    there is a problem with your code and you should always try to delete or remove
    the elements that are not in use anymore.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After finding out, how do we debug the unwanted elements created by script?
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s suppose that there is a JavaScript function that is getting called again
    and again, creating a huge stack. Let''s try to debug such code using the `console.trace()`
    function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'When you click on the button, it will call the function `LeakMemory()`. The
    function calls itself 50 times. We''re also using the `console.trace()` function
    to trace the function calls. You can see the following output in the Firebug console:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](graphics/3081_05_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You can clearly see that the `console.trace()` function traces each function
    call. It lets you debug and trace the JavaScript application that is creating
    an unwanted stack of function calls.
  prefs: []
  type: TYPE_NORMAL
- en: 'After this, let''s talk about the circular reference memory leak pattern in
    JavaScript, with an example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The preceding example is taken from a great article you can find about memory
    leaks on IBM''s website: [http://www.ibm.com/developerworks/web/library/wa-memleak/](http://www.ibm.com/developerworks/web/library/wa-memleak/).'
  prefs: []
  type: TYPE_NORMAL
- en: As you can see in the preceding example, the JavaScript object `obj` is referring
    to a DOM object with ID `DivElement. DivElement` is referring to the JavaScript
    object `obj`, which creates a circular reference between two elements and both
    elements are not destroyed, due to this circular reference.
  prefs: []
  type: TYPE_NORMAL
- en: 'When you run the preceding code, let''s see how memory consumption goes up
    in Windows Task Manager:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](graphics/3081_05_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As you can see, the memory usage curve goes up in the middle, when I run the
    web page containing the preceding code 4-5 times simultaneously.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Fixing the memory leak for circular reference is very easy. Just assign the
    object to the `null` element, after executing the code. Let''s see how it can
    be fixed in the preceding example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: Now, execute the preceding code in a web page while looking at the task manager.
    You won't see any significant fluctuation in memory usage.
  prefs: []
  type: TYPE_NORMAL
- en: Sequencing Ajax Requests
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As the name suggests, Ajax is asynchronous, so the sequence of code might not
    be followed, as most of the logical activities are done when the HTTP request
    is completed.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it ...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let''s try to understand the Ajax request with an example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: 'Once executed, the preceding code is seen as follows in the Firebug console:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it ...](graphics/3081_05_14.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Although the `$.ajax` function is called first, due to the asynchronous nature
    of the code, the **second log** is printed first (as this line of code follows
    directly after the `$.ajax` function). Then, `success: function` gets executed
    when the HTTP request is completed and, after that, **first log** gets printed
    to console.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Sequencing Ajax requests is a technique that is widely used in real-time applications.
    In the following example, let''s use a simple function using jQuery to sequence
    Ajax requests, to show the server time in the browser. First, let''s look at the
    JavaScript function that will send the sequence of Ajax requests:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: The function is straightforward. On each successful Ajax request, it calls the
    same function again. Please note that we're sending one request at a time to the
    server. Once that is completed, another request is sent.
  prefs: []
  type: TYPE_NORMAL
- en: If there is an error, or let's say the Ajax request is not completed, we will
    retry it after waiting for 5 seconds before sending another Ajax request. In this
    way, we minimize the number of requests to the server if there is some problem
    that the server is facing to complete the request.
  prefs: []
  type: TYPE_NORMAL
- en: Now, let's look at the PHP code in `ajax.php:`
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: As you can see in the preceding PHP code, the server waits for a second before
    printing the current time at the server. This is normally how server-side scripts
    work in real-time web applications. For example, a real-time chat application
    waits until a new chat message comes in to the database. Once the new message
    is in the database, the application sends out the latest chat message to the browser
    to display it.
  prefs: []
  type: TYPE_NORMAL
- en: Cross Browser and Ajax
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We all know that the core of the Ajax technique is the `XMLHttpRequest` object
    available in JavaScript. But this object is not necessarily available in your
    browser, especially in Internet Explorer, depending upon the browser and platform.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'It can be instantiated natively in browsers such as Mozilla Firefox, Google
    Chrome, Safari, and even IE7 or later, which support the native `XMLHttpRequest`
    object as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 'Now, in Internet Explorer 6 or 5, to use the `XMLHttpRequest` object, it has
    be created as a ActiveX object in JavaScript:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: 'But even the ActiveX object class can be different from one Windows platform
    to another, so we might also have to use the following code:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: 'Now, let''s create an Ajax function that will return the `XMLHttpRequest` object
    in a cross-browser platform:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: Since no browser except Internet Explorer supports ActiveX objects, the instance
    of the `XMLHTTPRequest` object is created using `try` and `catch` block statements,
    so that there are no JavaScript errors and so the code can be used in a cross-browser
    fashion.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If your web page already uses a JavaScript framework like jQuery or Mootools,
    you can use their core Ajax functions. These libraries are mostly released with
    functions that support multiple browsers and platforms and are updated with time,
    so using such a JavaScript library is highly recommended.
  prefs: []
  type: TYPE_NORMAL
- en: Beautifying JavaScript
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We''ve already seen how to minify JavaScript code using JSMin in the last chapter,
    <add name>. Now, let''s try to reverse engineer minified JavaScript code and beautify
    it. We can use the tool **JsBeautifier** to uncompress and beautify JavaScript
    code. It can be used directly from the URL [http://jsbeautifier.org/](http://jsbeautifier.org/),
    or you can download the code from Github using the URL [http://github.com/einars/js-beautify/zipball/master](http://github.com/einars/js-beautify/zipball/master).
    Let''s first look at the how the code in the `get_time()` function looks when
    compressed using JSMin:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: When JavaScript code is compressed, the file takes less space and loads faster
    in web pages, but its becomes very difficult to edit the code when we need to
    add new functionalities to that file. In such a case, we need to beautify the
    JavaScript code and edit it. Now, let's get back the beautified JavaScript code
    using [http://jsbeautifier.org/:](http://jsbeautifier.org/)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It is always recommended that we use compressed JavaScript code in the production
    server since it takes less space and loads faster than the beautified code format.
    But, in the development server, it's always recommended to have beautified code
    so it can be changed or edited later on.
  prefs: []
  type: TYPE_NORMAL
