- en: Chapter 9. Post-Exploitation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Welcome! We compromised a single target on the network in the previous chapter.
    So what happens next, you may ask yourself? The attacker is more than likely to
    dive deeper to attack internal workstations and servers. In this chapter, we will
    be covering the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: How to create a pivot
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Documenting our work
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Cleaning up our work
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Protecting ourselves against pivoting
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Post-Exploitation](img/3183OS_09_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Creating a pivot
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We've cracked the wireless encryption, gained access to the network, and compromised
    a system. The next step the attacker will take is avoid **Intrusion Prevention
    Systems** (**IPS**) or **Intrusion Detection Systems** (**IDS**). Pivoting will
    accomplish this by routing traffic to the compromised system and then using the
    compromised system's traffic to launch additional attacks against additional workstations
    and servers on the internal network. This will fool the IPS and firewall logs
    into displaying the internal IP address rather than the external IP of the attacker.
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a pivot](img/3183OS_09_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Now, you might ask yourself, why on earth would I want to purchase an IDS or
    IPS if it can't protect my network? Well, it's not only important to have an IDS
    or IPS active on the network, but it's also important that it is monitored and
    reviewed on a daily basis. If nobody is monitoring or reviewing the IDS or IPS
    properly, then you may already have someone lurking on your network without your
    knowledge.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s take a few moments to discuss why it is important to have an IDS or
    IPS:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Physical security:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How do you know someone isn't already on your network?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: They could be accessing sensitive data right now
  prefs: []
  type: TYPE_NORMAL
- en: Did you forget to disable SSH when working on the firewall?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All it takes is one open hole for an attacker to get access then possibly gain
    access to additional content
  prefs: []
  type: TYPE_NORMAL
- en: 'Reliability and stability:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Risk management
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Less impact on business operations
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Business continuity
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Less business downtime
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Flexibility:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Access security control features that others cannot
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Provide that extra layer of security and control
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Peace of mind:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When other security controls fail unexpectedly, an IDS can provide that extra
    security service
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Knowing who and what comes into your network to access data is very important,
    especially if it contains customer data or other sensitive information
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Creating a pivot](img/3183OS_09_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: In conclusion, security is becoming more of a requirement for businesses. Businesses
    lose money because they didn't take that extra security measure to protect their
    customer's personal data. In some circumstances, this information can be released
    in public. When publicly released, the business can lose both current and new
    customers.
  prefs: []
  type: TYPE_NORMAL
- en: Enough talk on IDS and IPS, it's time to begin our demonstration of pivoting
    for this chapter. Before we begin, we must have already compromised a system with
    access to a Meterpreter session. If you have not done that yet, please refer to
    [Chapter 8](ch08.html "Chapter 8. Data Capture and Exploitation"), *Data Capture
    and Exploitation*.
  prefs: []
  type: TYPE_NORMAL
- en: Let's begin!
  prefs: []
  type: TYPE_NORMAL
- en: 'Access Meterpreter and type:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'This displays the internal IP address:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a pivot](img/3183OS_09_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Run a network scan and type:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'This reveals all the hosts on the internal network:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a pivot](img/3183OS_09_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Then type `background`. This keeps the Meterpreter session running while we
    run other commands within the Metasploit console.![Creating a pivot](img/3183OS_09_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Then, we add the route from the default gateway to the compromised system and
    type:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: This will route all the traffic from the default gateway through the compromised
    system. This will provide us with access to additional hosts within the internal
    network, therefore compromising those systems as well.
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a pivot](img/3183OS_09_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Congratulations! You have successfully created a pivot. The internal network
    is fully accessible and here you can run exploits on the other hosts without the
    concern of an IDS, IPS, or firewall alert. The attacks will look like they came
    from the internal network.
  prefs: []
  type: TYPE_NORMAL
- en: Documenting your penetration test
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Possibly one of the most important parts of a penetration test is documenting
    your work. The best way to start documenting your penetration test would be to
    create an outline.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is an example of a professional outline:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Introduction**:'
  prefs: []
  type: TYPE_NORMAL
- en: Perform a penetration test on the client's 10.0.0.0/24 network. The objective
    of this penetration test is to determine the wireless security of the 10.0.0.0/24
    network. The assessment is performed on several target systems. The results given
    are not intended to be for all hosts, but only those systems that fell within
    the IP scope.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All identified vulnerabilities detected are acknowledged by the client, John
    Doe, throughout the penetration test. This test does not run any **Denial of Service**
    (**DoS**) attacks; however, it is possible to determine whether a host is vulnerable
    to a DoS attack without performing an actual attack.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Systems**:'
  prefs: []
  type: TYPE_NORMAL
- en: Displays each target system on the network that will be identified and scanned
    for vulnerabilities![Documenting your penetration test](img/3183OS_09_10.jpg)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Methods and techniques**:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Discovery:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Check DNS records, whois servers, use network tools such as ping and traceroute,
    and the backbone firewalls and routers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Map the network using TCP, UDP, and ICMP echo requests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Documenting your penetration test](img/3183OS_09_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: steve p2008, Creative Commons 2.0 ([https://www.flickr.com/photos/stevepj2009/6857101082/](https://www.flickr.com/photos/stevepj2009/6857101082/))
  prefs: []
  type: TYPE_NORMAL
- en: 'Enumeration:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Identifying open TCP and UDP ports
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Detecting operating systems and software versions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Determining the type of host (firewall, DNS server, and mail server)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Determining whether hosts are vulnerable to remote exploitation attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: System configuration and banner grabbing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Exploitation:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Attempting to exploit any vulnerabilities or weaknesses
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Executing buffer overflow exploits
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Gaining system-level access
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Brute-force attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Risks**:'
  prefs: []
  type: TYPE_NORMAL
- en: Each vulnerability is organized by the level of risk (low, medium, and high)
    along with details of the security concerns and the threats that are available
    to those vulnerabilities.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Any information in which an unauthorized user could access sensitive information
    regarding customer data, business data, employees, or network infrastructure.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Security problems such as weak passwords or social engineering attacks that
    may result in compromised systems.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Non-secure doorway entries that don't require any keys or passcodes. This way,
    a system can be breached at any time to gather additional information.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Open wireless networks are not on a separate subnet in which an attacker could
    remotely access servers or other hosts on the network.![Documenting your penetration
    test](img/3183OS_09_14.jpg)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Conclusion**:'
  prefs: []
  type: TYPE_NORMAL
- en: Details the percentage of overall risk concerns during the penetration test
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Provides details regarding vulnerabilities, weaknesses, concerns, data leaks,
    and unidentified sources
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Cleaning up unnecessary work
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It is time that we begin to clean up everything from our results of the penetration
    test. We want our report to be as clean, simple, and professional as possible
    for our client when we finish our penetration test. List every detail and all
    actions that have been performed during the penetration test. Any compromised
    hosts must be cleaned securely enough that it will not affect the normal business
    operations. The process should be verified by a technical staff member to ensure
    everything has been completed successfully in a good manner.
  prefs: []
  type: TYPE_NORMAL
- en: '![Cleaning up unnecessary work](img/3183OS_09_15.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Any leftover bad security practices and misconfigured systems should not be
    left unattended without some kind of reconfiguration or secure setting change.
    Encrypt and back up any important documents or information used during the penetration
    test. Delete or remove any unused user accounts that may have been created for
    testing. It is the penetration tester's responsibility to inform the organization
    about any system changes that have been made to the network.
  prefs: []
  type: TYPE_NORMAL
- en: Prevention
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we saw how we could attack a system, gain access to another
    system on the same subnet, and then attack a computer on a different subnet from
    there. While the scenario didn't cover any corporate firewalls, it is possible
    for a corporate firewall to block access to those systems or networks. If you
    happen to believe your network is in the middle of getting pivoted or compromised,
    immediately disconnect from the network. Then, begin to trace down the root cause
    and isolate it from the rest of the network. The real problem we have here is
    a lack of security awareness. The compromised user may have clicked on a malicious
    link or downloaded an e-mail attachment or software that they trusted to be legitimate.
  prefs: []
  type: TYPE_NORMAL
- en: '![Prevention](img/3183OS_09_16.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This is why it is extremely important to educate staff on security. Social engineering
    attacks are becoming more sophisticated in order to provide even better results.
    The best way to protect yourself is you and others getting educated on the threat.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We started this chapter with an introduction to pivoting and how it works, followed
    by a demonstration through Kali Linux. With documenting our penetration test,
    we were able to organize our work and list every detail given within an outline.
    Documenting is an important process to prepare us for planning and writing our
    report in the next chapter. Once we finished documenting our work, we started
    cleaning up all the unnecessary work.
  prefs: []
  type: TYPE_NORMAL
- en: Any new folders, files, user accounts, or altered system settings should be
    deleted or removed. Finally, we provided a rundown on protecting ourselves from
    a pivoting attack. In the next chapter, we will be providing a penetration testing
    report that will contain detailed information on vulnerabilities from our previous
    wireless penetration test.
  prefs: []
  type: TYPE_NORMAL
