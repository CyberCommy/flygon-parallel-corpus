- en: Setting Up Your Test Lab
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we look at setting up a lab environment for our penetration
    tests. Many of the tests should first be performed in this confined lab environment
    before attempting them in a production environment. Remember that you must obtain
    written permission when working on a live environment, as well as following all
    local laws when carrying out any stage of the penetration test on a network. It
    may also be a good idea to have a lawyer review any contract and engagement details
    before you commence to avoid any issues that may arise during or after the exercise.
    Some insurance companies also offer coverage to penetration testers in the event
    of unexpected damages.
  prefs: []
  type: TYPE_NORMAL
- en: To avoid running into legal issues and unnecessary expenditure as a result of
    penetration testing, it's highly recommended that you build a test environment,
    whether physical or virtual, in an effort to familiarize yourself with the tests
    and their results, as well as understand the impact of the tests on hardware,
    software, and bandwidth, as many of these tests are disruptive to devices and
    organizations.
  prefs: []
  type: TYPE_NORMAL
- en: 'We will cover the following topics in detail:'
  prefs: []
  type: TYPE_NORMAL
- en: Setting up a Windows environment in a VM
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing vulnerable servers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing additional tools in Kali Linux
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Network services in Kali Linux
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional labs and resources
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Minimal hardware requirements: 6 GB RAM, quad-core 2.4 GHz processor, 500 GB
    HDD'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'VirtualBox: [https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Metasploitable 2: [https://sourceforge.net/projects/metasploitable/files/Metasploitable2/](https://sourceforge.net/projects/metasploitable/files/Metasploitable2/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Packer: [https://www.packer.io/downloads.html](https://www.packer.io/downloads.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Vagrant: [https://www.vagrantup.com/downloads.html](https://www.vagrantup.com/downloads.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Metasploitble 3 (300 MB file)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Metasploitable 3 (6 GB `.ova` file for VirtualBox): [https://mega.nz/#!XQxEAABQ!frdh5DgZE-tSb_1ajPwLZrV4EZuj1lsS3WlWoLPvBjI](https://mega.nz/#!XQxEAABQ!frdh5DgZE-tSb_1ajPwLZrV4EZuj1lsS3WlWoLPvBjI)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The BadStore vulnerable web server: [https://d396qusza40orc.cloudfront.net/softwaresec/virtual_machine/BadStore_212.iso](https://d396qusza40orc.cloudfront.net/softwaresec/virtual_machine/BadStore_212.iso.)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Physical or virtual?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Deciding whether to set up a physical or virtual lab (or a combination thereof)
    depends on your budget and available resources. Penetration testing can get quite
    expensive depending on the tools used, especially if opting for commercial tools,
    but it doesn't have to be, considering the many available open source tools in
    Kali Linux as well as those available on GitHub and GitLab.
  prefs: []
  type: TYPE_NORMAL
- en: As a professional penetration tester, I use two physical machines. One is a
    laptop outfitted with a 1 TB hard drive, 16 GB of DDR4 RAM, an i7 processor, and
    an NVIDIA GeForce GTX 1050 graphics card, outfitted with three virtual machines
    including the main OS (Kali Linux 2018.2). The second machine is an older Tower
    workstation with 2 TB drives, 24 GB of DDR3  RAM, and an Intel Xeon 3500 processor
    with onboard graphics card with several VMs, including those used as part of my
    virtual lab environment.
  prefs: []
  type: TYPE_NORMAL
- en: When creating your lab environment, it’s crucial that you know the minimum and
    recommended resources required by each operating system, including the host and
    all VMs. While many Linux-based operating systems require as little as 2 GB of
    RAM, it's always a wise choice to assign more than the specified recommended RAM
    to allow your tools to run without lagging or insufficient memory errors. Again,
    though, this will all depend on your available budget or resources at hand.
  prefs: []
  type: TYPE_NORMAL
- en: Setting up a Windows environment in a VM
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For the Windows environment test lab, I've chosen to install Microsoft Windows
    10 as it is currently the latest release by Microsoft. Many users with newer PCs
    and laptops may already be running Windows 10 but Windows 10, should also be installed
    as a virtual machine for testing purposes, thereby leaving the host OS untouched.
    This is also recommended for readers with older versions of Windows as well as
    Mac and Linux users, so they are able to work with the latest version of Windows
    as part of their penetration tests in the lab environment. In the real world,
    we will be seeing fewer Windows 7 machines as support for it has ended (making
    these systems highly vulnerable), although there will also be faithful users who
    are not open to upgrading just yet.
  prefs: []
  type: TYPE_NORMAL
- en: For this installation, we will be using an evaluation copy of Windows 10 Enterprise
    edition, available as a direct download from the Microsoft website. You can download
    your evaluation copy of Windows 10 Enterprise by visiting [https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise).
    Remember that unless you have or purchase a license, this version has a 90-day
    evaluation period.
  prefs: []
  type: TYPE_NORMAL
- en: Once at the download page, you should notice that there are two available versions,
    ISO and **Long-Term Servicing Branch** (**LSTB**). Choose ISO – Enterprise and
    click on Continue.
  prefs: []
  type: TYPE_NORMAL
- en: Complete the evaluation form details and click on Continue. Please remember
    the details entered as you will be required to authenticate via phone call or
    SMS later on during the installation.
  prefs: []
  type: TYPE_NORMAL
- en: Select your platform (32 bit or 64 bit) as well as your language, and click
    on Download to proceed.
  prefs: []
  type: TYPE_NORMAL
- en: You can now begin creating your Windows 10 virtual machine. VirtualBox or VMware
    can be used for this but in this instance I will be using VirtualBox.
  prefs: []
  type: TYPE_NORMAL
- en: Open VirtualBox and click on the New icon at the top left. Give your VM a name
    and choose the appropriate version (32, bit or 64, bit) depending on the version
    you previously downloaded. Click on Next to continue.
  prefs: []
  type: TYPE_NORMAL
- en: 'Assign available RAM to the VM. The recommended memory is 2 GB, but I have
    assigned just over 6 GB as I have 24 GB of RAM on my machine. Remember to factor
    in the host usage, as well as other VMs such as Kali Linux, which may be running
    simultaneously:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/241ca8c8-b65e-4c11-804c-178357b2830e.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Add a new virtual hard disk by clicking on Create a virtual hard disk now and
    then clicking on Create.
  prefs: []
  type: TYPE_NORMAL
- en: For the hard disk file type, select **VirtualBox Disk Image** (**VDI**) and
    click on Next.
  prefs: []
  type: TYPE_NORMAL
- en: Choose the Dynamically Allocated option under Storage on the physical disk.
    This option conserves hard drive space by using space on the physical disk only
    when it is used as opposed to creating a fixed size space on the disk that may
    not be used. Click Next to continue.
  prefs: []
  type: TYPE_NORMAL
- en: 'When choosing the size of the virtual disk, consider the recommended HDD space
    as well as the space of the applications you may wish to install (such as Metasploitable)
    in the VM. In this instance, I''ve allocated 64 GB of HDD space. Click on Create
    to continue:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/96f5b4c7-2ea6-4e41-b55d-2a7670c3ec47.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'At this point, we must now point the ISO image to the VM. In the VirtualBox
    Manager, click on your newly created Windows 10 VM instance and click on the Start
    arrow. In the Select start-up disk box, click on the folder icon and browse the
    downloaded Windows 10 evaluation copy. Click on Start to continue:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/880ea3cb-1f2c-4ace-bb87-bc02ac42e86a.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This brings us to the Windows Setup splash screen. Enter the relevant information
    for your setup and click on Next to continue.
  prefs: []
  type: TYPE_NORMAL
- en: Click on Install now to begin the installation process.
  prefs: []
  type: TYPE_NORMAL
- en: 'Accept Microsoft''s license terms and click on Next to continue. Choose the
    Custom Installation option and then click on New and then Apply to format the
    VM hard disk:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/8f2c3138-cac9-4272-ba7b-ff4d1bcb2714.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Once formatted, ensure that the partition with the size you previously specified
    is selected and click on the Next button to continue:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a22d262d-b6d2-4a81-b203-df9b19f37827.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The installation process will begin and will also take some time to complete.
    In the meantime, have a look at some of the other great titles on penetration
    testing at [https://www.packtpub.com/tech/Penetration-Testing](https://www.packtpub.com/tech/Penetration-Testing).
  prefs: []
  type: TYPE_NORMAL
- en: Once the installation is complete as shown in the following screenshot, allow
    the OS to restart automatically.
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6a064124-13c9-4460-9b48-1d6ef9722746.jpg)'
  prefs: []
  type: TYPE_IMG
- en: You will then be prompted to choose your language and keyboard layout before
    continuing with the setup, after which you will then be prompted to enter a work
    or student email before choosing your privacy settings.
  prefs: []
  type: TYPE_NORMAL
- en: To set up your secure sign-in, click on Set up PIN. You may be first be required
    to verify your identity via phone call or SMS. Once verification is complete,
    you will be able to set up a pin. Be sure to remember this PIN (minimum six digits)
    as you will be required to use your pin to sign in.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once setup is complete, you can now configure your network and install your
    apps. At the lower-right corner of the screen, you should see the details of your
    evaluation copy:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/3e02e2c7-f684-4497-a4cd-608d03be818f.jpg)'
  prefs: []
  type: TYPE_IMG
- en: You may want to save the machine state in the event you need to quickly restore
    the VM to a working state.
  prefs: []
  type: TYPE_NORMAL
- en: Installing vulnerable servers
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we will install a vulnerable virtual machine as a target virtual
    machine. This target will be used in several chapters of the book, when we explain
    particular topics. The reason we chose to set up a vulnerable server in our machine
    instead of using vulnerable servers available on the internet is because we don't
    want you to break any laws. We should emphasize that you should never pentest
    other servers without written permission. Another purpose of installing another
    virtual machine would be to improve your skills in a controlled manner. This way,
    it is easy to fix issues and understand what is going on in the target machine
    when attacks do not work.
  prefs: []
  type: TYPE_NORMAL
- en: In several countries, even port scanning a machine that you don't own can be
    considered a criminal act. Also, if something happens to the operating system
    using a virtual machine, we can repair it easily.
  prefs: []
  type: TYPE_NORMAL
- en: In the following sections, we will be setting up the Metasploitable 2 and Metasploitable
    3 virtual machines as vulnerable servers. Metasploitable 2 is older but easier
    to install and configure. Metasploitable 3 is more recent and so has been updated
    to reflect updated vulnerabilities, but the installation is a bit different and
    sometimes problematic for new users. For this reason, we provide the readers with
    the option of Metasploitable 2 and 3, although we do recommend trying them both,
    should you have the available resources.
  prefs: []
  type: TYPE_NORMAL
- en: Setting up Metasploitable 2 in a VM
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The vulnerable virtual machine that we are going to use is Metasploitable 2\.
    The famous H.D. Moore of Rapid7 created this vulnerable system.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are other deliberately vulnerable systems besides Metasploitable 2 that
    you can use for your penetration testing learning process, as can be seen at the
    following site: [https://www.vulnhub.com](https://www.vulnhub.com).'
  prefs: []
  type: TYPE_NORMAL
- en: Metasploitable 2 has many vulnerabilities in the operating system, network,
    and web application layers.
  prefs: []
  type: TYPE_NORMAL
- en: Information about the vulnerabilities contained in Metasploitable 2 can be found
    on the Rapid7 site at [https://community.rapid7.com/docs/DOC-1875](https://community.rapid7.com/docs/DOC-1875).
  prefs: []
  type: TYPE_NORMAL
- en: 'To install Metasploitable 2 in VirtualBox, you can perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Download the Metasploitable 2 file from [http://sourceforge.net/projects/metasploitable/files/Metasploitable2/](http://sourceforge.net/projects/metasploitable/files/Metasploitable2/).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Extract the Metasploitable 2 ZIP file. After the extraction process is completed
    successfully, you will find five files:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Create a new virtual machine in VirtualBox. Set the Name to `Metasploitable2`,
    the operating system to `Linux`, and the Version to `Ubuntu`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the memory to `1024MB`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the Virtual Hard Disk setting, select Use existing hard disk. Choose the
    `Metasploitable` files that we have already extracted in the previous step.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Change the network setting to Host-only adapter to make sure that this server
    is accessible only from the host machine and the Kali Linux virtual machine. The
    Kali Linux virtual machine's network setting should also be set to Host-only adapter
    for pen testing local VMs.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Start the `Metasploitable2` virtual machine. After the boot process is finished,
    you can log in to the `Metasploitable2` console using the following credentials:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Username: `msfadmin`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Password: `msfadmin`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following is the Metasploitable 2 console after you have logged in successfully:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/736d2a8f-fec1-461d-a6b9-472b928f51e5.png)'
  prefs: []
  type: TYPE_IMG
- en: Setting up Metasploitable 3 in a VM
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Released in 2016 by Rapid7, Metasploitable 3 is the latest updated version which
    comes with more vulnerabilities than its predecessor. Metasploitable 3, however,
    is not available as a downloadable virtual machine but requires several components,
    which must be installed and configured, requiring the user to build the virtual
    machine themselves.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this example, I''ll be building the Metasploitable 3 VM on a Windows 10
    host machine. To do this, we will first need to download the following:'
  prefs: []
  type: TYPE_NORMAL
- en: VirtualBox or VMware (VirtualBox users have reported issues with version 5.2
    but have experienced good results using version 5.1.14, available on the VirtualBox
    page)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Packer
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Vagrant
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing Packer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Packer by Hashicorp is used to easily build automates images such as Metasploitable
    3\. Visit [https://www.packer.io/downloads.html](https://www.packer.io/downloads.html)
    and download the version of Packer for your OS. In this instance, I''ve downloaded
    the Windows 64-bit version:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b1b4fb03-0450-4b5f-a1dd-6ee358656201.png)'
  prefs: []
  type: TYPE_IMG
- en: Once downloaded, extract the contents of the file. There should be one file,
    in this case `packer.exe`.
  prefs: []
  type: TYPE_NORMAL
- en: 'From there, create a folder anywhere you like and name it packer. I''ve placed
    it on the `C:` drive of my system:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/bfb437ae-5348-4971-aa9c-bed7e7ca6187.png)'
  prefs: []
  type: TYPE_IMG
- en: At this point, you'll need to add the path to this folder in order to call the
    Packer application in the Command Prompt. Simply edit your environment variables
    and paste it into the path to `packer.exe`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Go to your Control Panel and click on Advanced system settings:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/82137962-71c6-448b-885e-74ed656aefa9.png)'
  prefs: []
  type: TYPE_IMG
- en: 'In the System Properties window, under the Advanced tab, click on Environment
    Variables:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/897ad4af-66f9-4230-8596-63eb30e00cea.png)'
  prefs: []
  type: TYPE_IMG
- en: You should see the Path entry under User variables for admin. In the System
    variables box, you should also the Path variable with an entry of `C:\Program
    Files (x86)\Common Files\Oracle|Java\javapath:..`
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on the `Edit` button to continue:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/85399e59-d3e2-43db-8503-7acf0a67ef8e.png)'
  prefs: []
  type: TYPE_IMG
- en: In the Edit environment variable, click on the New button in the top-right corner
    and select `C:\packer` from the list in the main window. Click on OK.
  prefs: []
  type: TYPE_NORMAL
- en: 'To test that the change was successful, launch the Command Prompt and type
    `packer`. You should return usage parameters and available commands if all is
    successful:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6ded105f-d008-4697-9159-d519e9db6993.png)'
  prefs: []
  type: TYPE_IMG
- en: Installing Vagrant
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Vagrant, also by Hashicorp, is open source and used in simplifying workflows
    and configurations in virtual environments. Visit [https://www.vagrantup.com/downloads.html](https://www.vagrantup.com/downloads.html)
    and download the Windows version.
  prefs: []
  type: TYPE_NORMAL
- en: Once the relevant downloader is installed (in this case, Windows), install Vagrant.
  prefs: []
  type: TYPE_NORMAL
- en: 'Assuming that you already have VirtualBox installed, download the Metasploitable
    3 source files from the GitHub repository at [https://github.com/rapid7/metasploitable3](https://github.com/rapid7/metasploitable3):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/9757e913-797f-411b-ad2f-6c3370476ded.png)'
  prefs: []
  type: TYPE_IMG
- en: Once the source files have been downloaded, extract the files to a location
    of your choice. Launch PowerShell in Windows 10, change directories until you
    arrive at the folder with the downloaded Metasploitable files, and enter the `./build_win2008`
    command.
  prefs: []
  type: TYPE_NORMAL
- en: This should be enough to get you started with building your Metasploit 3 server.
    It is a very complex build for beginners but definitely worth a try.
  prefs: []
  type: TYPE_NORMAL
- en: Pre-built Metasploit 3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For those having difficulty with building their own Metasploitable 3 server,
    a pre-built version can be found and downloaded from GitHub at [https://github.com/brimstone/metasploitable3/releases](https://github.com/brimstone/metasploitable3/releases).
  prefs: []
  type: TYPE_NORMAL
- en: This version of Metasploitable 3 was built by Brimstone (Matt Robinson) and
    is downloadable as an `.ova` file (Metasploitable3-0.1.4.ova) at only 211 MB.
    Once downloaded, the .ova file can be opened in VirtualBox by clicking on File
    and Import Appliance. You may wish to change the preset RAM amount to something
    greater than 1 GB if available.
  prefs: []
  type: TYPE_NORMAL
- en: 'Although there is a lengthy setup process, the installer does everything automatically
    and presents you will a complete version of the Metasploitable 3 Windows 2008
    server in the end:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fe741713-0db6-44ab-895d-e342c12d2a57.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Another fully configured pre-built Metasploitable 3 server can also be downloaded
    here: [https://mega.nz/#!XQxEAABQ!frdh5DgZE-tSb_1ajPwLZrV4EZuj1lsS3WlWoLPvBjI](https://mega.nz/#!XQxEAABQ!frdh5DgZE-tSb_1ajPwLZrV4EZuj1lsS3WlWoLPvBjI).'
  prefs: []
  type: TYPE_NORMAL
- en: Setting up BadStore in a VM
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The BadStore ISO is ancient compared to today's technology; however, unlike
    Metasploitable 3, it is incredibly easy to install and use. Readers with very
    limited knowledge and resources can use this ISO image as a starting point as
    it contains well-known exploits and is also under 15 MB in size.
  prefs: []
  type: TYPE_NORMAL
- en: The BadStore ISO image is no longer available in the official store as of writing
    this book, but there are several reputable links that can be used. As stated in
    a GitHub article at [https://github.com/jivoi/junk/blob/master/coursera_software-security/w3/project-2/info](https://github.com/jivoi/junk/blob/master/coursera_software-security/w3/project-2/info),
    the BadStore ISO can be downloaded from here: [https://d396qusza40orc.cloudfront.net/softwaresec/virtual_machine/BadStore_212.iso](https://d396qusza40orc.cloudfront.net/softwaresec/virtual_machine/BadStore_212.iso).
  prefs: []
  type: TYPE_NORMAL
- en: The manual for the BadStore ISO should also be downloaded as it contains essential
    information about IP connectivity and vulnerabilities in the OS.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once the file has been downloaded from the preceding link, open VirtualBox
    and click on File and New. Enter the details shown in the screenshot. Click on
    Next when finished:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2e516748-d319-49f3-aa63-e4648b9f80c4.png)'
  prefs: []
  type: TYPE_IMG
- en: 'BadStore uses very little RAM. The default allocation can be used, but I''ve
    allocated 640 MB of RAM. Click Next to continue:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d6ef949b-daca-417f-9d39-540cf852444e.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Complete the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Click on Create a virtual hard disk now and then click on the Create button
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Select **VirtualBox Disk Image** (**VDI**) as the hard disk file type and click
    on Next
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Select Dynamically Allocated when prompted to choose the physical storage option
    and click on Next
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For the File Location and Size, leave the default file size of 4 GB as BadStore
    also requires very little disk space
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Before starting your BadStore VM, click on the Settings button in the Oracle
    VM VirtualBox Manager. Click on the Network category in the left pane and change
    your adapter setting to Bridged Adapter and click OK. This will enable the VM
    to receive an IP address via DHCP (if it is enabled on your network) thereby simplifying
    the connectivity process in later steps:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/43ae07f6-721c-40b7-a382-8c5c68a67c38.png)'
  prefs: []
  type: TYPE_IMG
- en: 'In the Oracle VM VirtualBox Manager, click on the BadStore entry and click
    on the Start button:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/8cf744c8-6759-46a9-a669-b25b30294b2c.png)'
  prefs: []
  type: TYPE_IMG
- en: When prompted to select a startup disk, click on the Open Folder icon and browse
    to the `BadStore.iso` file, which you previously downloaded. Click Start to run
    the VM.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once BadStore is loaded, press Enter to activate the console:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/50fbdda1-7b73-4f5a-aedb-7dd6a866744f.png)'
  prefs: []
  type: TYPE_IMG
- en: 'After pressing *Enter*, enter the `ifconfig` command and press *Enter* to view
    your interface configurations. Note that in the following screenshot, in the `eth0`
    interface, the IP address (`inet addr`) is set to `192.168.3.136`. On your machine,
    it should be different, according to the IP scheme you are using. Take note of
    this IP as it will be required to connect to the BadStore VM via a browser:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6e4b7884-00c7-41c4-b5e7-20f3d78ee18d.png)'
  prefs: []
  type: TYPE_IMG
- en: Open a browser of your choice and in the address bar, enter the IP address of
    the BadStore VM followed by this syntax: `cgi-bin/badstore.cgi`.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this instance, I have entered the following URL in the address bar of my
    browser to access the BadStore VM: `http://192.168.3.136/cgi-bin/badstore.cgi`.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you have entered the IP of your BadStore VM and appended the preceding
    path, press enter and you will be presented with the BadStore frontend, as seen
    in this screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/eadbe524-69a5-4de1-bfd8-3d789bf01bf8.png)'
  prefs: []
  type: TYPE_IMG
- en: As mentioned earlier, the BadStore VM is nothing short of ancient, as reflected
    by the design of the interface; however, for beginners it contains a variety of
    common vulnerabilities that can be easily found and exploited with tools from
    Kali Linux covered in the following chapters.
  prefs: []
  type: TYPE_NORMAL
- en: Another similar and easy to set up VM that you can try is the **Damn Vulnerable
    Linux** (**DVL**) ISO. It can be downloaded from: [https://sourceforge.net/projects/virtualhacking/files/os/dvl/DVL_1.5_Infectious_Disease.iso/download](https://sourceforge.net/projects/virtualhacking/files/os/dvl/DVL_1.5_Infectious_Disease.iso/download).
  prefs: []
  type: TYPE_NORMAL
- en: Installing additional tools in Kali Linux
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Prior to or during a penetration test, it may be necessary to include other
    tools that are not commonly available with Kali Linux. The art of penetration
    testing has a great many individuals constantly creating tools that you can include.
    As a result, it may be necessary to install these tools in your Kali Linux setup.
    In other circumstances, it is generally a good idea to ensure that your tools
    are up to date prior to starting any penetration test.
  prefs: []
  type: TYPE_NORMAL
- en: When including additional penetration testing tools, it is advised to look within
    the Kali Linux repository first. If the package is available there, you can use
    the package and install it using the commands detailed next. Another option, if
    the tool is not available from the repository, is that the creator will often
    have a download option either on their website or through the software sharing
    and aggregation site [https://github.com/](https://github.com/).
  prefs: []
  type: TYPE_NORMAL
- en: While there are a number of tools available outside the Kali Linux repository,
    you should not rely on those as it is easy to add them to your Kali Linux installation.
    Also, many of the packages that are not in the repository have dependencies on
    other software and may cause stability issues.
  prefs: []
  type: TYPE_NORMAL
- en: There are several package management tools that can be used to help you manage
    the software package in your system, such as `dpkg`, `apt`, and `aptitude`. Kali
    Linux comes with `dpkg` and `apt` installed by default.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want to find out more about the apt and `dpkg` commands, you can look
    at the following references: [https://help.ubuntu.com/community/AptGet/Howto/](https://help.ubuntu.com/community/AptGet/Howto/)
    and [http://www.debian.org/doc/manuals/debian-reference/ch02.en.html](http://www.debian.org/doc/manuals/debian-reference/ch02.en.html).'
  prefs: []
  type: TYPE_NORMAL
- en: In this section, we will briefly discuss the apt command in a practical way
    that is related to the software package installation process.
  prefs: []
  type: TYPE_NORMAL
- en: 'To search for a package name in the repository, you can use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'This command will display the entire software package that has the name `package_name`.
    To search for a specific package, use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'If you have located the package but want more detailed information, use the
    following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'To install a new package or to update an existing package, use the `apt-get`
    command. The following is the command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: If the package is not available in the repository, you can search for and download
    it from the developer's site or through [www.github.com](http://www.github.com).
    Be sure to only include software from trusted sources. For developers who require
    a Debian package format (the package will have the file extension `.deb`), you
    can utilize the `dpkg` command. For other packages, you will often find that they
    are compressed using a compression program such as 7-Zip and will often have the
    extension `.zip` or `.tar`.
  prefs: []
  type: TYPE_NORMAL
- en: Network services in Kali Linux
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'There are several network services available in Kali Linux; in this section,
    we will describe only some of them: the HTTP, MySQL, and SSH services. You can
    find the other services by navigating to Kali Linux | System Services.'
  prefs: []
  type: TYPE_NORMAL
- en: HTTP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If your penetration testing works, you may want to have a web server for various
    reasons, such as to serve malicious web application scripts. In Kali Linux, there
    is already an Apache web server installed; you just need to start the service.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are the steps that are required to activate your HTTP server
    in Kali Linux:'
  prefs: []
  type: TYPE_NORMAL
- en: 'To start the Apache HTTP service, open a command line Terminal and type the
    following command to start the Apache server:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'After this, you can browse to the web page at `127.0.0.1`; it will display
    the It works! page by default:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a3d1dc34-82c0-4496-b411-9c2d1f913674.png)'
  prefs: []
  type: TYPE_IMG
- en: 'To stop the Apache HTTP service, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a command-line Terminal and type the following command to stop the Apache
    server:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Remember that the previous command will not survive boot up. After bootup, you
    need to give the command again. Fortunately, there is a way to start the Apache
    HTTP service automatically after the Kali Linux boots up by providing the `update-rc.d
    apache2 defaults` command.
  prefs: []
  type: TYPE_NORMAL
- en: The command will add the `apache2` service to be started on booting up.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: MySQL
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The second service that we will discuss is MySQL. It is a relational database
    system. MySQL is often used with the PHP programming language and an Apache web
    server to create a dynamic, web-based application. For the penetration testing
    process, you can use MySQL to store your penetration testing results, for example,
    the vulnerability information and network mapping result. Of course, you need
    to use the application to store those results.
  prefs: []
  type: TYPE_NORMAL
- en: 'To start the MySQL service in Kali Linux, you can perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'In a Terminal window, type the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'To test whether your MySQL has already started, you can use the MySQL client
    to connect to the server. We define the username (`root`) and the password to
    log in to the MySQL server:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'The system will respond with the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: After this MySQL prompt, you can provide any SQL commands. To exit from MySQL,
    just type `quit`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: By default, for security reasons, the MySQL service in Kali Linux can be accessed
    only from a local machine. You can change this configuration by editing the bind-address
    stanza in the MySQL configuration file located in `/etc/mysql/my.cnf`. We don't
    recommend that you change this behavior unless you want your MySQL to be accessed
    from elsewhere.
  prefs: []
  type: TYPE_NORMAL
- en: 'To stop the MySQL service, you can perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'In a Terminal window, type the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'To start the MySQL service automatically after Kali Linux boots up, you can
    give the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: This command will make the MySQL service start after the boot up.
  prefs: []
  type: TYPE_NORMAL
- en: SSH
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For the next service, we will look into **Secure Shell** (**SSH**). SSH can
    be used to log in to a remote machine securely; apart from that, there are several
    other uses of SSH, such as securely transferring a file between machines, executing
    a command in a remote machine, and X11 session forwarding.
  prefs: []
  type: TYPE_NORMAL
- en: 'To manage your SSH service in Kali Linux, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'To start the SSHD service from the command line, type the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: To test your SSH, you can log in to the Kali Linux server from another server
    using an SSH client such as Putty ([http://www.chiark.greenend.org.uk/~sgtatham/putty/](http://www.chiark.greenend.org.uk/~sgtatham/putty/)),
    if you are using the Microsoft Windows operating system.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To stop the SSHD service, from the command line, type the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'To start the SSH service automatically after Kali Linux boots up, you can give
    the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: This command will add the SSH service to be started on booting up.
  prefs: []
  type: TYPE_NORMAL
- en: Additional labs and resources
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: While our main focus has been on Windows 10, Metasploitable 2, and Metasploitable
    3, there are several other similar projects for exploring vulnerabilities and
    testing your skills. Seasoned security experts and penetration testers may remember
    a tiny vulnerable web server called BadStore. This vulnerable server was no larger
    than 15 MB (yes, megabytes) and contained several vulnerabilities from cross-site
    scripting to SQL injection. Although no longer available as a direct download
    on the official site, it can still be found around the web.
  prefs: []
  type: TYPE_NORMAL
- en: '[https://www.vulnhub.com/](https://www.vulnhub.com/) is exactly what its domain
    indicates: a hub for vulnerability projects. Several vulnerable VMs are listed
    on the site for download, which can be used for practice and **Capture the Flag **(**CTF**) scenarios
    and tournaments, including Damn Vulnerable Linux, Kioptrix, and others.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Several websites also exist for those interested in practicing their skills
    or learning within a contained environment:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Wargames**: Wargames, located at [http://overthewire.org/wargames/](http://overthewire.org/wargames/),
    has basic to advanced levels and is free for practicing:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '****![](img/e7537e08-41f5-4aeb-8d1a-c5d0b9abcdf7.png)****'
  prefs: []
  type: TYPE_NORMAL
- en: '**Hack this site**: [Hackthissite.org](http://www.hackthissite.org) also has
    many challenges (lower-left side) and offers missions for beginners as well as
    programmers. These challenges are free but signing up is required:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/0f6976b9-2dff-4fdd-8a70-b9455cb133f7.png)'
  prefs: []
  type: TYPE_IMG
- en: '**Hellbound Hackers**: As with Hack This Site, Hellbound Hackers ([https://www.hellboundhackers.org/](https://www.hellboundhackers.org/))
    also offers many challenges for free, including pen-testing challenges. Signing
    up is also required to access the challenges:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/701f5082-517c-4a3e-a6ce-89e5840bd5f8.png)'
  prefs: []
  type: TYPE_IMG
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we looked at creating a lab environment for penetration testing.
    As explained, your lab setup will depend solely on the resources available to
    you, such as CPU, RAM, and HDD space. It's a good idea to experiment with as many
    different OSes as you can, including Windows, Linux, Mac, Android, and even ARM
    OSes (available at [https://www.vulnhub.com/](https://www.vulnhub.com/)) to be
    able to get yourself some experience in a controlled environment where you may
    legally carry out tests.
  prefs: []
  type: TYPE_NORMAL
- en: If using the Metasploitable server, we recommend that beginners, including professionals
    with limited time, use the Metasploitable 2 OS as the Metasploitable 3 OS setup
    is highly complicated—the builds can be built for specific host operating systems.
  prefs: []
  type: TYPE_NORMAL
- en: Users with limited resources can also use smaller vulnerable OSes such as BadStore
    and DVL which, like Metasploitable 2, come as pre-built servers available in ISO
    format and are ready to install with only minor setup.
  prefs: []
  type: TYPE_NORMAL
- en: It's recommended to have at least one Windows and one Linux OS for your lab
    for testing and learning. Up next, we'll look at the various methodologies available
    for penetration testing.
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Lets try to answer some questions based on the knowledge you grabbed from the
    chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: What are two virtualization platforms that can be used to create and host virtual
    machines?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What does `.vmdk` stand for?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What are the default login credentials for Metasploitable 2?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If building the Metasploitable 3 server from scratch, what other additional
    pieces of software are required?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is the command used to install a new package or to update an existing package
    in Kali Linux?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What command is used to start the MySQL service?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What command is used to start the SSH service?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Further reading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Installing Metasploitable 2**: [https://metasploit.help.rapid7.com/docs/metasploitable-2](https://metasploit.help.rapid7.com/docs/metasploitable-2)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Building Metasploitable 3**: [https://github.com/rapid7/metasploitable3](https://github.com/rapid7/metasploitable3)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Full Metasploitable 3 download (6 GB file)**: [https://mega.nz/#!XQxEAABQ!frdh5DgZE-tSb_1ajPwLZrV4EZuj1lsS3WlWoLPvBjI](https://mega.nz/#!XQxEAABQ!frdh5DgZE-tSb_1ajPwLZrV4EZuj1lsS3WlWoLPvBjI)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
