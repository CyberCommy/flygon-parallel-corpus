- en: Chapter 2. Shape Drawing and Composites
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover:'
  prefs: []
  type: TYPE_NORMAL
- en: Drawing a rectangle
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Drawing a circle
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with custom shapes and fill styles
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Fun with Bezier curves: drawing a cloud'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Drawing transparent shapes
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with the context state stack to save and restore styles
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with composite operations
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Creating patterns with loops: drawing a gear'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Randomizing shape properties: drawing a field of flowers'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Creating custom shape functions: playing card suits'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Putting it all together: drawing a jet'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In [Chapter 1](ch01.html "Chapter 1. Getting Started withPaths and Text"), *Getting
    Started with Paths and Text*, we learned how to draw sub paths such as lines,
    arcs, Quadratic curves, and Bezier curves, and then we learned how to connect
    them together to form paths. In this chapter, we'll focus on basic and advanced
    shape drawing techniques such as drawing rectangles and circles, drawing custom
    shapes, filling shapes, working with composites, and drawing pictures. Let's get
    started!
  prefs: []
  type: TYPE_NORMAL
- en: Drawing a rectangle
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we'll learn how to draw the only built-in shape provided by
    the HTML5 canvas API, a rectangle. As unexciting as a rectangle might seem, many
    applications use them in one way or another, so you might as well get acquainted.
  prefs: []
  type: TYPE_NORMAL
- en: '![Drawing a rectangle](img/1369_02_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw a simple rectangle centered on the canvas:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define a 2D canvas context:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw a rectangle using the `rect()` method, set the color fill with the `fillStyle`
    property, and then fill the shape with the `fill()` method:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'As you can see from the preceding code, we can draw a simple rectangle by using
    the `rect()` method:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: The `rect()` method draws a rectangle at the position `x,y`, and defines its
    size with `width` and `height`. Another key thing to pay attention to in this
    recipe is the usage of `fillStyle` and `fill()`. Similar to `strokeStyle` and
    `stroke()`, we can assign a fill color using the `fillStyle` method and fill the
    shape using `fill()`.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Notice that we used `fill()` before `stroke()`. If we were to stroke a shape
    before filling it, the fill style would actually overlay half of the stroke style,
    effectively halving the line width style set with `lineWidth`. As a result, it's
    good practice to use `fill()` before using `stroke()`.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In addition to the `rect()` method, there are two additional methods that we
    can use to draw a rectangle and also apply styling with one line of code, the
    `fillRect()` method and the `strokeRect()` method.
  prefs: []
  type: TYPE_NORMAL
- en: The fillRect() method
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If we intend to fill a rectangle after drawing it with `rect()`, we might consider
    both drawing the rectangle and filling it with a single method using `fillRect()`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: The `fillRect()` method is equivalent to using the `rect()` method followed
    by `fill()`. When using this method, you'll need to define the fill style prior
    to calling it.
  prefs: []
  type: TYPE_NORMAL
- en: The strokeRect() method
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'In addition to the `fillRect()` method, we can draw a rectangle and stroke
    it with a single method using the `strokeRect()` method:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: The `strokeRect()` method is equivalent to using the `rect()` method followed
    by `stroke()`. Similar to `fillRect()`, you'll need to define the stroke style
    prior to calling this method.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Unfortunately, the HTML5 canvas API does not support a method that both fills
    and strokes a rectangle. Personally, I like to use the `rect()` method and apply
    stroke styles and fills as needed using `stroke()` and `fill()` because it's more
    consistent with custom shape drawing. However, if you're wanting to apply both
    a stroke and fill to a rectangle while using one of these short-hand methods,
    it's good practice to use `fillRect()` followed by `stroke()`. If you were to
    use `strokeRect()` followed by `fill()`, you would overlay the stroke style by
    the fill, halving the stroke line width.
  prefs: []
  type: TYPE_NORMAL
- en: See also...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Creating a linear motion* in [Chapter 5](ch05.html "Chapter 5. Bringing the
    Canvas to Life with Animation")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Detecting region events* in [Chapter 6](ch06.html "Chapter 6. Interacting
    with the Canvas: Attaching Event Listeners to Shapes and Regions")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Creating a bar chart* in [Chapter 7](ch07.html "Chapter 7. Creating Graphs
    and Charts")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Drawing a circle
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Although the HTML5 canvas API doesn't support a circle method, we can certainly
    create one by drawing a fully enclosed arc.
  prefs: []
  type: TYPE_NORMAL
- en: '![Drawing a circle](img/1369_02_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw a circle centered on the canvas:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define a 2D canvas context:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'Create a circle using the `arc()` method, set the color fill using the `fillStyle`
    property, and then fill the shape with the `fill()` method:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'As you might recall from [Chapter 1](ch01.html "Chapter 1. Getting Started
    withPaths and Text"), we can create an arc using the `arc()` method which draws
    a section of a circle defined by a starting angle and an ending angle. If, however,
    we define the difference between the starting angle and ending angle as 360 degrees
    (2π), we will have effectively drawn a complete circle:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: See also...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Creating patterns with loops: drawing a gear*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Transforming a circle into an oval* in [Chapter 4](ch04.html "Chapter 4. Mastering
    Transformations")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Swinging a pendulum* in [Chapter 5](ch05.html "Chapter 5. Bringing the Canvas
    to Life with Animation")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Simulating particle physics* in [Chapter 5](ch05.html "Chapter 5. Bringing
    the Canvas to Life with Animation")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Animating a clock* in [Chapter 5](ch05.html "Chapter 5. Bringing the Canvas
    to Life with Animation")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Detecting region events* in [Chapter 6](ch06.html "Chapter 6. Interacting
    with the Canvas: Attaching Event Listeners to Shapes and Regions")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Creating a pie chart* in [Chapter 7](ch07.html "Chapter 7. Creating Graphs
    and Charts")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with custom shapes and fill styles
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we'll draw four triangles and then fill each one with a different
    fill style. The fill styles available with the HTML5 canvas API are color fills,
    linear gradients, radial gradients, and patterns.
  prefs: []
  type: TYPE_NORMAL
- en: '![Working with custom shapes and fill styles](img/1369_02_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw four triangles, one with a color fill, one with
    a linear gradient fill, one with a radial gradient fill, and one with a pattern
    fill:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Create a simple function that draws a triangle:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'Define a 2D canvas context and set the height, width, and y position of our
    triangles:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw a triangle using a color fill:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw a triangle using a linear gradient fill:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw a triangle using a radial gradient fill:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw a triangle using a pattern fill:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'As you might recall from [Chapter 1](ch01.html "Chapter 1. Getting Started
    withPaths and Text"), we can start a new path with the `beginPath()` method, place
    our drawing cursor using `moveTo()`, and then draw consecutive sub paths to form
    a path. We can add one more step to this procedure by closing our path with the
    `closePath()` method of the canvas context to create a shape:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: This method essentially tells the canvas context to complete the current path
    by connecting the last point in the path with the start point of the path.
  prefs: []
  type: TYPE_NORMAL
- en: In the `drawTriangle()` method, we can begin a new path using `beginPath()`,
    position the drawing cursor using `moveTo()`, draw two sides of the triangle using
    `lineTo()`, and then complete the third side of the triangle with `closePath()`.
  prefs: []
  type: TYPE_NORMAL
- en: 'As you can see from the preceding screenshot, the second triangle from the
    left is filled with a linear gradient. Linear gradients can be created with the
    `createLinearGradient()` method of the canvas context, which is defined by a start
    point and an end point:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, we can set the colors of the gradient using the `addColorStop()` method
    which assigns a color value at an offset position along the gradient line from
    0 to 1:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: Colors assigned with an offset value of 0 will be positioned at the starting
    point of the linear gradient, and colors assigned with an offset value of 1 will
    be positioned at the end point of the linear gradient. In this example, we've
    positioned a light blue color at the top of the triangle and a dark blue color
    at the bottom of the triangle.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next up, let''s cover radial gradients. The second triangle from the right
    is filled with a radial gradient composed of six different colors. Radial gradients
    can be created using the `createRadialGradient()` method of the canvas context,
    which requires a starting point, a start radius, an end point, and an end radius:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: Radial gradients are defined by two imaginary circles. The first imaginary circle
    is defined by `startX`, `startY`, and `startRadius`. The second imaginary circle
    is defined by `endX`, `endY`, and `endRadius`. Similarly to linear gradients,
    we can position colors along the radial gradient line using the `addColorStop()`
    method of the canvas context.
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, the fourth type of fill style available with the HTML5 canvas API
    is patterns. We can create a `pattern` object using the `createPattern()` method
    of the canvas context, which requires an `image` object and a repeat option:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: The `repeatOption` can take one of the four options, `repeat`, `repeat-x`, `repeat-y`,
    and `no-repeat`. Unless otherwise specified, the `repeatOption` is defaulted to
    `repeat`. We'll cover images more in depth in [Chapter 3](ch03.html "Chapter 3. Working
    with Images and Videos"), *Working with Images and Videos*.
  prefs: []
  type: TYPE_NORMAL
- en: See also...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Putting it all together: drawing a jet*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Fun with Bezier curves: drawing a cloud'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we will learn how to draw a custom shape by connecting a series
    of Bezier curve sub paths to create a fluffy cloud.
  prefs: []
  type: TYPE_NORMAL
- en: '![Fun with Bezier curves: drawing a cloud](img/1369_02_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw a fluffy cloud in the center of the canvas:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define a 2D canvas context:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw a cloud by connecting six Bezier curves:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: 'Define a radial gradient with the `createRadialGradient()` method and fill
    the shape with the gradient:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: 'Set the line width and stroke the cloud:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To draw a fluffy cloud using the HTML5 canvas API, we can connect several Bezier
    curves to form the perimeter of the cloud shape. To create the illusion of a bulbous
    surface, we can create a radial gradient using the `createRadialGradient()` method,
    set the gradient colors and offsets using the `addColorStop()` method, set the
    radial gradient as the fill style using `fillStyle`, and then apply the gradient
    using `fill()`.
  prefs: []
  type: TYPE_NORMAL
- en: Drawing transparent shapes
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For applications that require shape layering, it's often desirable to work with
    transparencies. In this recipe, we will learn how to set shape transparencies
    using the global alpha composite.
  prefs: []
  type: TYPE_NORMAL
- en: '![Drawing transparent shapes](img/1369_02_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw a transparent circle on top of an opaque square:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define a 2D canvas context:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw a rectangle:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: 'Set the global alpha of the canvas using the `globalAlpha` property and draw
    a circle:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To set the opacity of a shape using the HTML5 canvas API, we can use the `globalAlpha`
    property:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: The `globalAlpha` property accepts any real number between 0 and 1\. We can
    set the `globalAlpha` property to `1` to make shapes fully opaque, and we can
    set the `globalAlpha` property to `0` to make shapes fully transparent.
  prefs: []
  type: TYPE_NORMAL
- en: Working with the context state stack to save and restore styles
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When creating more complex HTML5 canvas applications, you'll find yourself needing
    a way to revert back to previous style combinations so that you don't have to
    set and reset dozens of style properties at different points in the drawing process.
    Fortunately, the HTML5 canvas API provides us with access to the context state
    stack which allows us to save and restore context states. In this recipe, we'll
    demonstrate how the state stack works by saving the context state, setting the
    global alpha, drawing a transparent circle, restoring the state stack to the state
    before we set the global alpha, and then drawing an opaque square. Let's take
    a look!
  prefs: []
  type: TYPE_NORMAL
- en: '![Working with the context state stack to save and restore styles](img/1369_02_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Getting ready...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before we cover the canvas state stack, it's imperative that you understand
    how a stack data structure works (if you already do, you can skip to the *How
    it works* section).
  prefs: []
  type: TYPE_NORMAL
- en: A stack data structure is a last in, first out (LIFO) structure. Stacks have
    three major operations – **push**, **pop**, and **stack top**. When an element
    is pushed onto the stack, it gets added to the top of the stack. When the stack
    is popped, the top element is removed from the stack. The *stack top* operation
    simply returns the element at the top of the stack.
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready...](img/1369_02_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Take a look at the preceding diagram, which represents the state of a stack
    throughout multiple actions. In step 1, we start out with a stack containing one
    element, element "a". In step 2, the "b" element is pushed onto the stack. In
    step 3, the "c" element is pushed onto the stack. In step 4, we pop the stack,
    which removes the last element pushed onto the stack. Since element "c" was at
    the top of the stack, it's the element that's removed. In step 5, we again pop
    the stack, which removes the last element pushed onto the stack. Since element
    "b" was at the top of the stack, it's the element that's removed.
  prefs: []
  type: TYPE_NORMAL
- en: As we will see in the next section, stacks are a wonderful data structure for
    saving states as they change over time, and then restoring them by popping the
    stack.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw an opaque square on top of a transparent circle:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define a 2D canvas context:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw a rectangle:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: 'Save the context state with `save()`, set the global alpha of the canvas using
    the `globalAlpha` property, draw a circle, and then restore the canvas state with
    `restore()`:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw another rectangle (which will be opaque) to show that the context state
    has been restored to the state before the global alpha property was set:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As you can see in the preceding code, by wrapping the circle drawing code with
    a save-restore combination, we are essentially encapsulating any styles that we
    use between the `save()` method and the `restore()` method such that they don't
    affect the shapes drawn afterwards. Save-restore combinations can be thought of
    as a way to induce style scoping, similar to the way that a function induces variable
    scope in JavaScript. Although you might be saying "Well that sounds like a complicated
    way to set the globalAlpha back to 1!" Hold on partner. In the real world, you'll
    typically be dealing with lots of different combinations of styles for different
    sections of code. In this type of scenario, save-restore combinations are a life-saver.
    Writing complex HTML5 canvas applications without save-restore combinations is
    a lot like building a complex web application with one big block of JavaScript
    code using nothing but global variables. Yikes!
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As we'll see in [Chapter 4](ch04.html "Chapter 4. Mastering Transformations"),
    *Mastering Transformations*, another common usage of the state stack is to save
    and restore transformation states.
  prefs: []
  type: TYPE_NORMAL
- en: See also...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Handling multiple transforms with the state stack* in [Chapter 4](ch04.html
    "Chapter 4. Mastering Transformations")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with composite operations
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we'll explore composite operations by creating a table of each
    variation. Composite operations are particularly useful for creating complex shapes,
    drawing shapes underneath other shapes instead of on top of them, and creating
    other interesting effects.
  prefs: []
  type: TYPE_NORMAL
- en: '![Working with composite operations](img/1369_02_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Getting ready...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The following is a description for each possible composite operation available
    with the HTML5 canvas API, where the red circle represents the source (S) and
    the blue square represents the destination (D). To further develop your understanding
    of composite operations, it helps to look at the corresponding operation while
    reading each description:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Operation | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `source-atop` (S atop D) | Display the source image wherever both images
    are opaque. Display the destination image wherever the destination image is opaque
    but the source image is transparent. Display transparency elsewhere. |'
  prefs: []
  type: TYPE_TB
- en: '| `source-in` (S in D) | Display the source image wherever both the source
    image and destination image are opaque. Display transparency elsewhere. |'
  prefs: []
  type: TYPE_TB
- en: '| `source-out` (S out D) | Display the source image wherever the source image
    is opaque and the destination image is transparent. Display transparency elsewhere.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `source-over` (S over D, default) | Display the source image wherever the
    source image is opaque. Display the destination image elsewhere. |'
  prefs: []
  type: TYPE_TB
- en: '| `destination-atop` (S atop D) | Display the destination image wherever both
    images are opaque. Display the source image wherever the source image is opaque
    but the destination image is transparent. Display transparency elsewhere. |'
  prefs: []
  type: TYPE_TB
- en: '| `destination-in` (S in D) | Display the destination image wherever both the
    destination image and source image are opaque. Display transparency elsewhere.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `destination -out` (S out D) | Display the destination image wherever the
    destination image is opaque and the source image is transparent. Display transparency
    elsewhere. |'
  prefs: []
  type: TYPE_TB
- en: '| `destination -over` (S over D) | Display the destination image wherever the
    destination image is opaque. Display the destination image elsewhere. |'
  prefs: []
  type: TYPE_TB
- en: '| `lighter` (S plus D) | Display the sum of the source image and destination
    image. |'
  prefs: []
  type: TYPE_TB
- en: '| `xor` (S xor D) | Exclusive OR of the source image and destination image.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `copy` (D is ignored) | Display the source image instead of the destination
    image. |'
  prefs: []
  type: TYPE_TB
- en: At the time of writing, dealing with composite operations is quite tricky because
    each of the five major browsers—Chrome, Firefox, Safari, Opera, and IE9—handle
    composite operations differently. Rather than showing you a chart of currently
    supported composite operations by browser at the time of writing, you should instead
    go online and search for something like "canvas composite operation support by
    browser" to see the current support for each browser if you intend on using them.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to create a live table of composite operations:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define styles for the canvases and text displays:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: 'Define the sizes and relative distances of each square and circle:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: 'Build an array of composite operations:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: 'Perform each operation and draw the result on the corresponding canvas:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed a canvas tag for each operation inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We can set a composite operation by using the `globalCompositeOperation` property
    of the canvas context:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: The `globalCompositeOperaton` property accepts one of the eleven values, including
    `source-atop`, `source-in`, `source-out`, `source-over`, `destination-atop`, `destination-in`,
    `destination-out`, `destination-over`, `lighter`, `xor`, and `copy`. `Source`
    refers to everything drawn on the canvas after the operation, and `destination`
    refers to everything drawn on the canvas before the operation. Unless otherwise
    specified, the default composite operation is set to `source-over`, which basically
    means that each time something is drawn on the canvas, it's drawn on top of the
    stuff already there.
  prefs: []
  type: TYPE_NORMAL
- en: We can create an array for each composite operation and then loop through each
    one to draw the result onto the corresponding canvas. For each iteration, we can
    draw a square, set the composite operation, and then draw a circle.
  prefs: []
  type: TYPE_NORMAL
- en: 'Creating patterns with loops: drawing a gear'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we'll create a mechanical gear by iteratively drawing a radial
    zigzag to form teeth and then drawing circles to form the body of the gear.
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating patterns with loops: drawing a gear](img/1369_02_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw a gear centered on the canvas:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define a 2D canvas context and set the gear properties:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE43]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the gear teeth:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE44]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the gear body:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE45]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the gear hole:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE46]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE47]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To draw a gear with the HTML5 canvas, we can start by drawing the teeth around
    the gear. One way to draw teeth around a gear is to draw a radial zigzag pattern
    with beveled line joins. One great example of a radial zigzag is a star, which
    has five points along an imaginary inner circle, and five more points along an
    imaginary outer circle. To create a star, we can set up a loop with 10 iterations,
    one iteration for each point. For even iterations, we can draw a point along the
    outer circle, and for odd iterations we can draw a point along the inner circle.
    Since our star would have 10 points, each point would be separated by (2π / 10)
    radians.
  prefs: []
  type: TYPE_NORMAL
- en: You might be asking yourself "What does a star have to do with gear teeth?".
    If we extend this logic to draw a zigzag shape of say 50 points instead of 10,
    we'll have effectively created a gear with 25 wedged teeth.
  prefs: []
  type: TYPE_NORMAL
- en: Once the gear teeth are taken care of, we can draw a circle and apply a linear
    gradient using the `createLinearGradient()` method, and then draw a smaller circle
    for the hole of the gear.
  prefs: []
  type: TYPE_NORMAL
- en: See also...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Animating mechanical gears* in [Chapter 5](ch05.html "Chapter 5. Bringing
    the Canvas to Life with Animation")'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Randomizing shape properties: drawing a field of flowers'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we'll embrace our inner hippie by creating a field of colorful
    flowers.
  prefs: []
  type: TYPE_NORMAL
- en: '![Randomizing shape properties: drawing a field of flowers](img/1369_02_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw randomized flowers all over the canvas:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define the constructor of a `Flower` object:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE48]'
  prefs: []
  type: TYPE_PRE
- en: 'Define a `draw` method of the `Flower` object that creates flower petals with
    a `for` loop and then draws a yellow center:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE49]'
  prefs: []
  type: TYPE_PRE
- en: 'Set the 2D canvas context:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE50]'
  prefs: []
  type: TYPE_PRE
- en: 'Create a green gradation for the background:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE51]'
  prefs: []
  type: TYPE_PRE
- en: 'Create an array of flower colors:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE52]'
  prefs: []
  type: TYPE_PRE
- en: 'Create a loop that generates flowers with a random position, size, and color:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE53]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE54]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This recipe is all about randomizing object properties and drawing the results
    on the screen using HTML5 canvas. The idea is to create a bunch of flowers with
    varying positions, sizes, and colors.
  prefs: []
  type: TYPE_NORMAL
- en: To help aid us in creating a field of flowers, it's useful to create a `Flower`
    class that defines the properties of a flower and a method for drawing the flower.
    For this recipe, I've kept the number of petals constant, although you can certainly
    experiment with a varying number of petals for each flower on your own.
  prefs: []
  type: TYPE_NORMAL
- en: 'Drawing a flower is actually quite similar to our previous recipe, *Creating
    patterns with loops: drawing a gear*, only this time, we''ll be drawing petals
    around a circle instead of zigzags. I''ve found that the easiest way to draw a
    petal with HTML5 canvas is to draw a Bezier curve whose starting point is connected
    to its ending point. The starting and ending points of the Bezier curve are at
    the center of the flower, and the control points are defined with each iteration
    in the `draw()` method of the `Flower` class.'
  prefs: []
  type: TYPE_NORMAL
- en: Once our `Flower` class is set up and ready to go, we can create a loop that
    instantiates random `Flower` objects with each iteration and then render them
    with the `draw()` method.
  prefs: []
  type: TYPE_NORMAL
- en: If you try out this recipe for yourself, you'll see that the flowers are completely
    randomized each time you refresh the screen.
  prefs: []
  type: TYPE_NORMAL
- en: 'Creating custom shape functions: playing card suits'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If a royal flush gets your adrenaline going, then this one's for you. In this
    recipe, we'll create drawing functions for the spade, heart, club, and diamond
    suits.
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating custom shape functions: playing card suits](img/1369_02_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw a spade, heart, club, and diamond suit:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define the drawSpade() function which draws a spade with four Bezier curves,
    two quadratic curves, and one straight line:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE55]'
  prefs: []
  type: TYPE_PRE
- en: 'Define the drawHeart() function which draws a heart with four Bezier curves:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE56]'
  prefs: []
  type: TYPE_PRE
- en: 'Define the drawClub() function which draws a club with four circles, two quadratic
    curves, and one straight line:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE57]'
  prefs: []
  type: TYPE_PRE
- en: 'Define the drawDiamond() function which draws a diamond with four straight
    lines:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE58]'
  prefs: []
  type: TYPE_PRE
- en: 'When the page loads, define the canvas context and then use the four drawing
    functions to render a spade, a heart, a club, and a diamond:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE59]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE60]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'This recipe demonstrates how any shape can be drawn by combining the four major
    types of sub paths provided by the HTML5 canvas: straight lines, arcs, Quadratic
    curves, and Bezier curves.'
  prefs: []
  type: TYPE_NORMAL
- en: To draw a spade, we can connect four Bezier curves to form the top portion,
    and we can use two Quadratic curves and a straight line to form the bottom portion.
    To draw a heart, we can connect four Bezier curves in much the same way that we
    created the spade, except that the point of the shape is on the bottom instead
    of the top. To create a club, we can draw three circles using arcs for the top
    portion, and similar to the spade, we can use two Quadratic curves and a straight
    line to form the bottom portion. Finally, to draw a diamond, we can simply connect
    four straight lines.
  prefs: []
  type: TYPE_NORMAL
- en: 'Putting it all together: drawing a jet'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we'll push the limits of the HTML5 canvas drawing API by drawing
    a vector-style jet using lines, curves, shapes, colors, linear gradients, and
    radial gradients.
  prefs: []
  type: TYPE_NORMAL
- en: '![Putting it all together: drawing a jet](img/1369_02_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to draw a vector-style jet:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Define a 2D canvas context and set the line join style:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE61]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the right tail wing:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE62]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the right wing:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE63]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the body and top of the tail:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE64]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the left tail wing:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE65]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the left wing:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE66]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the side detail:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE67]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the nose detail:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE68]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the cockpit:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE69]'
  prefs: []
  type: TYPE_PRE
- en: 'Draw the intake:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE70]'
  prefs: []
  type: TYPE_PRE
- en: 'Embed the canvas tag inside the body of the HTML document:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE71]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This recipe combines the use of lines, Quadratic curves, Bezier curves, paths,
    shapes, solid fills, linear gradients, and radial gradients. Although it's true
    that the HTML5 canvas is quite rudimentary, it does provide everything that we
    need to make great drawings, including a vector-style jet.
  prefs: []
  type: TYPE_NORMAL
- en: To draw a jet with the HTML5 canvas, we can start by drawing a jet in Adobe
    Photoshop or some other image editor with a drawing area size equal to the size
    of our canvas, which in this case is 650 x 350 pixels. Next, we can use our cursor
    to find the major points that form the jet shape by hovering over the end points
    of each line in our drawing and recording the x, y coordinates. With these coordinates
    in hand, we can draw the major outline of the jet with a line width of 4, and
    we can go back and fill in the finer details of the jet using a line width of
    2.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It's good practice to draw the portions of the drawing farthest away from the
    viewer first because each shape that you draw on the canvas will overlap the previous
    shapes. If you take a look at the preceding code, you'll notice that the right
    wing was drawn first, followed by the body of the jet, followed by the left wing.
    This is because the right wing is farthest from the viewer while the left wing
    is closest to the viewer.
  prefs: []
  type: TYPE_NORMAL
- en: Once the line drawing is complete, we can fill in the jet with solid colors,
    add a linear gradient to the body, and add a radial gradient to the cockpit to
    give the drawing some depth. Finally, we can add a bold red gradation to the nose
    of the plane, preparing it for take-off and inspiring our imagination.
  prefs: []
  type: TYPE_NORMAL
