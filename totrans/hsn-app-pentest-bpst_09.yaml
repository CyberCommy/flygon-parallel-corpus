- en: Exploiting Vulnerabilities Using Burp Suite - Part 2
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As we saw in the previous chapter, Burp Suite is a flexible tool used to detect
    and exploit vulnerabilities. In this chapter, we will be exploiting other types
    of vulnerabilities, showing more options and capabilities in Burp Suite.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Using SSRF/XSPA to perform internal port scans
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using SSRF/XSPA to extract data from internal machines
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Extracting data using Insecure Direct Object Reference (IDOR) flaws
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Exploiting security misconfigurations
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using insecure deserialization to execute OS commands
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Exploiting crypto vulnerabilities
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Brute forcing HTTP basic authentication
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Brute forcing forms
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bypassing file upload restrictions
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using SSRF/XSPA to perform internal port scans
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A **Server-Side Request Forgery** (**SSRF**) is a vulnerability where a malicious
    user can send a manual request to the server where the application is hosted,
    usually a server that has no direct access from the user's perspective.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: Currently, this is a vulnerability that is getting a lot of popularity because
    it has a great impact on cloud infrastructures that use technologies, such as
    Elasticsearch, and NoSQL databases.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: 'In the following code snippet, we can see its effect:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This code is vulnerable because it is receiving the `url` parameter without
    validations, and then ...
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: Performing an internal port scan to the backend
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A port scan is one of the most basic and useful activities of network discovery
    when you are assessing a network. In applications, security assessment is limited
    to the scope determined in the assessment, but SSRF and XSPA allow users to perform
    port scanning from the application. To demonstrate how you can perform this technique,
    we will use a vulnerable test application, created by Acunetix, which you can
    find at [http://testphp.vulnweb.com/](http://testphp.vulnweb.com/).
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: 'This is a vulnerable application that you can use to learn some attacks and
    test scripts or tools, as shown in the following screenshot:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b7194d52-807a-4f01-a610-0e6048023915.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
- en: 'Open Burp Suite''s Dashboard, and click on New scan. Add Acunetix''s URL in
    the scope and click on Start, as demonstrated in the following screenshot:'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/3a756b75-6dc6-406d-bdf1-cee5b2bfe41d.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
- en: 'After scanning the application, Burp Suite detected that the URL ([http://testphp.vulnweb.com/showimage.php](http://testphp.vulnweb.com/showimage.php))
    is vulnerable to SSRF. This PHP file accepts the URL as a parameter, as shown
    in the following line:'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'To perform an automatic port scan, we can use Intruder. First, stop the request,
    and send it to Intruder, as shown in the following screenshot:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/66226f38-91db-48dd-9b1d-1464636571f5.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
- en: 'Clean the wildcard created by default, and add a new one by your own, as shown
    in the following screenshot:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Now, you can define your payloads as a list, from 0 to 65,535, and we will
    choose the Random option. Why? Because some **intrusion prevention systems** (**IPS**) detect
    a sequential request to the same IP, so by using the Random option, we can try
    to avoid being detected:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b7eba87e-7db4-4b2e-9e06-876df72faf7f.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
- en: 'Now, launch the attack, as shown in the following screenshot:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/29ada021-e7e8-4e43-a64c-a20747811370.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
- en: 'Why it works? If you see the response, it is possible to see whether the connection
    was successful or not, as follows:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/7eb1282c-cb77-404e-8a32-fbcaed7f5adc.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
- en: When a port is open, the response will not show any error. As a tip, you can
    analyze the length column to detect when there is a change in the response and
    see whether the error appears or not.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: Using SSRF/XSPA to extract data from internal machines
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'SSRF and XSPA vulnerabilities can also be used for other actions, such as extracting
    information from the servers into the network where the backend is located, or
    from the server where the application is hosted. Let''s analyze the following
    request:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/3ced569c-8afd-4646-b71f-2b49aa0a716a.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
- en: 'Here, the `filehookURL` parameter is vulnerable, so send it to the Repeater
    tool, using the secondary button of the mouse, and modify the parameter to extract
    a file, in `/etc/passwd`, as follows:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Send it to the application. If it works, the application will show you the ...
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Extracting data using Insecure Direct Object Reference (IDOR) flaws
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: IDOR is a vulnerability that allows a malicious user to access files, databases,
    or sensitive files in the server that hosts the application.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: To identify vulnerable applications to IDOR, it is necessary to test each variable
    that manages paths into the application. Let's look at an example of how to exploit
    this kind of vulnerability.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: Exploiting IDOR with Burp Suite
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In the following screenshot, you have a vulnerable application and you have
    intercepted the next request:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/19761a53-0504-4c29-9984-ac5c63ac67e1.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
- en: We have their parameters in this request; login, action, and secret. The vulnerable
    parameter here is login. The `secret` variable is the data assigned by the user
    during their registration; the vulnerability that exists is that if the malicious
    user modifies the login parameter, the application changes the secret value for
    the user specified without validation. So, we have created another user called
    **vendetta2**, to try to modify the secret value pertaining to this individual,
    as demonstrated in the following ...
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: Exploiting security misconfigurations
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The term *misconfiguration* is so open that it could mean a lot of things related
    to security. At the same time, it is so difficult to determine the impact of these
    kinds of vulnerabilities; some of these vulnerabilities could be just informational,
    showing information about the technology used to construct an application, and
    others could be so critical, providing access to the server, or to the application,
    thereby exposing all of it.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: So, in this section, we will be showing different common errors, and how to
    exploit them using Burp Suite.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: Default pages
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'It is common that server administrators install web servers or other applications,
    and they do not configure them to avoid showing the default pages, so, it is normal
    to find pages like the following:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fc8d3fb5-35f5-43e4-add7-7415e547a647.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
- en: This default page may be generic, but it shows information, which, depending
    on the environment, could be useful. For example, in this case, we are seeing
    Apache Tomcat's default page. Tomcat is an application server that has an administrative
    section, and Tomcat has a default user and password. So, if you detect this default
    page, you just need to enter the `tomcat` credentials, to see all of the options.
    One common attack consists ...
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: Directory listings
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It is normal for system administrators and developers to assign incorrect access
    permissions in the filesystem, allowing users to access sensible files, such as
    backups, configurations files, source code files, or just a directory that allows
    users to know more about the server and where the application is hosted.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: 'To discover all of this structure, we can use three main methods, which are
    as follows:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: Scanning
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Mapping the application
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Intruder
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let's explore each method in detail.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: Scanning
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Scanners, including Burp Suite scanner, have algorithms to detect sensible paths
    and commons files; actually, common files could be used as banner grabbing to
    detect potential vulnerabilities.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: 'If a sensible file is detected, it will be shown in the scanner results as
    an issue, as demonstrated in the following screenshot:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ea91811c-7536-4fcd-8616-0d981234efee.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
- en: Mapping the application
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In Burp Suite, you can find all of the different files that are mapped in the
    Target tool, where it creates a tree with all of the website structure. If you
    click on a file, it will be shown in detail on the right, detailing whether it
    is accessible or not, as well as what kind of file it is:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/80f192be-9241-40e2-8350-01e1fc47c26d.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
- en: This mapping is largely automatic; you just need to work in the application,
    while Burp Suite is caching all of the requests and creating this tree, but also
    Burp Suite has a specific tool for this purpose.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: 'In the Target tool, there is a tab called Scope; here, it is possible to define
    a URL or path as scope in order to map it deep. When you make a request, the request
    has a lot of resources that link to other resources. Burp Suite analyzes the requests
    and responses looking for these links and maps the site using the information
    that it can retrieve from them, as demonstrated in the following screenshot:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6b948f96-fa82-496f-994a-bc7da71beb83.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
- en: If the application has authenticated sections, it's recommended that you provide
    credentials, because each time Burp Suite tries to access the authenticated section,
    the proxy will launch a popup that could be annoying. When this happens, just
    enter the credentials and the proxy will save them for future requests.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: Using Intruder
  id: totrans-75
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: I think Intruder is the most flexible of Burp Suite's tools. You can use it
    for everything. While working with the Burp Suite Community Edition, where you
    do not have the advanced options and tools, Intruder can supply all of them with
    restrictions, which means more time in performing the tasks, but it can do any
    kind of task.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: So, to detect directory listings and sensitive files, we are going to use common
    lists. For example, we can have a list with common directories, such as usual
    paths in **content management systems** (**CMS**), eCommerce applications, and
    normal paths used in a homemade application, such as `/users/`, `/admin/`, `/administrator/`,
    `process.php`, `/config/`, and more.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: On the other hand, we need to have a list with common ...
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: Default credentials
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As mentioned previously, in this section, there are applications that have default
    credentials when they are installed. With some of them, this is because they are
    not installed directly, but use packages with the OS or because they are part
    of another application. For example, some **integrated development environments**
    (**IDE**) have web or application servers in their installations, which are used
    for testing purposes.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: Also, there are testing tools or packages that use **database management systems**
    (**DBMS**), but these systems have vulnerabilities or default access that exposes
    them.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: 'After doing some scouting, you will be able to know the applications, servers, and
    technology behind an application, and just looking for the term default password
    find the correct credentials, or accessing to the web that stores them, as shown
    in the following screenshot:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/61fd3d16-a956-4669-9a34-660beeaeaea5.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
- en: To identify the correct ones, you just need to load them as payload in Intruder
    and launch the applications, as we will see in more detail in this chapter.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: Untrusted HTTP methods
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The HTTP protocol has different methods, usually, we use to know the `GET`,
    `POST`, and `CONNECT` methods because they are the most commonly used. However,
    there are others that can be used to get information about the server, upload
    and delete files into the application, or obtain debug information.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: 'Testing these methods using Burp Suite is easy. From the proxy, just modify
    the request in the following way:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Actually, `OPTIONS` is a method that allows us to know what methods are allowed
    on the web server. The methods that can appear are `PUT`, `DELETE`, `TRACE`, `TRACK`,
    and `HEAD`. The exploitation of these methods is beyond the scope of this book
    because a lot depends on the environment in the application.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: Using insecure deserialization to execute OS commands
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Serialization is a process, in some programming languages, for converting the
    state of an object into a byte stream, this means 0's and 1's. The deserialization
    process converts a byte stream into an object in memory.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: In web technologies, there are more simple cases, for example, a common deserialization
    is the process to pass a JSON format into an XML format. This is so simple, but
    the real problems start in technologies that use native objects, for example,
    Java, where we can pass to direct calls in memory.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: The vulnerability, in fact, occurs when the application deserializes an input
    that is not valid, creating a new object that could be potentially risky to the
    application.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: Exploiting the vulnerability
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Imagine you have a vulnerable application that is using the pickle library.
    This is a Python module that implements different functions to serialize and deserialize.
    However, this module does not implement protection by itself. It needs to be implemented
    with validation by the developer. Look at the following vulnerable code snippet:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'This code reads a YAML file without any validations. A malicious user can enter
    an input that could execute other actions, for example, a command, as follows:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Exploiting crypto vulnerabilities
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: More than exploiting vulnerabilities related to cryptography, Burp Suite allows
    users to perform analysis to detect weak algorithms.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: To perform this analysis, we need to create a capture. This capture is just
    a navigation where we log in and log out from an application in order to create
    sessions, tokens, and IDs. The idea is to create the biggest capture that we can
    in order to have a sample.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: 'After creating the capture, use the normal history in Burp Suite, go to the
    Sequencer tool, and click on Analyze now, as demonstrated in the following screenshot:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/03e9e9b1-b2a1-4ef3-84fd-73d24a87557d.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
- en: 'Here, you can see the final analysis, as follows:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/710838f0-a0b1-499e-b00c-b48997aba3b8.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
- en: The Final Analysis
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: Now, you can determine whether the algorithm used is weak or not based on the
    entropy, the charset, and the probability.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: Brute forcing HTTP basic authentication
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Basic authentication is a type of access control mostly used in internal environments
    to restrict access to restricted areas in a website. It has a lot of weaknesses,
    including the following:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: The basic authentication sends the information in plain text. This means that
    a malicious user can intercept the information sent by the client to the server
    and extract the credentials.
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The password is protected by a Base64 encoding. It does not mean that the password
    is encrypted; anyone can get the plain password using a decoder, like the one
    included in Burp Suite, as shown in the following screenshot:'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/85bb0cab-7106-4191-8568-83344cce6d0c.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
- en: Brute forcing it with Burp Suite
  id: totrans-113
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We are going to show how to attack a basic authentication using Burp Suite.
    Imagine we have a domestic router that is used to provide us with the internet
    in our home. Most of these devices use basic authentication. So, access to the
    URL router and the web browser will display a window, as in the following screenshot:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/9786bec3-220c-4572-a1f3-8f62a11a0628.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
- en: 'Now, configure Burp Suite to intercept the credentials sent to the server,
    as demonstrated in the following screenshot:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/84489aa7-dd9e-45af-a60a-7740e03e0967.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
- en: 'Here, you can see the parameter authorization in the header. So, copy the value
    assigned to the parameter, and paste it in the Decoder section to know what it
    is. Remember that basic authentication uses Base64 encoding to protect the information:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/cade33a9-097a-4b08-98c7-bff5620e4eae.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
- en: 'Now, we know that the structure used by the basic authentication is `user:password`,
    so to brute force the control, we need to send credentials following this structure.
    We are going to use a list of potential users and passwords, and store them in
    TXT files, in order to use them as payloads. I recommend that you look for leaked
    passwords in common services, such as Facebook, LinkedIn, and Yahoo, because they
    are real passwords, and not just a common dictionary, so it is more probable that
    you can get access to the restricted area. Here, we have a small example list
    as follows:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们知道基本身份验证使用的结构是`user:password`，因此为了暴力破解控制，我们需要按照这个结构发送凭据。我们将使用潜在用户和密码的列表，并将它们存储在TXT文件中，以便将它们用作有效负载。我建议您在常见服务中寻找泄露的密码，如Facebook、LinkedIn和Yahoo，因为它们是真实的密码，而不仅仅是常见的词典，所以您更有可能能够访问受限区域。这里有一个小例子列表如下：
- en: '![](img/2d9616fc-e501-42e8-b841-0f126bd9f903.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2d9616fc-e501-42e8-b841-0f126bd9f903.png)'
- en: 'Now that we have our password and users list, click on the original request,
    using the secondary button of the mouse, and send it to the Intruder tool:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了密码和用户列表，点击鼠标的辅助按钮，将原始请求发送到入侵者工具：
- en: 'First, we are going to select the Cluster bomb option to send our request.
    As we only have one list, we want Burp Suite to test all of the possible combinations
    on the list, as shown in the following screenshot:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们将选择“集群炸弹”选项来发送我们的请求。由于我们只有一个列表，我们希望Burp Suite测试列表中的所有可能组合，如下面的截图所示：
- en: '![](img/58ed6b25-9667-41f6-8847-73ea5952a0ee.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](img/58ed6b25-9667-41f6-8847-73ea5952a0ee.png)'
- en: 'Then, we are going to select the value assigned to the authorization parameter
    as a wildcard. The trick however, is to create wildcards on the same parameter
    because we have to insert values to the password and the user, as demonstrated
    in the following screenshot:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们将选择授权参数分配的值作为通配符。然而，诀窍是在同一个参数上创建通配符，因为我们必须为密码和用户插入值，如下面的截图所示：
- en: '![](img/0efb4232-4d7f-4ab6-afc6-ca48a1fd02e8.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0efb4232-4d7f-4ab6-afc6-ca48a1fd02e8.png)'
- en: 'Then, go to the Payloads tab and here, we are going to select our lists. However,
    the most important step is that we need to encode our inputs in Base64 with the
    structure used by the basic authentication. First, in the Payload Sets section,
    select the use of two payload sets. It is not important if we will use the same
    list, but we need to use them as separate payloads, as shown in the following
    screenshot:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，转到有效负载选项卡，在这里，我们将选择我们的列表。然而，最重要的一步是，我们需要使用基本身份验证的结构对我们的输入进行Base64编码。首先，在有效负载集部分，选择使用两个有效负载集。我们将使用相同的列表并不重要，但我们需要将它们用作单独的有效负载，如下面的截图所示：
- en: '![](img/30b18b92-3434-4471-9fad-3e86092271d5.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](img/30b18b92-3434-4471-9fad-3e86092271d5.png)'
- en: 'Afterward, select the first payload list and, in the textbox separator for
    position 1, add the `:` character. This will be inserted after the first value,
    as demonstrated in the following screenshot:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，选择第一个有效负载列表，在第1个位置的文本框分隔符中添加`:`字符。这将在第一个值之后插入，如下面的截图所示：
- en: '![](img/3f342fc1-fea5-4b0e-9685-7db3a6d3a056.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3f342fc1-fea5-4b0e-9685-7db3a6d3a056.png)'
- en: 'Then, to encode the payload, click on Add payload processing rule. Here, select
    the Encode option in the list, and then Base64-encode. With this configuration,
    all of our payloads will be sent in Base64-encode, as shown in the following screenshot:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，点击“添加有效负载处理规则”来对有效负载进行编码。在这里，选择列表中的“编码”选项，然后选择Base64编码。通过这种配置，我们所有的有效负载都将以Base64编码发送，如下面的截图所示：
- en: '![](img/2864f3a8-aed5-4db2-8b07-84dbe5c089de.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2864f3a8-aed5-4db2-8b07-84dbe5c089de.png)'
- en: 'Now, go back to the Payload Sets section and select the second position. Here,
    select the list of users and passwords, but in the textbox leave empty the textbox
    separator for position 2\. Also, create the rule to encode the payload. Go back
    to the Positions tab and click on Start attack, as demonstrated in the following
    screenshot:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，返回到有效负载集部分，并选择第二个位置。在这里，选择用户和密码列表，但在文本框中留空第2个位置的文本框分隔符。还要创建规则来对有效负载进行编码。返回到位置选项卡，然后点击开始攻击，如下面的截图所示：
- en: '![](img/4b901b74-620c-4ad4-916d-fbd1089a08fa.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4b901b74-620c-4ad4-916d-fbd1089a08fa.png)'
- en: When the Intruder shows an HTTP error code 200, this means that the combination
    is correct.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 当入侵者显示HTTP错误代码200时，这意味着组合是正确的。
- en: Brute forcing forms
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 暴力破解表单
- en: As mentioned previously, basic authentication is not recommendable due to its
    security issues. More common is the use of authentication forms. These authentication
    forms consist in an HTML or another client technology form, which is passed to
    a backend where the credentials are processed to determine whether the user has
    access or not to the resource.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，基本身份验证由于其安全问题而不可取。更常见的是使用身份验证表单。这些身份验证表单包括HTML或其他客户端技术表单，将其传递到后端，那里处理凭据以确定用户是否有权访问资源。
- en: It is important to note that all the processing to determine whether the user
    is valid or not will be in the backend. Sometimes, it is recommendable to use
    structure validations in the client side, just to limit the number of incorrect
    attempts.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要注意，确定用户是否有效的所有处理都将在后端进行。有时，在客户端使用结构验证是可取的，只是为了限制错误尝试的次数。
- en: Automation with Burp Suite
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Burp Suite进行自动化
- en: 'To execute a brute forcing on a form, we are going to stop the request where
    the credentials are uploaded to the application, as can be seen in the following
    code block, where the user is accessing a login section:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 要在表单上执行暴力破解，我们将停止上传凭据到应用程序的请求，如下面的代码块所示，用户正在访问登录部分：
- en: '[PRE7]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: In this request, we can identify the parameters where the application receives
    the username and password. So, using the secondary button of the mouse, click
    on the emergent menu and select Send to Intruder. Here, we are going to create
    wildcards in the place where we have the parameters. Note that this is not a common `POST`
    request where the parameters are assigned as values. Here, we have a different
    structure, but it works in the same way.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
- en: 'In this case, the application is not using any kind of encoding. We just configure
    the payload as a normal list, selecting Cluster bomb as the attack type, and our
    previous list, as shown in the following screenshot:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/0dd09b83-fee8-4b1e-b9dd-5ea9572a6971.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
- en: 'To finish, click on Start attack. Intruder will launch a window where we can
    see the results. There are some applications, which, when the credentials are
    incorrect, respond with a 302 error code to redirect the user to the login page
    again. In this case, the application always responds with a 200 error code, so
    is needed to analyze the response in detail. To do this in an easy way, we can
    check the column length and look for a variation in the value that indicates a
    different result, as demonstrated in the following screenshot:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/30af46b5-ca2e-440b-8951-c5d8f2bb8488.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
- en: Bypassing file upload restrictions
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Many applications allow users to upload files. There are different ways to
    manage these files: some applications directly upload the file as binary, and
    others encode the file to reduce the size and manage in a database. Let''s explore
    how we can modify the restrictions established by an application to manage the
    files.'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
- en: Bypassing type restrictions
  id: totrans-149
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When an application allows you to upload files, usually the developer knows
    what types of files are allowed, so it is important to validate that a malicious
    user cannot upload other kinds of files. The common way to validate this is by
    using the extension file. So, if an application manages documents, maybe the developer
    allows PDF files and DOCX documents, but is this secure?
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: The file extension is not the only validation that the application needs to
    undertake. A malicious user can upload a malicious file with a valid extension;
    for example, to propagate malware.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
- en: First, we are going to create a malicious PDF using a tool called Metasploit.
    Metasploit is an exploitation framework that allows attack vulnerabilities, mainly
    in infrastructure; but it also has auxiliary modules to perform some tasks, such
    as creating binary files with embedded malicious code. You can get a copy of Metasploit
    in [https://www.metasploit.com/](https://www.metasploit.com/).
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
- en: 'To install it, you just need to uncompress the file in a directory. To create
    a PDF, follow these steps:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: Use the `adobe_utilprintf` tool, which will convert our PDF to a malicious PDF.
    You can use any PDF to do this.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the PDF to use the instruction set.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the payload to use. Metasploit has different payloads to perform actions
    when the file is executed, or in this case, opened. The simplest payload is to
    create a connection from the computer where the file is open to a remote computer.
    This is a reverse shell.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Set the remote IP address and the port, as demonstrated in the following screenshot:'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6394fa52-92a2-4751-a5c5-e9bb597acd5f.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
- en: 'After selecting all of the options, use the instruction exploit to create the
    file, as shown in the following screenshot:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/4daf1e92-6adf-48a8-8cfd-21cc4f2f3e09.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
- en: 'Open the application that you are assessing using Burp Suite and intercept
    a request in a section where the user is allowed to upload files. Imagine we have
    the following vulnerable request:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/12f9c3dc-896d-4d5d-824b-cd472e6dc290.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
- en: A sample vulnerable request
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: 'In this request, we can see we have two restrictions. First, we have a size
    limit, which is established to avoid uploading the biggest files. We can see this
    restriction in the following lines:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: So, if we modify these values, it's possible to upload files with a size bigger
    than what is expected by the user.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，如果我们修改这些值，就有可能上传比用户预期的更大的文件。
- en: 'The other restriction is the file, as follows:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个限制是文件，如下所示：
- en: '[PRE9]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: This application is waiting for a specific extension, if we upload another file,
    such as our modified PDF, see what happens.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 该应用程序正在等待特定的扩展名，如果我们上传另一个文件，比如我们修改过的PDF文件，看看会发生什么。
- en: You will see how the file is uploaded in a binary way to the server. At this
    point, the server has a malicious PDF that could be downloaded by other users,
    which will be infected. In order to confirm that the file is the same, you can
    download it and compare the downloaded file with your own file.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 您将看到文件是以二进制方式上传到服务器的。在这一点上，服务器有一个恶意的PDF文件，其他用户可以下载，这将导致感染。为了确认文件是否相同，您可以下载它并将下载的文件与您自己的文件进行比较。
- en: The conclusion for this point is that a file is just another type of input in
    an application, and you can modify it using Burp Suite like inputs in a form.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这一点的结论是，文件只是应用程序中的另一种输入类型，您可以像表单中的输入一样使用Burp Suite来修改它。
- en: Summary
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we learned the normal tools that Burp Suite uses to exploit
    different types of vulnerabilities. In particular, we exploited SSRF and XSPA
    to execute commands, extract information and perform tasks in the internal networks.
    Also, we reviewed the origin of these vulnerabilities. We reviewed an IDOR vulnerability,
    learned how to exploit it manually, and how to automate its exploitation using
    Intruder. Next, we reviewed some vulnerabilities related to configurations; how
    they could be critical and not critical, and how we can automate some of them.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了Burp Suite用于利用不同类型漏洞的常规工具。特别是，我们利用SSRF和XSPA来执行命令，提取信息并在内部网络中执行任务。此外，我们还回顾了这些漏洞的起源。我们回顾了IDOR漏洞，学会了如何手动利用它，以及如何使用Intruder自动化其利用。接下来，我们回顾了一些与配置相关的漏洞；它们可能是关键的，也可能不是关键的，以及我们如何自动化其中一些漏洞。
- en: We also performed brute forcing to look for valid credentials in two different
    types of authentications. We created a malicious PDF and learned how to upload
    it to a website ...
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还进行了暴力破解，以寻找两种不同类型认证的有效凭据。我们创建了一个恶意的PDF文件，并学会了如何将其上传到网站上...
