- en: Malware Detection with API Calls and PE Headers
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Some of the most annoying threats in information security are malicious programs.
    Every day, we hear news about data breaches and cyber attacks with malware. Attackers
    are enhancing their development skills and building new malware that are able
    to bypass company safeguards and AV-products. This chapter will introduce some
    new techniques and solutions for defeating malware, using cutting-edge data science,
    Python libraries, and machine learning algorithms.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Malware analysis approaches
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Machine learning aided malware analysis techniques, with practical, real-world
    Python projects
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we will use the same Python libraries that we already installed.
    We are going to use those libraries during most of the chapters in this book.
    That is why we used the first chapter to teach you how to install all of the required
    libraries.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: You will find all of the codes discussed, in addition to some other useful scripts,
    in the repository at [https://github.com/PacktPublishing/Mastering-Machine-Learning-for-Penetration-Testing/tree/master/Chapter03](https://github.com/PacktPublishing/Mastering-Machine-Learning-for-Penetration-Testing/tree/master/Chapter03).
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: Malware overview
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Malware are malicious pieces of software that are designed to infiltrate and
    damage information systems without the users'' consent. The term *malware* covers
    a lot of categories. There are many different types of malware:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: Viruses
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ransomware
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Worms
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Trojans
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Backdoor
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Spyware
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Keyloggers
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Adware, bots, and rootkits
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Malware analysis
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Your job, as a malware analyst, is to discover exactly what happened to a system,
    and to make sure that the machines damaged by malicious software are isolated
    from the organization''s network. In order to perform malware analysis, we need
    to follow specific operations and approaches. When it comes to malware analysis,
    we have to perform three techniques: static malware analysis, dynamic malware
    analysis, and memory malware analysis. We are going to look at them one by one.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: Static malware analysis
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The first step in malware analysis is gathering all of the information about
    the malware. Static analysis is the art of collecting all of the available information
    about the malicious binary, using different techniques and utilities. In this
    phase, the analyst examines the malware without really executing it. Some common
    static malware analysis methods are as follows:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: '**Online antivirus scanning**: Scanning the suspicious file using an online
    scanner is a good way to check the file, thanks to online environments that give
    you the ability to scan the file using many antivirus products. The most well
    known online scanner is VirusTotal. If you want to scan a file, just visit [https://www.virustotal.com/#/home/upload](https://www.virustotal.com/#/home/upload)
    and upload the file:'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/00072.jpeg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
- en: 'To automate the tasks, VirusTotal delivers some useful APIs. Thus, you can
    build your own Python script with a few lines:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00073.jpeg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
- en: 'To scan `file.exe`, you could use the following code snippet from VirusTotal:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: To obtain a key, just create a VirusTotal community account.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: '**Hashing**: This is a technique to identify files. Each hashed file has a
    unique hash. The most commonly used hash functions are MD5 and SHA256.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Strings**: These are also great sources of information. Extracting strings
    from the malicious program will give us juicy information about the malware. Some
    strings include URIs, URLs, error messages, and comments.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dynamic malware analysis
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'After collecting information about malware, you should run it in an isolated
    and secure environment. Generally, these environments are called **malware analysis
    sandboxes**. Sandboxes are loaded with analysis and monitoring tools to gather
    information about the malware while it is running. Malware analysts can collect
    the following information, and more:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: TCP connections
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DNS summaries
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Malware behaviors
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: System calls
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Memory malware analysis
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Years ago, using the two previous techniques was enough to analyze malware,
    but attackers are now using new, more complicated techniques to avoid detection.
    I bet that you have heard about fileless malware. Memory malware analysis is needed
    to detect the new wave of malware. Memory malware analysis occurs by analyzing
    memory dumps collected from infected machines. In order to perform memory analysis,
    the analyst first needs to acquire memory (dumping memory), and can analyze it
    later by using many utilities and techniques.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: 'One of the most used frameworks is the volatility framework. If you have installed
    a Kali Linux distribution, you can use volatility directly on your machine without
    installing it. The following screenshot was taken from a Kali Linux built-in volatility
    framework:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00074.jpeg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
- en: 'Volatility helps analysts to collect information from memory dumps, including
    the following, and more:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: Bash history
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: API hooks
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Network information
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Kernel-loaded modules
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Evasion techniques
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Attackers and malware developers are continuously coming up with new techniques
    and methods to avoid detection. Some of the most common techniques are:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: '**Obfuscation**: This is the practice of making the malware more difficult
    to detect or analyze. Dead-code insertion, register reassignment, and crypting
    are three obfuscation techniques.'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Binding**: This is the practice of binding a malware with a legitimate file,
    resulting in a single executable.'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Packing**: A packer, sometimes called a **self-extracting archive**, is a
    software that unpacks itself in memory when the *packed file* is executed.'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Portable Executable format files
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Portable Executable** (**PE**) files are file formats for executables, DDLs,
    and object codes  used in 32-bit and 64-bit versions of Windows. They contain
    many useful pieces of information for malware analysts, including imports, exports,
    time-date stamps, subsystems, sections, and resources. The following is the basic
    structure of a PE file:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00075.jpeg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
- en: 'Some of the components of a PE file are as follows:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: '**DOS Header**: This starts with the first 64 bytes of every PE file, so DOS
    can validate the executable and can run it in the DOS stub mode.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**PE Header**: This contains information, including the location and size of
    the code.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**PE Sections**: They contain the main contents of the file.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To explore the PE header's information, you can use many tools, such as PE EXPLORER,
    PEview, and PEstudio.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: Machine learning malware detection using PE headers
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To train our machine learning models to find malware datasets, there are a
    lot of publicly available sources for data scientists and malware analysts. For
    example, the following websites give security researchers and machine learning
    enthusiasts the ability to download many different malware samples:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: '**Malware-Traffic-Analysis**: [https://www.malware-traffic-analysis.net/](https://www.malware-traffic-analysis.net/)'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Kaggle Malware Families**: [https://www.kaggle.com/c/malware-classification](https://www.kaggle.com/c/malware-classification)'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VX Heaven**: [http://83.133.184.251/virensimulation.org/index.html](http://83.133.184.251/virensimulation.org/index.html)'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VirusTotal**: [https://www.virustotal.com](https://www.virustotal.com)'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VirusShare**: [https://virusshare.com](https://virusshare.com)'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To work with PE files, I highly recommend using an amazing Python library called `pefile`.
    `pefile` gives you the ability to inspect headers, analyze sections, and retrieve
    data, in addition to other capabilities, like packer detection and PEiD signature
    generation. You can check out the GitHub project at [https://github.com/erocarrera/pefile](https://github.com/erocarrera/pefile).
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: 'You can also install it with PIP, like we did with the other machine learning
    libraries:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now we installed `pefile` successfully:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00076.jpeg)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
- en: 'Let''s start to build our first malware classifier. For this model, we are
    going to use three different techniques:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: Random forests
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Gradient-boosting classification
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: AdaBoost classification
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: As you may have noticed from the classification algorithms in this book, we
    are trying to use many different techniques. In some cases, you can use one of
    the previously discussed algorithms, but I am trying to use different techniques
    in every chapter, so that you can acquire a clear understanding of how to use
    each machine learning technique.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: 'By now, you are aware that the first step to building a machine learning model
    (after studying the project needs and requirements, of course) is downloading
    a dataset. In this section, we are going to download a malware dataset delivered
    by a security blogger, Prateek Lalwani. The malware dataset contains features
    extracted from the following:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: 41,323 Windows binaries (executables `.exe` and `.dlls`), as legitimate files.
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 96,724 malware files downloaded from the VirusShare website. So, the dataset
    contains 138,048 lines, in total.
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The dataset is divided as follows:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00077.jpeg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
- en: 'Let''s start by loading the malware dataset using the `pandas` Python library:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](img/00078.jpeg)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
- en: 'To make sure that the dataset has loaded properly, let''s print the number
    of important features:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '`The Number of important features is 56` will be the resulting line:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00079.gif)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
- en: To improve the estimators' accuracy scores, we are going to use the `sklearn.feature_selection`
    module. This module is used in feature selection or dimensionality reduction in
    the dataset.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: 'To compute the features'' importance, in our case, we are going to use tree-based
    feature selection. Load the `sklearn.feature_selection` module:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](img/00080.gif)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
- en: 'So, the algorithms has selected nine important features for us. To print them
    out, use the following commands:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The most important features are as follows:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00081.jpeg)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
- en: 'Now, it is time to train our model with a random forest classifier. Don''t
    forget to split the dataset, like we learned previously:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](img/00082.gif)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
- en: 'Let''s look at the final result:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](img/00083.gif)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
- en: 'The score seems very promising. This model detected malware with a 99% success
    rate, which is a great result. To obtain more information about the `False positive`
    and `False negative` rates of our malware classifier, import the scikit-learn
    `confusion_matrix` module:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Add the following lines:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](img/00084.gif)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
- en: The `False positive rate` is 0.6%, and the `False negative rate` is 1.4%.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: 'To train the model with another classifier, redo the previous steps, but instead
    of choosing the random forest classifier, select a machine learning algorithm.
    For example, I am going to select gradient-boosting:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](img/00085.gif)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
- en: 'Let''s check the second score:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](img/00086.gif)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
- en: 'This has a 98.8% detection rate. The following is the score using the AdaBoost
    classifier:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](img/00087.gif)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
- en: Machine learning malware detection using API calls
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Analyzing malware with API calls plays a huge role in malware analysis. Thus,
    APIs can give malware analysts an idea about malware behavior, especially when
    basic, static analysis wasn't successful due to obfuscation techniques (like packers,
    crypters, and protectors). Malware analysts can gain an understanding of how a
    malicious file works by studying API calls. There are many online tools that will
    give you the ability to analyze malware in a secure environment. Those utilities
    and environments are called sandboxes. Malware that is detected is identified
    by a hash function (MD5 or SHA256). Malware analysts use hashing to sign a file.
    For example, the following APIs were taken from the report of an online malware
    scan with [https://www.hybrid-analysis.com](https://www.hybrid-analysis.com).
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
- en: 'These are some details about  the malware "PE32 executable (GUI) Intel 80386,
    for MS Windows". Its hash is: 4c510779ab6a58a3bdbbe8d5f3ec568fcf33df81b0f1a5bdacabf78a9c62f492'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00088.gif)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
- en: 'According to the Microsoft website, [https://msdn.microsoft.com/](https://msdn.microsoft.com/),
    `GetProcAddress` retrieves the address of an exported function or variable from
    the specified **dynamic-link library** (**DLL**). So, if you want to learn more
    about the other calls, just go to the Microsoft developer network and search for
    the API call functions:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00089.jpeg)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
- en: 'The report includes a full summary of the findings, not only the API calls.
    It includes:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: General information
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Malicious indicators
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Unusual characteristics
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Anti-detection/stealthiness
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Anti-reverse engineering
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Network-related information
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following are pieces of information about the scanned malware. We discussed
    most of the required findings (static analysis artifacts: size, type and so on)
    previously:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00090.jpeg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
- en: 'For our second malware classifier, we are going to use API calls to build a
    machine learning malware detector. To extract APIs from malware binaries, the
    malware analyst needs to go through well-defined steps:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
- en: Malware unpacking
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Assembly program retrieving
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: API call extraction
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Analyzing the API calls, using the official Microsoft website
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You can categorize malware behaviors into groups. For example, the University
    of Ballarat categorized API calls into six categories in the article, *Towards
    Understanding Malware Behavior by the Extraction of API Calls*. You can use it
    to analyze your findings:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00091.jpeg)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
- en: 'As a demonstration, let''s build an Android malware detection project using
    a support vector machine learning algorithm fed by API calls dataset. This chapter''s
    GitHub folder contains a prepared dataset to build our model:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00092.jpeg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
- en: 'Before building the model, we need to import some useful modules:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](img/00093.jpeg)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
- en: 'First, let''s pre-process our CSV file (`Android_Feats.csv`):'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![](img/00094.gif)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
- en: 'Identify the data and the labels in the file using NumPy:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](img/00095.gif)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
- en: 'By now, the processing phase is done. As seen previously, we need to extract
    the most important features, because computing all of the available features would
    be a heavy task:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](img/00096.gif)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
- en: 'Now, divide the dataset (data and labels) into training and testing sets:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![](img/00097.gif)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
- en: 'The feature selection has been successfully completed. To train the model,
    we are going to use the support vector machine classifier:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![](img/00098.gif)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
- en: Voila! The accuracy of our new model is 98%, which is a great detection rate.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Malware is one of the most prevalent cyber threats haunting the security of
    modern organizations. Black hat hackers are constantly improving; hence, classic
    detection techniques are obsolete, and AV products are often unable to detect
    advanced persistent threats. That is why machine learning techniques can help
    us to detect malware.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we learned how to build malware classifiers, using many machine
    learning algorithms and open source Python libraries. The next chapter will teach
    us how to build more robust systems to detect malware, using the same algorithm
    used by the human mind. We are going to learn how to use deep learning to detect
    malware  , using the same Python libraries used throughout this book.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You are now able to build a machine learning model. Let's practice, putting
    our new skills to the test. In this chapter's GitHub repository, you will find
    a dataset that contains information about Android malware samples. Now you need
    to build your own model, following these instructions.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: 'In the `Chapter3-Practice` GitHub repository, you will find a dataset that
    contains the feature vectors of more than 11,000 benign and malicious Android
    applications:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: Load the dataset using the `pandas` python library, and this time, add the `low_memory=False`
    parameter. Search for what that parameter does.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Prepare the data that will be used for training.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Split the data with the `test_size=0.33`  parameter.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Create a set of classifiers that contains `DecisionTreeClassifier()`, `RandomForestClassifier(n_estimators=100)`,
    and `AdaBoostClassifier()`.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个包含`DecisionTreeClassifier()`、`RandomForestClassifier(n_estimators=100)`和`AdaBoostClassifier()`的分类器集合。
- en: What is an `AdaBoostClassifier()`?
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`AdaBoostClassifier()`是什么？'
- en: Train the model using the three classifiers and print out the metrics of every
    classifier.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用这三个分类器训练模型，并打印出每个分类器的指标。
- en: Further reading
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'For more information, check out the following log posts and documents:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 欲了解更多信息，请查看以下日志帖子和文档：
- en: PE Format (Windows): [https://msdn.microsoft.com/en-us/library/windows/desktop/ms680547(v=vs.85).aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/ms680547(v=vs.85).aspx)
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PE格式（Windows）：[https://msdn.microsoft.com/en-us/library/windows/desktop/ms680547(v=vs.85).aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/ms680547(v=vs.85).aspx)
- en: '*Malware Analysis: An Introduction*:[https://www.sans.org/reading-room/whitepapers/malicious/malware-analysis-introduction-2103](https://www.sans.org/reading-room/whitepapers/malicious/malware-analysis-introduction-2103)'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*恶意软件分析：介绍*：[https://www.sans.org/reading-room/whitepapers/malicious/malware-analysis-introduction-2103](https://www.sans.org/reading-room/whitepapers/malicious/malware-analysis-introduction-2103)'
- en: VirusTotal documentation: [https://www.virustotal.com/en/documentation/](https://www.virustotal.com/en/documentation/)
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VirusTotal文档：[https://www.virustotal.com/en/documentation/](https://www.virustotal.com/en/documentation/)
