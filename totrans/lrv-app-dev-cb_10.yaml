- en: Chapter 10. Testing and Debugging Your App
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover:'
  prefs: []
  type: TYPE_NORMAL
- en: Setting up and configuring PHPUnit
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing and running a test case
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using Mockery to test controllers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing acceptance tests using Codeception
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Debugging and profiling your app
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As web applications grow more complex, we need to make sure that any changes
    or updates we make to the existing code won't negatively affect other parts of
    code. One way to check for this is to create unit tests. Laravel provides very
    helpful ways for us to include unit tests with our app.
  prefs: []
  type: TYPE_NORMAL
- en: Setting up and configuring PHPUnit
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this recipe, we''ll see how to install and setup the popular PHPUnit testing
    package: PHPUnit.'
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For this recipe, we need a working installation of Laravel 4\. We'll also need
    the Composer dependency tool installed from [http://getcomposer.org](http://getcomposer.org).
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To complete this recipe, follow the given steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'In the root directory of the application, add the following line to the `composer.json`
    file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Open the command line window, navigate to the root directory, and run an update
    on the Composer tool with the following line:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'After it is installed, run a quick test in the command line window with the
    command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Our `composer.json` file tells the Composer tool which packages it should install.
    So our first task is to add the `phpunit` package as a requirement. After saving
    that file, we'll run an `update` command and `phpunit` will be added to our `vendor`
    directory.
  prefs: []
  type: TYPE_NORMAL
- en: After it's installed, we can run the command to test out `phpunit` and make
    sure it was installed correctly. Laravel comes with an example test case in the
    `app/tests` directory, and it should pass all tests.
  prefs: []
  type: TYPE_NORMAL
- en: Writing and running a test case
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, if we already have the PHPUnit installed and working, we can
    write a test case and use PHPUnit to check if it is valid or not.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To run a test case, we'll need a working installation of Laravel. We'll also
    need to have installed PHPUnit from the previous recipe, *Setting up and configuring
    PHPUnit*.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To complete this recipe, follow the given steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'In the `app/tests` directory, create a file named `MyAppTest.php` with the
    following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'Run the tests in the command line window, and we should get failing tests on
    entering the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'In our `routes.php` file, add a new route with the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Run the test again to get a passing unit test
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When we run our PHPUnit tests, Laravel will automatically look in the `app/tests`
    directory. We begin by creating a new file in that directory to hold the test
    named as `MyAppTest` and extend `TestCase`.
  prefs: []
  type: TYPE_NORMAL
- en: For this simple test, we use the `call` method and do a `GET` request on the
    `myapp` route. The first thing we check for is that we receive an `Ok` or a 200
    status code, and then that the content returned is the string `This is my app`.
    At this point, when we run the test, it will fail because we haven't created the
    route yet.
  prefs: []
  type: TYPE_NORMAL
- en: Next, we create our `myapp` route and return the string `This is my app`. Finally,
    we re-run the test and we should get a successful result.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The *Setting up and configuring PHPUnit* recipe
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using Mockery to test controllers
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Sometimes, we need to test the code that uses our database. The commonly accepted
    practice is that we shouldn't actually do live queries on the database while running
    a unit test. To get around this, we can use the Mockery package to fake our data.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For this recipe, we need to have Laravel installed and working, as well as PHPUnit
    from the *Setting up and configuring PHPUnit* recipe.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To complete this recipe, follow the given steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open up our `composer.json` file, and make sure the following code is included:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Open the command line terminal and run the Composer update with the following
    command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'After the update, in the `app/controllers` directory, create the `ShipsController.php`
    file using the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'In `routes.php` file, add a route to this controller using the following command
    line:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'In the `app/tests` directory, create a file named as `SpaceshipTest.php` as
    shown in the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Back in the command line window, run our tests with the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'At this point, we will get a failing test that displays the following message:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'Since the `Spaceship` class is going to be our model, we''ll use Mockery to
    mock it. Update the `SpaceshipTest` class with the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: Now, back in the command line window, run the test again and it should pass.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We begin by installing the Mockery package using the Composer. This will allow
    us to use it throughout our application. Next, we create a controller with one
    method that will display the name of a single ship. In the controller's constructor,
    we pass in the model we want to use, and in this case it's going to be named `Spaceship`
    and use Laravel's Eloquent ORM.
  prefs: []
  type: TYPE_NORMAL
- en: In the `showShipName` method, we'll get the first record from the ORM, then
    do a simple return of the record's name. We then need to make a route that points
    to the controller and the showShipName method.
  prefs: []
  type: TYPE_NORMAL
- en: When we first create the test, we simply make a `GET` request and see if it
    sends back an OK response. At this point, since we haven't made out the `Spaceship`
    model yet, it will display an error when we run the test. We could add the needed
    tables to the database and create the model, and the test would pass. However,
    when testing controllers, we don't want to worry about the database and should
    only be testing whether the controller code is working. For that, we can now use
    Mockery.
  prefs: []
  type: TYPE_NORMAL
- en: When we call the `first` method on the `Spaceship` class, it will give us an
    object holding all the returned fields, so we first create a generic object and
    assign it to the `$ship` controller. Then, we create our `mock` object for the
    `Spaceship` class and, when our controller asks for the `first` method, the `mock`
    object will return our previously created generic object.
  prefs: []
  type: TYPE_NORMAL
- en: Next, we need to tell Laravel that whenever the `Spaceship` instance is requested,
    it should use our `mock` object instead. And finally, call `GET` on our ship route
    and make sure it returns an OK response.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The *Setting up and configuring PHPUnit* recipe
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing acceptance tests using Codeception
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Acceptance testing is a useful way to test that your application is outputting
    the correct information to the browser. Using a package such as Codeception, we
    can automate these tests.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For this recipe, we'll need a working copy of Laravel installed.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To complete this recipe, follow the given steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open the `composer.json` file, and add the following line to our `require-dev`
    section:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'Open the command line window, and update the app with the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'After it is installed, we need to run the `bootstrap` command in the terminal,
    as shown in the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: 'In the `app/tests/acceptance` directory, create a file named as `AviatorCept.php`
    using the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'In our main `routes.php` file, update the default route using the following
    code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'Open the command line window and run the acceptance test with the following
    command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'At this point, we should see it failing. To make it pass, update the default
    route once more by entering the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'In the command line window, run the test again using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: This time, it should pass.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We start by installing the Codeception package through the Composer. Once it's
    downloaded, we run the `bootstrap` command that will create all the needed files
    and directories. Codeception automatically adds the files and folders to a `tests`
    directory; thus, to make sure they are added into Laravel's test directory, we
    add the `app` directory to the end of the `bootstrap` command.
  prefs: []
  type: TYPE_NORMAL
- en: Next, we create the file to hold our test in the `acceptance` directory. We
    start by creating a new `WebGuy` object, which is Codeceptions class to run acceptance
    tests. The next line is describing what we want to do, which in this case is to
    see all the blueprints. The next line tells the test which page we need to be
    on, which will correspond to our routes. For our purposes, we're just checking
    the default route. Finally, we tell the test what we want to `see` on the page.
    Any text we put here should be displayed somewhere on the page.
  prefs: []
  type: TYPE_NORMAL
- en: Our first pass at the default route will display `Way of the future`; thus,
    when the Codeception test is run, it will fail. To run the tests, we use the `run`
    command and make sure we use the `–c` flag and specify the `app` as the path to
    the tests, since we installed the bootstrap files inside the `app/tests` directory.
  prefs: []
  type: TYPE_NORMAL
- en: Then, we can update the route to display the text `All The Blueprints` and re-run
    the test. This time, it will pass.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Codeception is a very powerful testing suite with many different options. To
    fully understand everything it can do, go to [http://codeception.com/](http://codeception.com/).
  prefs: []
  type: TYPE_NORMAL
- en: Debugging and profiling your app
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If we want to know how our application is working behind the scenes, we'll need
    to profile it. This recipe will show how to add in a profiler to our Laravel app.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For this recipe, we'll need a working copy of Laravel with a MySQL database
    properly configured.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To complete this recipe, follow the given steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open up the command line window and use the `artisan` command to create our
    migrations as given in the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: In the `app/database/migrations` folder, open the file whose name begins with
    the date and ends with `create_spaceships_table.php`, and use this for our database
    table
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: 'In the `app/database/seeds` folder, create a file named `SpaceshipSeeder.php`
    as shown in the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 'In the same directory, open the `DatabaseSeeder.php` file and make sure the
    `run()` method looks like the following snippet:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: 'Back in the command line window, install the migration and run the seeder with
    the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: 'In the `app/models` directory, create a file named as `Spaceship.php` as shown
    in the following snippet:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: In the `app/controllers` directory, create a file named as `ShipsController.php`
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: 'In the `routes.php` file, register the route as shown in the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: 'In the `app/views` directory, create a view named as `ships.blade.php` as shown
    in the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: 'At this point, if we go to the `http://{your-dev-url}/public/ship`, we''ll
    see the list of ships. Next we need to open the `composer.json` file and add the
    following line in the `require-dev` section:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: 'Then in the command line window, update the Composer using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: 'After everything is downloaded, in the `app/config` folder, open the `app.php`
    file. In the `providers` array, add the following line to the end of the code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: 'In the same file, in the `aliases` array, add the following line:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: At the top of this file, make sure `debug` is set to true, then go back to `http://{your-dev-url}/public/ship`
    in your browser. The `profiler` will show up at the bottom of the browser window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Our first step is to create the page we want to profile. We start with using
    the `artisan` command to create a `migrations` file, and then add in the Schema
    builder code to make our spaceships table. When that's done, we can add some information
    to the table using the seeder file.
  prefs: []
  type: TYPE_NORMAL
- en: With that complete, we can now run the migration and the seeder, and our table
    will be created with all the information already populated.
  prefs: []
  type: TYPE_NORMAL
- en: Next we create a simple model and a controller for our data. In the controller,
    we'll simply get all of the ships and pass the variable to our ships view. We'll
    also add a logging event in the middle of the code. This will allow us to debug
    the code later, if we need to.
  prefs: []
  type: TYPE_NORMAL
- en: Once that's done, we can see the list of ships we created.
  prefs: []
  type: TYPE_NORMAL
- en: Then, we need to install the profiler package, which is based on a previous
    version of Laravel's profiler. After updating our Composer file, we then register
    the profiler so our app knows of its existence; we also register the Façade if
    we want to do more with it later.
  prefs: []
  type: TYPE_NORMAL
- en: In our config file, if we have `debug` set to `TRUE`, the profiler will display
    on every page we access. We can disable the profiler by simply setting `debug`
    to `FALSE`.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We could also add timers to our app using the startTimer and endTimer methods
    as shown in the following snippet:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
