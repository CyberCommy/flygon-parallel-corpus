- en: 'Chapter 1. Instant Penetration Testing: Setting Up a Test Lab How-to'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Welcome to *Instant Penetration Testing: Setting Up a Test Lab How-to*. This
    How-to contains the necessary information and essential steps required to do all
    the preparation work and build your own lab for practicing infrastructure, web,
    and Wi-Fi penetration testing.'
  prefs: []
  type: TYPE_NORMAL
- en: Understanding penetration testing (Must know)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section contains a short overview of penetration testing (what it is, what
    types of penetration testing exist, the typical workflow, and what you should
    remember).
  prefs: []
  type: TYPE_NORMAL
- en: 'Let us start by defining what penetration testing is and do a quick review
    of its main must-know details. According to *NIST SP 800-115*, *Technical Guide
    to Information Security Testing and Assessment*, it is defined as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Penetration testing is security testing in which assessors mimic real-world
    attacks to identify methods for circumventing the security features of an application,
    system, or network. It often involves launching real attacks on real systems and
    data that use tools and techniques commonly used by attackers.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Generally speaking, there are two main types of penetration tests:'
  prefs: []
  type: TYPE_NORMAL
- en: '**External**: These tests are performed from the outside of the testing area
    (usually network) and mimicking potential external threats.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Internal**: These tests are performed from the inside of network and imitate
    a potential internal intruder, who could be a visitor (authorized or not) able
    to connect to the office network or a disloyal employee.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'It is worth mentioning that external penetration tests could be additionally
    divided into several types by different criteria, sometimes based on targets:'
  prefs: []
  type: TYPE_NORMAL
- en: VPN penetration tests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Web application penetration tests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Wi-Fi penetration tests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'It is important to say that penetration testing goals may vary as well. Some
    companies may want to check their network vulnerabilities, others may want to
    test the effectiveness of their security solutions such as IPS, and some may need
    to test their security processes such as monitoring and incident response. Moreover,
    there are also penetration tests necessary for compliance purposes; for example,
    PCI DSS. Those goals determine general conditions for penetration tests. Penetration
    tests are most-widely classified as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Black box**: Penetration tester does not have any information about his targets
    prior to testing'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Gray box**: Penetration tester has some basic information about target infrastructure'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**White box**: Penetration tester has all the information he needs and is able
    to ask the customer for additional info during the testing process'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Everyone should know that the penetration testing workflow consists of the
    four following phases:'
  prefs: []
  type: TYPE_NORMAL
- en: Planning
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Discovery
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Attack
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Reporting
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Planning and reporting phases are usually made once during the project, but
    discovery and attack phases could be iterated several times, depending on their
    results. The following is a diagram of the penetration testing workflow:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](img/4124_01_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: In the beginning, the planning phase, all the organizational questions are negotiated,
    all the approvals are received, the working time and dates are settled, and other
    management work is done. All this information will be used by a penetration tester
    in the reporting phase.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Discovery is the process of target networks and systems data mining (IPs, open
    ports, network services and versions, OSs, and so on) and vulnerability identification
    based on gained information. Data mining is performed by analyzing the target
    hosts' reactions and responses on external interaction. This interaction is often
    called **Enumeration** and could be performed by means of automated tools (scanning)
    or manually.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The next step after enumeration in the discovery phase is vulnerability identification.
    Similar to the enumeration process, this step could be automated, non-automated
    or, in most cases, mixed. The automated approach supposes the use of specialized
    software tools, while non-automated means comparing the targets' software versions
    gained during the enumeration process with vulnerability databases and analyzing
    the targets' behavior after data input.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In general, different types of scanning are used simultaneously in the discovery
    phase, if there is no such goal to avoid IDS.
  prefs: []
  type: TYPE_NORMAL
- en: The next phase is actually penetration itself and is performed by conducting
    different kinds of attacks against disclosed vulnerabilities on target systems,
    which is called vulnerabilities exploitation. After a successful exploitation,
    you can get a new route to reach other systems, which were inaccessible before.
    In such cases, the penetration tester goes back to the discovery phase and repeats
    it for newly achieved targets. Thus, a couple of discovery and attack phases could
    be iterated several times, depending on the scope and agreements between a penetration
    tester and a client.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, at the reporting phase, the penetration tester develops a final report,
    which includes all the organizational project details, all the data collected
    during the discovery phase, and a description of the attack phase with the obtained
    results.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Here are some important things to remember.
  prefs: []
  type: TYPE_NORMAL
- en: Common reasons to set up your own lab
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Before starting your work on planning and setting up the lab, it is a good
    idea to do some preparation work and determine your own reasons for why you need
    a lab. Normally, penetration testers and information security specialists have
    a combination of several reasons to build their own labs, but here I want to give
    you the most common reasons:'
  prefs: []
  type: TYPE_NORMAL
- en: It is the best way to practise professional penetration testing skills and gain
    more knowledge about testing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All your practising in lab is legal, because you own and control it and there
    is no need to get a **Letter of Authorization** (**LOA**) first, so there is no
    risk of breaking the law
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This is a fully controlled environment, whose parameters and configurations
    could be changed in different ways in order to try different tools and techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A lab could be useful for preparing a working environment; that is, configuring
    software tools and different templates in the laptop that will be used for penetration
    testing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using a fully controlled lab is one of the best ways to find and research new
    software vulnerabilities
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Information security mechanisms' and solutions' effectiveness and performance
    could also be researched and assessed in the lab
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It is important to say that different types of penetration testing require different
    approaches and methodologies to be used for performing specific tasks. This is
    why a penetration tester has to work out all the basic methodologies step by step,
    permanently controlling everything that happens inside the lab environment and
    analyzing the environment reaction. This is why constant practising and learning
    are the two processes that are necessary for every professional penetration tester
    who wants to carry out projects successfully. You can use a lab, both for initial
    study with skill practising and for later training with penetration testing of
    certain technologies, or for learning new modes or functionality of your tools.
    The latter could be reached by setting up all appropriate technologies in your
    lab.
  prefs: []
  type: TYPE_NORMAL
- en: At the same time, if you are the penetration tester working with customers,
    you can meet a variety of different software and technologies used in the customer's
    networks and it is extremely important for you to be familiar with them and to
    know what to do. Also, during penetration tests, you might meet technologies,
    mechanisms, or software that are new for you. So, you obviously would have to
    learn and practise hacking them at a safe lab, but not on a customer's productive
    system.
  prefs: []
  type: TYPE_NORMAL
- en: On the other hand, if you are an information security officer or an internal
    penetration tester who is going to perform tests for your employer's company inside
    its corporate network, then you have to test the penetration testing methodology
    and plan its influence on target systems and the whole network (by means of training
    with your tools and researching), while not disrupting or reducing any system
    functionality or performance. On the basis of the results of such a training,
    a penetration tester can usually tune specific tools or choose tools that work
    with the target environment in the most effective way.
  prefs: []
  type: TYPE_NORMAL
- en: What is more important is that the speed and effectiveness of the whole penetration
    testing process often depends upon how good and comfortable tools are set up in
    pentesting laptop. However, just installing all the necessary tools is not enough
    – laptop tuning and hardening is another significant activity in preparation for
    performing penetration tests. Consequently, the lab becomes very useful for writing
    most common scripts, configuring proxies and frameworks, identifying network connection
    parameters, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: 'I also mentioned that using your own lab is also a good way to find and research
    new software vulnerabilities. A lot of information security researchers use their
    own labs for this reason. In general, the research process usually includes the
    following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Installing the interested software that needs to be researched.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Using special techniques to find vulnerabilities; for example, fuzzing.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Using a debugger or other techniques to research vulnerability and determine
    its parameters.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Understanding the possible effects of vulnerability exploitation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating and testing **Proof-of-Concept** (**PoC**) for this vulnerability to
    publicly demonstrate that it is exploitable.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The last reason for setting up your own lab that I would like to mention, is
    assessing the effectiveness and performance of information security mechanisms
    and solutions. In this case, a lab is useful because you can research the behavior
    of security facilities by sequentially applying different attack techniques on
    them and varying configuration parameters. One of the important advantages of
    using a lab for such assessments is the ability to legally and safely perform
    stress-testing of information systems and security facilities.
  prefs: []
  type: TYPE_NORMAL
- en: What you should remember
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'There are several important rules that you should always remember in order
    to avoid law infringement while performing penetration testing:'
  prefs: []
  type: TYPE_NORMAL
- en: To avoid any legal problems, you should always get an approval from your customers.
    LOA is an authoritative permission, which makes penetration test legal. LOA should
    be issued by the proper authorities, very specifically in scope (actually, what
    to test) of penetration testing and must contain confirmation from the customer,
    who he really owns all assets in the scope.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Like in every information security audit or assessment, you should also negotiate
    a **Non-Disclosure Agreement** (**NDA**) with the customer prior to starting your
    penetration test project. This agreement limits the information disclosure for
    both sides, so customers are confident in saving the confidentiality of their
    information, and you are certain about your methodology privacy.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It is important to negotiate organizational details such as specific testing
    windows (exact dates and time), necessary contacts, and incident response procedures
    in case of an accidental target system failure.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional reading
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you want to go deeper into the penetration testing process and its details,
    you can check the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '*NIST SP 800-115*, *Technical Guide to Information Security Testing and Assessment*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Hacking Exposed 7: Network Security Secrets & Solutions*, by *Stuart McClure*,
    *Joel Scambray*, and *George Kurtz*, *2012*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[http://www.pentest-standard.org](http://www.pentest-standard.org)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Planning the lab environment (Should know)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section reveals how to plan your lab environment step by step and shows
    what you should consider during the lab planning process.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get the best result after setting up your lab, you should plan it properly
    at first. Your lab will be used to practise certain penetration testing skills.
    Therefore, in order to properly plan your lab environment, you should first consider
    which skills you want to practise based on ideas and reasons listed in the *Understanding
    penetration testing (Must know)* recipe. Although you could also have non-common
    or even unique reasons to build a lab, I can provide you with the average list
    of skills one might need to practice:'
  prefs: []
  type: TYPE_NORMAL
- en: Essential skills
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Discovery techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enumeration techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Scanning techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Network vulnerability exploitation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Privilege escalation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: OWASP TOP 10 vulnerabilities discovery and exploitation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Password and hash attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Wireless attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional skills
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Modifying and testing exploits
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tunneling
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fuzzing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Vulnerability research
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Documenting the penetration testing process
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'All these skills are applied in real-life penetration testing projects, depending
    on its depth and the penetration tester''s qualifications. The following skills
    could be practised at three lab types or their combinations:'
  prefs: []
  type: TYPE_NORMAL
- en: Network security lab
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Web application lab
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Wi-Fi lab
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'I should mention that the lab planning process for each of the three lab types
    listed consists of the same four phases:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Determining the lab environment requirements**: This phase helps you to actually
    understand what your lab should include. In this phase, all the necessary lab
    environment components should be listed and their importance for practising different
    penetration testing skills should be assessed.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Determining the lab environment size**: The number of various lab environment
    components should be defined in this phase.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Determining the required resources**: The point of this phase is to choose
    which hardware and software could be used for building the lab with the specified
    parameters and fit it with what you actually have or are able to get.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Determining the lab environment architecture**: This phase designs the network
    topology and network address space.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now, I want to describe step by step how to plan a common lab combined of all
    three lab types listed in the preceding section using the following four-phase
    approach:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Determine the lab environment requirements**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To fit our goal and practise particular skills, the lab should contain the
    following components:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Skills to practise | Necessary components |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Discovery techniques | Several different hosts with various OSsFirewallIPS
    |'
  prefs: []
  type: TYPE_TB
- en: '| Enumeration techniques |'
  prefs: []
  type: TYPE_TB
- en: '| Scanning techniques |'
  prefs: []
  type: TYPE_TB
- en: '| Network vulnerability exploitation |'
  prefs: []
  type: TYPE_TB
- en: '| OWASP TOP 10 vulnerabilities discovery and exploitation | Web serverWeb applicationDatabase
    serverWeb application firewall |'
  prefs: []
  type: TYPE_TB
- en: '| Password and hash attacks | WorkstationsServersDomain controllerFTP server
    |'
  prefs: []
  type: TYPE_TB
- en: '| Wireless attacks | Wireless routerRadius serverLaptop or any other host with
    Wi-Fi adapter |'
  prefs: []
  type: TYPE_TB
- en: '| Modifying and testing exploits | Any hostVulnerable network serviceDebugger
    |'
  prefs: []
  type: TYPE_TB
- en: '| Privilege escalation | Any host |'
  prefs: []
  type: TYPE_TB
- en: '| Tunneling | Several hosts |'
  prefs: []
  type: TYPE_TB
- en: '| Fuzzing | Any hostVulnerable network serviceDebugger |'
  prefs: []
  type: TYPE_TB
- en: '| Vulnerability research |'
  prefs: []
  type: TYPE_TB
- en: '| Documenting the penetration testing process | Specialized software |'
  prefs: []
  type: TYPE_TB
- en: 'Now, we can make our component list and define the importance of each component
    for our lab (importance ranges between less important, **Additional,** and most
    important, **Essential**):'
  prefs: []
  type: TYPE_NORMAL
- en: '| Components | Importance |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Windows server | Essential |'
  prefs: []
  type: TYPE_TB
- en: '| Linux server | Important |'
  prefs: []
  type: TYPE_TB
- en: '| FreeBSD server | Additional |'
  prefs: []
  type: TYPE_TB
- en: '| Domain controller | Important |'
  prefs: []
  type: TYPE_TB
- en: '| Web server | Essential |'
  prefs: []
  type: TYPE_TB
- en: '| FTP Server | Important |'
  prefs: []
  type: TYPE_TB
- en: '| Web site | Essential |'
  prefs: []
  type: TYPE_TB
- en: '| Web 2.0 application | Important |'
  prefs: []
  type: TYPE_TB
- en: '| Web application firewall | Additional |'
  prefs: []
  type: TYPE_TB
- en: '| Database server | Essential |'
  prefs: []
  type: TYPE_TB
- en: '| Windows workstation | Essential |'
  prefs: []
  type: TYPE_TB
- en: '| Linux workstation | Additional |'
  prefs: []
  type: TYPE_TB
- en: '| Laptop or any other host with Wi-Fi adapter | Essential |'
  prefs: []
  type: TYPE_TB
- en: '| Wireless router | Essential |'
  prefs: []
  type: TYPE_TB
- en: '| Radius server | Important |'
  prefs: []
  type: TYPE_TB
- en: '| Firewall | Important |'
  prefs: []
  type: TYPE_TB
- en: '| IPS | Additional |'
  prefs: []
  type: TYPE_TB
- en: '| Debugger | Additional |'
  prefs: []
  type: TYPE_TB
- en: '**Determine the lab environment size**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In this step, we should decide how many instances of each component we need
    in our lab. We will count only the essential and important components'' numbers,
    so let''s exclude all additional components. This means that we''ve now got the
    following numbers:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Components | Number |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Windows server | 2 |'
  prefs: []
  type: TYPE_TB
- en: '| Linux server | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| Domain controller | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| Web server | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| FTP Server | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| Web site | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| Web 2.0 application | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| Database server | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| Windows workstation | 2 |'
  prefs: []
  type: TYPE_TB
- en: '| Host with Wi-Fi adapter | 2 |'
  prefs: []
  type: TYPE_TB
- en: '| Wireless router | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| Radius server | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| Firewall | 2 |'
  prefs: []
  type: TYPE_TB
- en: '**Determine required resources**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, we will discuss the required resources:'
  prefs: []
  type: TYPE_NORMAL
- en: Server and victim workstations will be virtual machines based on VMWare Workstation
    8.0\. To run the virtual machines without any trouble, you will need to have an
    appropriate hardware platform based on a CPU with two or more cores and at least
    4 GB RAM.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows servers OSs will work under Microsoft Windows 2008 Server and Microsoft
    Windows Server 2003.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We will use Ubuntu 12.04 LTS as a Linux server OS. Workstations will work under
    Microsoft Windows XP SP3 and Microsoft Windows 7.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ASUS WL-520gc will be used as the LAN and WLAN router.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Any laptop as the attacker's host.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Samsung Galaxy Tab as the Wi-Fi victim (or other device supporting Wi-Fi).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We will use free software as a web server, an FTP-server, and a web application,
    so there is no need for any hardware or financial resources to get these requirements.
  prefs: []
  type: TYPE_NORMAL
- en: '**Determine the lab environment architecture**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, we need to design our lab network and draw a scheme:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](img/4124_02_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Address space parameters:'
  prefs: []
  type: TYPE_NORMAL
- en: '**DHCP server**: 192.168.1.1'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Gateway**: 192.168.1.1'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Address pool**: 192.168.1.2-15'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Subnet mask**: 255.255.255.0'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In the first step, we discovered which types of lab components we need by determining
    what could be used to practise the following skills:'
  prefs: []
  type: TYPE_NORMAL
- en: All OSs and network services are suitable for practising discovery, enumeration,
    and scanning techniques and also for network vulnerability exploitation. We also
    need at least two firewalls – windows built-in software and router built-in firewall
    functions.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Firewalls are necessary for learning different scanning techniques and firewall
    rule detection knowledge. Additionally, you can use any IPS for practising evasion
    techniques.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A web server, a website, and a web application are necessary for learning how
    to disclose and exploit OWASP TOP 10 vulnerabilities. Though a **web application
    firewall** (**WAF**) is not necessary, it helps to improve web penetration testing
    skills to a higher level.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An FTP service ideally serves as a way to practise password brute-forcing. Microsoft
    domain services are necessary to understand and try Windows domain passwords and
    hash attacks including relaying. This is why we need at least one network service
    with remote password authentication and at least one Windows domain controller
    with two Windows workstations.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A wireless access point is essential for performing various wireless attacks,
    but it is better to combine a LAN router and Wi-Fi access point in one device.
    So, we will use a Wi-Fi router with several LAN ports. A radius server is necessary
    for practising attacks on WLAN with WPA-Enterprise security.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A laptop and a tablet PC with any Wi-Fi adapters will work as an attacker and
    victim in wireless attacks.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tunneling techniques could be practised at any two hosts; it does not matter
    whether we use Windows or any other OS.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing and modifying exploits as well as fuzzing and vulnerability research
    need a debugger installed on a vulnerable host.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To properly document a penetration testing process, one can use just any test
    processor software, but there are several specialized software solutions, which
    make things much more comfortable and easier.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the second step, we determined which software and hardware we can use as
    instances of chosen component types and set their importance based on a common
    lab for a basic and intermediate professional level penetration tester.
  prefs: []
  type: TYPE_NORMAL
- en: In the third step, we understood which solutions will be suitable for our tasks
    and what we can afford. I have tried to choose a cheaper option, which is why
    I am going to use virtualization software. The ASUS WL-520gc router combines the
    LAN router and Wi-Fi access point in the same device, so it is cheaper and more
    comfortable than using dedicated devices. A laptop and a tablet PC are also chosen
    for practising wireless attacks, but it is not the cheapest solution.
  prefs: []
  type: TYPE_NORMAL
- en: In the fourth step, we designed our lab network based on determined resources.
    We have chosen to put all the hosts in the same subnet to set up the lab in an
    easier way. The subnet has its own DHCP server to dynamically assign network addresses
    to hosts.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let me give you an account of alternative ways to plan the lab environment details.
  prefs: []
  type: TYPE_NORMAL
- en: Lab environment components variations
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It is not necessary to use a laptop as the attacker machine and a tablet PC
    as the victim – you just need two PCs with connected Wi-Fi adapters to perform
    various wireless attacks.
  prefs: []
  type: TYPE_NORMAL
- en: As an alternative to virtual machines, a laptop, and a tablet PC or old unused
    computers (if you have them) could also be used to work as hardware hosts. There
    is only one condition – their hardware resources should be enough for planned
    OSs to work.
  prefs: []
  type: TYPE_NORMAL
- en: An IPS could be either a software or hardware, but hardware systems are more
    expensive. For our needs, it is enough to use any freeware Internet security software
    including both the firewall and IPS functionality.
  prefs: []
  type: TYPE_NORMAL
- en: It is not essential to choose the same OS as I have chosen in this chapter;
    you can use any other OSs that support the required functionality. The same is
    true about network services – it is not necessary to use an FTP service; you can
    use any other service that supports network password authentication such as telnet
    and SSH.
  prefs: []
  type: TYPE_NORMAL
- en: You will have to additionally install any debugger on one of the victim's workstations
    in order to test the new or modified exploits and perform vulnerability research,
    if you need to.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, you can use any other hardware or virtual router that supports LAN
    routing and Wi-Fi access point functionality. A connected, dedicated LAN router
    and Wi-Fi access point are also suitable for the lab.
  prefs: []
  type: TYPE_NORMAL
- en: Choosing virtualization solutions – pros and cons
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Here, I want to list some pros and cons of the different virtualization solutions
    in table format:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Solution | Pros | Cons |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| VMWare ESXi |'
  prefs: []
  type: TYPE_TB
- en: Enterprise solution
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Powerful solution
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Easily supports a lot of virtual machines on the same physical server as separate
    partitions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: No need to install the OS
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: Very high cost
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Requires a powerful server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Requires processor virtualization support
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| VMWare workstation |'
  prefs: []
  type: TYPE_TB
- en: Comfortable to work with
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User friendly GUI
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Easy install
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Virtual `*nix` systems work fast
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Better works with virtual graphics
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: Shareware
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It sometimes faces problems with USB Wi-Fi adapters on Windows 7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Demanding towards system resources
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Does not support 64-bit guest OS
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Virtual Windows systems work slowly
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| VMWare player |'
  prefs: []
  type: TYPE_TB
- en: Freeware
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User-friendly GUI
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Easy to install
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: Cannot create new virtual machines
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Poor functionality
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| Micrisoft Virtual PC |'
  prefs: []
  type: TYPE_TB
- en: Freeware
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Great compatibility and stability with Microsoft systems
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Good USB support
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Easy to install
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: Works only on Windows and only with Windows
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Does not support a lot of features that concurrent solutions do
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| Oracle Virtual Box |'
  prefs: []
  type: TYPE_TB
- en: Freeware
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Virtual Windows systems work fast
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User-friendly GUI
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Easy to install
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Works on Mac OS and Solaris as well as on Windows and Linux
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Supports the "Teleportation" technology
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: Paid USB support
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Virtual `*nix` systems work slowly
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: Here, I have listed only the leaders of the virtualization market in my opinion.
    Historically, I am mostly accustomed to VMWare Workstation, but of course, you
    can choose any other solutions that you may like.
  prefs: []
  type: TYPE_NORMAL
- en: You can find more comparison info at [http://virt.kernelnewbies.org/TechComparison](http://virt.kernelnewbies.org/TechComparison).
  prefs: []
  type: TYPE_NORMAL
- en: Setting up the network security lab (Must know)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This section is aimed at setting up a lab environment for practising penetration
    testing in general. Skills that you can practise with this type of lab are as
    follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Essential skills
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Discovery techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enumeration techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Scanning techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Network vulnerability exploitation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Privilege escalation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Password and hash attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional skills
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Modifying and testing exploits
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tunneling
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fuzzing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Vulnerability research
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Documenting the penetration testing process
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Prior to setting up the network security lab environment, let''s do some preparation.
    We need to clearly understand our lab network topology for this task. It will
    differ from the topology given in the *Planning the lab environment (Should know)*
    recipe, because of tweaking for the current lab needs. In this recipe, the other
    components are necessary:'
  prefs: []
  type: TYPE_NORMAL
- en: Router
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Domain controller (Windows 2008)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: FTP server (Ubuntu)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Two workstations (Windows 7 Pro and Windows XP Pro)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Attacker workstation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can see the current task network topology in the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/4124_03_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Since we decided to use virtual machines, we need to clearly understand the
    current lab environment architecture (physical and logical). One physical PC will
    be used as a host workstation for virtual machines. It could be the same PC, which
    will be used as an attacker workstation. One more physical component is the router;
    all other components will be virtual machines, bridged to the router via a host
    workstation network interface. The described network security lab architecture
    is provided in the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/4124_03_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Before we proceed with setting up the lab, you should prepare the router and
    distributions of the following software:'
  prefs: []
  type: TYPE_NORMAL
- en: VMware Workstation 8 (installer)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft Windows Server 2008 (`.iso` installer disk image)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ubuntu server 12 (`.iso` installer disk image)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows 7 (`.iso` installer disk image)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows XP (`.iso` installer disk image)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Except VMware Workstation, software versions without service packs are preferable,
    because they contain more publicly announced vulnerabilities, which you can exploit
    to practise your skills in the lab.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We need to configure our router in the first step. For my example, I used ASUS
    WL-520GC, but the difference between home routers is not significant:'
  prefs: []
  type: TYPE_NORMAL
- en: Plug in the power supply and Internet connection cable to the router. The Internet
    connection cable should be plugged in the WAN port.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, connect the LAN adapter of the computer, which will host the virtual machines
    (host workstation) to any of the router LAN ports with the network cable.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The power indicator, WAN port indicator, and one of LAN port indicators in the
    router front panel must shine with green lights.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the browser on the host workstation, go to the address `192.168.1.1`, and
    input the username and password for the router. By default, it is `admin:admin`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the left panel, click on the IP **config** link and input your WAN settings
    (taken from your ISP) to the corresponding fields. Leave the LAN IP settings as
    default (IP: `192.168.1.1`, Subnet Mask: `255.255.255.0`). Click on **Apply**.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **DHCP Server** page, enable **Integrated DHCP server** and change the
    setup of the IP pool from `192.168.1.2` to `192.168.1.15`. Click on **Apply**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to the Internet firewall section, enable **Internet firewall** and disable
    **Web access from WAN**. All other settings are left by default. Click on **Finish**
    and then **Save & Restart**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The router will reboot, which indicates that it is ready for us to work with
    it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, we need to install our virtualization software; in my case, it is VMware
    Workstation 8 (the installation process is similar for older versions):'
  prefs: []
  type: TYPE_NORMAL
- en: Start the setup process by executing the distribution file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose the custom setup type and click on **Next** to view the setup options:![How
    to do it...](img/4124_03_03.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: I used the default settings, which are enough for our task, but you can change
    them if you need more VMware features enabled or want to install it into another
    directory. After selecting your settings, click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Check for product updates on startup** checkbox on the next screen
    and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Help improve VMware Workstation** checkbox on the next screen if
    you want to let the VMware Workstation software send the debugging information
    to VMware company servers for further analysis. Click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the location where you want to put shortcuts for VMware Workstation,
    and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Continue** to start the installation process. It can take a while
    to install the program and its components.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter your license key when prompted for it, and finish the installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, we need to update the VMware Workstation software to the latest version:'
  prefs: []
  type: TYPE_NORMAL
- en: Run VMware Workstation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the drop-down menu **Help**, click on **Software Updates**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the opened **Software Updates** windows, click on the **Check for Updates**
    button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install the available updates by choosing them and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, the VMware workstation is ready for work and we can proceed with the other
    lab components.
  prefs: []
  type: TYPE_NORMAL
- en: First, we should install the servers. Let us start from Windows Server 2008
    which will be our DC.
  prefs: []
  type: TYPE_NORMAL
- en: Select **New virtual machine…** in the drop-down menu **File of VMware Workstation**
    or press *Ctrl* + *N*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the opened wizard, select the typical configuration for the new virtual machine
    and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the next window, select **Installer disk image file (iso)**, and browse through
    the path to the installer image of Windows Server 2008, and click on **Next**:![How
    to do it...](img/4124_03_04.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the next window, type in a product key if you have one or skip it, select
    the **Windows Server 2008 Enterprise** version, type in the user name (I use `lab`
    here), and click on **Next**:![How to do it...](img/4124_03_05.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you did not provide a product key, a new dialog window will appear and ask
    for your confirmation in order to proceed without a product key. Click on **Yes**.
  prefs: []
  type: TYPE_NORMAL
- en: In the next window, type in the name for this virtual machine (I used the default
    one). Choose the file location for the virtual machine path and click on **Next**:![How
    to do it...](img/4124_03_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the system volume disk size for the virtual machine (it is better to set
    no less than 40 gigabytes) in the next window and select **Split virtual disk
    into multiple files**, then click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Customize hardware** button in the next window to manually set
    virtual machine hardware parameters.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the new window, set no less than 1 GB of memory, but it''s better to set
    2 GB or more. Set the essential parameters to the following values:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '| Parameter | Value |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Memory | 2 GB |'
  prefs: []
  type: TYPE_TB
- en: '| Processors | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| Network adapter | Bridged (without physical network connection state replication)
    |'
  prefs: []
  type: TYPE_TB
- en: '| USB controller | None |'
  prefs: []
  type: TYPE_TB
- en: '| Display | Use host settings for monitors |'
  prefs: []
  type: TYPE_TB
- en: Click on **Close**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Power** **on this virtual machine after creation** and click on **Finish**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, your virtual machine is ready for installing the OS. This process will
    start automatically after turning the virtual machine on and will last for a while.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The VMware workstation will automatically start installing the VMware tools
    after the installation of the Windows 2008 server; wait until this process ends.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Reboot the guest system and log in. You must see the initial configuration dialog
    box.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Set time zone** link and set your time, date, and time zone.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide a computer description and the name using the link in the initial configuration
    window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Open the **Local area connection properties** window using the following sequence:
    **Configure networking** | **Local area connection** | **Properties**. Leave all
    properties to the default setting except TCP/IPv4\. Set the values for the TCP/IPv4
    properties as shown in the following screenshot:![How to do it...](img/4124_03_07.jpg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, you should have an initial configuration window similar to the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](img/4124_03_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Now, we need to assign a Domain Controller role to our server. In the initial
    configuration window, click on the **Add roles** link and then **Next** to open
    the **Server Roles** assigning dialog window. Select the **Active Directory Domain
    Services** checkbox and start the role installation by clicking on the **Next**
    and **Install** buttons:![How to do it...](img/4124_03_09.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When the role installation will be finished, open the **Start** menu and type
    in `dcpromo` in the **Search** field. Launch **dcpromo**:![How to do it...](img/4124_03_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Continue clicking on **Next** in the opened dialog window until you get to the
    **Choosing deployment configuration** dialog box, select **Create a new domain
    in a new forest**, and click on **Next**:![How to do it...](img/4124_03_11.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Type in your lab domain name (FQDN), for example `lab.local,` and click on **Next**:![How
    to do it...](img/4124_03_12.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, we need to choose the functional level for the domain forest. Choose the
    latest version in your system (for mine, it is **Windows Server 2008**) and click
    on **Next**:![How to do it...](img/4124_03_13.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the next screen, we must enable a **DNS server** role for our domain controller
    in order for it to work correctly:![How to do it...](img/4124_03_14.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When the wizard prompts you about the integration with an existing DNS infrastructure,
    click on **Yes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the next dialog box, leave the `Database`, `Log`, and `SYSVOL` folders as
    default and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the directory service restore mode administrator account password and click
    on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Check the summary info, click on **Next**, wait while the wizard is installing
    active directory domain services, and restart the system.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Take a snapshot of the domain controller virtual machine after its successful
    installation and initial configuration. To take a snapshot, select the **Take
    Snapshot** menu item, type in a snapshot name and comments in the dialog window,
    and click on the **Take Snapshot** button:![How to do it...](img/4124_03_15.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'After creating a domain controller, continue with installing Ubuntu Server:'
  prefs: []
  type: TYPE_NORMAL
- en: In VMware Workstation press *Ctrl* + *N* and follow the on-screen instructions
    to create a new Ubuntu virtual machine. This process is similar to creating a
    Windows Server 2008 virtual machine, so you should not have any trouble. Make
    sure you do not forget the root password that you enter during this process and
    set the network connection as bridged.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Ubuntu installation will start automatically after finishing with virtual machine
    creation. It will also automatically install VMware tools. It will take several
    minutes depending on your computer's performance and virtual machine properties.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After the installation, you should be able to see a standard Ubuntu Server console
    with a login invitation:![How to do it...](img/4124_03_16.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in and type the `ifconfig` command without arguments to find the name of
    your network interface. In my case it is `eth0`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, configure your network interface by executing the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'You will have to type in the root password to execute the command. After this,
    check if network interface settings are set as per our requirements, by typing
    the `ifconfig` command again but without any argument:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](img/4124_03_17.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Now, we need to add a route through a default gateway in order to let our server
    access the Internet. Do it by executing the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Now, execute the `route` command without any arguments and try `ping www.google.com`:![How
    to do it...](img/4124_03_18.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Let us install the FTP server now. I have chosen `vsftpd` as the solution for
    an easy way to install and setup. Type in the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: The installation will be done in automated mode.
  prefs: []
  type: TYPE_NORMAL
- en: 'To configure the `vsftp` daemon, open the `/etc/vsftpd.conf` file with the
    Nano editor by executing the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'Uncomment the following lines in the `vsftpd.conf` file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: Then, press *Ctrl* + *X* to exit. Answer `Y` to the question about saving your
    changes and choose the same file for saving `/etc/vsftpd.conf`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, we need to create at least one user who will have FTP access to his home
    directory. The easiest way to do it is to use the `adduser` command, which will
    prompt you with all the needed data and automatically create the user's home directory:![How
    to do it...](img/4124_03_19.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Restart the FTP daemon by executing the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Take a snapshot of your new virtual Ubuntu server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, we need to install and set up virtual Windows workstations. Let''s start
    from Windows XP:'
  prefs: []
  type: TYPE_NORMAL
- en: In VMware Workstation, press *Ctrl* + *N* and follow the on-screen instructions
    to create a new virtual machine with customized parameters. Do not forget to set
    up the network interface for the virtual machine as `bridged`. The Windows XP
    installation process starts automatically right after creating a virtual machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will be prompted to enter the Windows product key if you have not done it
    in the previous step. Enter the valid product key (you can find a lot of trial
    keys on the Internet). Windows XP with SP3 lets you skip the product key entering
    step during installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'As long as we use virtual machines for our lab, performance is important for
    us. We can improve the performance of Windows XP in the following ways:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open **Control Panel** from the **Start** menu and switch to the classic view.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Double-click on the **System** icon.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to the **Advanced** tab and click on the **Settings** button in the **Performance**
    section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Select the **Adjust to best performance** option and click on **Apply and OK**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![How to do it...](img/4124_03_20.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As this workstation will be used to practice penetration testing skills, it
    should have some vulnerabilities. This is why we need to turn off automatic updates
    — go to the **Automatic Updates** tab, select **Turn Off Automatic updates**,
    and click on **Apply** and then **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The network connection for the Windows XP workstation is configured to acquire
    the dynamic IP address by default, so it must be already set. But, you need to
    manually set the domain controller IP as the primary DNS server address:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open **Control Panel** and double-click on the **Network connections** icon.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open **Local Area Connection** and its properties.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Internet Protocol (TCP/IP)** and click on the **Properties** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Set the following properties and return to **Control Panel**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![How to do it...](img/4124_03_21.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Now, we need to join the Windows XP workstation to our lab domain:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Make sure that the domain controller is turned on.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Double-click on the **System** icon.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to the **Computer Name** tab in the **System Properties** dialog window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Change…** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the computer name as `WinXP`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Member of** section, select the **Domain** radio button and type in
    the lab domain name in the text field below it. In my case, it is `lab.local`,
    and click on **OK**:![How to do it...](img/4124_03_22.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will be prompted for domain credentials. Enter the domain administrator's
    credentials and you should see the welcome window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Restart the Windows XP virtual machine and take a snapshot of it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The last lab component is Windows 7:'
  prefs: []
  type: TYPE_NORMAL
- en: In VMware Workstation, press *Ctrl* + *N* and follow the on-screen instructions
    to create a new virtual machine with customized parameters. Do not forget to set
    up the network interface for the virtual machine as `bridged`. The Windows 7 installation
    process starts automatically right after creating a virtual machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Windows 7 starts automatically after its installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in and set up the performance setting to **Adjust for best performance**
    in the **System Properties** dialog window; it can be found at **Control Panel**
    | **All Control Panel Items** | **System** | **Advanced System Settings**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Turn to the **Computer Name** tab and join this workstation to the lab domain
    in the same way as we did for Windows XP.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Reboot the system and take a snapshot.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Finally, we are done with the installation and configuration tasks and can
    check some components to see if they work ok:'
  prefs: []
  type: TYPE_NORMAL
- en: By joining the Windows workstation to the domain, we have already checked if
    the lab domain works.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, check the FTP server in the following way:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the Windows XP **Start** menu, find the **Run** command and enter `cmd`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the command line, type `ftp` and press *Enter*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Type the command `open 192.168.1.14` and press *Enter*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should see something similar to the following code if the FTP server works:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Enter the username and password.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After logging in, enter the `ls` command and the `ftp` user directory listing
    should be executed if everything works fine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Try to ping all the hosts from every host.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let's explore the essential steps that we just went over.
  prefs: []
  type: TYPE_NORMAL
- en: During the router configuration process, we need to restrict Internet users
    from rooting our lab router, so we should disable web access to the router from
    the external network (WAN) and activate the firewall.
  prefs: []
  type: TYPE_NORMAL
- en: When you start the VMware Workstation software, it will indicate if there are
    any updates available, and will ask if you want to install them. Some updates
    need to uninstall VMware Workstation first to install the new version. It will
    be done automatically if you click on **Yes**. Software updates for VMware Workstation
    are strongly recommended to be installed, because it is a way to fix known bugs
    and security flaws in VMware software.
  prefs: []
  type: TYPE_NORMAL
- en: But, we do not need any software updates for our virtual systems because we
    need them to have vulnerabilities with which we can practice penetration testing
    skills. This is the reason why I recommend you to turn off the automatic updates
    on all virtual systems.
  prefs: []
  type: TYPE_NORMAL
- en: We use bridged network interfaces in our virtual machines in order to let them
    communicate with the router, as they were physical hosts. If we set up NAT, then
    our systems will use VMware Workstation as a software DHCP server and will work
    in another subnet than the router.
  prefs: []
  type: TYPE_NORMAL
- en: I intentionally did not type in the Windows product key, because I use it only
    for demonstration purposes less than 30 days. But if you want to use it longer,
    then I recommend you to buy licenses.
  prefs: []
  type: TYPE_NORMAL
- en: The domain controller as well as DNS server; should have a static IP address
    in order to operate well. So, let it be `192.168.1.15`. It is also a good practice
    to give static IPs to servers; that is why our Ubuntu server also has a static
    IP.
  prefs: []
  type: TYPE_NORMAL
- en: A domain infrastructure needs a DNS server that is why we used `dcpromo` to
    install a DNS server role to the domain controller for maintaining the active
    directory.
  prefs: []
  type: TYPE_NORMAL
- en: During the domain controller configuration process, I set only two roles (**Domain
    Services** and **DNS Server**), but you can add or remove other roles for any
    training purposes and at any time later.
  prefs: []
  type: TYPE_NORMAL
- en: By default, `vsftpd` is configured to only allow an anonymous download. During
    the installation, an FTP user is created with a home directory `/home/ftp`. This
    is the default FTP directory. But we want to practise password guessing techniques
    with the FTP server, so we need to create different FTP users. I have shown you
    how to create an FTP user and now you can easily create as many users as you want.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Being a professional penetration tester means always going further find out
    more information than was given and constantly improving your knowledge. This
    is common for both a professional penetration tester and a real hacker, and this
    is also the reason to check the next paragraphs.
  prefs: []
  type: TYPE_NORMAL
- en: Alternative solutions and configurations
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You have to understand that the described way of building a network security
    lab is not the only one or the right one – there could be plenty of variations
    and different solutions starting from small personal labs to corporate virtualization
    clusters.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let me give you some options:'
  prefs: []
  type: TYPE_NORMAL
- en: If you are going to research vulnerabilities and modify or write your own exploits,
    it might be useful to set up VMware Workstation with the Visual Studio plugin
    for debugging purposes. It provides an interface between virtual machines and
    Microsoft Visual Studio.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You may need to add other hosts and install other additional network services
    in order to practise specific skills. This is not difficult, and you can always
    find appropriate manuals on the Internet.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can also replace some or all of the virtual machines with old unused physical
    computers and connect them into a network with a router or switch.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you do not want to manually install and configure all virtual systems, you
    can find virtual machines with already installed OSs on the Internet. You can
    also use specially-crafted vulnerable virtual machines. For example, one of the
    best vulnerable machines for lab purposes is **Metasploitable**.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional tips
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Here, I would like to tell you about some more useful things:'
  prefs: []
  type: TYPE_NORMAL
- en: After setting up the lab and taking snapshots of all the virtual machines, you
    will start performing different kinds of techniques and attacks against them.
    When you finish with the basic discovery and enumeration attacks, you would probably
    want to improve your skills to the next level and test yourself against different
    security solutions. In that case, install and set up integrated **host antivirus**,
    **firewall**, and **intrusion preventing systems** (**HIPS**) on the target virtual
    machines and take new snapshots. This will let you practise different firewall
    rules enumeration techniques, which is called **firewalking**, and different IDS
    evasion techniques. You can always revert your systems from any state to any of
    your snapshots in order to compare the results of using different techniques performed
    on different system states.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: One of the most useful techniques that I usually use during penetration testing
    projects is tunneling. It is a technique for passing your traffic through hosts,
    already controlled by you (successfully attacked). This means that you can reach
    non-routable hosts and networks. That is why I strongly recommend you to learn
    and practise it in your lab if you want to leverage your penetration testing skills
    robustly.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Always try new techniques and software in your lab to understand them well.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Try different penetration testing distributions such as BackTrack, and choose
    which fits you the best.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: I always take snapshots of my virtual systems. A snapshot is a saved state of
    a virtual machine that lets you return to any point you have previously saved.
    This means that you have a great opportunity to do whatever you want with your
    virtual machines, without being afraid of totally misconfiguring or losing them.
    So, do not forget to take snapshots.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional info
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To get additional info, you can check the following resources:'
  prefs: []
  type: TYPE_NORMAL
- en: '[technet.microsoft.com](http://technet.microsoft.com)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[www.ubuntu.com](http://www.ubuntu.com)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[www.offensive-security.com](http://www.offensive-security.com) and [www.offensive-security.com/metasploit-unleashed/Metasploitable](http://www.offensive-security.com/metasploit-unleashed/Metasploitable)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[www.backtrack-linux.org](http://www.backtrack-linux.org)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[pentestlab.wordpress.com](http://pentestlab.wordpress.com)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting up a web app lab (Should know)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This section is aimed at setting up a lab environment for practising web application
    penetration testing. You can practise the following skills using this type of
    a lab:'
  prefs: []
  type: TYPE_NORMAL
- en: Essential skills
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enumeration techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Scanning techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: OWASP TOP 10 vulnerabilities discovery and exploitation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Privilege escalation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional skills
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fuzzing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Vulnerability research
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Documenting the penetration testing process
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'At first, we have to determine the web app lab topology and architecture. In
    this recipe, we will use only components essential for web app penetration testing
    and will not include others. The following lab components are necessary for our
    current task:'
  prefs: []
  type: TYPE_NORMAL
- en: Router
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Web server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Victim web client workstation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Attacker workstation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can see the current task network topology in the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/4124_04_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Our lab topology and physical architecture will not be the same as we are going
    to build the lab on virtual machines. We will use one physical router and one
    physical PC (which will also be an attacker's host) for hosting a virtual web
    server, and a virtual client workstation with bridged network interfaces.
  prefs: []
  type: TYPE_NORMAL
- en: 'The described network security lab architecture is provided in the following
    diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/4124_04_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Before we proceed with setting up the lab, you should prepare the router and
    distributions of the following software:'
  prefs: []
  type: TYPE_NORMAL
- en: VMware Workstation 8 (installer)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft Windows Server 2003 (`.iso` installer disk image)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows XP (`.iso` installer disk image)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: XAMPP Apache distribution (installer for Windows can be downloaded from [http://www.apachefriends.org/en/xampp-windows.html](http://www.apachefriends.org/en/xampp-windows.html))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Mozilla Firefox (offline installer, the older the version, the better it is)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Google Chrome (offline installer, the older the version, the better it is)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Apple Safari (offline installer, the older the version, the better it is)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Except VMware Workstation, older software versions and no service packs are
    preferable, because they contain more publicly announced vulnerabilities, which
    you can exploit to practise your skills in the lab.
  prefs: []
  type: TYPE_NORMAL
- en: I recommend finding the offline browser installer, otherwise installers will
    try to download and install the latest versions with fixed bugs.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As always, our initial steps should be configuring the router and installing
    the VMware Workstation 8 in the same way as it was described in the *Setting up
    the network security lab (Must know)* recipe.
  prefs: []
  type: TYPE_NORMAL
- en: After updating the VMware Workstation, you can disconnect the WAN cable from
    your router as we do not need an Internet connection anymore.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, we can proceed with setting up a web client workstation and a web server
    hosting a vulnerable web application. Let us start with a workstation. It will
    be the Windows XP workstation with several web browsers installed:'
  prefs: []
  type: TYPE_NORMAL
- en: In the VMware Workstation, press *Ctrl* + *N* and follow the on-screen instructions
    to create a new virtual machine with customized parameters. Do not forget to set
    up the network interface for a virtual machine as `bridged`. The Windows XP installation
    process starts automatically right after creating a virtual machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will be prompted to enter the Windows product key if you have not done it
    in the previous step. Enter the valid product key (you can find a lot of trial
    keys on the Internet). Windows XP, with SP3, lets you skip the product key entering
    step during installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'So long as we use virtual machines for our lab, performance is important for
    us. We can improve the performance of Windows XP in the following way:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open **Control Panel** through the **Start** menu and switch to the classic
    view.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Double-click on the **System** icon.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to the **Advanced** tab and click on the **Settings** button in the **Performance**
    section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Adjust to best performance** option and click on **Apply and OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![How to do it…](img/4124_04_04_(1).jpg)'
  prefs: []
  type: TYPE_IMG
- en: As this workstation will be used to practise penetration testing skills, it
    should have some vulnerabilities. This is why we need to turn off automatic updates;
    go to the **Automatic Updates** tab, select the **Turn Off Automatic updates**
    option, and click **Apply** and then **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The network connection for the Windows XP workstation is configured to acquire
    a dynamic IP address by default, so it must be already set. But, you need to manually
    set the domain controller IP as the primary DNS server address:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open **Control Panel** and double-click on the **Network connections** icon.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open **Local Area Connection** and its properties.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Internet Protocol (TCP/IP)** and click on the **Properties** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Set up the following properties and return to the **Network connections** window:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![How to do it…](img/4124_04_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: We need to turn the network interface off before installing browsers so they
    do not download and install the latest versions. Right-click on **Local Area Connection**
    and select **Disable**:![How to do it…](img/4124_04_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The network connection icon should become grey, which means an inactive state
    of the interface.
  prefs: []
  type: TYPE_NORMAL
- en: Install the Google Chrome browser (for the web app lab's needs, I use Chrome
    v.14) by running the installer and following the on-screen instructions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, we need to turn off the Google Chrome automatic updates. In the **Start**
    menu click on **Run** and enter the `regedit` command.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Find the `HKEY_LOCAL_MACHINE\SOFTWARE\Policies` key in the registry editor.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Create a subkey `\Google\Update\`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In `HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Google\Update\`, create a DWORD parameter
    `AutoUpdateCheckPeriodMinute`, and set its value to `0`:![How to do it…](img/4124_04_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Close the registry editor and run the Mozilla Firefox installer (for the web
    app lab's needs, I use Firefox v8).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Follow the on-screen instructions and select **Standard Installation**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run the Mozilla Firefox browser after the installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the option not to import any data from other browsers when prompted.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Tools** drop-down menu, select **Options**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to the **Advanced** tab in the **Options** window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the sub-tab **Update** and deselect all the checkboxes. For Firefox 8,
    it looks similar to the following screenshot:![How to do it…](img/4124_04_08.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'For the latest versions of Firefox, for example 15, the update options sub-tab
    has been changed and you need to select **Never check for updates**, as shown
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it…](img/4124_04_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Close Mozilla Firefox and proceed with installing the Apple Safari browser.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run the Apple Safari installer (for the web app lab's needs, I use Safari v4),
    and follow the on-screen instructions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Apple Safari lets you choose the automatic update options during installation,
    so deselect the **Automatically update Safari and other Apple software** checkbox
    when prompted, and finish the installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, open the **Network Connections** window from **Control Panel** and enable
    **Local Area Connection** by right-clicking on its icon and selecting **Enable**:![How
    to do it…](img/4124_04_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The last thing we need to do with our Windows XP virtual machine is take a snapshot.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the VM dropdown menu of VMware Workstation, select **Snapshot** | **Take
    Snapshot…**, and input a name and a description for the new snapshot:![How to
    do it…](img/4124_04_11.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Our web client workstation is now ready for lab experiments, and we can go further
    by installing a Windows 2003-based web server.
  prefs: []
  type: TYPE_NORMAL
- en: In VMware Workstation, press *Ctrl* + *N*, and follow the on-screen instructions
    to create a new virtual machine with customized parameters. Do not forget to set
    up the network interface for the virtual machine as `bridged`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Depending on the Windows Server 2003 distribution, the installer can prompt
    you with which type of Windows 2003 you want to install. We need to choose **Windows
    2003 Server Standard** (option **B**):![How to do it…](img/4124_04_12.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After this, the Windows Server 2003 installation process starts.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: During the installation, you will be prompted for a product key. Enter any trial
    key found on the Internet or enter a valid key if you have a license.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After the installation of Windows Server 2003, wait until VMware Tools is installed
    and restart the system.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, we need to set up the network connection properties. Open **Local Area
    Connection Properties** and set the static IP `192.168.1.13` using other IP settings,
    as described in the *Setting up the network security lab (Must know)* recipe.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, copy the XAMPP installer to the Windows 2003 Server virtual machine and
    run it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Follow the on-screen instructions and leave the XAMPP path by default as `C:\xampp\`
    when prompted:![How to do it…](img/4124_04_14.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Also, we should install Apache and MySQL as services, so select the following
    checkboxes during installation:![How to do it…](img/4124_04_15.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Install** and wait while the installation ends.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The Apache server and the MySQL server will start automatically after the installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, find the `htdocs` directory in the `XAMPP` directory (in my case, it is
    `C:\xampp\htdocs`), and delete all the default content from that directory:![How
    to do it…](img/4124_04_16.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, copy the unzipped Damn Vulnerable Web Application folder `dvwa` into the
    empty `htdocs` directory.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to the `dvwa` directory and find the `.htaccess` file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open it for editing with notepad.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Find the next part of the code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Replace it with the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Save the file and close the Notepad.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Let us now simplify the attacker's task by reducing some PHP security settings.
    Go to the XAMPP control panel, click on Apache's **Config** button and select
    **PHP (php.ini)** to open the PHP `config` file:![How to do it…](img/4124_04_24.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Find the `allow_url_fopen` parameter in the `php.ini` file and set its value
    to `off`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Find the `allow_url_include` parameter and set its value to `off` as well.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, we need to restart the Apache server to apply the new settings. Click on
    Apache's **Stop** button:![How to do it…](img/4124_04_17.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You can see it in the status log area, and the **Stop** button should change
    its caption to **Start**:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it…](img/4124_04_18.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Start the Apache server by clicking on the **Start** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, let us check the network access to the Damn Vulnerable Web Application.
    Start your Windows XP virtual machine if it was stopped and run any web browser.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Type `192.168.1.13/dvwa/` into the address bar. You should see the following
    screenshot:![How to do it…](img/4124_04_19.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The next step is creating a database. Open the link you see in the browser window
    and you will be redirected to the DVWA control page:![How to do it…](img/4124_04_20.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Create / Reset Database** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the left-bottom corner of the DVWA control page, you will be able to see
    that the DVWA security level is set to high:![How to do it…](img/4124_04_21.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Let us change it to the low level. Click on the **DVWA Security** button at
    the left side of the page.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the DVWA login page, type in the username as `admin` and the password as
    `password`:![How to do it…](img/4124_04_22.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **DVWA Security** button on the left side of the page again.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **low** security level in the drop-down menu:![How to do it…](img/4124_04_23.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Then, click on the **Submit** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, take a snapshot; our web server and vulnerable web application are ready
    for practising web penetration testing skills.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let me explain the essential steps.
  prefs: []
  type: TYPE_NORMAL
- en: At first, we need to configure the router in order to provide our lab with networking
    capabilities. Then, our virtualization software, which will support the virtual
    machines, should be installed. After that, we can install and set up our virtual
    server and workstation.
  prefs: []
  type: TYPE_NORMAL
- en: To truly imitate the real-world scenarios, where different people use various
    web browsers to access web applications, we need to install several web browsers
    on our virtual web client machine. I have chosen Google Chrome, Mozilla Firefox,
    and Apple Safari as victim client browsers, because they are the most popular
    in real life and you should practice every kind of client-side attack with at
    least each of these three browsers. Also, I should mention that some kinds of
    client-side attacks work better with certain browsers and with others, different
    exploits are aimed at different browsers, and that is why we need several web
    browsers installed on the victim web client workstation not to restrict our training
    facilities to only a short list of attack performance.
  prefs: []
  type: TYPE_NORMAL
- en: To leave more opportunities for exploitation, we need to have as many vulnerabilities
    in web browsers as we can (the more, the better). Fully patched browsers require
    using the newest exploits, which are hard to find and use because in most cases
    you will need to personally modify and debug them. So, for successful and productive
    training, we need to have more older vulnerabilities, and this is the reason why
    we installed the older versions of web browsers and turned off automatic updates.
  prefs: []
  type: TYPE_NORMAL
- en: The XAMPP package was chosen because it already contains an Apache server, a
    MySQL server, and PHP configured to work together. It is easy to install, so we
    don't have to perform any additional configuration to run a web server.
  prefs: []
  type: TYPE_NORMAL
- en: But we need to additionally configure the DVWA access settings to allow access
    from external clients and not only localhost connections. This is the reason why
    we edited the `.htaccess` file in a relevant way.
  prefs: []
  type: TYPE_NORMAL
- en: Also we need create a database in DVWA in order to let it work as it should.
  prefs: []
  type: TYPE_NORMAL
- en: For those readers who have already high web penetration testing skills, the
    high DVWA security level is recommended because they know all the basic techniques
    and need to practise advanced tricking attack skills. But for beginners I recommend
    learning basic attack and exploitation techniques with a low DVWA security level
    to leverage your knowledge step by step.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Web application penetration testing is the most rapidly changing security issue
    and any penetration tester who wants to have up-to-date knowledge needs to constantly
    learn and train. This section gives you advice on where to look for more information.
  prefs: []
  type: TYPE_NORMAL
- en: Alternative lab options
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Let me show you some alternative options of building a web application penetration
    testing lab.
  prefs: []
  type: TYPE_NORMAL
- en: So, at first, it is not necessary to use a hardware router. Using the built-in
    VMware Workstation NAT capabilities is enough, but we need a hardware router for
    other types of labs, so why not use it in this lab as well. Additionally, using
    a hardware router has a better influence on the lab performance.
  prefs: []
  type: TYPE_NORMAL
- en: Also, you don't have to install the web server on a Windows machine. You can
    easily use a Linux-based server if you have appropriate knowledge. I should also
    mention that DVWA is platform independent, so you should not get any troubles
    installing it on a Linux-based web server.
  prefs: []
  type: TYPE_NORMAL
- en: The web client workstation can be also be a Linux-based system. In addition
    to this, it is better to have both Windows- and Linux-based client workstations
    to have a larger field for experimentation.
  prefs: []
  type: TYPE_NORMAL
- en: Alternative vulnerable web app packages
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Damn Vulnerable Web Application is not the one and only vulnerable web app that
    you can use for training in your lab environment.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are a lot of prepared vulnerable web applications on the Internet that
    are ready for use with whole virtual server images having vulnerable web app installed.
    Here is the list of some of them:'
  prefs: []
  type: TYPE_NORMAL
- en: OWASP Broken Web Applications Project ([https://www.owasp.org/index.php/OWASP_Broken_Web_Applications_Project](https://www.owasp.org/index.php/OWASP_Broken_Web_Applications_Project))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: NOWASP (Mutillidae) Web Pen-Test Practice Application ([http://sourceforge.net/projects/mutillidae/](http://sourceforge.net/projects/mutillidae/))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SQLol ([https://github.com/SpiderLabs/SQLol](https://github.com/SpiderLabs/SQLol))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Hackxor ([http://sourceforge.net/projects/hackxor/](http://sourceforge.net/projects/hackxor/))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bodgeit ([http://code.google.com/p/bodgeit/](http://code.google.com/p/bodgeit/))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional info
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Here are some additional information resources:'
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.dvwa.co.uk/](http://www.dvwa.co.uk/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[http://www.apachefriends.org/en/xampp.html](http://www.apachefriends.org/en/xampp.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.owasp.org/index.php/Web_Application_Firewall](https://www.owasp.org/index.php/Web_Application_Firewall)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.owasp.org/index.php/Category:OWASP_Testing_Project](https://www.owasp.org/index.php/Category:OWASP_Testing_Project)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.owasp.org/index.php/OWASP_Top_Ten_Project](https://www.owasp.org/index.php/OWASP_Top_Ten_Project)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting up a Wi-Fi lab (Become an expert)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section describes how to set up a lab for practising Wi-Fi penetration
    skills with basic wireless network protection mechanisms.
  prefs: []
  type: TYPE_NORMAL
- en: 'Skills you can practise using this type of lab are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Essential skills
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Discovery techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enumeration techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Password and hash attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Wireless attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional skills
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Documenting the penetration testing process
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'At first, we have to determine the Wi-Fi lab topology and architecture. In
    this chapter, we will use only those components that are essential for Wi-Fi penetration
    testing and will not include others. The following lab components are necessary
    for our current task:'
  prefs: []
  type: TYPE_NORMAL
- en: Wireless router
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: LAN workstation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Victim Wi-Fi client (workstation, laptop, smartphone, or tablet PC)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We will use a direct LAN connection between the LAN workstation and the router,
    and wireless connections between the victim Wi-Fi client and the wireless router.
    The topology of that network looks similar to the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/4124_05_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We will set up two Wi-Fi networks of different types. The initial router setup
    is the same for both types, so I will give the instructions only once before describing
    the security mechanism's setup. I will use the ASUS WL-520GC router, and all my
    examples will be given for this model of router.
  prefs: []
  type: TYPE_NORMAL
- en: 'I want to start by setting up a WEP protected network:'
  prefs: []
  type: TYPE_NORMAL
- en: Connect your workstation to the router using a LAN cable.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the browser at the LAN workstation and go to the address `192.168.1.1`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in to the router control panel using the default login ID and password `admin:admin`
    and go to the **Wireless** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the wireless network name (**SSID**) in the corresponding field; for example,
    set it to `wifilab`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Leave the **Channel** and **Wireless Mode** settings as **Auto**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Authentication Method** as **Shared Key**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the **Passphrase** setting value; it will be your key for connecting to
    the wireless network. Use an easy and not complicated key value, something that
    can be guessed by a dictionary.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Leave all other settings on this page as their default values.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, you should have settings similar to the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it…](img/4124_05_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Now, go to the **Wireless** | **Advanced** section and set the **Hide SSID**
    option to **Yes**, leaving all other settings on this page as their default values:![How
    to do it…](img/4124_05_04.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Finish** and then **Save & Restart**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After the router reboots, go to **System setup** | **Settings Management** and
    save a backup copy of your current router settings to the file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The WEP protected network is ready for operating now.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'After configuring a router, you need to connect your victim Wi-Fi client device
    to the `wifilab` network. Depending upon the type of your device and its OS, there
    can be different ways to connect to a wireless network, but the basic steps in
    general are the same:'
  prefs: []
  type: TYPE_NORMAL
- en: Enter the wireless network name (**SSID**) – it is `wifilab` in our case.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the wireless network passphrase, which you have set during the router
    configuration process.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Connect**, or **OK**, or whatever button your system offers you to
    connect to the wireless network.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'After setting up a WEP protected wireless network, we can proceed with setting
    up a more secure WPA-PSK protected network:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to the router control panel and go to the **Wireless** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the wireless network name (**SSID**) in the corresponding field; for example,
    set it to `wifilab` again.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Leave the **Channel** and **Wireless Mode** settings as **Auto**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Authentication Method** as **WPA-Personal**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, set the value of **WPA Pre-Shared key**. Use something easy and not complicated
    as a key value, something that can be guessed by a dictionary.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You should have settings similar to the following:![How to do it…](img/4124_05_05.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, go to **Wireless** | **Advanced**, and set the **Hide SSID** option to
    **Yes**, leaving all other settings on this page as their default values:![How
    to do it…](img/4124_05_04.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Finish** and then **Save & Restart**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After the router reboots, go to the **System setup** | **Settings Management**,
    and save a backup copy of your current router settings to the file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The WPA-PSK protected network is ready for operating now.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, you need to connect your victim Wi-Fi client device to the `wifilab` network
    in the same way as it was described in the *Planning the lab environment (Should
    know)* recipe.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: I would like to give you some explanation of the described steps in this section.
  prefs: []
  type: TYPE_NORMAL
- en: I have chosen the network topology based on real-world penetration testing scenarios.
    We need at least one wireless client connected to the wireless network, because
    most of the attacks require both a communicating wireless access point and a client.
    We also need a LAN workstation in order to practise penetration in the LAN through
    WLAN.
  prefs: []
  type: TYPE_NORMAL
- en: I recommend using simple and easy guessing values for the WEP and WPA password
    phrases to facilitate password guessing, which you will perform while practising
    wireless attacks.
  prefs: []
  type: TYPE_NORMAL
- en: I also recommend saving your router configuration backups in order to easily
    revert the router to the needed state without having to repeat all the configuration
    steps every time.
  prefs: []
  type: TYPE_NORMAL
- en: It is necessary to restart the router every time after changing its configuration
    in order to apply new settings.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As usual, if you do not want to limit yourself to only the given steps, then
    there is more information in the following sections to help you choose your next
    steps.
  prefs: []
  type: TYPE_NORMAL
- en: Improving your hacker skills
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: An advanced hacker has to be an expert in every type of security, including
    Wi-Fi WPA-Enterprise protection. So, if you want to become a highly qualified
    Wi-Fi penetration testing expert, I recommend you to additionally set up a Radius
    server in your lab network and connect the router to it for practising WPA-Enterprise
    protection hacking.
  prefs: []
  type: TYPE_NORMAL
- en: 'It is better done with a virtual Linux machine and free-radius software. You
    will need to install a virtual Linux host with a bridged network interface configured
    to use a static IP address. The network topology with the Radius server will look
    similar to the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Improving your hacker skills](img/4124_05_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'After creating a virtual Linux machine, you will need to install the free-radius
    software. The easiest way to do it is to use `apt-get` command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'Or:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '`free-radius-wpe` is the modified version of `free-radius` and is mostly used
    for hacking purposes, but you can also use it just for creating a Radius server.'
  prefs: []
  type: TYPE_NORMAL
- en: After installing, you will need to edit some configuration files in order to
    set the connection key, which will be used by the router to work with a Radius
    server, and set up account settings to let users connect to the wireless network
    via WPA-Enterprise.
  prefs: []
  type: TYPE_NORMAL
- en: At the end, you need to set the Radius server IP address, port number, and connection
    key in the router settings. Reboot the router.
  prefs: []
  type: TYPE_NORMAL
- en: Tips
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Most Wi-Fi routers support the WPS protocol (Wi-Fi Protected setup: [http://www.wi-fi.org/knowledge-center/articles/wi-fi-protected-setup%E2%84%A2](http://www.wi-fi.org/knowledge-center/articles/wi-fi-protected-setup%E2%84%A2)),
    which allows us to easily connect devices to the wireless network. But recently,
    WPS was compromised and is now considered unsafe. Also, the WPS key can be guessed
    in less than 30 hours.'
  prefs: []
  type: TYPE_NORMAL
- en: You can learn how to do it at [http://www.ehacking.net/2012/01/reaver-wps-wpawpa2-cracking-tutorial.html](http://www.ehacking.net/2012/01/reaver-wps-wpawpa2-cracking-tutorial.html).
  prefs: []
  type: TYPE_NORMAL
- en: 'It is often necessary to guess the WPA keys by using a dictionary, but such
    procedures take a lot of time with big dictionaries. That is why I recommend using
    cloud services to easily and quickly test hashes with big dictionaries. For example,
    I use this service: [http://www.cloudcracker.com](http://www.cloudcracker.com).'
  prefs: []
  type: TYPE_NORMAL
- en: Another thing worth mentioning is the wireless interface with packet injection
    capabilities on the attacker's machine, which is essential for successful wireless
    attacks. It could be Wi-Fi cards based on Atheros or Prism chipsets. For example,
    I use the ALFA Network AWUS036NH wireless USB adapter.
  prefs: []
  type: TYPE_NORMAL
- en: Additional info
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'I recommend that you check the following books to improve your Wi-Fi penetration
    testing skills to an advanced level:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Johnny Cache, Vincent Liu. Hacking Wireless Exposed: Wireless Security Secrets
    & Solutions*, Second Edition'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Andrew Vladimirov, Konstantin V. Gavrilenko, Andrei A. Mikhailovsky. Wi-Foo:
    The Secrets of Wireless Hacking*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Rob Flickenger, Roger Weeks. Wireless Hacks: Tips & Tools for Building, Extending,
    and Securing Your Network*, Second Edition'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'If you are going to become a Wi-Fi penetration testing expert, you should definitely
    check the following web resources:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Aircrack-Ng wireless attack toolset: [http://www.aircrack-ng.org/](http://www.aircrack-ng.org/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Wireless penetration testing methodology: [http://wirelessdefence.org/Contents/Wireless%20Pen%20Test%20Framework.html](http://wirelessdefence.org/Contents/Wireless%20Pen%20Test%20Framework.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Reviewing online lab portals (Become an expert)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, I will make short reviews of public online penetration testing
    labs on the Internet, which are being held by third parties.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Nowadays, there are a lot of such online penetration testing lab portals available,
    which offer plenty of various network services and lab environment topologies
    suitable for almost any training tasks and needs. But, there is at least one common
    thing with them that is important for any junior penetration tester – you do not
    need to install, set up, and maintain any hardware or software on your own; it
    is already done for you.
  prefs: []
  type: TYPE_NORMAL
- en: It is worth mentioning that you cannot change all lab components settings and
    this is the reason why they are not suitable for some kinds of specific tasks,
    which demand configuring specific lab environment parameters.
  prefs: []
  type: TYPE_NORMAL
- en: 'To start training with online penetration testing labs, you will need the following:'
  prefs: []
  type: TYPE_NORMAL
- en: A computer with Internet access
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A web browser
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An e-mail address, which will be used only for working with online penetration
    testing lab portals and will not be connected to your other e-mail accounts
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: BackTrack 5R3 virtual machine
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let us check some online lab portals with a short description of each. We will
    start by examining "Hacking-Lab" – one of the most interesting online hacking
    portals, which offers you various online hacking challenges, including OWASP TOP
    10 trainings:'
  prefs: []
  type: TYPE_NORMAL
- en: Open your browser and enter the address as [https://www.hacking-lab.com/](https://www.hacking-lab.com/).
    You should see the following page:![How to do it…](img/4124_06_01.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on **Remote Security Lab** on the left side of the main page, then click
    on **Topology** to see that the **Hacking Lab** portal consists of two logical
    parts: **Public web portal** and **VPN-protected lab network**:![How to do it…](img/4124_06_02.jpg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To start using the Hacking Lab programs, you need to register and log in with
    your account.
  prefs: []
  type: TYPE_NORMAL
- en: Click on **Create a free account now!** on the left side of the web page and
    register.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Events** link to check which events are available at the moment:![How
    to do it…](img/4124_06_08.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose the event and click on **Register Now** in the **Status** column. In
    my case, it is **OWASP Top Ten**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Return to the **Events** page, click on the event that you have chosen and select
    the challenge from the opened list to read details.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Some of the events require a VPN connection to the lab. Let me show you how
    to establish it with **OWASP Top Ten event #1 - OWASP A1 - Blind SQL Injection
    Attack**. Remember that you will be allowed to establish a connection only if
    you are registered to one of the events which requires it.'
  prefs: []
  type: TYPE_NORMAL
- en: Click on the **Download** link on the left side of the web page and choose **LiveCD**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the last version and download **VMware8 Appliance**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, run VMware Workstation and select **Open** in the **File** menu and select
    the **LiveCD VMware8 Appliance** in the new dialog window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Import Virtual Machine** dialog window, set the virtual machine name
    directory and click on **Import**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run the LiveCD virtual machine:![How to do it…](img/4124_06_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the flag icon at the top-right corner and change the keyboard layout
    to **US**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, right-click on the VPN connection icon next to keyboard layout and select
    **Connect Password**. The following window will be opened:![How to do it…](img/4124_06_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter your Hacking-Lab ID (e-mail) with the initial password and click on **OK**.
    The VPN connection icon at the top-right corner should become green if everything
    was correct.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, open the browser and enter the vulnerable application URL: [http://glocken.hacking-lab.com/12001/inputval_case2/inputval2/index.html](http://glocken.hacking-lab.com/12001/inputval_case2/inputval2/index.html).![How
    to do it…](img/4124_06_09.jpg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Start solving the challenge!
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, let us take a look at another portal called Hack-a-Server.
  prefs: []
  type: TYPE_NORMAL
- en: This portal is used not only by white-hat hackers and penetration testers who
    want to improve their skills, but also by system administrators and owners of
    real servers who want to test its security and are ready to pay for vulnerabilities
    disclosure. You can find the main idea of that portal right at its home page.
  prefs: []
  type: TYPE_NORMAL
- en: Open the browser and enter the address as [https://www.hackaserver.com/](https://www.hackaserver.com/).![How
    to do it…](img/4124_06_04.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Sign Up** at the top right-corner of the page.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter your nickname, e-mail, password, and click on **Sign Up**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Check your e-mail; you will receive a message from the Hack-A-Server portal
    containing your account activation link. Click on the link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Only Training and Exam arenas are available for you in this step. But, it is
    worth mentioning that Hack-A-Server is a commercial start up and that is why it
    allows you to earn money for vulnerabilities disclosure and exploitation at the
    playground arena.
  prefs: []
  type: TYPE_NORMAL
- en: But, before you can access the playground arena where money could be earned,
    you have to pass the exam.
  prefs: []
  type: TYPE_NORMAL
- en: Click on the **Training Arena** link at the top of the web page and check what
    is available for practising your penetration testing skills:![How to do it…](img/4124_06_05.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select any target and click on **Hack It!** to view the target details.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The portal will ask you to download the certificate bundle (connection package)
    to create a VPN connection to the training arena.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Download the certificate bundle and unzip it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Start the BackTrack 5R3 virtual machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Copy the unzipped connection package to your virtual BackTrack 5R3 machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the terminal and change the working directory to the certificate bundle
    directory.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: Now, open a new terminal window and check the connection to the target by trace
    routing and pinging its IP address (you can find it on the target details web
    page):![How to do it…](img/4124_06_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now hack it!
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To pass the exam, you will have to find as many vulnerabilities as you can at
    the exam arena and submit a report to the Hack-a-Server team for review. If you
    pass the exam, you will be allowed into the playground arena, where you can get
    paid for hacking.
  prefs: []
  type: TYPE_NORMAL
- en: There's more…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'If you are interested in trying as many online hacking playgrounds as possible,
    you should definitely check the following ones too:'
  prefs: []
  type: TYPE_NORMAL
- en: '[http://try2hack.nl](http://try2hack.nl)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[http://www.hackthissite.org](http://www.hackthissite.org)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[http://www.dareyourmind.net](http://www.dareyourmind.net)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[http://www.hackquest.com/](http://www.hackquest.com/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[http://www.root-me.org](http://www.root-me.org)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[http://hax.tor.hu](http://hax.tor.hu)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
