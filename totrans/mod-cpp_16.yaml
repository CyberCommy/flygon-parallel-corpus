- en: Date and Time
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problems
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Here are the problem-solving sections for this chapter.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: 39\. Measuring function execution time
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Write a function that can measure the execution time of a function (with any
    number of arguments) in any required duration (such as seconds, milliseconds,
    microseconds, and so on).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: 40\. Number of days between two dates
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Write a function that, given two dates, returns the number of days between the
    two dates. The function should work regardless of the order of the input dates.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: 41\. Day of the week
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Write a function that, given a date, determines the day of the week. This function
    should return a value between 1 (for Monday) and 7 (for Sunday).
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: 42\. Day and week of the year
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Write a function that, given a date, returns the day of the year (from 1 to
    365 or 366 for leap years) and another function that, for the same input, returns
    the calendar week of the year.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: 43\. Meeting time for multiple time zones
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Write a function that, given a list of meeting participants and their time zones,
    displays the local meeting time for each participant.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: 44\. Monthly calendar
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Write a function that, given a year and month, prints to the console the month
    calendar. The expected output format is as follows (the example is for December
    2017):'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Solutions
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Here are the solutions for the above problem-solving sections.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: 39\. Measuring function execution time
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To measure the execution time of a function, you should retrieve the current
    time before the function execution, execute the function, then retrieve the current
    time again and determine how much time passed between the two time points. For
    convenience, this can all be put in a `variadic` function template that takes
    as arguments the function to execute and its arguments, and:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: Uses `std::high_resolution_clock` by default to determine the current time.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Uses `std::invoke()` to execute the function to measure, with its specified
    arguments.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Returns a duration and not a number of ticks for a particular duration. This
    is important so that you don''t lose resolution. It enables you to add execution
    time duration of various resolutions, such as seconds and milliseconds, which
    would not be possible by returning a tick count:'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'This function template can be used as follows:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 40\. Number of days between two dates
  id: totrans-26
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As of C++17, the `chrono` standard library does not have support for working
    with dates, weeks, calendars, time zones, and other useful related features. This
    will change in C++20, as time zones and calendar support have been added to the
    standard at the Jacksonville meeting, in March 2018\. The new additions are based
    on an open source library called `date`, built on top of `chrono`, developed by
    Howard Hinnant and available on GitHub at [https://github.com/HowardHinnant/date](https://github.com/HowardHinnant/date).
    We will use this library to solve several of the problems in this chapter. Although
    in this implementation the namespace is `date`, in C++20 it will be part of `std::chrono`.
    However, you should be able to simply replace the namespace without any further
    code changes.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: 'To solve this task, you could use the `date::sys_days` class, available in
    the `date.h `header. It represents a count of days since the `std::system_clock` epoch.
    This is a `time_point` with a resolution of a day and is implicitly convertible
    to `std::system_clock::time_point`. Basically, you have to construct two objects
    of this type and subtract them. The result is exactly the number of days between
    the two dates. The following is a simple implementation of such a function:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Here are a couple of examples of how these overloaded functions could be used:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 41\. Day of the week
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Solving this problem is again relatively straightforward if you use the `date`
    library. However, this time, you have to use the following types:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: '`date::year_month_day`, a structure that represents a day with fields for year,
    month (1 to 12), and day (1 to 31).'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`date::iso_week::year_weeknum_weekday`, from the `iso_week.h `header, is a
    structure that has fields for year, number of weeks in a year, and number of days
    in a week (1 to 7). This class is implicitly convertible to and from `date::sys_days`,
    which makes it explicitly convertible to any other calendar system that is implicitly
    convertible to and from `date::sys_days`, such as `date::year_month_day`.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'With that being said, the problem resolves to creating a `year_month_day` object
    to represent the desired date and then a `year_weeknum_weekday` object from it,
    and retrieving the day of the week with `weekday()`:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 42\. Day and week of the year
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The solution to this two-part problem should be straightforward from the previous
    two:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: To compute the day of the year, you subtract two `date::sys_days` objects, one
    representing the given day and the other January 0 of the same year. Alternatively,
    you could start from January 1 and add 1 to the result.
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To determine the week number of the year, construct a `year_weeknum_weekday`
    object, like in the previous problem, and retrieve the `weeknum()` value:'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'These functions can be used as follows:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 43\. Meeting time for multiple time zones
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To work with time zones, you must use the `tz.h` header of the `date` library.
    However, this needs the *IANA Time Zone Database* to be downloaded and uncompressed
    on your machine.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: 'This is how to prepare the time zone database for the date library:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: Download the latest version of the database from [https://www.iana.org/time-zones](https://www.iana.org/time-zones).
    Currently, the latest version is called `tzdata2017c.tar.gz`.
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Uncompress this to any location on your machine, in a subdirectory called `tzdata`.
    Let's suppose the parent directory is `c:\work\challenges\libs\date` (on a Windows
    machine); this will have a subdirectory called `tzdata`.
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For Windows, you need to download a file called `windowsZones.xml`, containing
    mappings of Windows time zones to IANA time zones. This is available at [https://unicode.org/repos/cldr/trunk/common/supplemental/windowsZones.xml](https://unicode.org/repos/cldr/trunk/common/supplemental/windowsZones.xml).
    The file must be stored in the same `tzdata` subdirectory created earlier.
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In your project settings, define a preprocessor macro called `INSTALL` that
    indicates the parent directory for the `tzdata` subdirectory. For the example
    given here, you should have `INSTALL=c:\\work\\challenges\\libs\\date`. (Note
    that the double backslash is necessary because the macro is used to create a file
    path using stringification and concatenation, and would otherwise result in an
    incorrect path.)
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To solve this problem, we will consider a user structure with minimal information,
    such as name and time zone. The time zone is created using the `date::locate_zone()` function:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'A function that displays a list of users and their local time for the start
    of a meeting should transform the given time from a reference zone to the time
    in their own zone. To do that, we can use a conversion constructor of the `date::zoned_time`
    class:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'This function can be used as follows, where the given time (hour and minute)
    is represented in the current time zone:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 44\. Monthly calendar
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Solving this task is actually partially based on the previous tasks. In order
    to print the days of the month as indicated in the problem, you should know:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: What weekday is the first day of the month. This can be determined using the
    `week_day()` function created for a previous problem.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The number of days in the month. This can be determined using the `date::year_month_day_last`
    structure and retrieving the value of `day()`.
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'With this information determined first, you should:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: Print empty values for the first week before the first weekday
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Print the day number with the proper formatting from 1 to the last day of the
    month
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Break on a new line after every seven days (counting from day 1 of the first
    week, even though that could belong to the previous month)
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The implementation of all this is shown here:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些的实现如下所示：
- en: '[PRE11]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
