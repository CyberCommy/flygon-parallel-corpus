- en: Configuration Audits
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Introducing compliance scans
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Selecting a compliance scan policy
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introducing configuration audits
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Performing an operating system audit
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Performing a database audit
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Performing a web application scan
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introducing compliance scans
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we will be going through various recipes on the significance
    of Nessus for performing various audits, such as a credentialed scan, and performing
    policy compliance audits, such as an operating system audit, a database audit,
    and an application audit. This is a crucial part of a white box assessment for
    network security, as this allows an internal administrator or auditor to understand
    the security posture of the systems in the organization.
  prefs: []
  type: TYPE_NORMAL
- en: Selecting a compliance scan policy
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: An entire compliance scan or audit is different from a typical vulnerability
    scan; it is completely dependent on the plugins and the Nessus audit file. We
    have already covered the basics on how to download and update the plugins in [Chapter
    2](888a67bc-261d-466c-bd68-e1f498ac4213.xhtml), *Understanding Network Scanning
    Tools*. We will now uncover further details about plugins and the Nessus audit
    file. In this recipe, we will look how to select the correct baseline policy from
    the set of policies that come preloaded in Nessus, in order to perform a configuration
    audit for a Linux host.
  prefs: []
  type: TYPE_NORMAL
- en: Plugins
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Each plugin consists of syntax to check for a specific vulnerability for a
    version or multiple versions of the software, services, and operating systems.
    A group of plugins for a similar operating system/service/software are grouped
    as a plugin family, shown as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5bd2d877-0501-4dd3-9a7a-1279816be86b.png)'
  prefs: []
  type: TYPE_IMG
- en: These plugin families expand into different plugins that each perform a specific
    check. A user cannot manually add a plugin; they can only download or update new
    or missing plugins only when they are made available by Tenable. Each plugin has
    a set of parameters to help a user understand the plugin. These parameters are
    discussed in greater detail in the following section.
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/741c4cf5-4c58-47d2-9764-fa6bf1157df1.png)'
  prefs: []
  type: TYPE_IMG
- en: Synopsis
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section consists of brief information about the vulnerability and acts
    as a title for the vulnerability.
  prefs: []
  type: TYPE_NORMAL
- en: Description
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section provides deeper insight into the vulnerability of the exact component
    and version (if available) affected, along with details about the vulnerability.
    This allows the user to understand which part of the service or software is vulnerable,
    and the vulnerability as a whole.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section provides the user with details of remediation, such as configuration
    changes or code changes that are to be performed, or a link to an article by Tenable
    or any other trusted source on how to mitigate the vulnerability.
  prefs: []
  type: TYPE_NORMAL
- en: Plugin information
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section consists of parameters that differentiate the plugin from other
    plugins. Parameters include the ID, version, type, publication date, and modified
    date. These parameters act as metadata for the plugin.
  prefs: []
  type: TYPE_NORMAL
- en: Risk information
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section provides information about the severity of the vulnerability, alongside
    **Common Vulnerability Scoring System** (**CVSS**) data, which is one of the globally
    accepted standards for scoring vulnerabilities. The severity ratings vary from
    Critical to Informational; the CVSS score is on a scale of 1-10.
  prefs: []
  type: TYPE_NORMAL
- en: Vulnerability information
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section provides details about the platform for which the plugin is applicable,
    using the** Common Platform Enumeration** (**CPE**) index, which is currently
    maintained by the **National Vulnerability Database** (**NVD**). Further, it also
    provides information about the exploitability of the vulnerability, using parameters
    such as exploit available and exploit ease. It also consists of the publication
    date of the plugin.
  prefs: []
  type: TYPE_NORMAL
- en: Reference information
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section consists of information about reference IDs assigned to the vulnerability
    sent to the plugin by various known bodies, such as NVD and Secunia. These references
    include EDB-ID, BID, Secunia, and CVE-ID.
  prefs: []
  type: TYPE_NORMAL
- en: 'Each plugin, plugin family, or even all plugins, can be enabled and disabled
    as per the user''s requirements, thus allowing the user to reduce the scan time
    and use only the necessary plugins to perform a scan. The following screenshot
    shows a single plugin disabled:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6cdd11a3-d4b9-4ffe-8094-a97f91d3c34d.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The following screenshot shows a whole plugin family disabled:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/10dfa77d-bef6-4d75-8601-9b2c600d9295.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The following screenshot shows all the plugins disabled, using the Disable
    All button at the top right of the screen:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c916aee3-b244-48a6-92d8-8d03d38ed920.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The very important components of the plugins needed to perform the compliance
    scan are the policy compliance plugins. These plugins will be used along with
    the audit file provided to identify the operating system-level, service-level,
    and configuration-level vulnerabilities. For example, if you want to perform a
    compliance scan for Windows, you can disable all the remaining plugins and enable
    only Windows Compliance Checks, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/15cc7d13-994c-4e48-be2d-f636a924fb2d.png)'
  prefs: []
  type: TYPE_IMG
- en: Compliance standards
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are many standards in different sectors that have to be followed, and
    to which organizations are required to be compliant, in order to perform certain
    business operations or to ensure the security of their information. For example,
    most payment gateways, or any payment-related functionality, are required to be
    tested against the PCI standard to be considered secure.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are some of the standards in the market to which relevant organizations
    are expected to be compliant:'
  prefs: []
  type: TYPE_NORMAL
- en: ETSI **Cybersecurity technical committee** (**TC CYBER**)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ISO/IEC 27001 and 27002
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: CISQ
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DoCRA
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: NERC
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: NIST
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ISO 15408
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: RFC 2196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ANSI/ISA 62443 (formerly ISA-99)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The **ISA Security Compliance Institute** (**ISCI**) Conformity Assessment Program
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ISCI Certification offerings
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ISO 17065 and Global Accreditation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Chemical, oil, and gas industries
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: IEC 62443
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: IEC 62443 Certification programs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: IASME
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Banking Regulators
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Auditors create a checklist to identify the gaps against an industry standard
    baseline, thus allowing the organization to work on filling in the gaps to become
    compliant and certified. The compliance module in Nessus works in a similar fashion.
    It works to identify configuration gaps, data leakage, and compliance against
    various benchmarks.
  prefs: []
  type: TYPE_NORMAL
- en: The Nessus compliance module provides default audit files to check compliance
    against benchmarks for operating systems, network devices, software, and services
    running. Nessus has preloaded audit files for the **Center for Internet Security**
    (**CIS**), **Health Insurance Portability and Accountability Act** (**HIPAA**),
    and **Tenable Network Security** (**TNS**). It also allows the user to write a
    custom audit file using **Nessus Attack Scripting Language** (**NASL**). We will
    look at the customization of this in [Chapter 7](73856151-c7b8-44d9-9622-676a45f8292d.xhtml),
    *Understanding the Customization and Optimization of Nessus and Nmap*.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In order to perform this activity, you will have to satisfy the following prerequisites
    on your machine:'
  prefs: []
  type: TYPE_NORMAL
- en: Installing Nessus
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Getting network access to the hosts on which the scans are to be performed
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'In order to install Nesus, you can follow the instructions provided in [Chapter
    2](888a67bc-261d-466c-bd68-e1f498ac4213.xhtml), *Understanding Network Scanning
    Tools*. This will allow you to download a compatible version of Nessus and install
    all the required plugins. In order to check whether your machine has Nessus installed
    on it already, open the search bar and search for the Nessus Web Client. Once
    found and clicked on, this will be opened in the default browser window:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/58fd3189-18c6-46ad-ba86-2a38b92fc8cf.png)'
  prefs: []
  type: TYPE_IMG
- en: 'If you are sure Nessus is correctly installed, you can use the `https://localhost:8834`
    URL directly in your browser to open the Nessus Web Client. If you are unable
    to locate the Nessus Web Client, you should remove and re-install Nessus. For
    the removal of Nessus and installation instructions, refer to [chapter 2](888a67bc-261d-466c-bd68-e1f498ac4213.xhtml),
    *Understanding Network Scanning Tools*. If you have located the Nessus Web Client
    and are unable to open it in the browser window, you need to check whether the
    Nessus service is running in the Windows services utility, as shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b07ab37d-8b5e-4c39-83d7-a0143db809ae.png)'
  prefs: []
  type: TYPE_IMG
- en: 'You can also start and stop Nessus as per your requirements by using the services
    utility. In order to further confirm the installation using the command-line interface,
    you can navigate to the installation directory to see and access Nessus command-line
    utilities:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b7a4998b-159c-4606-b7f5-65841d6e700c.png)'
  prefs: []
  type: TYPE_IMG
- en: 'It is always recommended to have administrator or root-level credentials to
    provide the scanner access to all system files. This will allow the scanner to
    perform a deeper scan and populate better results compared to a non-credentialed
    scan. The policy compliance module is only available in paid versions of Nessus,
    such as Nessus Professional or Nessus Manager. For these, you will have to purchase
    an activation key from Tenable and update it in the Settings page, as shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c6b73df0-d2cd-4268-a421-860bb92213f0.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Click on the Edit button to open a window and enter the new activation code
    purchased from Tenable:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b37fd601-dcd0-416e-8e24-7d6538dfb3ff.png)'
  prefs: []
  type: TYPE_IMG
- en: In order to test the scans, we need to install a virtual machine. In order to
    run a virtual machine, I would recommend using VMware, which can be downloaded
    and installed from [https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html](https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html).
  prefs: []
  type: TYPE_NORMAL
- en: 'For the test system, readers can download Metasploitable (a vulnerable virtual
    machine by Rapid 7) from [https://information.rapid7.com/download-metasploitable-2017.html](https://information.rapid7.com/download-metasploitable-2017.html).
    Apply the following steps to open Metasploitable. This provides various components,
    including an operating system, a database, and a vulnerable application, which
    will help us to test the recipes in the current chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Unzip the downloaded Metasploitable package:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/3c83ede4-7a4c-471d-b431-dd7f356318b8.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Open the `.vmx` file using the installed VMware Workstation or VMware Player:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e4a8bd4c-5789-4bbe-8ed2-c4ceab583096.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Log in using `msfadmin`/`msfadmin` as the username and password:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/72e3eb1a-e742-4583-8301-e499a7e45f6e.png)'
  prefs: []
  type: TYPE_IMG
- en: How do it…
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Open the Nessus Web Client.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in to the Nessus Web Client with the user info created during installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the Policies tab and select Create a new policy.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Select Advanced Scan and fill in the required details:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/25ba53cc-109a-4d2e-baab-f27dcedcdb92.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Navigate to the Compliance tab and search for Linux benchmarks available in
    Nessus:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/cc2b9a79-e43b-4c61-bde7-19e47235c09c.png)'
  prefs: []
  type: TYPE_IMG
- en: This shows various benchmarks for different versions of Ubuntu. But in order
    to select the appropriate profile, we will first have to identify the version
    of Ubuntu running on the test machine.
  prefs: []
  type: TYPE_NORMAL
- en: 'Use the `lsb_release –a` command on the test machine to display the version
    of Ubuntu running:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/79c3505b-ebfb-443f-849b-fcbdcf2b7d18.png)'
  prefs: []
  type: TYPE_IMG
- en: It is clear that the remote test machine is running on Ubuntu 8.04, hence we
    will have to select the lowest available version in the available audit files
    to obtain approximate results.
  prefs: []
  type: TYPE_NORMAL
- en: 'Select the CIS Benchmark file for Ubuntu 12.04, as it is the lowest version
    available:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/de28613a-cae7-41c3-a59a-131af6ae2e3e.png)'
  prefs: []
  type: TYPE_IMG
- en: You can choose to change the available parameters, such as NTP server address,
    Hosts.allow network, Shadow Group ID, Syslog host address, and Banner file location,
    if there is any specific server/location to be configured. Also, as shown in the
    preceding screenshot, the SSH credentials for the remote Ubuntu host have to be
    entered.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Selecting an appropriate Nessus file is very important for performing any compliance
    scan, as the underlying syntax in NASL is customized for every audit file as per
    the operating system chosen. A Windows audit file would not work on Linux, and
    vice versa. To ensure that the right policy is selected, it is always recommend
    to check the operating system version to the last decimal point and select the
    policy for the closest available decimal.
  prefs: []
  type: TYPE_NORMAL
- en: Introducing configuration audits
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A configuration audit is an information security procedure where you prepare
    a baseline configuration, and then compare this with the current configuration
    to perform a gap analysis, later working on closing those gaps to get as close
    as possible to the baseline configuration. This process of closing the gaps and
    achieving a maximum hardened state is called risk or vulnerability mitigation.
  prefs: []
  type: TYPE_NORMAL
- en: Most companies and organizations rely on strong configurations to ensure security
    in their systems. A well hardened and patched system is a nightmare for a hacker
    to break into. As many companies opt to move their operations to the cloud, configuration
    plays a great role in security now more than ever. A simple lapse in a network
    device, allowing default users to log in, would help a hacker gain access to a
    whole network in minutes.
  prefs: []
  type: TYPE_NORMAL
- en: 'A regular application has two major components: the frontend and the backend.
    The frontend is where the end users access the application as a visible resource.
    Anything that is not visible or not accessible to the end user, then, can be considered
    the backend. This includes the web server, application server, database server,
    router, firewall, and intrusion prevention and detection systems. All of these
    devices could be physically different or being handled by a single cluster of
    servers. All of these are software that can be installed on any physical server;
    that is, an Apache Web Server can be installed on a normal computer with the Windows
    operating system. A simple XAMPP package installs a web/app server, a database,
    and an application framework. All these different components come with different
    configurations—a simple misconfiguration at any level of the application architecture
    can compromise the security of the whole system:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6523c7b2-2b5a-4816-b09e-eb8ae5237cd0.png)'
  prefs: []
  type: TYPE_IMG
- en: 'A configuration audit will ensure that the structure of any organization''s
    network security will be strengthened. Continuous monitoring of the changes to
    configurations of network devices and services in the infrastructure also helps
    to ensure safe configuration of the devices and servers. The following are some
    of the steps that can be taken to ensure strict hardening of servers:'
  prefs: []
  type: TYPE_NORMAL
- en: Detecting any dynamic changes in the configuration
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Configuration audit on new or changed configurations should be performed
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Examining device and server logs strictly
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Audit is to be performed on end-end of the network right from web application
    to the database
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There are four major types of audits that can be performed during the configuration
    audit, as discussed in the following sections.
  prefs: []
  type: TYPE_NORMAL
- en: Database audit
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As a part of the database audit, it is recommended to perform an audit on the
    database configuration, schema, users, privileges, and structures. A baseline
    can be created by using the secure configuration guides produced by the respective
    manufacturer, and analyzing the gaps present in the configuration. Some of the
    sample database configuration checks are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Authentication methods
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Revoking unnecessary privileges and roles from the role public
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Restricting permissions on runtime facilities
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ensuring that TCPs are specified as the `PROTOCOL` in the `ADDRESS` parameter
    in the `tnsnames.ora` file
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Network device audit
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As a part of the network configuration audit, it is recommended to perform
    an audit on firewall configuration, the firewall rulebase, router configuration,
    web application firewall signatures, and email client configuration. These are
    essential components in any network, as one faulty rule in the firewall could
    expose the whole network to the internet. The following are some of the checks
    to be performed on network devices:'
  prefs: []
  type: TYPE_NORMAL
- en: Authentication methods
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Access control list review
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Communication security
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Operating system audit
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As a part of an operating system audit, it is always recommended to audit access
    control, security settings, errors reports, a password policy, and folder permissions.
    These checks will fall in the same category, more or less, except for the actual
    method to obtain and audit the operating system. The following are some of the
    operating system checks to be performed:'
  prefs: []
  type: TYPE_NORMAL
- en: Authentication methods
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Password policy
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Partition and data segregation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Public shares
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Application audit
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: An application audit is one of the major components to be performed in a configuration
    and compliance audit. Instead of simply checking for configuration uses, it is
    always recommended to hunt for security bugs in the application caused by poorly
    built modules and services; for example, an application module allowing user input
    directly into SQL queries without any sanitization. This could allow an attacker
    with basic knowledge of SQL to craft queries and dump the entire database without
    having any network-level access directly to the database. It is very important
    for everyone to understand the significance of end-to-end security.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are the top 10 most critical web application security risks,
    as listed by OWASP:'
  prefs: []
  type: TYPE_NORMAL
- en: Injection
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Broken authentication
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Sensitive data exposure
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**XML external entities** (**XXE**)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Broken access control
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Security misconfiguration
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Cross-site scripting** (**XSS**)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Insecure deserialization
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using components with known vulnerabilities
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Insufficient logging and monitoring
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Performing an operating system audit
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous recipes, we have learned a great deal about the need for configuration
    audits and their contribution toward more secure networks. In this recipe, we
    will be looking at using the compliance scan feature of Nessus to perform a configuration
    audit of an operating system.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The *Getting ready* section for this recipe is same as the *Getting ready* section
    of the *Selecting a compliance scan policy* section. This recipe will also require
    you to have studied and practiced the previous recipes in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: How do it…
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Open the Nessus Web Client.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in to the Nessus Web Client with the user details created during installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Follow the steps from the *Selecting a compliance scan policy* recipe.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Navigate to the Credentials tab and select SSH credentials to be entered, as
    it is a Ubuntu test system. Select password-based authentication and fill in the Username
    and Password (unsafe!) fields, as shown here:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/9d501696-8214-454a-9ca0-68dfeb9173d7.png)'
  prefs: []
  type: TYPE_IMG
- en: 'If you have remote root login disabled in any Linux system, you can log in
    as a low privilege user and elevate to root privilege, as Nessus provides an Elevate
    privileges with option. All you have to do is select Root from the drop-down menu
    and enter the root password. Nessus will log in as the low-privilege user and
    run an `su` command in the background to log in using `root`:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/be096ca4-311e-4992-9b7b-06a3dbabc0f2.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Now navigate to the Plugins tab and enable only the plugins required for this
    scan—as mentioned earlier in the book, this reduces scan time and provides quicker
    results:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/fd9d8839-1a86-430b-9688-46a774c00327.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Then save the policy, as shown here:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c15129e7-8714-4e9b-980f-83c87792b584.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Navigate to Scans and select New Scan, and click on User Defined on the Scan
    Templates screen to find the Linux compliance scan policy you have created:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b61e696f-eefc-4ad4-a68f-70bf4dc70fe6.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Select the Policy and enter the required details, such as the name, description,
    and target list. To identify the IP address of the test system, run the `ifconfig`
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ae867998-78be-4108-ab6e-e812469b4bc4.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Enter the `192.168.75.137` IP address and select Launch from the drop-down
    menu:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/08011ae2-173d-4bdf-adef-21fd26ca9069.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Once the scan is completed, open the scan by clicking on it as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/90d7c9d7-1c2e-44ec-9ebf-6940c84eb917.png)'
  prefs: []
  type: TYPE_IMG
- en: 'There are four tabs that should appear once you open the results:'
  prefs: []
  type: TYPE_NORMAL
- en: Hosts
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Vulnerabilities
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Compliance
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: History
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'These tabs are shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/74bb38f8-15c0-44e9-a015-a4387480ed1f.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Navigate to the Vulnerabilities column. This will display the patches that
    are missing in the remote Ubuntu host:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b8447d9a-a89b-4770-b713-e31c8a912e53.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Each vulnerability, as listed by Nessus, consists of the following sections,
    with additional plugin details to help a user understand the vulnerability better
    and mitigate by applying the recommended solution:'
  prefs: []
  type: TYPE_NORMAL
- en: Description
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Output
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Port
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Host
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/cc99ed9b-31db-466d-bd1d-4b40b398e765.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Navigate to the Compliance tab to check the gaps in the configuration from
    the CIS benchmark audit file used:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/31c7581b-1fd0-4aff-8b90-f4a2cb76c45c.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Each compliance consists of the following sections and reference information
    to help the user understand the gap between the baseline and current configuration:'
  prefs: []
  type: TYPE_NORMAL
- en: Description
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Output
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Audit file
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Policy value
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Port
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Host
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/db3e9bf6-cd78-40fb-95e5-d75dab0303cf.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The major difference between the vulnerability scan and the compliance scan
    is the ratings. Results for the vulnerability scan are reported in terms of their
    severity: high, medium, low, and informational risk, based on multiple factors
    including CVSS score and ease of exploitation. By contrast, in a compliance scan,
    the observations are reported as failed, warning, and passed, where passed means
    the configuration is secure, and failed points toward a gap in the configuration.'
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A configuration audit of an operating system allows a user to understand the
    gaps present in the configuration of the operating system. A simple USB open access
    can lead to a network takeover these days, given the sophisticated viruses, malware,
    and adware available on the market. The WannaCry malware in Windows was one such
    example where an obsolete SMB version allowed the attackers to target millions
    of machines all over the world. Hence, it is always necessary, as a matter of
    routine, to include the configuration of the operating system in the audit in
    order to be fully secure and compliant.
  prefs: []
  type: TYPE_NORMAL
- en: Performing a database audit
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous recipes, we have seen a great deal about the need for a configuration
    audit and its contribution toward more secure networks. In this recipe, we will
    be looking at using the compliance scan feature of Nessus to perform a configuration
    audit of a MariaDB database.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The *Getting ready* section for this recipe is same as the *Getting ready* section
    of the *Selecting a compliance scan policy* section. Further, instead of using
    the Metasploitable virtual machine as the test setup, we are going to use the
    Kali Linux operating system. You can download the Kali Linux ISO from [https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/](https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/).
    Download and unzip the package to find a `.vmx` file, as in the *Getting ready*
    section of *Selecting a compliance scan policy* section.
  prefs: []
  type: TYPE_NORMAL
- en: 'Use the following syntax to start the MySQL service and set a password for
    the default user root so that we can remotely log in to the service using the
    same credentials to perform the audit:'
  prefs: []
  type: TYPE_NORMAL
- en: '`- service myql start`: To start the MySQL service'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`- mysql –u root`: To log in using the root user'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`- use mysql`: To select a MySQL table'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`- update user set password=PASSWORD("NEW-ROOT-PASSWORD") where User=''root'';`:
    To update the password for the root user in the MySQL table'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'This should look something like the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/bc464f72-0df3-4755-8a18-c6a965da0a19.png)'
  prefs: []
  type: TYPE_IMG
- en: How do it…
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Open the Nessus Web Client.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in to the Nessus Web Client with the user details created during installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the Policies tab and Select Create a new policy.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Select Advanced Scan and fill in the required details as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a3256a78-466a-4164-adbc-7b046bada805.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Navigate to the Compliance tag and search for MySQL benchmarks available in
    Nessus:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7c330048-7040-4f23-92af-cbaaefb6bd50.png)'
  prefs: []
  type: TYPE_IMG
- en: The screenshot in the *Getting ready* section shows that the remote host runs
    MariaDB 10.1.26; thus, we can conclude that the compatible version is MySQL 5.6,
    as seen at [https://mariadb.com/kb/en/library/mariadb-vs-mysql-compatibility/](https://mariadb.com/kb/en/library/mariadb-vs-mysql-compatibility/).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Select CIS MySQL 5.6 for Linux OS as a policy to perform a compliance scan:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c06b4a45-a660-4ca4-904a-e1ef438dd297.png)'
  prefs: []
  type: TYPE_IMG
- en: You can change the default paths of the policy if necessary.
  prefs: []
  type: TYPE_NORMAL
- en: 'Navigate to the Credentials tab, select Database from the drop-down menu, and
    enter the required details:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/73f533ec-cda8-409a-bbc7-f37fd1d69d99.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Navigate to the Plugins tab and disable all the plugins that are not required
    for the scan:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/2c2a71c8-0adb-448a-ac52-3668a24e7501.png)'
  prefs: []
  type: TYPE_IMG
- en: Save the policy and navigate to the Scans page to create a New Scan.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Navigate to the User Defined policy section to find the policy created for
    the database compliance scan:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/9b668f89-dc3b-4686-a2e4-1c97a69627ac.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Select the Policy and fill in the required details, such as the scan name,
    description, and targets to be scanned:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b2c7c83f-3561-4df8-8c22-d0eb1a3235ed.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The IP address of the remote host can be obtained using the `ifconfig` command.
    Enter the `192.168.75.136` IP address in the Targets field and select Launch to
    begin the scan:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/7e1f7c24-e71c-467f-adec-8f56c9b1a82a.png)'
  prefs: []
  type: TYPE_IMG
- en: How it works...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A database configuration audit covers a wide spectrum of checks, ranging from
    logins to schema-level access granted to the user. The previous scan technique
    helps highlight the missing patches to in the MySQL server and the failed compliance
    checks.
  prefs: []
  type: TYPE_NORMAL
- en: Performing a web application scan
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Nessus also supports web application scans. This can be used to audit and identify
    vulnerabilities in web applications.
  prefs: []
  type: TYPE_NORMAL
- en: Nessus plugins are effective enough to identify critical vulnerabilities from
    the OWASP Top 10\. Nessus provides options for the user to provide authentication
    details in order to perform a detailed scan and report various vulnerabilities.
    As a part of web application tests, Nessus also scans for vulnerabilities in application
    servers, web servers, and databases; that is, end-to-end vulnerability scanning.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The *Getting ready* section for this recipe is same as the *Getting ready*
    section of the *Selecting a compliance scan policy* section. This recipe will
    also require you to have studied and practiced the previous recipes in this chapter.
    Metasploitable consists of multiple vulnerable applications. In this recipe, we
    will be using DVWA to demonstrate Nessus'' capability to perform web application
    tests:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/72ce9984-aa96-444b-91de-dd3e6fc1a2e1.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The default login credentials for the DVWA application are `admin` for the
    Username field and `password` as the Password, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ed3eb03b-29a4-44c2-9774-e7d9a55314c5.png)'
  prefs: []
  type: TYPE_IMG
- en: How do it…
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Open the Nessus Web Client.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in to the Nessus Web Client with the user details created during installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to the Policies page and Create a new policy by selecting the web application
    tests scan template.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Fill in the name of the policy and navigate to the credentials:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b9149a10-d372-4b50-acf6-316e202c53d2.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Select HTTP authentication and fill in the remaining parameters according to
    the application to be audited:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/fe4e9b45-16c8-485a-9655-45be8b0010d3.png)'
  prefs: []
  type: TYPE_IMG
- en: 'There are multiple parameters to be filled in for this authentication form,
    such as Username, Password, path to Login page, path to Login Submission page,
    Login parameters, path to Check authentication on page, and Regex to verify successful
    authentication. Most of these could be obtained by spending a couple of minutes
    observing the workings of the application and the request it sends to the server
    from the browser console:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4efa5469-fa88-49f3-ad08-5c3a33658a15.png)'
  prefs: []
  type: TYPE_IMG
- en: Save the policy and navigate to the Scans page to create a new scan.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Navigate to the User Define policies to find the Web Application audit policy
    file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c3e2c093-fb15-420c-9539-f5aeabf5fd89.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Select the appropriate policy and fill in the details such as Name, Description,
    and Targets. You can simply enter the IP address or the domain name of the host,
    without any prefix or suffix path:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/619ea8f0-4cee-4f24-bd79-a6a4105c27a8.png)'
  prefs: []
  type: TYPE_IMG
- en: Launch the scan and wait for it to complete.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Once the scan is complete, open it to see the following info:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/98776e14-f9c5-40a1-8c96-004dcd006e9c.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Navigate to the Vulnerabilities tab to check the reported observations:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/8a21a732-6e3d-4ef7-a245-c32feb832b2d.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Each vulnerability consists of the following sections, along with other plugin
    details, to help you understand the vulnerability, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Description
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Output
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Port
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Hosts
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/20f3c4cb-5245-4247-8c5a-757d06bb642b.png)'
  prefs: []
  type: TYPE_IMG
- en: How it works...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Nessus plugins test the web application against the test cases configured
    and report the failed vulnerabilities along with the respective outputs. The report
    also reveals a great deal about the exploits that were executed by the scanner
    in order to help the user to recreate the issue and create a better mitigation
    method. The Nessus web application scanner cannot perform any business logic checks,
    as it lacks the decision-making algorithms for these. Hence it is always good
    to use the Nessus web application scanner module only for quick tests and later
    perform a full-fledged penetration test on the application to obtain better results.
  prefs: []
  type: TYPE_NORMAL
