- en: Chapter 3. Deploying IPCop and Designing a Network
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that we understand what IPCop is capable of as a firewall unconnected to
    any other system, we need to start considering how it does connect to them, and
    what are the implications for us. As you must now be realizing, the scope for
    deploying IPCop is quite varied, and especially in conjunction with a knowledge
    of Linux and the flexibility of open-source software, the number of possible permutations
    of even one IPCop box are fairly limitless! That said, there is a core of functionality
    used by the majority of networks, and among all of those permutations, there are
    a few core network layouts that will probably be common among the majority of
    IPCop deployments.
  prefs: []
  type: TYPE_NORMAL
- en: What we will try to do here, therefore, is outline a few common methods of deploying
    IPCop and the motivation behind these topologies, depending on which IPCop components
    we want to deploy.
  prefs: []
  type: TYPE_NORMAL
- en: Trust Relationships between the Interfaces
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As we now understand, the four types of network interface—Green, Red, Blue,
    and Orange—supported by IPCop have differing levels of trust associated with them.
    Here is a simple table outlining what traffic is allowed to go to and from which
    interfaces. This table, and the knowledge contained within it, should form the
    basis of our planning when considering how many interfaces to use and what to
    use them for. This is basically the Traffic Flow diagram from the IPCop administrative
    guide ([http://www.ipcop.org/1.4.0/en/admin/html/section-firewall.html](http://www.ipcop.org/1.4.0/en/admin/html/section-firewall.html)).
  prefs: []
  type: TYPE_NORMAL
- en: '| Interface From | Interface To | Status | How To Access |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| RedRedRedRed | FirewallOrangeBlueGreen | CLOSEDCLOSEDCLOSEDCLOSED | External
    AccessPort ForwardingPort Forwarding / VPNPort Forwarding / VPN |'
  prefs: []
  type: TYPE_TB
- en: '| OrangeOrangeOrangeOrange | FirewallRedBlueGreen | CLOSEDOPENCLOSEDCLOSED
    |   |   | DMZ PinholesDMZ Pinholes |'
  prefs: []
  type: TYPE_TB
- en: '| BlueBlueBlueBlue | FirewallRedOrangeGreen | CLOSEDCLOSEDCLOSEDCLOSED | Blue
    AccessBlue AccessBlue AccessDMZ Pinholes / VPN |   |   |'
  prefs: []
  type: TYPE_TB
- en: '| GreenGreenGreenGreen | FirewallRedOrangeBlue | OPENOPENOPENOPEN |   |   |
      |'
  prefs: []
  type: TYPE_TB
- en: In visualizing the way in which traffic goes through the IPCop firewall, we
    can see it as a sort of giant junction with a traffic cop (literally, an IP Cop—hence
    the name!) in the middle of it. When a car (in network parlance, a packet of data)
    reaches the crossroads, the cop decides in which direction the packet should go
    (based on the routing tables IPCop uses), and pushes it in the appropriate direction.
  prefs: []
  type: TYPE_NORMAL
- en: In the case of a Green client accessing the Internet, we can see from the previous
    table that this access is OPEN, so the cop allows the traffic through. In other
    instances, however, this might not be the case. If a Blue client tries to access
    a client on the Green segment, for instance, the cop might allow the traffic through
    if it comes over a VPN or through DMZ pinholes—but if a client on the Blue segment
    has neither of these things explicitly allowing the traffic, it is stopped. The
    car is pulled over, the occupants victims of some virtual time in the cells!
  prefs: []
  type: TYPE_NORMAL
- en: 'Note that (generally) when we illustrate IPCop Configurations, the Red interface
    is uppermost (North), the Orange interface is to the left (West), the Blue interface
    is to the right (East), and the Green interface is to the bottom (South). With
    all four interfaces, this appears like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Trust Relationships between the Interfaces](img/1361_03_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Altering IPCop Functionality
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As with many aspects of the behavior of the IPCop firewall, it is possible to
    alter the behavior of the firewalling rules in order to customize IPCop to meet
    a topology un-catered for by the default rules. Within the context of the firewall
    rules, IPCop has had a file since the 1.4-series release that allows users to
    specifically add their own firewall rules (`/etc/rc.d/rc.firewall.local`). Since
    version 1.3, there have been iptables chains, *CUSTOMINPUT, CUSTOMFORWARD,* etc.,
    allowing iptables rules to be added manually.
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifically using iptables is out of our scope here, but we recommend that
    interested readers read:'
  prefs: []
  type: TYPE_NORMAL
- en: The Linux iptables HOWTO at [http://www.linuxguruz.com/iptables/howto/](http://www.linuxguruz.com/iptables/howto/)
  prefs: []
  type: TYPE_NORMAL
- en: 'Topology One: NAT Firewall'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Our first topology exists as a drop-in replacement for the many NAT firewalls
    that exist in the market. In small offices and homes, solutions such as the embedded
    NAT firewalls sold by D-Link, Linksys, and friends are frequently deployed in
    order to provide small networks with cost-effective Internet access. Solutions
    such as **Internet Connection Sharing** (see [http://www.microsoft.com/windowsxp/
    using/networking/learnmore/default.mspx](http://www.microsoft.com/windowsxp/)
    for more information on Internet Connection Sharing from Microsoft), a combined
    NAT firewall, DNS Proxy, and DHCP Server, built into client editions of Windows
    since Windows 98, are also frequently used in order to allow one PC with a modem
    or network interface to act as a network gateway for other clients. For our purposes
    here, we will consider **ICS**, as such a topology with ICS is effectively a superset
    of the work required to replace a router such as a Linksys or NETGEAR model as
    mentioned previously Our migration from one of these routers to IPCop would be
    identical save for the decommissioning of the ICS software on the client—if we
    remove the router, this is unnecessary and the router can be left configured as-is
    (and/or kept as a backup, or reused elsewhere) (See [http://www.annoyances.org/exec/show/ics](http://www.annoyances.org/exec/show/ics)
    for more information on implementing (and consequently, decommissioning) ICS on
    different Windows versions).
  prefs: []
  type: TYPE_NORMAL
- en: 'Such a topology with ICS might look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Topology One: NAT Firewall](img/1361_03_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Such solutions, while cheap and convenient, are often not scalable or reliable,
    and provide poor security. They open workstations up to unnecessary security risks,
    provide limited throughput, and are often unreliable, requiring frequent reboots
    and locking up.
  prefs: []
  type: TYPE_NORMAL
- en: As with software firewalls, a network firewall is designed as a barrier in between
    your workstations and the Internet. By connecting one of your workstations directly
    to the Internet and using a solution like ICS, although you reduce the resources
    required to share the internet connection, you expose that workstation to unnecessary
    risk. There is also an obligation for that PC to be on all the time—compared to
    a low-end PC with no unnecessary components and a low-power PSU running IPCop,
    this may be noisier, and have more power consumption.
  prefs: []
  type: TYPE_NORMAL
- en: IPCop offers a cost-effective replacement in such situations, providing small
    businesses and home users with a powerful firewall without the need for over-complexity,
    and adding other features not present in embedded solutions or ICS, such as a
    customizable DHCP Server, Intrusion Detection, a Proxy Server, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: 'With IPCop acting as a replacement in this situation, the replacement network
    might look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Topology One: NAT Firewall](img/1361_03_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Such a topology ensures that firewalling is done before data gets to clients,
    using a package designed to act as a network firewall, greatly increasing the
    quality of service to clients as well as the security that their network offers.
    In this situation, the components of IPCop in use would be:'
  prefs: []
  type: TYPE_NORMAL
- en: Green/Red zones
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DHCP Server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DNS Server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'In such a situation, a network administrator or consultant might also choose
    to enable any of the following pieces of functionality in order to enhance the
    services provided to the network:'
  prefs: []
  type: TYPE_NORMAL
- en: Intrusion Detection
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: IPSec in order to allow remote work or remote support
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Port Forwarding in order to allow remote access to VNC or Terminal Services/Remote
    Desktop for a simplified model of remote access for remote support (more convenient
    than IPSec although inherently more insecure)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Decommissioning of ICS in such a situation is quite simple—we would merely disable
    the ICS functionality, as depicted in the following screenshot (taken from the
    network connections property of the external, internet-facing ICS network interface).
  prefs: []
  type: TYPE_NORMAL
- en: '![Topology One: NAT Firewall](img/1361_03_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Removing ICS is as simple as deselecting the **Allow other network users to
    connect through this computer's Internet connection** option. After we have done
    this, we should hit **OK**, reboot if asked to, and then we are free to disable
    and/or remove the external interface on the workstation (disable if we wish to
    leave a second network card in the machine or if it has two onboard cards, or
    remove if we are using an external modem or other piece of hardware we intend
    to remove or install in our IPCop host).
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**IPCop''s Intrusion Detection System**'
  prefs: []
  type: TYPE_NORMAL
- en: The Intrusion Detection feature is a powerful component of IPCop, which is easy
    to enable and use. Although precise analysis of the log files that IPCop's IDS
    generates requires considerable skill and experience, it is simple to turn on
    and unless there are specific space requirements for the IPCop firewall (i.e.
    it is running on a device with a very small hard disk or compact flash card, or
    with inadequate CPU/memory to perform analysis), there is no compelling reason
    not to enable the IDS system.
  prefs: []
  type: TYPE_NORMAL
- en: Firewall rules for this topology are simple; as the Green segment is automatically
    allowed to access resources on the Red interface, there is no topology-specific
    setup required in order to set this up.
  prefs: []
  type: TYPE_NORMAL
- en: Another substantial benefit in deploying IPCop for such a small office situation
    is that in the event that the business is required to grow, the solution that
    it has is scalable. Such a business running a handful of Windows workstations
    in a workgroup may decide that a workgroup is insufficient for its needs and that
    it requires centralized management, file storage, and configuration.
  prefs: []
  type: TYPE_NORMAL
- en: IPCop, even in a pre-upgrade scenario like this, is advantageous simply because
    it provides a built-in, open upgrade path. There is no hardware or software upgrade
    required to move from simple NAT and DHCP to a network with several network segments,
    port forwarding, and a proxy server. If the Server already has several network
    cards (and with the price of these nowadays, there's no reason for it not to,
    if an expansion is anticipated), this can even be done with little or no noticeable
    interruption in service to existing clients.
  prefs: []
  type: TYPE_NORMAL
- en: 'Topology Two: NAT Firewall with DMZ'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In a small office situation with a growing company, the need for incoming email
    might force the activation of the Orange zone, and the deployment and installation
    of a mail server in this segment.
  prefs: []
  type: TYPE_NORMAL
- en: Such a company might choose to keep its Desktop and Internal Server infrastructure
    within the Green network segment and put their its server in the DMZ on a switch/hub,
    or simply attached to the Orange interface of the IPCop host using a crossover
    cable. As such systems are exposed to the Internet, this segmentation provides
    a considerable advantage by providing a 'stop line' past which it would be harder
    for an intruder to escalate his or her access to the network.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**DMZ and External Network Segment Infrastructure**'
  prefs: []
  type: TYPE_NORMAL
- en: Although it's often extremely convenient to attach a DMZ server or external
    router to the firewall (or another router) using crossover cables, using a hub
    or switch can often pay dividends—inevitably, when you might actually need a switch
    or hub in this role may be while troubleshooting connectivity issues associated
    with these systems, and in such scenarios you may not be able to find and install
    a hub/switch in adequate time, or may not want to interrupt any connectivity that
    is still remaining.
  prefs: []
  type: TYPE_NORMAL
- en: Using hubs and switches also plans for future expansion, and enables you to
    add another system with even less effort. Small switches with half a dozen ports
    really aren't expensive, either!
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft's Exchange mail server has for some time supported such a configuration
    through the use of the 'front end' and 'back end' exchange roles (although these
    roles will be deprecated with future Exchange releases). With a different network
    configuration however, such as Linux clients using a management system such as
    Novell's eDirectory or RedHat's Directory Server (RHDS), or a filtering appliance,
    a similar system with externally-facing SMTP servers (perhaps running the open-source
    MTA exim) would be equally beneficial.
  prefs: []
  type: TYPE_NORMAL
- en: '![Topology Two: NAT Firewall with DMZ](img/1361_03_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: In this topology, Clients are freely able to connect to the mail server (whether
    via POP, IMAP, RPC, or RPC over HTTP). In order for a mail server that exists
    as part of the network domain to authenticate to the directory server, we would
    also need to open the appropriate ports (contingent upon the directory provider)
    to the directory server using the DMZ Pinholes feature.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Firewalling Active Directory Domain Controllers**'
  prefs: []
  type: TYPE_NORMAL
- en: Information on specifically which ports Active Directory needs to replicate
    (i.e. in between domain controllers, if a mail host and the directory server were
    domain controllers) is available at [http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/deploy/confeat/adrepfir.mspx](http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/deploy/confeat/adrepfir.mspx)
  prefs: []
  type: TYPE_NORMAL
- en: Although in such a scenario the security benefit to a DMZ would be limited as
    the compromise of the mail host would mean the compromise of a domain controller,
    there would still be a slight security benefit—running a domain controller in
    an internet-facing role, however, is not recommended!
  prefs: []
  type: TYPE_NORMAL
- en: 'Ports required by Clients or Servers talking to a domain controller can be
    found in the following article, which details the ports required to configure
    the Windows firewall on a Windows 2003 system:'
  prefs: []
  type: TYPE_NORMAL
- en: '[http://support.microsoft.com/default.aspx?scid=kb;en-us;555381&sd=rss&spid=3198](http://support.microsoft.com/default.aspx?scid=kb;en-us;555381&sd=rss&spid=3198)'
  prefs: []
  type: TYPE_NORMAL
- en: We also have a Port Forwarding rule set up from the external IP address of the
    IPCop firewall to port 25 on the mail server. This allows external mail servers
    to connect to the mail server in order to deliver email.
  prefs: []
  type: TYPE_NORMAL
- en: In this topology, a compromise of the mail server (which in the Green segment
    could compromise the entire network segment) is controlled, as there is some level
    of protection provided by the firewall.
  prefs: []
  type: TYPE_NORMAL
- en: 'In such a topology, we use the following capabilities of the IPCop Firewall:'
  prefs: []
  type: TYPE_NORMAL
- en: Red, Orange, Green zones
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DMZ Pinholes
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DHCP Server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DNS Server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Port Forwarding to Orange segment
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We might also choose to employ any of the following elements of functionality:'
  prefs: []
  type: TYPE_NORMAL
- en: Intrusion Detection System
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Port Forwarding to web server on the mail server (for external access of IMAP
    or Exchange mailboxes via a webmail solution such as Horde, SquirrelMail, or Outlook
    Web Access)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Proxy Server (for desktop Internet access)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: IPSec for remote access to Servers in the Green and Orange segment or for external
    support
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Back-end mail server with mailboxes in the Green zone, using the Server in the
    Orange zone as a relay, performing anti-spam and anti-virus scanning/filtering
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Topology Three: NAT Firewall with DMZ and Wireless'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In a larger organization, or if the network above grew, we might choose to expand
    our network topology using one or more IPCop firewalls. Very large networks are
    out of the scope of this book alone, as they require aggregated knowledge and
    experience that a networking/IT professional will need to glean from multiple
    sources.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**The IPCop Mailing List**'
  prefs: []
  type: TYPE_NORMAL
- en: The IPCop user mailing list is a very good source of information on extending
    IPCop and deploying it in more advanced roles. It is worth subscribing to and
    perusing for those who have more than a passing interest in IPCop. The archives
    for this mailing list can be found at [https://sourceforge.net/mailarchive/forum.php?forum_id=4957](http://https://sourceforge.net/mailarchive/forum.php?forum_id=4957)
    and there is a subscription page at [http://lists.sourceforge.net/lists/listinfo/ipcop-user](http://lists.sourceforge.net/lists/listinfo/ipcop-user).
  prefs: []
  type: TYPE_NORMAL
- en: Several IPCop firewalls might be used by such an individual in order to separate
    several sites, or in order to further segregate one or more DMZs with physically
    distinct firewalls.
  prefs: []
  type: TYPE_NORMAL
- en: It is also worth considering that IPCop is designed primarily for networks in
    which it is the only network firewall, in the Small and Medium Business, and Home/Home
    Office market. Although it is possible to set IPCop up in larger deployments,
    this is fairly rare, and there are other packages that are arguably more suited
    to such deployments. In such circumstances, the constraints of IPCop's network
    segmentation begin to be more burdensome than they are convenient, and the amount
    of work required to tailor IPCop to meet an organization's needs may exceed the
    work it would take to manually set up another firewall package to suit the same
    topology.
  prefs: []
  type: TYPE_NORMAL
- en: In this example, we will consider the broadest scope in which one IPCop box
    could be deployed, using all four network interfaces to protect a network with
    an internal (Green) network, an Internet or WAN connection (Red), a DMZ containing
    more than one Server (Orange), and a wireless segment (Blue) with an IPSec VPN
    system.
  prefs: []
  type: TYPE_NORMAL
- en: In such a situation, we would almost certainly choose to deploy all of the higher-end
    features that IPCop contains, such as the Proxy Server and the Intrusion Detection
    System.
  prefs: []
  type: TYPE_NORMAL
- en: '![Topology Three: NAT Firewall with DMZ and Wirelesstopology two, NAT firewall
    with DMZIPCop functionalities](img/1361_03_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'In this situation, the services we are providing for individual network interfaces
    are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: On the Red Interface, in addition to the default firewalling policy, we are
    invoking the Port Forwarding feature to allow connections to the mail server on
    port 25 in the DMZ, and also to port 443 (HTTPS) on the mail server in order to
    allow connections to the business webmail system. We are also allowing incoming
    IPSec connections to the IPCop firewall in order to allow remote access to staff
    who work remotely and to provide remote connectivity for support purposes for
    the IT Staff and third-party software and hardware vendors.
  prefs: []
  type: TYPE_NORMAL
- en: On the Blue interface, we are providing connectivity via an IPSec VPN for clients
    in order that they can access services run from Servers internally on the Green
    segment and DMZ segment. Vendors and visitors are allowed access to the Green
    segment through use of WPA in pre-shared key mode configured on the wireless access
    point.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**WPA and WEP**'
  prefs: []
  type: TYPE_NORMAL
- en: WPA was designed to introduce some features of a more advanced wireless standard
    designed to entirely supplant WEP, but before this standard was ready. The insecurity
    of the WEP system for securing 802.11 wireless LANs is well-documented, and WPA
    most notably employs the TKIP protocol (in addition to other changes) to constantly
    change the encryption key used to encrypt data transmitted over the air. Using
    TKIP, instead of one constantly used key, greatly reduces the severity of the
    encryption being broken (as in effect, it is only broken for a short timeframe),
    although it does mean that the Pre-Shared Key, used to generate these encryption
    keys, must be strong, and closely guarded.
  prefs: []
  type: TYPE_NORMAL
- en: WPA-RADIUS or WPA-Enterprise employs the use of a RADIUS server. RADIUS, which
    is often used to authenticate users to switches or systems for Internet Service
    provision, allows the access point to force client computers to authenticate to
    the RADIUS Server using a username and password or cryptographic certificate,
    before they are allowed to fully associate with the wireless access point. Utilization
    of a RADIUS server in this way is significantly more secure than WPA-PSK, both
    because the insecurity of the Pre-Shared Key is eliminated (each client has their
    own certificate or username/password, and these can be individually locked out
    or distributed) and also because a unique encrypted tunnel is created for each
    client, causing the wireless network to behave more, logically, like a switch
    than a hub (through the use of encryption).
  prefs: []
  type: TYPE_NORMAL
- en: WPA2, which eliminates some of the cryptographic weaknesses of WPA and TKIP,
    is stronger still, and uses the AES encryption standard for maximum data security.
  prefs: []
  type: TYPE_NORMAL
- en: 'Microsoft TechNet has excellent guides on implementing WPA-RADIUS using its
    RADIUS server (IAS, the Internet Authentication Service) available online via
    Microsoft TechNet, at the following URLs: Securing Wireless LANs with Certificate
    Services: [http://www.microsoft.com/technet/security/prodtech/windowsserver2003/pkiwire/swlan.mspx?mfr=true](http://www.microsoft.com/technet/security/prodtech/windowsserver2003/pkiwire/swlan.mspx?mfr=true)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Securing Wireless LANs with PEAP and passwords: [http://www.microsoft.com/technet/security/topics/cryptographyetc/peap_0.mspx](http://www.microsoft.com/technet/security/topics/cryptographyetc/peap_0.mspx)'
  prefs: []
  type: TYPE_NORMAL
- en: WPA-PSK with solely an access point prevents access to the wireless segment
    and the Internet by unauthorized users, and is an adequate solution for most small
    and medium networks; use of a newer, WPA2-PSK-capable access point increases this
    security more for those without an access point or network infrastructure implementing
    RADIUS or Certificate Services.
  prefs: []
  type: TYPE_NORMAL
- en: The firewalling policy and IPSec system ensures that visitors/vendors only have
    access to the Red zone (the Internet), and not to any of the resources on the
    network.
  prefs: []
  type: TYPE_NORMAL
- en: On the Orange interface, our pinholes allow the DMZ servers to connect to a
    directory server and Kerberos domain controller in the Green segment in order
    to authenticate users logging onto them via the company directory system. This
    ensures that the policy and configuration for these Servers is managed centrally,
    and that there are logs stored centrally for them, but the damage that could be
    caused by a compromise of these externally-facing services is greatly minimized,
    ensuring business security and regulatory compliance.
  prefs: []
  type: TYPE_NORMAL
- en: On the Green interface, we allow connectivity to all interfaces, as workstations
    and Servers within the Green segment are managed service workstations on which
    users do not have the necessary level of access to cause damage to the resources
    to which they have access.
  prefs: []
  type: TYPE_NORMAL
- en: 'In such a situation, we are making use of the following IPCop features:'
  prefs: []
  type: TYPE_NORMAL
- en: Red, Orange, Green, Blue zones
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DMZ Pinholes
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DHCP Server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DNS Server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Port Forwarding to Orange segment
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: IPSec for remote access to Green, Orange, Blue segments
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: IPSec for access to internal resources by Blue users
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Intrusion Detection System
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Port Forwarding to web server on the Mail server externally
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Proxy Server (for desktop Internet access)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In a larger organization, we may also choose to use IPSec in site-to-site mode
    in order to link this office with one or more branch or parent offices. In this
    role as in the role of a single network firewall, IPCop excels.
  prefs: []
  type: TYPE_NORMAL
- en: Planning Site-To-Site VPN Topologies
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In addition to *local* services such as those illustrated previously with our
    IPCop deployment, we may also be using the IPSec software in IPCop to configure
    a 'site-to-site' VPN to a branch or parent office, business partner, support company,
    or second site. In such situations, topology planning can become important as
    a network grows.
  prefs: []
  type: TYPE_NORMAL
- en: It is important, if we have more than one site, to consider exactly how we configure
    our VPN tunnels in order to provide a balance of service and stability to our
    clients. In a situation in which two branch offices attached to a main office
    both contain fileservers synchronizing content with each other, for instance,
    it would make little or no sense to setup two VPN tunnels from the branch offices
    to the main office in a 'spoke' topology. The extra hop would, during file transfers,
    slow down internet connectivity at the main site, and make for slow transfers.
  prefs: []
  type: TYPE_NORMAL
- en: Conversely, if we have many smaller offices with minimal requirements for site-to-site
    traffic and a head office with a large internet connection, we may decide that
    the added control of having all network activity converging through a single spot
    is worthwhile for us. As a network increases, forming individual VPN tunnels from
    site to site in a 'mesh' configuration can become very complex and hard to manage—although
    unlikely as a deployment with IPCop, such a deployment of more than a dozen or
    so servers would be increasingly hard to flexibly administer without thinking
    about using a routing protocol such as RIP or OSPF to calculate our routing tables
    for us!
  prefs: []
  type: TYPE_NORMAL
- en: When taking your VPN design into consideration, take a moment to ascertain your
    goals in terms of redundancy and speed (is the extra burden of setting up VPNs
    from remote offices to each other worth the redundancy in case your main site
    goes down, for instance?). Work it out on paper, think about what traffic will
    be going over your VPNs, and pick the best design for you that will scale.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter we have provided a high-level overview of three scenarios in
    which IPCop may be deployed in roles that suit it, along with an analysis of the
    benefits and pitfalls of IPCop usage in these situations.
  prefs: []
  type: TYPE_NORMAL
- en: These three topologies will be used further on in the book as case studies for
    maintenance and deployment.
  prefs: []
  type: TYPE_NORMAL
- en: 'Topology one: A dual-homed firewall performing Network Address Translation
    for a few clients. This is an excellent drop-in replacement for a small SOHO router
    or Microsoft''s Internet Connection firewall. It is more secure, more reliable,
    and more scalable than other solutions for similar situations.'
  prefs: []
  type: TYPE_NORMAL
- en: This topology uses IPCop's NAT features, and can use Port Forwarding for external
    services access and the Intrusion Detection System for added network security.
  prefs: []
  type: TYPE_NORMAL
- en: 'Topology two: A DMZ firewall with a separate segment for externally facing
    services such as incoming mail. Typically used by a small or medium business who
    have outgrown a single-subnet network, this is a common stepping stone between
    a small network with an embedded device and a larger network with a commercial
    or medium to high-end firewall.'
  prefs: []
  type: TYPE_NORMAL
- en: This topology uses IPCop's NAT features, as well as DMZ pinholes in order to
    allow Servers in the DMZ segment to access resources and authenticate to Servers
    in the Green zone. The Intrusion Detection system may be used for added security,
    and Port Forwarding is used in order to allow external (Red zone) access to the
    services running on hosts in the DMZ.
  prefs: []
  type: TYPE_NORMAL
- en: 'Topology three: A DMZ firewall with separate segments for externally facing
    services such as incoming mail and for wireless access. This is typically used
    by a small or medium business that has outgrown a single-subnet network. This
    is similar to the second topology with the addition of a third internal segment,
    the Blue zone, for wireless clients on a less trusted network.'
  prefs: []
  type: TYPE_NORMAL
- en: This might be a common extension of topology two or a way to segment a larger
    network with two workstation segments.
  prefs: []
  type: TYPE_NORMAL
- en: This topology uses IPCop's NAT features, as well as DMZ pinholes in order to
    allow Servers in the DMZ segment to access resources and authenticate to Servers
    in the Green zone. The Intrusion Detection system may be used for added security,
    and Port Forwarding is used in order to allow external (Red zone) access to the
    services running on hosts in the DMZ. The IPSec server is used in order to allow
    hosts in the Blue zone to access resources in the Green and Orange zones.
  prefs: []
  type: TYPE_NORMAL
- en: This topology may also be used in order to segment or provide better security
    to a network without the use of wireless technology.
  prefs: []
  type: TYPE_NORMAL
