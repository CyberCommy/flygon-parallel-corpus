- en: Wi-Fi Sniffing
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Finding Wi-Fi devices
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Finding SSIDs
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Exposing hidden SSIDs
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dictionary attack on hidden SSIDs
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fake access points with Scapy
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We have learned to use the Scapy module in Python. Now we can utilize the Scapy
    module for sniffing access points and their MAC addresses. Before that, it would
    be useful to have an idea of SSIDs. A **Service Set Identifier** (**SSID**) is
    the name of the wireless network that helps to separate the multiple signals in
    the same network. We can use the SSID to identify and connect to a network.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: Finding Wi-Fi devices
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The process of joining a Wi-Fi network is simple. The devices can listen for
    other devices to identity them. These identifiers are broadcast continuously and
    are known as **beacons**. These types of unique beacons are broadcast by the devices,
    which act as access points. These beacons include an SSID that acts as the name
    of that access point. Every SSID broadcasts its own unique beacon frame to notify
    any listening device that this SSID is available and it has particular capabilities.
    We can sniff the packets in the Wi-Fi interface to get the Wi-Fi devices available
    in the area by listening to these beacons broadcast by the access points. Here
    we use Scapy to analyze the packets captured by the interface to extract the beacons.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As we have to sniff the packets from the interface, we require a Wi-Fi card
    capable of sniffing the Wi-Fi signals with the Monitor Mode. So we have to make
    sure the card is capable of sniffing. Then we have to set the interface to the
    Monitor Mode which is different for different operating systems. As Scapy has
    some limitations in the Windows systems, we have to run this recipe in a Linux
    or macOS environment.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: Before we start coding, we have to get an idea about the Wi-Fi packets. As with
    the other packets, Wi-Fi packets also have a structure. According to the specification
    802.11, each beacon frame from the access point contains a lot of information
    about the specific SSID.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the frame format for an 802.11 mgmt beacon frame:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00046.jpeg)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
- en: 'From this, we can get an idea of the content of the beacon frame. The really
    important items in the beacon frame are as follows:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: '**SSID name**: This is a 1-32 character name of the WLAN network and is present
    in all beacons. The Wireshark capture will display the SSID tag as follows:'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/00047.jpeg)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
- en: '**BSSID**: This is a unique layer 2 MAC address of the SSID. Here is what it
    looks like in the Wireshark capture:'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/00048.jpeg)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
- en: '**Timestamp**: This represents the time on the access point.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Security capabilities**: This item refers to the security capabilities of
    the access point, such as open, WEP, WPA, WPA2, personal (passphrase) versus enterprise
    (802.1x with RADIUS server). Here is what it looks like in the Wireshark capture:'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/00049.jpeg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
- en: '**Channel**: This indicates the specific frequency that the SSID on this AP
    is operating on. Here is it what it looks like in the Wireshark capture:'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/00050.jpeg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
- en: '**Channel width**: This indicates the width of the channel, such as 20, 40,
    80, and 160 mbps.'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Country**: This provides a list of all the supported channels and corresponding
    channel settings. Each country has its own regulatory bodies that decide the channels
    or power levels allowed in their regulatory domain. This tag defines the country
    of operation and the allowed channels and the allowed maximum transmit limit.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Beacon interval**: This indicates how often the AP broadcasts this beacon
    frame. Here is what it looks like in the Wireshark capture:'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/00051.jpeg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Enable the Monitor Mode in the network interface. This is different for different
    operating systems. Also, not all network cards support the Monitor Mode. We have
    to use a terminal command to do this as it is not possible through Python script.
    This will put the network card Interface as wlan0 into the Monitor Mode.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: Linux
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Follow the steps to enable Monitor Mode in a Linux environment:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: 'This can be done with the `airmon-ng` package. Please make sure you install
    the `airmon-ng` package for this. Also, make sure you provide the correct interface
    as the parameter:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'It can also be done with the following networking commands:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'To disable the Monitor Mode, we can use the following commands:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: macOS
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Follow the steps to enable Monitor Mode in a macOS environment:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: 'We can use the airport utility command to enable the Monitor Mode in macOS.
    As this is a binary command in the library, we can `symlink` this to `usr/local/bin/`:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now we can select the channel to sniff with `airport` :'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Then we can start sniffing with the following command:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'This will `sniff` the interface `en0` and save to a pcap file inside a `tmp/`
    folder such as this: `/tmp/airportSniffXXXXXX.pcap.` We can analyze this file
    with Scapy.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: Now create a `wifi-sniff.py` file and open it in your editor.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'As usual, load the required modules:'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Now we can define the required variable. Here we will create a list for the
    access points:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Now we can define the callback function to parse the packets:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'This will print the captured Wi-Fi packets. The output will be as follows:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00052.jpeg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
- en: 'For the 802.11 packet layer, the main variables are:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: '`type=0`: This indicates that the frame is a management frame (type 0)'
  id: totrans-59
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
- en: '`subtype=8`: This indicates the management frame''s subtype is a beacon (type
    8)'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`addr1`: Destination MAC address'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`addr2`: Source MAC address of the sender'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`addr3`: MAC address of the access point'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'From the preceding details, we can update the parser function to get the Wi-Fi
    MAC address:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Now call the `sniff` function and pass the packets to the `callback` function:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Save the script and call with the `sudo` permission:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Finding SSIDs
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To get the SSID, we need to update the previous recipe and parse the SSID from
    the packets.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Following are the steps to write a SSID sniffer script with `scapy` module:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: Create a `sniff-ssid.py` file and open it in your editor.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Import the module required:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Now create a function to parse the SSID from the packet:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Now run the `sniff` and call the parse function on the callback.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Now run this script with the `sudo` permission:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Exposing hidden SSIDs
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We can modify the previous recipe to get the hidden SSIDs. With Scapy, we can
    identify probe answers and requests to extract the hidden SSIDs.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Follow the steps to write a script to expose hidden SSIDs:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: Create a `sniff-hidden-ssid.py` file and open it in the editor.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Import the `scapy` module and create a dictionary for the identified SSIDs:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Now create the function to parse the hidden SSIDs from the packets:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Here it checks for the probe response and request to extract the BSSID and SSID
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: Finally, `sniff` the packet and pass it to the `callback` function.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Now run this script with the root permission:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Dictionary attack on hidden SSIDs
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With hidden SSIDs, we could run a dictionary attack to identify the hidden SSIDs.
    For that, we will iterate through a list of SSIDs and send a broadcast packet
    with a particular SSID. If the SSID exists, the access point will respond with
    a packet. So, we could start the SSID sniffer we created in the previous recipe
    and wait for the response from the access point while running the brute force
    attack with the SSIDs.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Here are the steps to write a script that can be used to run a dictionary attack
    on SSIDs:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: As usual, create a new `dictionary-attack-ssid.py` file and open it in an editor.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Load all the required modules, and initialize the variables:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Then, we iterate through the SSIDs in the list and send a `RadioTap()` packet
    with the SSID set as the parameter:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Now start the sniffer script in one terminal window and wait for the response.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Finally, start the dictionary attack script with the `sudo` permission:'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Fake access points with Scapy
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We can create fake Wi-Fi access points by injecting beacon frames with Scapy.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Let''s try creating a fake SSID with the following steps:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们尝试用以下步骤创建一个假的SSID：
- en: Create a new `fake-access-point.py` file and open it in the editor.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的`fake-access-point.py`文件并在编辑器中打开它。
- en: 'Load the required modules for the script:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载脚本所需的模块：
- en: '[PRE23]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Here we use the `scapy` and `random` modules for creating random MAC IDs
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们使用`scapy`和`random`模块来创建随机的MAC ID
- en: 'Then define the access point name and the interface to broadcast:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后定义接入点名称和要广播的接口：
- en: '[PRE24]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Now we can craft the packet with the `beacon` frame as follows:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们可以用`beacon`帧来制作数据包：
- en: '[PRE25]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Now we can broadcast the access point with the `sendp()` method:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们可以用`sendp()`方法广播接入点：
- en: '[PRE26]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Now run the script with the required permission:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在以所需的权限运行脚本：
- en: '[PRE27]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: This will broadcast an access point with the provided SSID
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 这将广播一个带有提供的SSID的接入点
