- en: Item Views and Dialogs
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 项目视图和对话框
- en: In the previous chapter, we learned how to display data using different types
    of chart. Charts are one of many ways to present information to the users on screen.
    It is very important for your application to present vital information to the
    users so that they know exactly what's happening to the application—whether data
    has been saved successfully, or the application is waiting for the user's input,
    or warning/error messages that the users should be aware of, and so on—it's all
    very important to ensure your application's user-friendliness and usability.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们学习了如何使用不同类型的图表显示数据。图表是向用户在屏幕上呈现信息的许多方式之一。对于您的应用程序来说，向用户呈现重要信息非常重要，这样他们就可以准确地了解应用程序的情况——无论数据是否已成功保存，或者应用程序正在等待用户的输入，或者用户应该注意的警告/错误消息等等——这些都非常重要，以确保您的应用程序的用户友好性和可用性。
- en: 'In this chapter, we will cover the following topics :'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Working with item view widgets
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用项目视图部件
- en: Working with dialog boxes
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用对话框
- en: Working with file selection dialogs
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用文件选择对话框
- en: Image scaling and cropping
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 图像缩放和裁剪
- en: Qt provides us with many types of widget and dialog that we can easily use to
    display important information to the users. Let's check out what these widgets
    are!
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Qt为我们提供了许多类型的部件和对话框，我们可以轻松使用它们来向用户显示重要信息。让我们看看这些部件是什么！
- en: Working with item view widgets
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用项目视图部件
- en: Other than displaying data using different types of chart, we can also display
    this data using different types of item view. An item view widget presents data
    by rendering it visually, usually along the vertical axis.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 除了使用不同类型的图表显示数据外，我们还可以使用不同类型的项目视图来显示这些数据。项目视图部件通过在垂直轴上呈现数据来将数据可视化呈现。
- en: A two-dimensional item view, often known as a **table view**, displays data
    in both vertical and horizontal directions. That allows it to display huge volumes
    of data within a compact space, and enables the users to search for an item very
    quickly and easily.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 二维项目视图，通常称为**表视图**，在垂直和水平方向上显示数据。这使它能够在紧凑的空间内显示大量数据，并使用户能够快速轻松地搜索项目。
- en: 'There are two ways to display data in an item view. The most common method
    is to use the **model-view architecture**, which uses three different components,
    model, view, and delegate, to retrieve data from a data source and display it
    in the item view. These components all make use of the **signal-slot architecture**
    provided by Qt to communicate with each other:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在项目视图中显示数据有两种方法。最常见的方法是使用**模型-视图架构**，它使用三个不同的组件，模型、视图和委托，从数据源检索数据并在项目视图中显示它。这些组件都利用Qt提供的**信号-槽架构**来相互通信：
- en: Signals from the model inform the view about changes to the data held by the
    data source
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模型的信号通知视图有关数据源保存的数据的更改
- en: Signals from the view provide information about the user's interaction with
    the items being displayed
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 视图的信号提供有关用户与正在显示的项目的交互的信息
- en: Signals from the delegate are used during editing to tell the model and view
    about the state of the editor
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 委托的信号在编辑期间用于告诉模型和视图有关编辑器状态的信息
- en: The other method is the manual way, in which the programmer must tell Qt which
    data goes into which column and row. This method is much simpler than the model-view,
    but much slower when compared to its performance. However, for small amounts of
    data, the performance issue can be negligible, making this a good approach.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种方法是手动方式，程序员必须告诉Qt哪些数据放在哪一列和行。与模型-视图相比，这种方法要简单得多，但在性能上要慢得多。然而，对于少量数据，性能问题可以忽略不计，这是一个很好的方法。
- en: 'If you open up Qt Designer, you will see the two different categories for Item
    View Widgets, namely Item Views (Model-Based) and Item Widgets (Item-Based):'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您打开Qt Designer，您将看到两种不同的项目视图部件类别，即项目视图（基于模型）和项目部件（基于项目）：
- en: '![](img/6f63f909-cc29-4299-baf3-b34e7655cf7d.png)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6f63f909-cc29-4299-baf3-b34e7655cf7d.png)'
- en: Even though they might look the same, in actual fact the widgets within the
    two categories work very differently. In this chapter, we will learn how to use
    the latter category, as it is more straightforward and easy to understand, and
    able to serve as prerequisite knowledge for the former category.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管它们看起来可能相同，但实际上这两个类别中的部件工作方式非常不同。在本章中，我们将学习如何使用后一类别，因为它更直观、易于理解，并且可以作为前一类别的先决知识。
- en: 'Under the Item Widgets (Item-Based) category are three different widgets called
    List Widget, Tree Widget, and Table Widget. Each of these item widgets displays
    data in a different way. Pick the one that suits your needs:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在项目部件（基于项目）类别下有三种不同的部件，称为列表部件、树部件和表部件。每个项目部件以不同的方式显示数据。选择适合您需求的部件：
- en: '![](img/a50b4415-472d-4c74-b1e1-f735f0a5bd21.png)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a50b4415-472d-4c74-b1e1-f735f0a5bd21.png)'
- en: As you can see from the preceding diagram, the **List Widget** displays its
    items in a one-dimensional list, while the **Table Widget** displays its item
    in a two-dimensional table. Even though the **Tree Widget** works almost similar
    to the **List Widget**, its items are displayed in a hierarchical structure, in
    which each item can have multiple children items under it, recursively. One good
    example of this is the filesystem in our operating system, which displays the
    directory structure using the tree widget.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您从前面的图表中所看到的，**列表部件**以一维列表显示其项目，而**表部件**以二维表格显示其项目。尽管**树部件**几乎与**列表部件**类似，但其项目以分层结构显示，其中每个项目下可以递归地有多个子项目。一个很好的例子是我们操作系统中的文件系统，它使用树部件显示目录结构。
- en: To illustrate the differences, let's create a new Qt Widgets application project
    and try it out ourselves.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明这些区别，让我们创建一个新的Qt Widgets应用程序项目，并自己试一试。
- en: Creating our Qt Widgets application
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建我们的Qt Widgets应用程序
- en: 'Once you have created the project, open up `mainwindow.ui` and drag the three
    different item widgets to your main window. After that, select the main window
    and click the Layout Vertically button located at the top:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/e0e15392-5def-4f64-accd-075c8e6d2778.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
- en: 'Then, double-click on the List Widget and a new window will pop out. Here,
    you can add a few dummy items to the List Widget by clicking the + icon, or remove
    them by selecting an item from the list and clicking the - icon. Click the OK
    button to apply the final result to the widget:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4a126e2c-2059-4faf-a325-fafa3b81ce9d.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
- en: 'You can do the same to the Tree Widget. It''s almost the same as the List Widget,
    except that you can add sub-items to an item, recursively. You can also add columns
    to the Tree Widget and name the columns:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/486ef112-0666-4f94-a753-eac1472c352e.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
- en: 'Finally, double-click on the Table Widget to open the Edit Table Widget window.
    Unlike the other two item views, the Table Widget is a two-dimensional item view,
    which means you can add columns and rows to it just like a spreadsheet. Each column
    and row can be labeled with the desired name by setting it in the Columns or Rows
    tab:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c3e07ba3-fb5c-4017-90db-caf9edae65e1.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
- en: It's really easy to understand how a widget works by using the Qt Designer.
    Just drag and drop the widget into the window and play around with its settings,
    then build and run the project to see the result for yourself.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: 'In this case, we have demonstrated the differences between the three item views
    widgets without writing a single line of code:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/cb94f990-0b6d-435e-8bea-c09205c56bf3.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
- en: Making our List Widget functional
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Writing code, however, is still required in order for the widgets to be fully
    functional in your application. Let's learn how to add items to our item view
    widgets using C++ code!
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: 'First, open up `mainwindow.cpp` and write the following code to the class constructor,
    right after `ui->setupui(this)`:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: As simple as that, you have successfully added an item to the List Widget!
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2f54393e-6a48-42c9-90c3-0d36ae463ad2.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
- en: 'There is another way to add an item to the List Widget. But before that, we
    must add the following headers to `mainwindow.h`:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The `QDebug` header is for us to print out debug message, and the `QListWidgetItem`
    header is for us to declare List Widget `Item` objects. Next, open up `mainwindow.cpp`
    and add the following code:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The preceding code does the same as the previous one-line code. Except, this
    time, I've added an extra data to the item. The `setData()` function takes in
    two input variables—the first variable is the data-role of item, which indicates
    how it should be treated by Qt. If you put a value that matches the `Qt::ItemDataRole`
    enumerator, the data will affect the display, decoration, tooltip, and so on,
    and that may change its appearance.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: 'In my case, I just simply set a number that doesn''t match any of the enumerators
    in `Qt::ItemDataRole` so that I can store it as a hidden data for later use. To
    retrieve the data, you can simply call `data()` and insert the number that matches
    the one you''ve just set:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Build and run the project; you should be able to see that the new item is now
    being added to the List Widget:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/bf13b2e0-4637-4f30-a7c4-2c79b541baad.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
- en: For more information about `Qt::ItemDataRole` enumerators, please check out
    the following link: [http://doc.qt.io/qt-5/qt.html#ItemDataRole-enum](http://doc.qt.io/qt-5/qt.html#ItemDataRole-enum)
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: As mentioned earlier, hidden data can be attached to a list item for later use.
    For example, you could use the list widget to display a list of products ready
    to be purchased by the user. Each of these items can be attached with its product
    ID so that when the user selects the item and places it on the cart, your system
    can automatically identify which product has been added to the cart by identifying
    the product ID stored as the data role.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: In the preceding example, I stored custom data, `1000`, in my list item and
    set its data role as `100`, which does not match any of the `Qt::ItemDataRole`
    enumerators. This way, the data won't be shown to the users, and thus it can only
    be retrieved through C++ code.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的例子中，我在我的列表项中存储了自定义数据`1000`，并将其数据角色设置为`100`，这与任何`Qt::ItemDataRole`枚举器都不匹配。这样，数据就不会显示给用户，因此只能通过C++代码检索。
- en: Adding functionality to the Tree Widget
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向树部件添加功能
- en: 'Next, let''s move on to the Tree Widget. It is actually not that different
    from the List Widget. Let''s take a look at the following code:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们转到树部件。实际上，它与列表部件并没有太大的不同。让我们看一下以下代码：
- en: '[PRE4]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: It's pretty much the same as the List Widget, except we have to set the column
    ID in the `setText()` function. This is because the Tree Widget is somewhere between
    a List Widget and a Table Widget—it can have more than one column but can't have
    any rows.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 它与列表部件几乎相同，只是我们必须在`setText()`函数中设置列ID。这是因为树部件介于列表部件和表部件之间——它可以有多个列，但不能有任何行。
- en: 'The most obvious distinction between a Tree Widget and other view widgets is
    that all its items can contain children items, recursively. Let''s look at the
    following code to see how we can add a child item to an existing item in the Tree
    Widget:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 树部件与其他视图部件最明显的区别是，所有的项都可以递归地包含子项。让我们看一下以下代码，看看我们如何向树部件中的现有项添加子项：
- en: '[PRE5]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'It''s really that simple! The final result looks like this:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 就是这么简单！最终结果看起来像这样：
- en: '![](img/3580d596-4c97-4c34-9699-f54ddf816393.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3580d596-4c97-4c34-9699-f54ddf816393.png)'
- en: Finally, our Table Widget
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 最后，我们的表部件
- en: Next, let's do the same for the Table Widget. Technically, the items already
    exist and are reserved in the Table Widget when the columns and rows are being
    created. What we need to do is to create a new item and replace it with the (currently
    empty) item located at a specific column and row, which is why the function name
    is called `setItem()`, instead of `addItem()` used by the List Widget.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们对表部件做同样的操作。从技术上讲，当列和行被创建时，表部件中的项已经存在并被保留。我们需要做的是创建一个新项，并用特定列和行的（当前为空的）项替换它，这就是为什么函数名叫做`setItem()`，而不是列表部件使用的`addItem()`。
- en: 'Let''s take a look at the code:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一下代码：
- en: '[PRE6]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'As you can see from the code, I have added two sections of data to two different
    locations, which translates into the following result:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 从代码中可以看出，我在两个不同的位置添加了两个数据部分，这将转化为以下结果：
- en: '![](img/05cecb5e-908c-4668-8afa-dde23dae413d.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/05cecb5e-908c-4668-8afa-dde23dae413d.png)'
- en: 'That''s it! It''s all that simple and easy to display data using item views
    in Qt. If you are looking for more examples related to item views, please visit
    the following link: [http://doc.qt.io/qt-5/examples-itemviews.html](http://doc.qt.io/qt-5/examples-itemviews.html)'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 就是这样！使用Qt中的项视图来显示数据是如此简单和容易。如果你正在寻找与项视图相关的更多示例，请访问以下链接：[http://doc.qt.io/qt-5/examples-itemviews.html](http://doc.qt.io/qt-5/examples-itemviews.html)
- en: Working with dialog boxes
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用对话框
- en: One very important aspect of creating a user-friendly application is the ability
    to display vital information regarding the status of the application when a certain
    event (intended or unintended) occurs. To display such information, we need an
    external window that can be dismissed by the user once he/she has acknowledged
    the information.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 创建用户友好的应用程序的一个非常重要的方面是，在发生某个事件（有意或无意）时，能够显示关于应用程序状态的重要信息。为了显示这样的信息，我们需要一个外部窗口，用户可以在确认信息后将其关闭。
- en: 'Qt comes with this functionality, and it''s all residing in the `QMessageBox`
    class. There are several types of message box you can use in Qt; the most basic
    one uses just a single line of code, like so:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: Qt具有这个功能，它全部驻留在`QMessageBox`类中。在Qt中，你可以使用几种类型的消息框；最基本的一种只需要一行代码，就像这样：
- en: '[PRE7]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'There are three parameters you need to provide for this function. The first
    one is the parent of the message box, which we have set as the main window. The
    second parameter is for the window title, and the third parameter is for the message
    we want to deliver to the user. The preceding code will produce the following
    result:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个函数，你需要提供三个参数。第一个是消息框的父窗口，我们已经将其设置为主窗口。第二个参数是窗口标题，第三个参数是我们想要传递给用户的消息。上述代码将产生以下结果：
- en: '![](img/2b92e3f2-4363-46db-aa12-afc721e665e8.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2b92e3f2-4363-46db-aa12-afc721e665e8.png)'
- en: 'The appearance shown here is running on a Windows system. The appearance may
    look different on different operating systems (Linux, macOS, and so forth). As
    you can see, the dialog box even comes with an icon located before the text. There
    are a few types of icon you can use, such as information, warning, and critical.
    The following code shows you the code for calling all the different message boxes
    with icons:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 这里显示的外观是在Windows系统上运行的。在不同的操作系统（Linux、macOS等）上，外观可能会有所不同。正如你所看到的，对话框甚至带有文本之前的图标。你可以使用几种类型的图标，比如信息、警告和严重。以下代码向你展示了调用带有图标的不同消息框的代码：
- en: '[PRE8]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The preceding code produces the following results:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码产生以下结果：
- en: '![](img/84024277-2f97-4651-b89e-b3a4e9528f8a.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![](img/84024277-2f97-4651-b89e-b3a4e9528f8a.png)'
- en: 'If you don''t need any icons, just call the `QMessageBox::about()` function
    instead. You can also set the buttons you want by picking from a list of standard
    buttons provided by Qt, for example:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不需要任何图标，只需调用`QMessageBox::about()`函数。你还可以通过从Qt提供的标准按钮列表中选择来设置你想要的按钮，例如：
- en: '[PRE9]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The preceding code will produce the following result:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码将产生以下结果：
- en: '![](img/e95537ee-6b14-4da6-9e38-af1eaaf6fda3.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e95537ee-6b14-4da6-9e38-af1eaaf6fda3.png)'
- en: 'Since these are the built-in functions provided by Qt to create message boxes
    with ease, it doesn''t give developers the freedom to fully customize a message
    box. However, Qt does allow you to create your message boxes manually using another
    method, which is much more customizable than the built-in method. It takes a couple
    more lines of code, but is still pretty simple to write:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The preceding code will produce the following result:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/f79a9076-7112-4fa4-bed4-5bc3b9bc5628.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
- en: '*It looks just the same*, you''re telling me. What about adding our own icon
    and customized buttons? No problem with that:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The preceding code produces the following result:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/04e2e8f6-5139-4bfb-aced-564cedaf5d2d.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
- en: 'In the preceding code example, I have loaded the question icon that comes with
    Qt, but you can also load your own icon from the resource file if you intended
    to do so:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Build and run the project now, and you should be able to see this fantastic
    message box:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ce170a25-75c4-448e-ab26-b82691eda029.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
- en: Once you have understood how to create your own message boxes, let's proceed
    to learn about the event system that comes with the message box.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: When a user is presented with a message box with multiple different choices,
    he/she would expect a different reaction from the application when pressing a
    different button.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: For example, when a message box pops up and asks the user whether they wish
    to quit the program or not, the button Yes should make the program terminate,
    while the No button will do nothing.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: 'Qt''s `QMessageBox` class provides us with a simple solution for checking the
    button event. When the message box is being created, Qt will wait for the user
    to pick their choice; then, it will return the button that gets triggered. By
    checking which button is being clicked, the developer can then proceed to trigger
    the relevant event. Let''s take a look at the example code:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The preceding code will produce the following result:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4ec73206-502c-4051-aa2a-ba175f839f16.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
- en: 'If you prefer the manual way to create your message box, the code for checking
    the button event is slightly longer:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Even though the code is slightly longer, the basic concept is pretty much the
    same—the clicked button will always be able to be retrieved by the developer for
    triggering the appropriate action. This time, however, instead of checking the
    enumerator, Qt directly checks the button pointer instead, since the preceding
    code does not use the built-in standard buttons from the `QMessageBox` class.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: 'Build the project, and you should be able to get the following result:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/9c49eca5-6076-4609-9e1c-e3f2e7a1a762.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
- en: 'For more information regarding the dialog boxes, please visit the API documents
    located at the following link: [http://doc.qt.io/qt-5/qdialog.html](http://doc.qt.io/qt-5/qdialog.html)'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: Creating File Selection Dialogs
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Since we have covered the topic about message boxes, let's also learn about
    the other type of dialog—the File Selection Dialog. The File Selection Dialog
    is also very useful, especially if your application frequently deals with files.
    It is extremely unpleasant to ask users to key in the absolute path of the file
    they wanted to open, so the File Selection Dialog is very handy in this kind of
    situation.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: Qt provides us with a built-in File Selection Dialog that looks exactly the
    same as the one we see in our operating system, and therefore, it won't feel unfamiliar
    to the users. The File Selection Dialog essentially only does one thing—it lets
    the user pick the file(s) or folder they want and return the path(s) of the selected
    file(s) or folder; that's all. In fact, it is not in charge of opening the file
    and reading its content.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s look at how we can trigger the File Selection Dialog. First, open up
    `mainwindow.h` and add in the following header files:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Next, open up `mainwindow.cpp` and insert the following code:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'It''s that simple! Build and run the project now, and you should get this:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/cb0d3f1e-1e61-4d02-b280-9a4935ead609.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
- en: If the user has selected a file and pressed Open, the `fileName` variable will
    be filled with the absolute path of the selected file. If the user clicked the
    Cancel button, the `fileName` variable will be an empty string.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
- en: 'The File Selection Dialog also contains several options that can be set during
    the initialization step. For example:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'There are three things that we have set in the preceding code they are as follows:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: The window title of the File Selection Dialog
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The default path that the users see when the dialog is being created
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: File type filters
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The file type filter is very handy when you only allow the users to select a
    specific type of file (for example, only JPEG image files) and hide the rest.
    Besides `getOpenFileName()`, you can also use `getSaveFileName()`, which will
    allow the user to specify a filename that does not already exist.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: 'For more information regarding the File Selection Dialog, please visit the
    API documents located at the following link: [http://doc.qt.io/qt-5/qfiledialog.html](http://doc.qt.io/qt-5/qfiledialog.html)'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
- en: Image scaling and cropping
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Since we learned about the File Selection Dialog in the previous section, I'd
    thought we should learn something fun this time!
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
- en: 'First off, let''s create a new Qt Widgets Application. Then, open up `mainwindow.ui`
    and create the following user interface:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/867c3332-9f87-40c0-933b-05190c15dd8e.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
- en: 'Let''s dissect this user interface into three parts:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
- en: 'Top—Image preview:'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: First, add a Horizontal Layout to the window.
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Then, add a Label widget into the Horizontal Layout we just added, then set
    the text property to `empty`. Set both the label's minimumSize and maximumSize
    properties to 150x150\. Finally, set the frameShape property under the QFrame
    category to Box.
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add two Horizontal Spacers to the sides of the label to make it centered.
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Middle—Sliders for adjustments:'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add a Form Layout to the window, below the Horizontal Layout we just added previously
    in step 1.
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add three Labels to the Form Layout, and set their text property to `Scale:`,
    `Horizontal:`, and `Vertical:` respectively.
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add three Horizontal Sliders to the Form Layout. Set the minimum property to
    `1` and maximum to `100`. Then, set the pageStep property to `1`.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Set the value property of the scale slider to `100`.
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Bottom—Browse button and Save button:'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add a Horizontal Layout to the window, below the Form Layout we previously added
    during step 2.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add two Push Buttons to the Horizontal Layout and set their text property to
    `Browse` and `Save` respectively.
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Lastly, delete the Menu Bar, Tool Bar, and Status Bar from the central widget.
  id: totrans-142
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Now that we have created the user interface, let''s dive into the coding! First,
    open up `mainwindow.h` and add in the following headers:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'After that, add the following variables to `mainwindow.h`:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Then, go back to `mainwindow.ui` and right-click on the Browse button, followed
    by selecting Go to slot. Then, a window will pop up and ask you to select a signal.
    Pick the `clicked()` signal located at the top of the list, and then press the
    OK button:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/e63f85a0-57c5-4097-a3aa-ddba2adc9e17.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
- en: 'A new `slot` function will be automatically added to your source file. Now,
    add the following code to open up the File Selection Dialog when the Browse button
    is clicked. The dialog only lists JPEG images and hides the other files:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: As you can see, the code checks whether any image has been selected by the user.
    If it has its checks again and see whether the image resolution is at least 150
    x 150\. If no problem is found, we will save the image's pixel map to a pointer
    called `pix`, then save the image size to the `imageSize` variable, and the initial
    drawing size to the `drawSize` variable. Finally, we set the `canDraw` variable
    to `true`.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
- en: 'After that, open up `mainwindow.h` again and declare these two functions:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The first function, `paintEvent()`, is a virtual function that automatically
    gets called whenever Qt needs to refresh the user interface, such as when the
    main window is being resized. We''ll override this function and draw the newly
    loaded image onto the image preview widget. In this case, we''ll call the `paintImage()`
    function within the `paintEvent()` virtual function:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'After that, we''ll write the `paintImage()` function in `mainwindow.cpp`:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: This function does two things—if we don't set the `fileName` variable, it will
    proceed to draw the image on top of the image preview widget, otherwise, it will
    crop the image based on the dimension of the image preview widget and save it
    to the disk following the `fileName` variable.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
- en: 'We''ll call this function again when the save button is being clicked. This
    time, we''ll set the `fileName` variable as the desired directory path and filename,
    so that the `QPainter` class can save the image correctly:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Lastly, right-click on each of the three sliders and select Go to slot. Then,
    select `valueChanged(int)` and click OK.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b605edff-3b8d-4ce0-9661-b08ae23bbb5d.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
- en: 'After that, we''ll write the code for the `slot` functions resulting from the
    previous step:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: The scale slider is basically for users to resize the image to their desired
    scale within the image preview widget. The left slider is for the users to move
    the image horizontally, while the top slider is used by the users to move the
    image vertically. By combining these three different sliders, users can adjust
    and crop the image to their liking before proceeding to upload the image to the
    server, or use it for other purposes.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: 'If you build and run the project now, you should be able to get this result:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2b7d67e4-2cc1-434a-87b7-8e09130c019a.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
- en: You can click on the Browse button to select a JPG image file to load. After
    that, the image should appear on the preview area. You can then move the sliders
    around for adjusting the cropping size. Once you're satisfied with the result,
    click the Save button to save your image in the current directory.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: 'Do check out the sample code that comes together with this book if you want
    to learn more about it in detail. You can find the source code at the following
    GitHub page: [https://github.com/PacktPublishing/Hands-On-GUI-Programming-with-C-QT5](https://github.com/PacktPublishing/Hands-On-GUI-Programming-with-C-QT5)'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-170
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Input and Output (I/O)** are the essence of modern computer software. Qt
    allows us to display our data in many different ways that are both intuitive and
    engaging to the end users. Other than that, the event system that comes with Qt
    makes our life as a programmer a lot easier, as it tends to automatically capture
    the user inputs through the powerful signal-and-slot mechanism and in-response
    triggering custom-defined behaviors. Without Qt, we would have a hard time trying
    to figure out how to reinvent the proverbial wheel, and might eventually end up
    creating a less user-friendly product.'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we have learned how to make use of the fantastic features that
    are provided by Qt—view widgets, dialog boxes, and file selection dialogs used
    to display important information to the users. Furthermore, we also went through
    a fun little project that taught us how to scale and crop an image using Qt widgets
    for user inputs. In the next chapter, we will go for something more advanced (and
    fun too), which is creating our very own web browser using Qt!
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
