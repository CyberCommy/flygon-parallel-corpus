- en: Chapter 3. Exploitation Basics
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Exploitation refers to the art of compromising a computer system. The basics
    of computer exploitation involves a deep understanding of the vulnerabilities
    and payloads. An exploit is a piece of well-written code, compiled and executed
    on a targeted system, which may compromise that system. An exploit usually targets
    a known vulnerability, a flaw in a service or a poorly written code. In this chapter,
    we will discuss the basics of how to find vulnerable systems and then exploit
    them.
  prefs: []
  type: TYPE_NORMAL
- en: Basic terms of exploitation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The basic terms of exploitation are explained as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Vulnerability:** A vulnerability is a security hole in software or hardware,
    which allows an attacker to compromise a system. A vulnerability can be as simple
    as a weak password or as complex as a Denial of Service attack.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Exploit:** An exploit refers to a well-known security flaw or bug with which
    a hacker gains entry into a system. An exploit is the actual code with which an
    attacker takes advantage of a particular vulnerability.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Payload:** Once an exploit executes on the vulnerable system and the system
    has been compromised, the payload enables us to control the system. The payload
    is typically attached to the exploit and delivered.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Shellcode:** This is a set of instructions usually used as a payload when
    the exploitation occurs.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Listener:** A listener works as component waiting for an incoming connection.![Basic
    terms of exploitation](img/3589_03_01.jpg)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How does exploitation work?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We consider the scenario of a computer lab in which we have two students doing
    work on their computers. After some time one of the students goes out for a coffee
    break and he responsibly locks down his computer. The password for that particular
    locked computer is `Apple`, which is a very simple dictionary word and is a system
    vulnerability. The other student starts to attempt a password guessing attack
    against the system of the student who left the lab. This is a classic example
    of an exploit. The controls that help the malicious user to control the system
    after successfully logging in to the computer are called the payload.
  prefs: []
  type: TYPE_NORMAL
- en: We now come to the bigger question of how exploitation actually works. An attacker
    basically sends an exploit with an attached payload to the vulnerable system.
    The exploit runs first and if it succeeds, the actual code of the payload runs.
    After the payload runs, the attacker gets fully privileged access to the vulnerable
    system, and then he may download data, upload malware, virus', backdoors, or whatever
    he wants.
  prefs: []
  type: TYPE_NORMAL
- en: '![How does exploitation work?](img/3589_03_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: A typical process for compromising a system
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For compromising any system, the first step is to scan the IP address to find
    open ports and its operating system and services. Then we move on to identifying
    a vulnerable service and finding an exploit in Metasploit for that particular
    service. If the exploit is not available in Metasploit, we will go through the
    Internet databases such as [www.securityfocus.com](http://www.securityfocus.com),
    [www.exploitdb.com](http://www.exploitdb.com), [www.1337day.com](http://www.1337day.com),
    and so on. After successfully finding an exploit, we launch the exploit and compromise
    the system.
  prefs: []
  type: TYPE_NORMAL
- en: The tools that are commonly used for port scanning are **Nmap** (**Network Mapper**),
    Autoscan, Unicorn Scan, and so on. For example, here we are using Nmap for scanning
    to show open ports and their services.
  prefs: []
  type: TYPE_NORMAL
- en: First open the terminal in your BackTrack virtual machine. Type in `nmap –v
    –n 192.168.0.103` and press *Enter* to scan. We use the `–v` parameter to get
    verbose output and the `–n` parameter to disable reverse DNS resolutions.
  prefs: []
  type: TYPE_NORMAL
- en: '![A typical process for compromising a system](img/3589_03_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Here we can see the results of Nmap, showing three open ports with their services
    running on them. If we need more detailed information such as the service version
    or Operating System type, we have to perform an intense scan using Nmap. For an
    intense scan, we use the command `nmap –T4 –A –v 192.168.0.103`. This shows us
    the complete results of the service version and the Operating System type.
  prefs: []
  type: TYPE_NORMAL
- en: '![A typical process for compromising a system](img/3589_03_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The next step is to find an exploit according to the service or its version.
    Here, we can see that the first service running on port number `135` is `msrpc`,
    which is known as Microsoft Windows RPC. Now we will learn how to find an exploit
    for this particular service in Metasploit. Let's open our terminal and type in
    `msfconsole` to start Metasploit. On typing in `search dcom`, it searches all
    of the Windows RPC related exploits in its database.
  prefs: []
  type: TYPE_NORMAL
- en: In the following screenshot, we can see the exploit with its description and
    also the release date of this vulnerability. We are presented with a list of exploits
    according to their rank. From the three exploits related to this vulnerability,
    we select the first one since it is the most effective exploit with the highest
    rank. Now we have learned the technique of searching for an exploit in Metasploit
    through the `search <service name>` command.
  prefs: []
  type: TYPE_NORMAL
- en: '![A typical process for compromising a system](img/3589_03_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Finding exploits from online databases
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If the exploit is not available in Metasploit, then we have to search the Internet
    exploit databases for that particular exploit. Now we will learn how to search
    for an exploit on these online services such as [www.1337day.com](http://www.1337day.com).
    We open the website and click on the **Search** tab. As an example, we will search
    for exploits on the Windows RPC service.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Now we have to download and save a particular exploit. For this, just click
    on the exploit you need.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: After clicking on the exploit it shows the description of that exploit .Click
    on **Open material** to view or save the exploit.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The usage of this exploit is provided as a part of the documentation in the
    exploit code as marked in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Now we will be exploiting our target machine with the particular exploit that
    we have downloaded. We have already scanned the IP address and found three open
    ports. The next step would be to exploit one of those ports. As an example, we
    will target the port number `135` service running on this target machine, which
    is `msrpc`. Let us start by compiling the downloaded exploit code. To compile
    the code, launch the terminal and type in `gcc <exploit name with path> -o<exploitname>`.
    For example, here we are typing `gcc –dcom –o dcom`.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: After compiling the exploit we have a binary file of that exploit, which we
    use to exploit the target by running the file in the terminal by typing in `./<filename>`.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: From the preceding screenshot, we can see the requirements for exploiting the
    target. It requires the target IP address and the ID (Windows version). Let's
    have a look at our target IP address.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: We have the target IP address, so let's start the attack. Type in `./dcom 6
    192.168.174.129`.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The target has been exploited and we already have the command shell. Now we
    check the IP address of the victim machine. Type in `ipconfig`.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_14.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The target has been compromised and we have actually gained access to it.
  prefs: []
  type: TYPE_NORMAL
- en: Now we will see how to use the internal exploits of Metasploit. We have already
    scanned an IP address and found three open ports. This time we target port number
    445, which runs the Microsoft-ds service.
  prefs: []
  type: TYPE_NORMAL
- en: Let us start by selecting an exploit. Launch msfconsole, type in `use exploit/windows/smb/ms08_067_netapi`,
    and press *Enter*.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_15.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The next step will be to check the options for an exploit and what it requires
    in order to perform a successful exploitation. We type in `show options` and it
    will show us the requirements. We would need to set **RHOST** (**remote host**),
    which is the target IP address, and let the other options keep their default values.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_16.jpg)'
  prefs: []
  type: TYPE_IMG
- en: We set up the `RHOST` or the target address by typing in `set RHOST 192.168.0.103`.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_17.jpg)'
  prefs: []
  type: TYPE_IMG
- en: After setting up the options, we are all set to exploit our target. Typing in
    `exploit` will give us the Meterpreter shell.
  prefs: []
  type: TYPE_NORMAL
- en: '![Finding exploits from online databases](img/3589_03_18.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we covered the basics of vulnerability, a payload, and some
    tips on the art of exploitation. We also covered the techniques of how to search
    for vulnerable services and further query the Metasploit database for an exploit.
    These exploits were then used to compromise the vulnerable system. We also demonstrated
    the art of searching for exploits in Internet databases, which contain zero-day
    exploits on software and services. In the next chapter, we will be covering Meterpreter
    basics and in-depth tactics on exploitation.
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The following are some helpful references that shed further light on some of
    the topics covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.securitytube.net/video/1175](http://www.securitytube.net/video/1175)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[http://resources.infosecinstitute.com/system-exploitation-metasploit/](http://resources.infosecinstitute.com/system-exploitation-metasploit/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
