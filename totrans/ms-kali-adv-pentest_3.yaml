- en: Part 2. *The Delivery Phase*
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '*[Physical Attacks and Social Engineering](ch07.html "Chapter 7. Physical Attacks
    and Social Engineering")*'
  prefs: []
  type: TYPE_NORMAL
- en: '*[Exploiting Wireless Communications](ch08.html "Chapter 8. Exploiting Wireless
    Communications")*'
  prefs: []
  type: TYPE_NORMAL
- en: '*[Reconnaissance and Exploitation of Web-based Applications](ch09.html "Chapter 9. Reconnaissance
    and Exploitation of Web-based Applications")*'
  prefs: []
  type: TYPE_NORMAL
- en: '*[Exploiting Remote Access Communications](ch10.html "Chapter 10. Exploiting
    Remote Access Communications")*'
  prefs: []
  type: TYPE_NORMAL
- en: '*[Client-side Exploitation](ch11.html "Chapter 11. Client-side Exploitation")*'
  prefs: []
  type: TYPE_NORMAL
- en: '*[Installing Kali Linux](apa.html "Appendix A. Installing Kali Linux")*'
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 7. Physical Attacks and Social Engineering
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Social engineering, especially when combined with physical access to the target
    system, is the single most successful attack vector used for penetration testing
    or an actual attack.
  prefs: []
  type: TYPE_NORMAL
- en: As an attack route supporting the kill chain, social engineering focuses on
    the nontechnical aspects of an attack that take advantage of a person trust and
    innate helpfulness to deceive and manipulate them into compromising a network
    and its resources.
  prefs: []
  type: TYPE_NORMAL
- en: 'The success of social engineering attacks relies on two key factors:'
  prefs: []
  type: TYPE_NORMAL
- en: The knowledge that is gained during the reconnaissance phase. The attacker must
    know the names and usernames associated with the target; more importantly, the
    attacker must understand the concerns of the users on the network.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Understanding how to apply this knowledge to convince potential targets to activate
    the attack by clicking on a link, or executing a program. For example, if the
    target company has just merged with a former competitor, the job security of employees
    will likely be the top-of-mind concern. Therefore, e-mails or documents with titles
    associated with that subject will likely be opened by targeted individuals.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Kali Linux provides several tools and frameworks that have an increased chance
    of success if social engineering is used as a pretext to influence victims to
    open files or execute certain operations. Examples include script attacks (includes
    Visual Basic, WMI, and PowerShell scripts), executables created by the Metasploit
    Framework, and the **BeEF** (**The Browser Exploitation Framework**).
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we'll focus on Social Engineering Toolkit or SEToolkit. The
    techniques used in employing these tools will serve as the model for using social
    engineering to deploy attacks from other tools.
  prefs: []
  type: TYPE_NORMAL
- en: 'By the end of this chapter, you will learn how to use the SEToolkit to do the
    following:'
  prefs: []
  type: TYPE_NORMAL
- en: Obtain a remote shell using spear phishing and Java applet attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Harvest or collect usernames and passwords using the credential harvester attack
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Launch the tabnabbing and webjacking attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Employ the multi-attack web method
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use PowerShell's alphanumeric shellcode injection attack
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To support SET''s social engineering attacks, the following general implementation
    practices will be described:'
  prefs: []
  type: TYPE_NORMAL
- en: Hiding malicious executables and obfuscating the attacker's URL
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Escalating an attack using DNS redirection
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You will also learn how to create and implement hostile physical devices based
    on the Raspberry PI microcomputer.
  prefs: []
  type: TYPE_NORMAL
- en: Social Engineering Toolkit
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Social-Engineer Toolkit (SEToolkit) was created and written by David Kennedy
    (ReL1K), and it is maintained by an active group of collaborators ([www.social-engineer.org](http://www.social-engineer.org)).
    It is an open source python-driven framework that is specifically designed to
    facilitate social engineering attacks.
  prefs: []
  type: TYPE_NORMAL
- en: A significant advantage of SEToolkit is its interconnectivity with the Metasploit
    Framework which provides the payloads needed for exploitation, the encryption
    to bypass anti-virus, and the listener module that connects to the compromised
    system when it sends a shell back to the attacker.
  prefs: []
  type: TYPE_NORMAL
- en: Before launching SEToolkit, you may wish to make some modifications to the configuration
    file.
  prefs: []
  type: TYPE_NORMAL
- en: 'The social engineering toolkit is preconfigured with common default settings;
    however, these settings can be altered to adapt the kit to specific attack scenarios.
    In Kali, the configuration file is `/usr/share/set/config/set_config`. Modifying
    this file allows you to control the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Metasploit variables, including the location, the database to use, how many
    times a payload should be encoded, and commands to automatically run once a meterpreter
    session has been established.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ettercap** and **dsniff** switches to facilitate DNS redirection attacks
    and capture of authentication credentials. By controlling the DNS, an attacker
    can automatically direct groups of people to false sites created using the `setoolkit`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuration of `sendmail` or other mail programs for use in attacks requiring
    spoofed e-mail addresses; this allows the social engineer to enhance the credibility
    of attacks by using an e-mail address that appears to come from a trusted source,
    such as a senior manager in the same company.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The e-mail provider to be used, including Gmail, Hotmail, and Yahoo.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating self-signed Java applets with a spoofed publisher, activating SSL certificates,
    and stealing digital signatures.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Other variables such as the IP address, port assignments, and encoding parameters.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To open Social Engineering Toolkit (SET) in Kali distribution, go to **Applications**
    | **Kali Linux** | **Exploitation Tools** | **Social Engineering Toolkit** | **setoolkit**,
    or enter `setoolkit` at a shell prompt. You will be presented with the main menu,
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Social Engineering Toolkit](img/3121OS_07_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'If you select `1) Social-Engineering Attacks`, you will be presented with the
    following submenu:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Social Engineering Toolkit](img/3121OS_07_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The following is a brief explanation of the social engineering attacks :'
  prefs: []
  type: TYPE_NORMAL
- en: '`Spear-Phishing Attack Vector` allows an attacker to create e-mail messages
    and send them to targeted victims with attached exploits.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Website Attack Vectors` utilize multiple web-based attacks, including the
    following:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Java Applet Attack Method` spoofs a Java certificate and delivers a Metasploit-based
    payload. This is one of the most successful attacks, and it is effective against
    Windows, Linux, or OSX targets.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Metasploit Browser Exploit Method` delivers a Metasploit payload using an
    iFrame attack.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Credential Harvester Attack Method` clones a website and automatically rewrites
    the POST parameters to allow an attacker to intercept and harvest user credentials;
    it then redirects the victim back to the original site when harvesting is completed.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Tabnabbing Attack Method` replaces information on an inactive browser tab
    with a cloned page that links back to the attacker. When the victim logs in, the
    credentials are sent to the attacker.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Web Jacking Attack Method` utilizes iFrame replacements to make the highlighted
    URL link appear legitimate; however, when it is clicked, a window pops up, and
    is then replaced with a malicious link.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Multi-Attack Web Method` allows an attacker to select some or all of several
    attacks that can be launched at once, including `The Java Applet Attack Method`,
    `The Metasploit Browser Exploit Method`, `Credential Harvester Attack Method`,
    `Tabnabbing Attack Method`, and `Man Left in the Middle Attack Method`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Infectious Media Generator` creates an `autorun.inf` file and Metasploit payload.
    Once burned or copied to a USB device or physical media (CD or DVD) and inserted
    into the target system, it will trigger an autorun (if an autorun is enabled)
    and compromise the system.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `Create a Payload and Listener` module is a rapid menu-driven method of
    creating a Metasploit payload. The attacker must use a separate social engineering
    attack to convince the target to launch it.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`MassMailer Attack` allows the attacker to send multiple customized e-mails
    to a single e-mail address or a list of recipients.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Arduino-Based Attack Vector` programs Arduino-based devices, such as the Teensy.
    Because these devices register as a USB keyboard when connected to a physical
    Windows system, they can bypass security based on disabling the autorun or other
    endpoint protection.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`SMS Spoofing Attack Vector` allows the attacker to send a crafted Short Message
    Service text to a person''s mobile device, and spoof the source of the message.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Wireless Access Point Attack Vector` will create a fake wireless access point
    and DHCP server on the attacker''s system and redirect all DNS queries to the
    attacker. The attacker can then launch various attacks, such as the Java Applet
    Attack or a credential harvester attack.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`QRcode Generator Attack Vector` creates a QRCode with a defined URL associated
    with an attack.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Powershell Attack Vectors` allow the attacker to create attacks that rely
    on PowerShell, a command-line shell and scripting language available on all Windows
    Vista and higher versions.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Third Party Modules` allow the attacker to use the **Remote Administration
    Tool Tommy Edition** (**RATTE**), as part of a Java Applet Attack or as an isolated
    payload. RATTE is a text menu-driven remote access tool.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SEToolkit also gives a menu item for `Fast-Track Penetration Testing`, which
    gives rapid access to some specialized tools that support brute force identification
    and password cracking of SQL databases, as well as some customized exploits that
    are based on Python, SCCM attack vectors, Dell computer DRAC/chassis exploitation,
    user enumeration, and PSEXEC PowerShell injection.
  prefs: []
  type: TYPE_NORMAL
- en: The menu also gives options for updating the Metasploit Framework, SEToolkit,
    and the SEToolkit configuration. However, these additional options should be avoided
    as they are not fully supported by Kali, and may cause conflicts with dependencies.
  prefs: []
  type: TYPE_NORMAL
- en: As an initial example of the SEToolkit's strengths, we'll see how it can be
    used to gain a remote shell—a connection made from the compromised system back
    to the attacker's system.
  prefs: []
  type: TYPE_NORMAL
- en: Spear Phishing Attack
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Phishing is an e-mail fraud attack carried out against a large number of victims,
    such as a list of known American Internet users. The targets are generally not
    connected, and the e-mail does not attempt to appeal to any specific individual.
    Instead, it contains an item of general interest (for example, "Click here for
    bargain medications") and a malicious link or attachment. The attacker plays the
    odds that at least some people will click on the link attachment to initiate the
    attack.
  prefs: []
  type: TYPE_NORMAL
- en: On the other hand, spear phishing is a highly specific form of phishing attack—by
    crafting the e-mail message in a particular way, the attacker hopes to attract
    the attention of a specific audience. For example, if the attacker knows that
    the sales department uses a particular application to manage its customer relationships,
    he may spoof an e-mail pretending that it is from the application's vendor with
    a subject line of "Emergency fix for <application> - Click link to download".
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The success rate of a phishing attack is typically less than five percent; however,
    the success rate of a spear phishing attack ranges from forty to eighty percent.
    This is why information from the reconnaissance phase is critical to the success
    of this type of attack.
  prefs: []
  type: TYPE_NORMAL
- en: On average, only ten to fifteen e-mails need to be sent to a target before at
    least one is clicked on.
  prefs: []
  type: TYPE_NORMAL
- en: Before launching the attack, ensure that `sendmail` is installed on Kali (`apt-get
    install sendmail`) and change the `set_config` file from `SENDMAIL=OFF` to `SENDMAIL=ON`.
  prefs: []
  type: TYPE_NORMAL
- en: 'To launch the attack, select `Social Engineering Attacks` from the main SEToolkit
    menu, and then select `Spear-Phishing Attack Vectors` from the submenu. This will
    launch the start options for the attack, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Spear Phishing Attack](img/3121OS_07_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Select `1` to perform a mass e-mail attack; you will then be presented with
    a list of attack payloads, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Spear Phishing Attack](img/3121OS_07_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: One of the most effective attacks is `15) Adobe PDF Embedded EXE Social Engineering`;
    however, the attack selected will vary with the attacker's knowledge of available
    targets gained during the reconnaissance phase.
  prefs: []
  type: TYPE_NORMAL
- en: When prompted to use your own PDF or a built-in blank PDF for the attack as
    shown in the following screenshot, select `2` for the built-in blank payload.
    You will then be prompted to select the payload.
  prefs: []
  type: TYPE_NORMAL
- en: '![Spear Phishing Attack](img/3121OS_07_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Through testing on multiple networks, we have found that options `1` and `2`
    (`Windows Reverse TCP shell`, and `Windows Meterpreter Reverse TCP`) are the most
    reliable payloads. For this example, we will select `Windows Meterpreter Reverse
    TCP`—when the PDF is opened, it will execute a reverse shell back to the attacking
    system.
  prefs: []
  type: TYPE_NORMAL
- en: In instances where stealth is more important than reliability, `Windows Meterpreter
    Reverse HTTPS` is the best option.
  prefs: []
  type: TYPE_NORMAL
- en: SEToolkit will prompt for the payload listener (the attacker's IP address) and
    listening port, with the default port of `443`.
  prefs: []
  type: TYPE_NORMAL
- en: 'The next menu prompts for changing the filename of the PDF file; the default
    name is `moo.pdf`, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Spear Phishing Attack](img/3121OS_07_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The default name will not likely entice a potential victim to open the file;
    furthermore, it may be identified by client-side security. For these reasons,
    the filename should be changed. The name should reflect the intended audience
    being attacked. For example, if you are targeting the finance group, give the
    PDF file a title such as Tax Law Amendments.
  prefs: []
  type: TYPE_NORMAL
- en: You will now be offered the option of either attacking a single e-mail address,
    or mass-mailing (for example, an employee list of the target company, or a specific
    group within the company). Option `1` was selected for this example.
  prefs: []
  type: TYPE_NORMAL
- en: 'SEToolkit will then prompt to use a predefined template or craft a one-time
    e-mail template. If you select a predefined template, the following options will
    be available:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Spear Phishing Attack](img/3121OS_07_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'An effective social engineering attack is crafted for the target; therefore,
    select option `2`, `One-Time Use Email Template`, to create a one-time use e-mail
    template, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Spear Phishing Attack](img/3121OS_07_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'You will be offered the option of using your own Gmail account to launch the
    attack (`1`) or use your own server or open relay(`2`). If you use a Gmail account,
    it is likely that the attack will fail, and you will receive the following message:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Gmail inspects outgoing emails for malicious files, and is very effective at
    identifying payloads produced by SEToolkit and the Metasploit Framework. If you
    have to send a payload using GMail, use `Veil-Evasion` to encode it first.
  prefs: []
  type: TYPE_NORMAL
- en: It is recommended that you use the `sendmail` option to send executable files;
    furthermore, it allows you to spoof the source of the e-mail to make it appear
    as though it originated from a trusted source.
  prefs: []
  type: TYPE_NORMAL
- en: 'The target will receive the following e-mail message:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Spear Phishing Attack](img/3121OS_07_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'To ensure that an e-mail is effective, the attacker should take care of the
    following points:'
  prefs: []
  type: TYPE_NORMAL
- en: The content should provide a "carrot" (the new server will be faster, have improved
    anti-virus) and a "stick" (changes you will have to make *before* you can access
    your e-mail). Most people respond to immediate calls for action, particularly
    when affects them.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the sample given previously, the attached document is titled `template.doc`.
    In a real-world scenario, this would be changed to `Email instructions.doc`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ensure that your spelling and grammar are correct, and the tone of the message
    matches the content.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The title of the individual sending the e-mail should match the content. If
    the target organization is small, you may have to spoof the name of a real individual
    and send the e-mail to a small group that does not normally interact with that
    person.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Include a phone number—it makes the e-mail look more "official", and there are
    various ways to use commercial voice over IP solutions to obtain a short-term
    phone number with a local area code.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Once the attack e-mail is sent to the target, successful activation (the recipient
    launches the executable) will create a reverse Meterpreter tunnel to the attacker's
    system. The attacker will then employ Meterpreter and other tools to conduct typical
    post-exploitation activities.
  prefs: []
  type: TYPE_NORMAL
- en: Using a website attack vector – Java Applet Attack Method
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `Java Applet Attack Method` uses an infected Java applet to load a malicious
    application onto the target system. This attack is favored by many attackers because
    it is highly reliable, and it is effective against Windows, Linux, and Mac OS
    X systems.
  prefs: []
  type: TYPE_NORMAL
- en: 'To launch the attack, open SEToolkit and select option `2) Website Attack Vectors`,
    from the main menu. Then select option `1) Java Applet Attack Method`, to launch
    the initial menu, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Java Applet Attack Method](img/3121OS_07_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The options for web template are `Java Required`, `Gmail`, `Google`, `Facebook`,
    `Twitter`, and `Yahoo`. The **Java Required** page, as shown in the following
    screenshot, is usually effective because it directly prompts the user to update
    a vital piece of software before continuing.
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Java Applet Attack Method](img/3121OS_07_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: You can also choose to clone an existing site, such as the target's corporate
    website.
  prefs: []
  type: TYPE_NORMAL
- en: 'After making the selection, the attacker is then prompted to determine if they
    use Port/NAT forwarding and provide the IP address of the attacking machine for
    the reverse connection, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Java Applet Attack Method](img/3121OS_07_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Word wrapping is not well handled by the SEToolkit, and it is common that a
    typed response will wrap back and overwrite a part of the command line.
  prefs: []
  type: TYPE_NORMAL
- en: After providing the required URL, SEToolkit will start the site cloning process,
    as shown in the following screenshot. When completed, the application will start
    generating the payload and supporting files (the `.jar` archive and the cloned
    `index.html` file).
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Java Applet Attack Method](img/3121OS_07_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The next stage includes the selection of the payload. If stealth is especially
    important, use option `17` to select an executable that has been encoded using
    `veil`, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Java Applet Attack Method](img/3121OS_07_14.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Select the encoding option to bypass local anti-virus on the target system;
    the most effective of them is the fourth option, `Backdoored Executable`, as shown
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Java Applet Attack Method](img/3121OS_07_15.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The application will prompt for the listening port, and then start generating
    code for common ports (`25`, `53`, `80`, `443`, and so on) on the victim''s machine,
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Java Applet Attack Method](img/3121OS_07_16.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Now comes the social engineering step—the attacker has to convince the targeted
    person to connect to the IP address of the listening system. If the target enters
    that system, they will be directed to the cloned site hosted on the listener.
  prefs: []
  type: TYPE_NORMAL
- en: The site will present the targeted person with a security warning, as shown
    in the following screenshot, indicating that an application needs to be executed
    in order to access the site.
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Java Applet Attack Method](img/3121OS_07_17.jpg)'
  prefs: []
  type: TYPE_IMG
- en: If the person chooses to execute the application, a reverse shell (depending
    on the selected payload) will be formed between their computer and the attacker's
    computer.
  prefs: []
  type: TYPE_NORMAL
- en: The two attacks presented demonstrate the different approaches used by the SEToolkit
    to gain control of a target's computer using a reverse shell or a similar payload.
    An attacker can extend the control in a number of ways, such as using a VNC payload
    or placing a RATTE.
  prefs: []
  type: TYPE_NORMAL
- en: However, these attacks are intrusive—it is possible that the reverse shell may
    trigger an egress alarm at the firewall as it connects to the attacker's machine.
    More importantly, the payload may be reverse engineered to identify information
    about the attacker.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, the goal of the attack may not be an immediate compromise; instead,
    the attacker may wish to collect user credentials to support a later attack, or
    to reuse the credentials at multiple places on the Internet. So, let's examine
    a credential harvesting attack.
  prefs: []
  type: TYPE_NORMAL
- en: Using a website attack vector – Credential Harvester Attack Method
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Credentials, generally the username and password, give a person access to networks,
    computing systems, and data. An attacker can use this information indirectly (by
    logging on to the victim's Gmail account and sending e-mails to facilitate an
    attack against the victim's trusted connections), or directly against the user's
    account. This attack is particularly relevant given the extensive reuse of credentials—users
    typically reuse passwords in multiple places.
  prefs: []
  type: TYPE_NORMAL
- en: Particularly prized are the credentials of a person with privileged access,
    such as a system administrator or a database administrator, which can give an
    attacker access to multiple accounts and data repositories.
  prefs: []
  type: TYPE_NORMAL
- en: The SEToolkit's credential harvesting attack uses a cloned site to collect credentials.
  prefs: []
  type: TYPE_NORMAL
- en: To launch this attack, select `Website Attack Vectors` from the main menu, and
    then select `Credential Harvester Attack Method`. For this example, we will follow
    the menu selections to clone a website, such as Facebook.
  prefs: []
  type: TYPE_NORMAL
- en: Again, the target IP address must be sent to the intended target. When the target
    clicks on the link or enters the IP address, they will be presented with a cloned
    page that resembles the regular entry page for Facebook, and they will be prompted
    to enter their usernames and passwords.
  prefs: []
  type: TYPE_NORMAL
- en: Once this is done, the users will be redirected to the regular Facebook site,
    where they will be logged in to their account.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the background, their access credentials will be collected and forwarded
    to the attacker. They will see the following entry in the listener window:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Credential Harvester Attack Method](img/3121OS_07_18.jpg)'
  prefs: []
  type: TYPE_IMG
- en: When the attacker has finished collecting credentials, entering *CTRL* + *C*
    will generate two reports in the `/SET/reports` directory in the XML and HTML
    formats.
  prefs: []
  type: TYPE_NORMAL
- en: 'A similar attack option is the `Web Jacking Attack`. When the victims open
    the attacker''s link, they will be presented with a page informing them that their
    selected page has been moved, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Credential Harvester Attack Method](img/3121OS_07_19.jpg)'
  prefs: []
  type: TYPE_IMG
- en: When the users click on the link to go to the new location, they will be presented
    with a cloned page that appears to be the one expected, as shown in the following
    screenshot; again, the page will be harvesting their login credentials.
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Credential Harvester Attack Method](img/3121OS_07_20.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that the address in the URL bar is not the valid address for Google; most
    users will recognize that something is wrong if they can see the address. A successful
    exploit requires the attacker to prepare the victim with a suitable pretext, or
    story, to make the victim accept the unusual URL. For example, send an e-mail
    to a targeted group of nontechnical managers to announce that a "local Google
    mail site is now being hosted by IT to reduce delays in the mail system."
  prefs: []
  type: TYPE_NORMAL
- en: The Credential harvesting attack is an excellent tool for assessing the security
    of a corporate network. To be effective, the organization must first train all
    employees on how to recognize and respond to a phishing attack. Approximately
    two weeks later, send a corporate-wide e-mail that contains some obvious mistakes
    (incorrect name of the corporate CEO or an address block that contains the wrong
    address) and a link to a program that harvests credentials. Calculate the percentage
    of recipients who responded with their credentials, and then tailor the training
    program to reduce this percentage.
  prefs: []
  type: TYPE_NORMAL
- en: Using a website attack vector – Tabnabbing Attack Method
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Tabnabbing exploits a user's trust by loading a fake page in one of the open
    tabs of a browser. By impersonating a page of a site such as Gmail, Facebook,
    or any other site that *posts* data (usually usernames and passwords), a tabnabbing
    attack can collect a victim's credentials. The Social Engineering Toolkit invokes
    the credential harvester attack that we previously described.
  prefs: []
  type: TYPE_NORMAL
- en: To launch this attack, launch the Social Engineering Toolkit from a console
    prompt, and then select `1) Social-Engineering Attacks`. In the next menu, select
    `2) Website Attack Vectors`. The tabnabbing attack is launched by selecting `4)
    Tabnabbing Attack Method`.
  prefs: []
  type: TYPE_NORMAL
- en: When the attack is launched, you will be prompted with three options to generate
    the fake websites that will be used to gather credentials. The attacker can allow
    `setoolkit` to import a list of predefined web applications, clone a website (such
    as Gmail), or import their own website. For this example, we will select `2) Site
    Cloner`.
  prefs: []
  type: TYPE_NORMAL
- en: This will prompt the attacker to enter the IP address that the server will POST
    to; this is usually the IP address of the attacker's system. The attacker will
    then be prompted to enter the URL of the website to be cloned. In the following
    screenshot, Gmail's website has been selected.
  prefs: []
  type: TYPE_NORMAL
- en: 'The attacker must then employ social engineering to force the victim to visit
    the IP address for the post back action (for example, URL shortening). The victim
    will receive a message that the site is loading (as the attack script loads the
    cloned site under a different tab in the browser, as shown in the following screenshot):'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Tabnabbing Attack Method](img/3121OS_07_21.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The target will then be presented with the fake page (with the false IP address
    still visible). If the users enter their usernames and passwords, the data will
    be posted to the listener on the attacker's system. As you can see in the following
    screenshot, it has captured the username and the password.
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector – Tabnabbing Attack Method](img/3121OS_07_22.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Using a website attack vector - Multi-Attack Web Method
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The "hail Mary" attack for website attack vectors is `Multi-Attack Web Method`,
    which allows the attacker to implement several different attacks at one time,
    should they choose to. By default, all attacks are disabled, and the attacker
    chooses the ones to run against the victim, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using a website attack vector - Multi-Attack Web Method](img/3121OS_07_23.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This is an effective option if you are unsure which attacks will be effective
    against a target organization; select one employee, determine the successful attack(s),
    and then reuse these against the other employees.
  prefs: []
  type: TYPE_NORMAL
- en: Using the PowerShell alphanumeric shellcode injection attack
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Social Engineering Toolkit also incorporates the more effective attacks
    based on PowerShell, which is available on all Microsoft operating systems after
    the release of Microsoft Vista. Because PowerShell shellcode can easily be injected
    into the target's physical memory, attacks using this vector do not trigger anti-virus
    alarms.
  prefs: []
  type: TYPE_NORMAL
- en: To launch a PowerShell injection attack using `setoolkit`, select `1) Social-Engineering
    Attacks` from the main menu. Then select `10) Powershell Attack Vectors` from
    the next menu.
  prefs: []
  type: TYPE_NORMAL
- en: This will give the attacker four options for attack types; for this example,
    select `1` to invoke `PowerShell Alphanumeric Shellcode Injector`.
  prefs: []
  type: TYPE_NORMAL
- en: This will set the attack parameters and prompt the attacker to enter the IP
    address for the payload listener, which will usually be the IP address of the
    attacker. When this has been entered, the program will create the exploit code
    and start a local listener.
  prefs: []
  type: TYPE_NORMAL
- en: The PowerShell shellcode that launches the attack is stored at `/root/.set/reports/powershell/x86_powershell_injection.txt`.
  prefs: []
  type: TYPE_NORMAL
- en: The social engineering aspect of the attack occurs when the attacker convinces
    the intended victim to copy the contents of `x86_powershell_injection.txt` on
    a command prompt, as shown in the following screenshot, and executes the code.
  prefs: []
  type: TYPE_NORMAL
- en: '![Using the PowerShell alphanumeric shellcode injection attack](img/3121OS_07_24.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As shown in the following screenshot, execution of the shellcode did not trigger
    an anti-virus alarm on the target system. Instead, when the code was executed,
    it opened a meterpreter session on the attacking system and allowed the attacker
    to gain an interactive shell with the remote system.
  prefs: []
  type: TYPE_NORMAL
- en: '![Using the PowerShell alphanumeric shellcode injection attack](img/3121OS_07_25.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Hiding executables and obfuscating the attacker's URL
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As shown in the previous examples, there are two keys to success in launching
    a social engineering attack. The first is to obtain the information needed to
    make it work—usernames, business information, and supporting details about networks,
    systems, and applications.
  prefs: []
  type: TYPE_NORMAL
- en: However, the majority of the work effort is focused on the second aspect—crafting
    the attack to entice the target into opening an executable or clicking on a link.
  prefs: []
  type: TYPE_NORMAL
- en: 'Several attacks produce modules that require the victim to execute them in
    order for the attack to succeed. Unfortunately, users are increasingly wary about
    executing unknown software. However, there are some ways to increase the possibility
    of successful execution of the attack, including the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Attack from a system that is known and trusted by the intended victim, or spoof
    the source of the attack. If the attack appears to originate from the help desk
    or IT support, and claims to be an "urgent software update", it will likely be
    executed.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Rename the executable to resemble trusted software, such as "Java Update".
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Embed the malicious payload into a benign file such as a PDF file using an attack
    such as Metasploit's `adobe_pdf_embedded_exe_nojs` attack. Executables can also
    be bound to Microsoft Office files, MSI install files, or BAT files configured
    to run silently on the desktop.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Have the user click on a link that downloads the malicious executable.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Since the SEToolkit uses the attacker''s URL as the destination for its attacks,
    a key success factor is to ensure that the attacker''s URL is believable to the
    victim. There are several techniques to accomplish this, including the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Shorten the URL using a service such as [goo.gl](http://goo.gl) or [tinyurl.com](http://tinyurl.com).
    The shortened URLs are common among social media such as Twitter, and victims
    rarely use precautions when clicking on such links.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enter the link on a social media site such as Facebook or LinkedIn; the site
    will create its own link to replace yours, with an image of the destination page.
    Then, remove the link that you entered, leaving behind the new social media link.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Create a fake web page on LinkedIn or Facebook—as the attacker, you control
    the content, and can create a compelling story to drive members to click on links
    or download executables. A well-executed page will not only target employees,
    but also vendors, partners, and their clients, maximizing the success of a social
    engineering attack.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Embed the link in a file such as PowerPoint.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To embed a link in PowerPoint, launch it and create a slide show by saving
    the extension as `.pps`. Give the presentation a title that will be of interest
    to the target person, and create a couple of generic content files. On the front
    page, insert a text box and drag the box to cover the entire surface of that slide.
    Click on **Insert**, and then select the Action tab. In the dialog box, click
    on the **Hyperlink** to radio button, and select **URL** from the drop-down menu.
    Enter the URL used to launch the attack, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Hiding executables and obfuscating the attacker''s URL](img/3121OS_07_26.jpg)'
  prefs: []
  type: TYPE_IMG
- en: When the file is opened, it starts as a fullscreen slide show. Because the attack
    is launched via a mouse over, the users will launch the attack when they attempt
    to close the document.
  prefs: []
  type: TYPE_NORMAL
- en: Escalating an attack using DNS redirection
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If an attacker or penetration tester has compromised a host on the internal
    network, they can escalate the attack using DNS redirection. This is generally
    considered to be a horizontal attack (it compromises persons of roughly the same
    access privileges); however, it can also escalate vertically if credentials from
    privileged persons are captured.
  prefs: []
  type: TYPE_NORMAL
- en: In this example, we will use ettercap which acts as a sniffer, interceptor,
    and logger for switched LANs. It facilitates man-in-the-middle attacks, but we
    will use it to launch a DNS redirection attack to divert users to sites used for
    our social engineering attacks.
  prefs: []
  type: TYPE_NORMAL
- en: 'To start the attack, we must first modify the ettercap configuration file located
    at `/etc/ettercap/etter.dns` to redirect queries to our hostile site. A sample
    using Microsoft''s site is found in the configuration file; replicate the same
    details to direct the target site request to the malicious IP address, as shown
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Escalating an attack using DNS redirection](img/3121OS_07_27.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Start ettercap in graphical mode by typing `ettercap –G` at a command prompt.
    From the **Sniff** tab, select **Unified** sniffing from the drop-down menu, as
    shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Escalating an attack using DNS redirection](img/3121OS_07_28.jpg)'
  prefs: []
  type: TYPE_IMG
- en: When prompted to select the network interface, select **eth0** for the internal
    network (as you can see, ettercap will also support wireless attacks when you
    select a different interface). You should see that the tabbed menu change, giving
    you more options.
  prefs: []
  type: TYPE_NORMAL
- en: 'From the **Hosts** tab, select **Scan for hosts** from the drop-down menu.
    It will conduct a rapid scan, and then report that "x hosts added to the hosts
    list". From the **Hosts** tab, select **Hosts list** to see a list of possible
    target systems, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Escalating an attack using DNS redirection](img/3121OS_07_29.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Highlight the identified systems that you wish to target (for example, all hosts
    located on the same segment of a switched LAN) and select the **Add to Target
    1** tab.
  prefs: []
  type: TYPE_NORMAL
- en: 'When this is done, select the **Plugins** tab, which will provide you with
    a list of the ettercap plugins that are available for use. Select the **ec_dns_spoof.so**
    plugin, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Escalating an attack using DNS redirection](img/3121OS_07_30.jpg)'
  prefs: []
  type: TYPE_IMG
- en: To launch the attack, select the **Mitm** tab, and choose **Arp poisoning**
    from the pull-down menu, as shown in the following screenshot. Ettercap will poison
    the Address Resolution Protocol table or cache, on the selected systems.
  prefs: []
  type: TYPE_NORMAL
- en: '![Escalating an attack using DNS redirection](img/3121OS_07_31.jpg)'
  prefs: []
  type: TYPE_IMG
- en: When ARP poisoning is selected, you will be offered optional parameters. Select
    the parameter to sniff remote connections. Then, go to the **Start** tab, and
    select to start unified sniffing.
  prefs: []
  type: TYPE_NORMAL
- en: When a user on any of the targeted systems attempts to go to Facebook, their
    cache table will not provide them with the location on the Internet. Ettercap
    will divert their lookups to the URL that you supplied in the configuration file,
    and the users will instead be directed to the hostile web page prepared by the
    attacker, and will be subject to an attack such as credential harvesting.
  prefs: []
  type: TYPE_NORMAL
- en: At all times, the persons being attacked will see the apparently correct URL
    in their browser window.
  prefs: []
  type: TYPE_NORMAL
- en: DNS redirection can be used to facilitate all attacks that rely on the user
    clicking on a URL link to initiate the attack, and this works on both wired and
    wireless networks.
  prefs: []
  type: TYPE_NORMAL
- en: Physical access and hostile devices
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Kali and SEToolkit also facilitate attacks where the intruder has direct physical
    access to systems and the network. This can be a risky attack, as the intruder
    may be spotted by an observant human, or caught on a surveillance device. However,
    the reward can be significant, because the intruder can compromise specific systems
    that have valuable data.
  prefs: []
  type: TYPE_NORMAL
- en: 'Physical access is usually a direct result of social engineering, especially
    when impersonation is used. Common impersonations include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: A person who claims to be from the help desk or IT support, and just needs to
    quickly interrupt the victim by installing a system upgrade.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A vendor who drops by to talk to a client, and then excuses himself to talk
    to someone else or visit a restroom.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A delivery person dropping off a package. Attackers can opt to buy a delivery
    uniform online; however, since most people assume that anyone who is dressed all
    in brown and pushing a handcart filled with boxes is a UPS delivery person, uniforms
    are rarely a necessity for social engineering!
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tradespersons wearing work clothes, carrying a "work order" that they have printed
    out, are usually allowed access to wiring closets and other areas, especially
    when they claim to be present at the request of the building manager.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dress in an expensive suit, carry a clipboard, and walk fast—employees will
    assume that you're an unknown manager. When conducting this type of penetration,
    we usually inform people that we are auditors, and our inspections are rarely
    questioned.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The goal of hostile physical access is to rapidly compromise selected systems;
    this is usually accomplished by installing a backdoor or similar device on the
    target.
  prefs: []
  type: TYPE_NORMAL
- en: One of the classic attacks is to place a CD-ROM, DVD, or USB key in a system
    and let the system install it using the autoplay option; however, many organizations
    disable autoplay across the network.
  prefs: []
  type: TYPE_NORMAL
- en: 'Attackers can also create "poisoned bait" traps—mobile devices that contain
    files with names that invite a person to click the file and examine its contents.
    Some of the examples include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: USB keys with labels such as Employee Salaries or Medical Insurance Updates.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Metasploit allows an attacker to bind a payload, such as a reverse shell, to
    an executable such as a screensaver. The attacker can create a screensaver using
    publicly available corporate images, and mail CDs to employees with the new *endorsed
    screensaver*. When the user installs the program, the backdoor is also installed,
    and it connects to the attacker.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you know that employees have attended a recent conference, attackers can
    impersonate a vendor who was present and send the target a letter insinuating
    that it is a follow-up from the vendor show. A typical message will be, "If you
    missed our product demonstration and one-year free trial, please review the slide
    show on the attached USB key by clicking start.exe".
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: One interesting variant is the SanDisk U3 USB key, or Smart Drive. The U3 keys
    were preinstalled with launchpad software that automatically allowed the keys
    to write files or registry information directly to the host computer when inserted
    to assist in the repaid launching of approved programs. The `u3-pwn` tool (**Kali
    Linux** | **Maintaining Access** | **OS Backdoors** | **u3**-**pwn**) removes
    the original ISO file from the Sandisk U3 and replaces it with a hostile Metasploit
    payload, which is then encoded to avoid detection on the target system.
  prefs: []
  type: TYPE_NORMAL
- en: Unfortunately, support for these USB devices is lessening, and they remain vulnerable
    to the same degree of detection as other Metasploit payloads.
  prefs: []
  type: TYPE_NORMAL
- en: An emerging option is the use of Teensy—a small integrated circuit device that
    registers as a USB keyboard when inserted into a Windows-based system. This allows
    it to bypass systems that disable autorun or use client-side anti-virus software.
    A Teensy can be purchased online from Amazon for approximately $20 to $25.
  prefs: []
  type: TYPE_NORMAL
- en: 'The `setoolkit` generates the code required by a Teensy to turn it into an
    attack vector, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Physical access and hostile devices](img/3121OS_07_32.jpg)'
  prefs: []
  type: TYPE_IMG
- en: A Teensy configured as a hostile agent is quite powerful; during penetration
    testing of corporate clients, our testers have demonstrated a hundred percent
    chance of being able to infect at least one system on each network being tested!
  prefs: []
  type: TYPE_NORMAL
- en: Unfortunately, these devices suffer a significant limitation—they can do only
    what they are programmed to do, and the attacker or penetration tester has limited
    ability to capitalize on any discoveries that are made post compromise.
  prefs: []
  type: TYPE_NORMAL
- en: To remedy this short-fall, attackers are now using microcomputers, such as the
    Raspberry Pi, as the attack vector.
  prefs: []
  type: TYPE_NORMAL
- en: Raspberry Pi attack vectors
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Raspberry Pi is a microcomputer—it measures approximately 8.5 cm X 5.5 cm
    in size, but manages to pack 512 MB RAM, two USB ports, and an Ethernet port supported
    by a Broadcom chip using an ARM processor running at 700 MHz (which can be overclocked
    to 1 GHz). It doesn't include a hard drive, but uses an SD card for data storage.
    As shown in the following image, the Raspberry Pi is approximately two-third the
    length of a pen; it is easy to hide on a network (behind workstations or servers,
    placed inside of server cabinets, or hidden beneath floor panels in the data center).
  prefs: []
  type: TYPE_NORMAL
- en: '![Raspberry Pi attack vectors](img/3121OS_07_33.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'To configure Raspberry Pi as an attack vector, the following items are required:'
  prefs: []
  type: TYPE_NORMAL
- en: Raspberry Pi Model B, or newer Version
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An HDMI cable
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A micro USB cable and charging block
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An Ethernet cable or mini-wireless adaptor
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A SD card, Class 10, of at least 8 GB
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Together, all supplies are typically available online for a total of less than
    $100.
  prefs: []
  type: TYPE_NORMAL
- en: To configure Raspberry, download the latest version of Kali Linux ARM edition,
    and extract it from the source archive. If you are configuring from a Windows-based
    desktop, then download and extract Win32DiskImager ([http://sourceforge.net/projects/win32diskimager/](http://sourceforge.net/projects/win32diskimager/)).
  prefs: []
  type: TYPE_NORMAL
- en: Using a card reader, connect the SD card to the Windows-based computer and open
    the **Win32DiskImager**. Select the ARM version of Kali, `kali-custom-rpi.img`,
    which was downloaded and previously extracted, and write it to the SD card. This
    will take some time.
  prefs: []
  type: TYPE_NORMAL
- en: Separate instructions for flashing the SD card from Mac or Linux systems are
    available on the Kali website.
  prefs: []
  type: TYPE_NORMAL
- en: Insert the newly flashed SD card into the Raspberry Pi and connect the Ethernet
    cable or wireless adapter to the Windows workstation, the HDMI cable to a monitor,
    and the Micro USB power cable to a power supply. Once supplied with power, it
    will boot directly into Kali Linux. The Raspberry relies on external power, and
    there is no separate on/off switch; however, Kali can still be shut down from
    the command line.
  prefs: []
  type: TYPE_NORMAL
- en: Once Kali is installed, ensure that it is up to date using the apt-get command.
  prefs: []
  type: TYPE_NORMAL
- en: 'Make sure the SSH host keys are changed as soon as possible, as all Raspberry
    Pi images have the same keys. Use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: At the same time, make sure the default username and password are changed.
  prefs: []
  type: TYPE_NORMAL
- en: The next step is to configure Raspberry to connect back to the attacker's computer
    (using a static IP address or a dynamic DNS addressing service) at a regular interval
    using **cron**.
  prefs: []
  type: TYPE_NORMAL
- en: An attacker must then physically access the target's premises and connect Raspberry
    to the network. The majority of networks automatically assigns devices a DHCP
    address and has limited controls against this type of attack.
  prefs: []
  type: TYPE_NORMAL
- en: Once Raspberry connects back to the attacker's IP address, the attacker can
    run reconnaissance and exploit applications against the victim's internal network
    from a remote location using SSH to issue commands.
  prefs: []
  type: TYPE_NORMAL
- en: If a wireless adapter is connected, such as EW-7811Un, the 150 Mbps wireless
    802.11b/g/nNano USB adaptor, the attacker can connect wirelessly, or use the Pi
    to launch wireless attacks ([Chapter 8](ch08.html "Chapter 8. Exploiting Wireless
    Communications"), *Exploiting Wireless Communications*).
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Social engineering is a methodology of *hacking the human*—taking advantage
    of a person's innate trust and helpfulness to attack a network and its devices.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we examined how social engineering can be used to facilitate
    attacks designed to harvest network credentials, activate malicious software,
    or assist in launching further attacks. Most of the attacks rely on the Social
    Engineering Toolkit; however, Kali has several other applications that can be
    improved using a social engineering methodology. We also examined how physical
    access, usually in conjunction with social engineering, can be used to place hostile
    devices on a target network.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will examine how to conduct reconnaissance against wireless
    networks, and attack open networks as well as networks that are protected with
    encryption schemes based on WEP, WPA, and WPA2\. We will also examine general
    weaknesses in wireless protocols that render them vulnerable to the denial of
    service attacks, as well as impersonation attacks.
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 8. Exploiting Wireless Communications
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With the dominance of mobile devices and the need to provide instant network
    connectivity, wireless networks have become the ubiquitous access point to the
    Internet. Unfortunately, the convenience of wireless access is accompanied with
    an increase in effective attacks that result in theft of access and data as well
    as the denial of service of network resources. Kali provides several tools to
    configure and launch these wireless attacks, allowing organizations to improve
    security.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will examine several housekeeping tasks and wireless attacks,
    including:'
  prefs: []
  type: TYPE_NORMAL
- en: Configuring Kali for wireless attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Wireless reconnaissance
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bypassing MAC address authentication
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Compromising WEP encryption
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Attacking WPA and WPA2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Wireless attacks and social engineering—cloning an access point
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Intercepting communications—man-in-the-middle wireless attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Man-in-the-middle wireless attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Denial-of-service** (**DoS**) attacks against wireless communications'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring Kali for wireless attacks
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Kali Linux was released with several tools to facilitate the testing of wireless
    networks; however, these attacks require extensive configuration to be fully effective.
    In addition, testers should acquire a strong background in wireless networking
    before they implement attacks or audit a wireless network.
  prefs: []
  type: TYPE_NORMAL
- en: The most important tool in wireless security testing is the wireless adaptor,
    which connects to the wireless access point. It must support the tools that are
    used, especially the `aircrack-ng` suite of tools; in particular, the card's chipset
    and drivers must possess the ability to inject wireless packets into a communication
    stream. This is a requirement for attacks that require specific packet types to
    be injected into the traffic stream between the target and the victim. The injected
    packets can cause a denial of service, allowing an attacker to capture handshake
    data needed to crack encryption keys or support other wireless attacks.
  prefs: []
  type: TYPE_NORMAL
- en: The `aircrack-ng` site ([www.aircrack-ng.org](http://www.aircrack-ng.org)) contains
    a list of known compatible wireless adaptors.
  prefs: []
  type: TYPE_NORMAL
- en: The most reliable adapters that can be used with Kali are the ALFA NETWORK cards,
    especially the **AWUS036NH** adaptors, which support wireless 802.11 b, g, and
    n protocols. The Alfa cards are readily available online and will support all
    the tests and attacks delivered using Kali.
  prefs: []
  type: TYPE_NORMAL
- en: Wireless reconnaissance
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The first step to conduct a wireless attack is to conduct reconnaissance—this
    identifies the exact target access point and highlights the other wireless networks
    that could impact testing.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you are using a USB-connected wireless card to connect to a Kali virtual
    machine, make sure that the USB connection has been disconnected from the host
    operating system and is attached to the VM by clicking on the USB connection icon
    , which is indicated by an arrow in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Wireless reconnaissance](img/3121OS_08_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, determine which wireless interfaces are available by running `iwconfig`
    from the command line, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Wireless reconnaissance](img/3121OS_08_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'For certain attacks, you may wish to increase the power output of the adapter.
    This is especially useful if you are colocated with a legitimate wireless access
    point, and you want the targets to connect to a false access point under your
    control rather than the legitimate access point. These false, or **rogue**, access
    points allow an attacker to intercept data and to view or alter it as needed to
    support an attack. Attackers will frequently copy or clone a legitimate wireless
    site and then increase its transmission power compared to the legitimate site
    as a means of attracting victims. To increase power, the following command is
    used:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Many attacks will be conducted using `aircrack-ng` and its related tools. To
    start, we need to be able to intercept or monitor wireless transmissions; therefore,
    we need to set the Kali communication interface with wireless capabilities to
    *monitor mode* using the `airmon-ng` command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Wireless reconnaissance](img/3121OS_08_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Note that the description that is returned indicates that there are some processes
    that *could cause trouble*. The most effective way to deal with these processes
    is to use a comprehensive kill command as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'To view the local wireless environment, use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'The previous command lists all the identified networks that can be found within
    the range of the wireless adaptor at that particular point of time. It provides
    the BSSID of the wireless nodes on the network as identified by the MAC addresses,
    an indication of the relative output power, information on data packets sent,
    bandwidth information including the channel used, and data, information on the
    encryption used, and the ESSID which provides the name of the wireless network.
    This information is shown in the following screenshot; non-essential ESSIDs have
    been blurred out:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Wireless reconnaissance](img/3121OS_08_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The `airodump` command cycles through the available wireless channels and identifies
    the following:'
  prefs: []
  type: TYPE_NORMAL
- en: The **Basic Service Set Identifier** (**BSSID**), which is the unique MAC address
    that identifies a wireless access point or router.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `PWR`, or power, of each network. Although `airodump-ng` incorrectly shows
    power as being negative, this is a reporting artefact. To obtain the proper positive
    values, access a terminal and run `airdriver-ng unload 36` and then run `airdriver-ng
    load 35`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`CH` shows the channel that is being used to broadcast.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`ENC` shows the encryption in use—it is `OPN`, or open, for no encryption being
    used, or `WEP` or `WPA`/`WPA2` if encryption is being used. `CIPHER` and `AUTH`
    provide additional encryption information.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The **Extended Service Set Identifier** (**ESSID**) is the common name of the
    wireless network that is made up of the access points that share the same SSID
    or name.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the lower section of the terminal window, you will see the stations attempting
    to connect, or that are connected to the wireless network.
  prefs: []
  type: TYPE_NORMAL
- en: 'Before we can interact with any of these (potential) target networks, we have
    to confirm that our wireless adapter is capable of packet injection. To do this,
    run the following command from a terminal shell prompt:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: The execution of the previous command is shown in the following screenshot.
    Here `-9` indicates an injection test.
  prefs: []
  type: TYPE_NORMAL
- en: '![Wireless reconnaissance](img/3121OS_08_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Kismet
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: One of the most important tools for wireless reconnaissance is Kismet, an 802.11
    wireless detector, sniffer, and intrusion detection system.
  prefs: []
  type: TYPE_NORMAL
- en: 'Kismet can be used to gather the following information:'
  prefs: []
  type: TYPE_NORMAL
- en: Name of the wireless network, ESSID
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Channel of the wireless network
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The MAC address of the access point, BSSID
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The MAC address of the wireless clients
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It can also be used to sniff data from 802.11a, 802.11b, 802.11g, and 802.11n
    wireless traffic. Kismet also supports plugins that allow it to sniff other wireless
    protocols.
  prefs: []
  type: TYPE_NORMAL
- en: To launch Kismet, enter `kismet` from a command prompt in a terminal window.
  prefs: []
  type: TYPE_NORMAL
- en: When Kismet is launched, you will be faced with a series of questions that will
    allow you to configure it during the start up process. Respond with **Yes** to
    **Can you see colors**, accept **Kismet is running as root**, and select **Yes**
    to **Start Kismet Server**. In the Kismet start up options, uncheck **Show Console**
    as it will obscure the screen. Allow Kismet to start.
  prefs: []
  type: TYPE_NORMAL
- en: You will be prompted to add a capture interface; usually, `wlan0` will be selected.
  prefs: []
  type: TYPE_NORMAL
- en: Kismet will then start sniffing packets and collecting information about all
    the wireless systems located in the immediate physical neighborhood.
  prefs: []
  type: TYPE_NORMAL
- en: '![Kismet](img/3121OS_08_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Selecting a network by double-clicking on it will bring you to a network view
    that provides additional information on the wireless network.
  prefs: []
  type: TYPE_NORMAL
- en: You can also drill down to identify specific clients that connect to the various
    wireless networks.
  prefs: []
  type: TYPE_NORMAL
- en: Use Kismet as an initial reconnaissance tool to launch some specific attacks
    (such as sniffing-transmitted data) or to identify networks. Because it passively
    collects connectivity data, it is an excellent tool for identifying networks that
    are hidden, especially when the SSID is not being publicly transmitted.
  prefs: []
  type: TYPE_NORMAL
- en: Bypassing a Hidden Service Set Identifier
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'ESSID is the sequence of characters that uniquely identify a wireless local
    area network. Hiding the ESSID is a poor method of attempting to achieve *security
    through obscurity*; unfortunately, the ESSID can be obtained by:'
  prefs: []
  type: TYPE_NORMAL
- en: Sniffing the wireless environment and waiting for a client to associate to a
    network and then capturing that association
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Actively deauthenticating a client to force the client to associate and then
    capturing that association
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The `aircrack` tools are particularly well suited to capture the data needed
    to unhide a hidden ESSID, as shown in the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'At the command prompt, confirm that wireless is enabled on the attacking system
    by entering the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, use the following `ifconfig` command to review the available interfaces
    and to determine the exact name used by your wireless system:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'Enable your wireless interface by entering the following (you may need to replace
    `wlan0` with an available wireless interface that was identified in the previous
    step):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'If you reconfirm with `ifconfig`, you will see that there is now a monitoring
    or `mon0` address in use. Now, use `airodump` to confirm the available wireless
    networks, as given in the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '![Bypassing a Hidden Service Set Identifier](img/3121OS_08_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'As you can see, the first network''s ESSID is identified only as `<length:
    9>`. No other name or designation is used. The length of the hidden ESSID is identified
    as being composed of nine characters; however, this value may not be correct because
    the ESSID is hidden. The true ESSID length may actually be shorter or longer than
    nine characters.'
  prefs: []
  type: TYPE_NORMAL
- en: What is important is that there may be clients attached to this particular network.
    If clients are present, we will deauthenticate the client, forcing them to send
    the ESSID when they reconnect to the access point.
  prefs: []
  type: TYPE_NORMAL
- en: 'Rerun `airodump`, and filter out everything but the target access point. In
    this particular case, we will focus on collecting data from the hidden network
    on channel six using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Executing the command removes the output from the multiple wireless sources,
    and allows the attacker to focus on the target ESSID, as shown in the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Bypassing a Hidden Service Set Identifier](img/3121OS_08_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The data that we get when the `airodump` command is executed indicates that
    there is one station (`00:0E:2E:CF:8C:7C`) connected to the BSSID (`00:18:39:D5:5D:61`)
    which is in turn associated with the hidden ESSID.
  prefs: []
  type: TYPE_NORMAL
- en: To capture the ESSID as it is being transmitted, we have to create a condition
    where we know it will be sent—during the initial stage of the connection between
    a client and the access point.
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, we will launch a deauthentication attack against both the client
    and the access point by sending a stream of packets that breaks the connection
    between them and forces them to reauthenticate.
  prefs: []
  type: TYPE_NORMAL
- en: 'To launch the attack, open a new command shell and enter the command as shown
    in the following screenshot (`0` indicates that we are launching a deauthentication
    attack, `10` indicates that we will send 10 deauthentication packets, `-a` is
    the target access point, and `c` is the client''s MAC address):'
  prefs: []
  type: TYPE_NORMAL
- en: '![Bypassing a Hidden Service Set Identifier](img/3121OS_08_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: After all the deauthentication packets have been sent, return to the original
    window that monitors the network connection on channel six, as shown in the following
    screenshot. You will now see the ESSID in the clear.
  prefs: []
  type: TYPE_NORMAL
- en: '![Bypassing a Hidden Service Set Identifier](img/3121OS_08_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Knowing the ESSID helps an attacker to confirm that they are focused on the
    correct network (because most ESSIDs are based on the corporate identity) and
    facilitates the logon process.
  prefs: []
  type: TYPE_NORMAL
- en: Bypassing the MAC address authentication
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The **Media Access Control** (**MAC**) address uniquely identifies each node
    in a network. It takes the form of six pairs of hexadecimal digits (0 to 9 and
    the letters A to F) that are separated by colons or dashes and usually appears
    like this: `00:50:56:C0:00:01`.'
  prefs: []
  type: TYPE_NORMAL
- en: The MAC address is usually associated with a network adaptor or a device with
    networking capability; for this reason, it's frequently called the physical address.
  prefs: []
  type: TYPE_NORMAL
- en: The first three pairs of digits in the MAC address are called the **Organizational
    Unique Identifier**, and they serve to identify the company that manufactured
    or sold the device. The last three pairs of digits are specific to the device
    and can be considered to be a *serial number*.
  prefs: []
  type: TYPE_NORMAL
- en: Because a MAC address is unique, it can be used to associate a user to a particular
    network, especially a wireless network. This has two significant implications—it
    can be used to identify a hacker or a legitimate network tester who has tried
    to access a network, and it can be used as a means of authenticating individuals
    and granting them access to a network.
  prefs: []
  type: TYPE_NORMAL
- en: During penetration testing, the tester may prefer to appear anonymous to a network.
    One way to support this anonymous profile is to change the MAC address of the
    attacking system.
  prefs: []
  type: TYPE_NORMAL
- en: 'This can be done manually using the `ifconfig` command. To determine the existing
    MAC address, run the following from a command shell:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'To manually change the IP address, use the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: Substitute different hexadecimal pairs for the "xx" expressions. This command
    will allow us to change the attacking system's MAC address to one that is used
    is accepted by the victim network. The attacker must ensure that the MAC address
    is not already in use on the network, or the repeated MAC address may trigger
    an alarm if the network is monitored.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The wireless interface must be brought down before changing the MAC address.
  prefs: []
  type: TYPE_NORMAL
- en: 'Kali also permits the use of an automated tool, `macchanger`. To change the
    attacker''s MAC address to a MAC address of a product produced by the same vendor,
    use the following `macchanger` command from a terminal window:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'To change the existing MAC address to a completely random MAC address, use
    the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: '![Bypassing the MAC address authentication](img/3121OS_08_11_new.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Some attackers use automated scripts to change their MAC addresses on a frequent
    basis during testing to anonymize their activities.
  prefs: []
  type: TYPE_NORMAL
- en: Many organizations, particularly large academic groups such as colleges and
    universities, use MAC address filtering to control who can access their wireless
    network resources. MAC address filtering uses the unique MAC address on the network
    card to control access to network resources; in a typical configuration, the organization
    maintains a **whitelist** of the MAC addresses that are permitted to access the
    network. If an incoming MAC address is not on the approved access list, it is
    restricted from connecting to the network.
  prefs: []
  type: TYPE_NORMAL
- en: Unfortunately, MAC address information is transmitted in the clear. An attacker
    can use `airodump` to collect a list of accepted MAC addresses and then manually
    change their MAC address to one of the addresses that is accepted by the target
    network. Therefore, this type of filtering provides almost no real protection
    to a wireless network.
  prefs: []
  type: TYPE_NORMAL
- en: The next level of wireless network protection is provided using encryption.
  prefs: []
  type: TYPE_NORMAL
- en: Compromising a WEP encryption
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Wireless Equivalent Privacy** (**WEP**) originated in 1999 as a means of
    providing a degree of confidentiality to 802.11 wireless networks that was comparable
    to what was available on a wired network. Multiple flaws were quickly discovered
    in its implementation of cryptography, and by 2004 it was superseded by the **WiFi
    Protected Access** (**WPA**) protocol.'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: WEP remains in use today, particularly in the older networks that can't support
    the resource requirements of the new wireless routers. In a recent wireless survey
    of a major metropolitan centre, almost 25 percent of the encrypted wireless networks
    continued to use WEP. Many of these networks were associated with financial companies.
  prefs: []
  type: TYPE_NORMAL
- en: One of primary flaws of WEP was first identified in the reuse of the **initialization
    vector** (**IV**). WEP relies on the RC4 encryption algorithm, which is a stream
    cipher—the same encryption key cannot be repeated. IVs were introduced to guard
    against key reuse by introducing an element of *randomness* into the encrypted
    data. Unfortunately, the 24-bit IV is too short to prevent repetition; furthermore,
    there is a 50 percent probability that the same IV will repeat after only 5,000
    packets have been transmitted.
  prefs: []
  type: TYPE_NORMAL
- en: An attacker can eavesdrop or intercept WEP-encrypted traffic. Depending on the
    number of intercepted packets available for inspection, key recovery can occur
    quickly. In practice, most WEP keys can be recovered, or *cracked*, within three
    minutes.
  prefs: []
  type: TYPE_NORMAL
- en: 'To make WEP cracking work, you will also need to know the following information
    about the target:'
  prefs: []
  type: TYPE_NORMAL
- en: The name of the wireless network or ESSID
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The MAC address of the access point, BSSID
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The wireless channel used
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A MAC address of the wireless client
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The most common attack against WEP can be done by performing the following
    steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'First, identify the available wireless network interfaces using the following
    command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'Stop the interface to change the MAC address to the address that is being used
    by an existing client already associated with the target network. You can also
    use `macchanger` for this step. When the MAC address has been changed, restart
    `airmon-ng`. Use the following commands to perform these steps:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: Using a known and accepted MAC address simplifies the attack. However, this
    is not always the case. This attack assumes that you do *not* know the MAC address.
    Instead, we will make a fake association with the network.
  prefs: []
  type: TYPE_NORMAL
- en: 'Use the following `airodump` command to locate the target wireless network:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: When `airodump` locates the target, press *Ctrl* + *C* to stop the search. Copy
    the MAC address in the BSSID, and note the channel. When `airodump` locates the
    target, press *Ctrl* + *C* to stop the search. Copy the MAC address in the BSSID,
    and note the channel; in the example shown in the following screenshot, the target
    network `dd_wep` is operating on channel six at a speed of 11 MB.
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising a WEP encryption](img/3121OS_08_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Start `airodump-ng` to sniff wireless traffic and collect IVs using the following
    command, where `--bssid` allows us to select the target''s BSSID, `-c` indicates
    the channel, and `-w` allows us to write the name of the output file (`wep_out`):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'Now we have to increase the number of transmitted IV packets. Open a second
    terminal window (do not close the first) and enter the following command to fake
    an authentication to the targeted wireless access point:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: Here,`-1` signals a fake authentication and `0` is the reassociation timing
    in seconds (a setting of `0` might alert the defender, so an attacker might set
    it to 30 or even higher).
  prefs: []
  type: TYPE_NORMAL
- en: With the fake authentication in place, we will generate traffic that appears
    to come from a trusted MAC address and route it to the target wireless access
    point.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: This attack is known as an ARP injection or ARP replay attack. Normally, the
    target access point will rebroadcast the ARP packets and generate a new IV each
    time; therefore, this is a quick way to cultivate the necessary IVs.
  prefs: []
  type: TYPE_NORMAL
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising a WEP encryption](img/3121OS_08_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Let''s generate some additional packets while the ARP injection continues.
    Open another terminal window, and start an interactive packet replay attack by
    entering the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: Here, `-2` indicates that we are using an interactive replay attack, `-p 0841`
    sets the Frame Control field of the packet to make it appear as if it is being
    sent from a wireless client, `-c FF:FF:FF:FF:FF:FF` sets the destination (in this
    case, the `FF` notation sends the packet to all the hosts on the network), `-b`
    is the MAC address of the BSSID, and `-h` is the MAC address of the packets being
    transmitted that should match the tester's MAC address.
  prefs: []
  type: TYPE_NORMAL
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising a WEP encryption](img/3121OS_08_14_new.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Another technique to make the network appear busy is to open multiple command
    shells on the attacking system, and enter the following command replacing (`IP
    address`) with the target''s IP address:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: After enough packets have been collected and saved, the following `aircrack-ng`
    command can be used to crack the WEP key, where `-a 1` forces the attack mode
    to be static WEP, `-b` is the BSSID, and `dd_wep.cap` is the capture file containing
    the captured IVs.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: As you can see in the following screenshot, the attack was successful, and the
    key was identified. (Although it appears as a hexadecimal number, you can simply
    enter it to log onto the WEP network.)
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising a WEP encryption](img/3121OS_08_15.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Although this demonstration focused on a 64-bit key, longer keys do not take
    significantly more time to crack once you have harvested the IVs from the access
    point.
  prefs: []
  type: TYPE_NORMAL
- en: The `aircrack-ng` suite of tools is the "gold standard" and provides the most
    reliable and effective way to gain access. However, Kali comes with several other
    tools that can assist you in compromising encrypted wireless networks.
  prefs: []
  type: TYPE_NORMAL
- en: 'One of these is the Fern WiFi Cracker, which is a Python GUI that incorporates
    `aircrack-ng`. It can automatically scan for wireless networks and identify WEP,
    WPA, and WPA2 networks. Once the networks are identified, an attacker can take
    advantage of several features, including the following:'
  prefs: []
  type: TYPE_NORMAL
- en: WEP cracking using a variety of attacks, including fragmentation, Chop Chop,
    Caffe Latte, Hirte, ARP request replay, or WPS attack
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: WPA and WPA2 cracking using dictionary or WPS-based attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Automatic saving of the key in a database following a successful crack
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Internal man-in-the-middle engine supports session hijacking
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Brute-force attacks against HTTP, HTTPS, Telnet, and FTP
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The interface of Fern is very clean, and the setup directs the user to select
    the interface and scan for an access point. It will report the access points for
    WEP and WPA/WPA2; from this point onwards, it is just a matter of clicking on
    the appropriate button to launch the attack. The initial launch screen for Fern
    is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising a WEP encryption](img/3121OS_08_16.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Although Fern is an excellent tool, most testers do not rely on it exclusively—if
    there is a failure to identify a key or gain access to a network, the reason for
    this failure can remain hidden behind the GUI, making troubleshooting difficult.
  prefs: []
  type: TYPE_NORMAL
- en: 'A similar application is the Wifite wireless auditor, which presents a text-based
    interface to support testing. It has proven to be very effective during field
    testing, and it takes advantage of features that include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Wifite supports anonymity by changing the attacker's MAC address to a random
    MAC address before attacking and then changing it back when all the attacks are
    complete
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It sorts targets by signal strength (in dB) to crack the closest access points
    first
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It automatically deauthenticates clients of hidden networks to reveal the SSIDs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It supports multiple attack types
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the example shown in the following screenshot, a single target, `dd_wep`,
    was selected for attack. No other interaction with the application was required;
    it completed the full compromise and saved the cracked key to a database by itself.
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising a WEP encryption](img/3121OS_08_17.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Although the vulnerability of the deprecated WEP is well known and has been
    proven by some basic tools available on Kali, how well does the stronger WPA encryption
    protocol stand up to attack?
  prefs: []
  type: TYPE_NORMAL
- en: Attacking WPA and WPA2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**WiFi Protected Access** (**WPA**) and **WiFi Protected Access 2** (**WPA2**)
    are wireless security protocols that were intended to address the security shortcomings
    of WEP. Because the WPA protocols dynamically generate a new key for each packet,
    they prevent the statistical analysis that caused WEP to fail. Nevertheless, they
    are vulnerable to some attack techniques.'
  prefs: []
  type: TYPE_NORMAL
- en: WPA and WPA2 are frequently deployed with a **pre-shared key** (**PSK**) to
    secure communications between the access point and the wireless clients. The PSK
    should be a random passphrase of at least 13 characters in length; if not, it
    is possible to determine the PSK using a brute-force attack by comparing the PSK
    to a known dictionary. This is the most common attack. (Note that if configured
    in the Enterprise mode, which provides authentication using a RADIUS authentication
    server, WPA is "unbreakable" from our perspective!)
  prefs: []
  type: TYPE_NORMAL
- en: Brute-force attacks
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Unlike WEP, which can be broken using a statistical analysis of a large number
    of packets, WPA decryption requires the attacker to create specific packet types
    that reveal details, such as the handshake between the access point and the client.
  prefs: []
  type: TYPE_NORMAL
- en: 'To attack a WPA transmission, the following steps should be performed:'
  prefs: []
  type: TYPE_NORMAL
- en: Start the wireless adaptor and use the `ifconfig` command to ensure that the
    monitor interface is created.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use `airodump-ng –wlan0` to identify the target network.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Start capturing traffic between the target access point and the client using
    the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 'Set `-c` to monitor a specific channel, the `--showack` flag to ensure that
    the client computer acknowledges your request to deauthenticate it from the wireless
    access point, and `-w` to write the output to a file for a dictionary attack later.
    A typical output from this attack is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Brute-force attacks](img/3121OS_08_18.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Leave this terminal window open, and open a second terminal window to launch
    a deauthentication attack; this will force a user to reauthenticate to the target
    access point and re-exchange the WPA key. The deauthentication attack command
    is shown as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Brute-force attacks](img/3121OS_08_19.jpg)'
  prefs: []
  type: TYPE_IMG
- en: A successful deauthentication attack will show `ACKs`, which indicate that the
    client who was connected to the target access point has acknowledged the deauthentication
    command that was just sent.
  prefs: []
  type: TYPE_NORMAL
- en: Review the original command shell that was kept open to monitor the wireless
    transmission, and ensure that you capture the 4-way handshake. A successful WPA
    handshake will be identified in the top-right hand corner of the console . In
    the following example, the data indicates the WPA handshake value is `28:10:7B:61:20:32`:![Brute-force
    attacks](img/3121OS_08_20.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use `aircrack` to crack the WPA key using a defined wordlist. The filename defined
    by the attacker for collecting handshake data will be located in the root directory,
    and the `-01.cap` extension will be appended to it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In Kali, wordlists are located in the `/usr/share/wordlists` directory. Although
    several wordlists are available, it is recommended that you download lists that
    will be more effective in breaking common passwords.
  prefs: []
  type: TYPE_NORMAL
- en: In the previous example, the key was preplaced in the password list. Undertaking
    a dictionary attack for a long, complex password can take several hours depending
    on the system configuration. The following command uses `words` as the source
    wordlist.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: The following screenshot shows the results from a successful cracking of the
    WPA key; the key to the network gaffer was found to be `princessmouse` after testing
    44 keys.
  prefs: []
  type: TYPE_NORMAL
- en: '![Brute-force attacks](img/3121OS_08_21.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'If you don''t have a custom password list at hand or wish to rapidly generate
    a list, you can use the crunch application in Kali. The following command instructs
    crunch to create a wordlist of words with a minimum length of 5 characters and
    a maximum length of 25 characters using the given character set:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: You can also improve the effectiveness of the brute-force attack using GPU-based
    password cracking tools (oclHashcat for AMD/ATI graphics cards and cudaHashcat
    for NVIDIA graphics cards).
  prefs: []
  type: TYPE_NORMAL
- en: 'To implement this attack, first convert the WPA handshake capture file, `psk-01.cap`
    to a hashcat file using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: 'When the conversion is completed, run the hashcat against the new capture file
    (choose the version of hashcat that matches your CPU architecture and your graphics
    card) using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: Attacking wireless routers with Reaver
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: WPA and WPA2 are also vulnerable to attacks against an access point's Wi-Fi
    Protected Setup, WPS, and pin number.
  prefs: []
  type: TYPE_NORMAL
- en: Most access points support the **Wi-Fi Protected Setup** (**WPS**) protocol,
    which emerged as a standard in 2006 to allow users to easily set up and configure
    access points and add new devices to an existing network without having to re-enter
    large and complex passphrases.
  prefs: []
  type: TYPE_NORMAL
- en: Unfortunately, the pin is an 8-digit number (100,000,000 possible guesses),
    but the last number is a checksum value. Because the WPS authentication protocol
    cuts the pin in half and validates each half separately, it means that there are
    10⁴ (10,000) values for the first half of the pin, and 10³ (1,000) possible values
    for the second half—the attacker only has to make a maximum of 11,000 guesses
    to compromise the access point!
  prefs: []
  type: TYPE_NORMAL
- en: Reaver is a tool designed to maximize the guessing process (although Wifite
    also conducts WPS guesses).
  prefs: []
  type: TYPE_NORMAL
- en: 'To start a Reaver attack, use a companion tool called `wash` to identify any
    vulnerable networks as given in the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: 'If there are any vulnerable networks, launch an attack against them using the
    following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: Testing this attack in Kali has demonstrated that the attack is slow and is
    prone to failure; however, it can be used as a background attack or can supplement
    other routes of attack to compromise the WPA network.
  prefs: []
  type: TYPE_NORMAL
- en: Cloning an access point
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: One of the more interesting attacks against wireless networks relies on cloning
    the access point and then monitoring the information that is transmitted when
    users attempt to connect to it. An attacker can not only gain access to authentication
    credentials but can also employ a man-in-the-middle attack to intercept or redirect
    network traffic.
  prefs: []
  type: TYPE_NORMAL
- en: Several tools included in Kali claim to support cloning or producing a rogue
    access point; however, at this time there are shortcomings in these tools. For
    example, the Social Engineering Toolkit and Websploit do not integrate with the
    DHCP server that comes preinstalled in Kali.
  prefs: []
  type: TYPE_NORMAL
- en: Most attackers look for external tools, including scripts such as Gerix, or
    easy-creds; however, the `aircrack-ng` suite also includes a tool. `airbase-ng`,
    for cloning access points.
  prefs: []
  type: TYPE_NORMAL
- en: 'To make a fake wireless access point, an attacker will:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Start `wlan0` in monitor mode, which will create a `mon0` interface for monitoring,
    using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: 'Set up the access point (AP) on `mon0` using the following command. Social
    engineering can have a significant impact on the success of the AP, so use a name
    that will attract the target clients. For this example, we will use a generic
    name of an open Wi-Fi network. It will be established on the WiFi channel six:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: 'Install the bridge utilities using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: In another terminal window, create a bridge (`rogue`) and link `at0` (the `at0`
    interface is created by the previous command) to `eth0` using the bridge utilities
    (note that bridge utilities must first be installed using `apt-get install bridge-utils`).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: 'Because the two interfaces are integrated into the virtual bridge, you can
    release their IP addresses using the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: 'Enable IP forwarding across the bridge using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: 'Configure the bridge with an IP address of the LAN where it connects to `eth0`
    using the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: 'Start the AP to sniff authentication handshakes using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: Denial-of-service attacks
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The final attack against wireless networks that we''ll evaluate is the denial-of-service
    attack, where an attacker deprives a legitimate user of access to a wireless network
    or makes the network unavailable by causing it to crash. Wireless networks are
    extremely susceptible to DoS attacks, and it is difficult to localize the attacker
    on a distributed wireless network. Examples of DoS attacks include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Injecting crafted network commands, such as reconfiguration commands, onto a
    wireless network can cause a failure of routers, switches, and other network devices.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Some devices and applications can recognize that an attack is taking place and
    will automatically respond by disabling the network. A malicious attacker can
    launch an obvious attack and then let the target create the DoS itself!
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bombarding the wireless network with a flood of data packets can make it unavailable
    for use; for example, an HTTP flood attack making thousands of page requests to
    a web server can exhaust its processing ability. In the same way, flooding the
    network with authentication and association packets blocks users from connecting
    to the access points.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Attackers can craft specific deauthentication and disassociation commands, which
    are used in wireless networks to close an authorized connection and to flood the
    network and stop legitimate users from maintaining their connection to a wireless
    access point.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To demonstrate this last point, we will create a denial-of-service attack by
    flooding a network with deauthentication packets. Because the wireless 802.11
    protocol is built to support deauthentication upon the receipt of a defined packet
    (so that a user can break a connection when it is no longer required), this can
    be a devastating attack—it complies with the standard, and there is no way to
    stop it from happening.
  prefs: []
  type: TYPE_NORMAL
- en: 'The easiest way to "bump" a legitimate user off a network is to target them
    with a stream of deauthentication packets. This can be done with the help of the
    `aircrack-ng` tool suite using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: This command identifies the attack type as `-0`, indicating that it is for a
    deauthentication attack. The second `0` (zero) launches a continuous stream of
    deauthentication packets, making the network unavailable to its users.
  prefs: []
  type: TYPE_NORMAL
- en: The Websploit framework is an open source tool used to scan and analyze remote
    systems. It contains several tools, including tools that are specific to wireless
    attacks. To launch it, open a command shell and simply type `websploit`.
  prefs: []
  type: TYPE_NORMAL
- en: The Websploit interface is similar to that of `recon-ng` and the Metasploit
    Framework, and it presents the user with a modular interface.
  prefs: []
  type: TYPE_NORMAL
- en: Once launched, use the `show modules` command to see the attack modules present
    in the existing version. Select the WiFi jammer (a stream of deauthentication
    packets) using the `use wifi/wifi_jammer` command. As shown in the following screenshot,
    the attacker just has to use the `set` commands to set the various options and
    then select `run` to launch the attack.
  prefs: []
  type: TYPE_NORMAL
- en: '![Denial-of-service attacks](img/3121OS_08_22.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we examined several management tasks required for a successful
    attack against a wireless network, including the selection of the wireless adaptor,
    configuration of the wireless modem, and reconnaissance using tools such as aircrack-ng
    Kismet. We focused on using the `aircrack-ng` suite of tools to identify hidden
    networks, bypass MAC authentication, and compromise WEP and WPA/WPA2 encryption.
    We also saw how to clone, or copy, a wireless access point, and how to perform
    a denial-of-service attack against a wireless network.
  prefs: []
  type: TYPE_NORMAL
- en: The next chapter, will focus on how attackers target a website and its services.
    We'll examine the tools used for reconnaissance, especially client-side proxies
    and vulnerability scanners. We'll see how attackers take advantage of these vulnerabilities
    with automated tools, such as exploit frameworks and online password cracking.
    More importantly, we'll examine some discrete attacks that usually require manual
    intervention, such as injection attacks and cross-site scripting. Finally, we'll
    look at the peculiarities of online services and why and how they're vulnerable
    to the DoS attacks.
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 9. Reconnaissance and Exploitation of Web-based Applications
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapters, we reviewed the attacker's kill chain—the specific
    approach used to compromise networks and devices, and disclose data or hinder
    access to network resources. In [Chapter 7](ch07.html "Chapter 7. Physical Attacks
    and Social Engineering"), *Physical Attacks and Social Engineering*, we examined
    the routes of attack, starting with physical attacks and social engineering. In
    [Chapter 8](ch08.html "Chapter 8. Exploiting Wireless Communications"), *Exploiting
    Wireless Communications*, we saw how wireless networks could be compromised. In
    this chapter, we'll focus on one of the most common attack routes, through websites
    and web-based applications.
  prefs: []
  type: TYPE_NORMAL
- en: Websites that deliver content and web-based services (for example, e-mails and
    FTP) are ubiquitous, and most organizations allow remote access to these services
    with almost constant availability. To penetration testers and attackers, however,
    websites expose back-end services occurring on the network, client-side activities
    of the users accessing the website, and the connection between users and the website's
    data frequent attacks. This chapter will focus on the attacker's perspective of
    websites and web services, and we will review attacks against connectivity in
    [Chapter 10](ch10.html "Chapter 10. Exploiting Remote Access Communications"),
    *Exploiting Remote Access Communications* and client-side attacks in [Chapter
    11](ch11.html "Chapter 11. Client-side Exploitation"), *Client-side Exploitation*.
  prefs: []
  type: TYPE_NORMAL
- en: 'By the end of this chapter, you will have learned the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Extending the principles of reconnaissance to web services
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Vulnerability scanning
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using client-side proxies
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Exploiting vulnerabilities in web services
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Maintaining access to compromised systems with web backdoors
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: For many exercises, we'll use NOWASP or Mutillidae as a target website that
    contains known vulnerabilities that can be exploited; it can be downloaded from
    [www.owasp.org/index.php/Category:OWASP_Mutillidae](http://www.owasp.org/index.php/Category:OWASP_Mutillidae).
    This web application can be installed directly onto Linux or Windows using LAMP,
    WAMP, and XAMPP. It is also preinstalled on the SamauraiWTF and Metasploitable
    testing environments. Refer to the [Appendix](apa.html "Appendix A. Installing
    Kali Linux"), *Installing Kali Linux* for instructions on creating a Metasploitable
    test environment.
  prefs: []
  type: TYPE_NORMAL
- en: Conducting reconnaissance of websites
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Websites, and the delivery of services from those sites, are particularly complex.
    Typically, services are delivered to the end user using a multi-tiered architecture
    with web servers that are accessible to the public Internet, while communicating
    with back-end servers and databases located on the network.
  prefs: []
  type: TYPE_NORMAL
- en: 'The complexity is increased by several additional factors that must be taken
    into account during testing, which include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Network architecture, including security controls (firewalls, IDS/IPS, and honeypots),
    and configurations such as load balancing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Platform architecture (hardware, operating system, and additional applications)
    of systems that host web services
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Applications, middleware, and final-tier databases, which may employ different
    platforms (Unix or Windows), vendors, programming languages, and a mix of commercial
    and proprietary software
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Authentication and authorization processes, including the process for maintaining
    the session state across the application
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The underlying business logic that governs how the application will be used
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Client-side interactions and communications with the web service
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Given the proven complexity of web services, it is important for a penetration
    tester to be adaptable to each site's specific architecture and service parameters.
    At the same time, the testing process must be applied consistently and ensure
    that nothing is missed. Several methodologies have been proposed to accomplish
    these goals. The most widely accepted one is the **Open Web Application Security
    Project** (**OWASP**) ([www.owasp.org](http://www.owasp.org)) and its list of
    the top 10 vulnerabilities.
  prefs: []
  type: TYPE_NORMAL
- en: As a minimum standard, OWASP has provided a strong direction to testers. However,
    focusing on only the top 10 vulnerabilities is short-sighted, and the methodology
    has demonstrated some gaps, particularly when applied to finding vulnerabilities
    in the logic of how an application should work to support business practices.
  prefs: []
  type: TYPE_NORMAL
- en: 'Using the kill chain approach, some activities specific to web service reconnaissance
    to be highlighted include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Identifying the target site, especially with regards to where and how it is
    hosted.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enumerating the site directory structure and files of the target website, including
    determining if a **content management system** (**CMS**) is in use. This may include
    downloading the website for offline analysis, including document metadata analysis,
    and using the site to create a custom wordlist for password cracking (using a
    program such as crunch). It also ensures that all support files are also identified.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Identifying the authentication and authorization mechanisms and determining
    how the session state is maintained during a transaction with that web service.
    This will usually involve an analysis of cookies and how they are used.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enumerating all forms. As these are the primary means for a client to input
    data and interact with the web service, these are the specific locations for several
    exploitable vulnerabilities, such as SQL injection attacks and cross-site scripting.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Identifying other areas that accept input, such as pages that allow for file
    upload as well as any restrictions on accepted upload types.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Identifying how errors are handled, and the actual error messages that are received
    by a user; frequently, the error will provide valuable internal information such
    as version of software used, or internal file names and processes.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Determining which pages require and maintain Secure Sockets Layer or other secure
    protocols (refer to [Chapter 10](ch10.html "Chapter 10. Exploiting Remote Access
    Communications"), *Exploiting Remote Access Communications*).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The first step is to conduct the passive and active reconnaissance previously
    described (refer to [Chapter 2](ch02.html "Chapter 2. Identifying the Target –
    Passive Reconnaissance"), *Identifying the Target – Passive Reconnaissance* and
    [Chapter 3](ch03.html "Chapter 3. Active Reconnaissance and Vulnerability Scanning"),
    *Active Reconnaissance and Vulnerability Scanning*); in particular, ensure that
    hosted sites are identified, and then use DNS mapping to identify all the hosted
    sites that are delivered by the same server (one of the most common and successful
    means of attack is to attack a non-target site hosted on the same physical server
    as the target website, exploit weaknesses in the server to gain root access, and
    then use the escalated privileges to attack the targeted site).
  prefs: []
  type: TYPE_NORMAL
- en: The next step is to identify the presence of network-based protective devices,
    such as firewalls, IDS/IPS, and honeypots. An increasingly common protective device
    is the **Web Application Firewall** (**WAF**).
  prefs: []
  type: TYPE_NORMAL
- en: If a WAF is being used, testers will have to ensure that the attacks, especially
    those that rely on crafted input, are encoded to bypass the WAF.
  prefs: []
  type: TYPE_NORMAL
- en: WAFs can be identified by manually inspecting cookies (some WAFs tag or modify
    the cookies that are communicated between the web server and the client), or by
    changes to the header information (identified when a tester connects to port 80
    using a command line tool such as Telnet).
  prefs: []
  type: TYPE_NORMAL
- en: 'The process of WAF detection can be automated using the `nmap` script, `http-waf-detect.nse`,
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Conducting reconnaissance of websites](img/3121OS_09_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The nmap script identifies that a WAF is present; however, testing of the script
    has demonstrated that it is not always accurate in its findings, and that the
    returned data may be too general to guide an effective strategy to bypass the
    firewall.
  prefs: []
  type: TYPE_NORMAL
- en: 'The wafw00f script is an automated tool to identify and fingerprint web-based
    firewalls; testing has determined that it is the most accurate tool for this purpose.
    The script is easy to invoke from Kali, and ample output is shown in the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Conducting reconnaissance of websites](img/3121OS_09_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**Load balancing detector** (**lbd**) is a bash shell script that determines
    if a given domain uses DNS and/or HTTP load balancing. This is important information
    from the perspective of a tester, as it can explain seemingly anomalous results
    that occur when one server is tested, and then the load balancer switches requests
    to a different server. Lbd uses a variety of checks to identify the presence of
    load balancing; a. A sample output is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Conducting reconnaissance of websites](img/3121OS_09_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The website should be inspected to determine the CMS that may be used to build
    and maintain it. CMS applications such as Drupal, Joomla, and WordPress, among
    others, may be configured with a vulnerable administrative interface that allows
    access to the elevated privileges, or may contain exploitable vulnerabilities.
  prefs: []
  type: TYPE_NORMAL
- en: 'Kali includes an automated scanner, **BlindElephant**, which fingerprints a
    CMS to determine version information. A sample output is shown in the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Conducting reconnaissance of websites](img/3121OS_09_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: BlindElephant reviews the fingerprint for components of the CMS and then provides
    a best guess for the versions that are present. However, like other applications,
    we have found that it may fail to detect a CMS that is present; therefore, always
    verify results against other scanners that crawl the website for specific directories
    and files, or manually inspect the site.
  prefs: []
  type: TYPE_NORMAL
- en: One particular scanning tool, automated web crawlers, can be used to validate
    information that has already been gathered, as well as determine the existing
    directory and file structure of a particular site. Typical findings of web crawlers
    include administration portals, configuration files (current and previous versions)
    that may contain hardcoded access credentials and information on the internal
    structure, backup copies of the website, administrator notes, confidential personal
    information, and source code.
  prefs: []
  type: TYPE_NORMAL
- en: Kali supports several web crawlers, including Burp Suite, DirBuster, OWASP-ZAP,
    Vega, WebScarab, and WebSlayer. The most commonly used tool is DirBuster.
  prefs: []
  type: TYPE_NORMAL
- en: 'DirBuster is a GUI-driven application that uses a list of possible directories
    and files to perform a brute-force analysis of a website''s structure. Responses
    can be viewed in a list or a tree format that reflects the site''s structure more
    accurately. Output from executing this application against a target website is
    shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Conducting reconnaissance of websites](img/3121OS_09_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: It is also possible to copy a website directly to the tester's location. This
    "website cloning" allows a tester the leisure to review the directory structure
    and its contents, extract metadata from local files, and use the site's contents
    as an input to a program such as `crunch`, which will produce a personalized wordlist
    to support password cracking.
  prefs: []
  type: TYPE_NORMAL
- en: To clone a website to a local system, use HTTrack. If it is not present in Kali,
    it can be downloaded using the `apt-get` command and then executed by typing `httrack`
    in the command prompt. You will be prompted to select a directory location to
    store the downloaded website. Once the program has executed, you will have a backup
    of the target website.
  prefs: []
  type: TYPE_NORMAL
- en: Once you have mapped out the basic structure of the website and/or web services
    that are being delivered, the next stage of the kill chain is to identify the
    vulnerabilities that can be exploited.
  prefs: []
  type: TYPE_NORMAL
- en: Vulnerability scanners
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Scanning for vulnerabilities using automated tools can be problematic. Web vulnerability
    scanners suffer the common shortcomings of all scanners (a scanner can only detect
    the signature of a known vulnerability; they cannot determine if the vulnerability
    can actually be exploited; there is a high incidence of *false-positive* reports).
    Furthermore, web vulnerability scanners cannot identify complex errors in business
    logic, and they do not accurately simulate the complex chained attacks used by
    hackers.
  prefs: []
  type: TYPE_NORMAL
- en: In an effort to increase reliability, most penetration testers use multiple
    tools to scan web services; when multiple tools report that a particular vulnerability
    may exist, this consensus will direct the tester to areas that may require manually
    verify the findings.
  prefs: []
  type: TYPE_NORMAL
- en: 'Kali comes with an extensive number of vulnerability scanners for web services,
    and provides a stable platform for installing new scanners and extending their
    capabilities. This allows penetration testers to increase the effectiveness of
    testing by selecting scanning tools that:'
  prefs: []
  type: TYPE_NORMAL
- en: Maximize the completeness (the total number of vulnerabilities that are identified)
    and accuracy (the vulnerabilities that are real and not false-positive results)
    of testing.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Minimize the time required to obtain usable results.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Minimize the negative impacts on the web services being tested. This can include
    slowing down the system due to an increase of traffic throughput. For example,
    one of the most common negative effects is a result of testing forms that input
    data to a database and then e-mail an individual providing an update of the change
    that has been made—uncontrolled testing of such forms can result in more than
    30,000 e-mails being sent!
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'There is significant complexity in choosing the most effective tool. In addition
    to the factors already listed, some vulnerability scanners will also launch the
    appropriate exploit and support the post-exploit activities. For our purposes,
    we will consider all tools that scan for exploitable weaknesses to be "vulnerability
    scanners." Kali provides access to several different vulnerability scanners, including
    the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Scanners that extend the functionality of traditional vulnerability scanners
    to include websites and associated services (Metasploit Framework and Websploit)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Scanners that extend the functionality of non-traditional applications, such
    as web browsers, to support web service vulnerability scanning (OWASP Mantra)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Scanners that are specifically developed to support reconnaissance and exploit
    detection in websites and web services (Arachnid, Nikto, Skipfish, Vega, w3af,
    and so on)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Extending the functionality of traditional vulnerability scanners
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The best example of this type of vulnerability scanner is the `wmap` module
    that is packaged with the Metasploit Framework of Rapid7\. To use this module,
    you must first ensure that the `postgresql` database service has been started;
    use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: Next, launch `msfconsole` from a command prompt and enter the `load wmap` command.
    Like most of the framework applications, typing `help` or `-h` in the command
    prompt will display the commands that are available for use.
  prefs: []
  type: TYPE_NORMAL
- en: 'To manage the target sites, use the `wmap_sites` command. The `–a` option will
    add the target''s IP address to the application''s database. The `–l` option provides
    a list of the available sites to target for testing, as shown in the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Extending the functionality of traditional vulnerability scanners](img/3121OS_09_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'With the target selected, the tester is now able to run the `wmap` modules
    using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Extending the functionality of traditional vulnerability scanners](img/3121OS_09_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Executing this command may take some time to reach completion (it depends on
    the number of pages in the website, as well as the site's structural complexity,
    as well as how the selected modules operate to detect vulnerabilities).
  prefs: []
  type: TYPE_NORMAL
- en: The Metasploit Framework was not designed for the complexities of websites and
    web services; this is visible in the limited amount of findings that result from
    using this product versus using vulnerability scanners that were specifically
    designed for websites and web services. Nevertheless, because it is always undergoing
    updates, it is worth monitoring the changes in its scanning abilities.
  prefs: []
  type: TYPE_NORMAL
- en: The **Websploit** application also uses the `wmap` modules.
  prefs: []
  type: TYPE_NORMAL
- en: Extending the functionality of web browsers
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Web browsers are designed to interact with web services. As a result, it is
    natural that they are selected as vulnerability assessment and exploit tools.
  prefs: []
  type: TYPE_NORMAL
- en: 'The best example of this type of toolset is OWASP''s Mantra—a collection of
    third-party security utilities built on the Firefox web browser. OWASP''s Mantra
    supports Windows, Linux, and Macintosh test systems, and provides access to utilities
    that support the following activities:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Information gathering**: These utilities provide passive reconnaissance,
    reporting on the target''s physical location, uncovering the underlying site technologies,
    and searching and testing of the site''s hyperlinks'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Editors**: A collection of utilities that edit, debug, and monitor HTML,
    CSS, and JavaScript'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Proxy**: Utilities that provide proxy management tools, including FoxyProxy,
    a tool that facilitates switching back and forth among proxies'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Network utilities**: These utilities provide clients for FTP and SSH communications,
    and simplify DNS cache management'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Application auditing**: These switch between various user agents, access
    to web developer tools, control what gets sent as the HTTP referrer on a per-site
    basis, find SQL injection and XSS vulnerabilities, allow testers to tamper with
    the data, and access to the Websecurify tools'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Miscellaneous**: Generate scripts, manage sessions and downloads, and access
    encryption, decryption, and hashtag functions'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Mantra framework can be used to facilitate a semi-automated reconnaissance
    of a website.
  prefs: []
  type: TYPE_NORMAL
- en: In the example shown in the following screenshot, the Mutillidae login page
    has been opened in the Mantra browser. Using the drop-down menu (activated from
    the blue logo in the upper-right corner), the SQL Inject Me application has been
    selected from among the available tools, and is displayed in the left-hand panel.
  prefs: []
  type: TYPE_NORMAL
- en: '![Extending the functionality of web browsers](img/3121OS_09_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Web-service-specific vulnerability scanners
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Vulnerability scanners are automated tools that crawl an application to identify
    the signatures of known vulnerabilities.
  prefs: []
  type: TYPE_NORMAL
- en: Kali comes with several different preinstalled vulnerability scanners; they
    can be accessed by navigating to **Kali Linux** | **Web Applications** | **Web
    Vulnerability Scanners**. Penetration testers will typically use two or three
    comprehensive scanners against the same target to ensure valid results. Note that
    some of the vulnerability scanners also include an attack functionality.
  prefs: []
  type: TYPE_NORMAL
- en: Vulnerability scanners are quite "noisy", and are usually detected by the victim.
    However, scans frequently get ignored as part of regular background probing across
    the Internet. In fact, some attackers have been known to launch large-scale scans
    against a target to camouflage the real attack or to induce the defenders to disable
    detection systems to reduce the influx of reports that they have to manage.
  prefs: []
  type: TYPE_NORMAL
- en: 'A quick survey of the most important vulnerability scanners include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Application | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Arachnid | An open-source Ruby framework that analyzes HTTP responses received
    during scanning to validate responses and eliminate false-positives. |'
  prefs: []
  type: TYPE_TB
- en: '| GoLismero | It maps web applications and detects common vulnerabilities.
    The results are saved in TXT, CVS, HTML, and RAW formats. |'
  prefs: []
  type: TYPE_TB
- en: '| Nikto | A Perl-based open-source scanner that allows IDS evasion and user
    changes to scan modules; however, this "original" web scanner is beginning to
    show its age, and is not as accurate as some of the more modern scanners. |'
  prefs: []
  type: TYPE_TB
- en: '| Skipfish | This scanner completes a recursive crawl and dictionary-based
    crawl to generate an interactive sitemap of the targeted website that is annotated
    with the output from additional vulnerability scans. |'
  prefs: []
  type: TYPE_TB
- en: '| Vega | It is a GUI-based open-source vulnerability scanner. As it is written
    in Java, it is a cross-platform (Linux, OS X, and Windows) and can be customized
    by the user. |'
  prefs: []
  type: TYPE_TB
- en: '| w3af | This scanner provides both a graphical and command-line interface
    to a comprehensive Python-testing platform. It maps a target website and scans
    for vulnerabilities. This project is acquired by Rapid7, so there will be a closer
    integration with the Metasploit Framework in the future. |'
  prefs: []
  type: TYPE_TB
- en: '| Wapiti | It is a Python-based open source vulnerability scanner. |'
  prefs: []
  type: TYPE_TB
- en: '| Webscarab | This is OWASP''s Java-based framework for analyzing HTTP and
    HTTPS protocols. It can act as an intercepting proxy, a fuzzer, and a simple vulnerability
    scanner. |'
  prefs: []
  type: TYPE_TB
- en: '| Webshag | This is a Python-based website crawler and scanner that can utilize
    complex IDS evasion. |'
  prefs: []
  type: TYPE_TB
- en: '| Websploit | This is a framework for wired and wireless network attacks. |'
  prefs: []
  type: TYPE_TB
- en: 'Most testers start testing a website by using Nikto, a simple scanner (particularly
    with regards to reporting) that generally provides accurate but limited results;
    a sample output of this scan is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Web-service-specific vulnerability scanners](img/3121OS_09_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The next step is to use more advanced scanners that scan a larger number of
    vulnerabilities; in turn, they can take significantly longer to run to completion.
    It is not uncommon for complex vulnerability scans (as determined by the number
    of pages to be scanned as well as the site's complexity, which can include multiple
    pages that permit user input such as search functions or forms that gather data
    from the user for a back-end database) to take several days to be completed.
  prefs: []
  type: TYPE_NORMAL
- en: One of the most effective scanners based on the number of verified vulnerabilities
    discovered is Subgraph's Vega. As shown in the following screenshot, it scans
    a target and classifies the vulnerabilities as high, medium, low, or information.
    The tester is able to click on the identified results to "drill down" to specific
    findings. The tester can also modify the search modules, which are written in
    Java, to focus on particular vulnerabilities or identify new vulnerabilities.
  prefs: []
  type: TYPE_NORMAL
- en: '![Web-service-specific vulnerability scanners](img/3121OS_09_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Another scanner worth using is the **Web Application Attack and Audit Framework**
    (**w3af**), a Python-based open-source web application security scanner. It provides
    preconfigured vulnerability scans in support of standards such as OWASP. The breadth
    of the scanner''s options comes at a price—it takes significantly longer than
    other scanners to review a target, and it is prone to failure over long testing
    periods. A w3af instance configured for a full audit of a sample website is shown
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Web-service-specific vulnerability scanners](img/3121OS_09_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Kali also includes some application-specific vulnerability scanners. For example,
    WPScan is used specifically against **WordPress CMS** applications.
  prefs: []
  type: TYPE_NORMAL
- en: Testing security with client-side proxies
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Unlike automated vulnerability scanners, client-side proxies require extensive
    human interaction in order to be effective. A client-side proxy intercepts HTTP
    and HTTPS traffic, allowing a penetration tester to examine communications between
    the user and the application. It allows the tester to copy the data or interact
    with requests that are sent to the application.
  prefs: []
  type: TYPE_NORMAL
- en: Kali comes with several client-side proxies, including Burp Suite, OWASP ZAP,
    Paros, ProxyStrike, the vulnerability scanner Vega, and WebScarab. After extensive
    testing, we have come to rely on Burp Proxy, with ZAP as a back-up tool.
  prefs: []
  type: TYPE_NORMAL
- en: 'Burp is primarily used to intercept HTTP(S) traffic; however, it is part of
    a larger suite of tools that has several additional functions, including:'
  prefs: []
  type: TYPE_NORMAL
- en: An application-aware spider that crawls the site
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A vulnerability scanner, including a sequencer to test the randomness of session
    tokens, and a repeater to manipulate and resend requests between the client and
    the website (the vulnerability scanner is not included with the free version of
    Burp proxy that is packaged in Kali)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An intruder tool that can be used to launch customized attacks (there are speed
    limitations in the free version of the tool included with Kali; these are removed
    if you purchase the commercial version of the software)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The ability to edit existing plugins or write new ones in order to extend the
    number and type of attacks that can be used
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To use Burp, ensure that your web browser is configured to use a local proxy;
    usually, you will have to adjust the network settings to specify that HTTP and
    HTTPS traffic must use the localhost (127.0.0.1) at port 8080.
  prefs: []
  type: TYPE_NORMAL
- en: After setting up the browser and the proxy to work together, manually map the
    application. This is accomplished by turning off the proxy interception and then
    browsing the entire application. Follow every link, submit the forms, and log
    in to as many areas of the site as possible. Additional content will be inferred
    from various responses. The site map will populate an area under the **Target**
    tab (automated crawling can also be used by right-clicking on the site and selecting
    **Spider This Host**; however, the manual technique gives the tester the opportunity
    to become deeply familiar with the target, and it may identify areas to be avoided).
  prefs: []
  type: TYPE_NORMAL
- en: 'Once the target is mapped, define the Target – Scope by selecting branches
    within the site map and using the **Add to Scope** command. Once this is completed,
    you can hide items that are not of interest on the site map using display filters.
    A site map created of a target website is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Testing security with client-side proxies](img/3121OS_09_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Once spidering has been completed, manually review the directory and file list
    for any structures that do not appear to be part of the public website, or that
    appear to be unintentionally disclosed. For example, directories titled admin,
    backup, documentation, or notes should be manually reviewed.
  prefs: []
  type: TYPE_NORMAL
- en: 'Manual testing of the login page using a single quote as the input produced
    an error code suggesting that it may be vulnerable to a SQL injection attack;
    a sample return of the error code is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Testing security with client-side proxies](img/3121OS_09_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The real strength of a proxy is its ability to intercept and modify commands.
    For this particular example, we'll use the Mutillidae website—a "broken" site
    that is installed as part of the Metasploitable testing framework to perform an
    attack to bypass SQL injection authentication.
  prefs: []
  type: TYPE_NORMAL
- en: To launch this attack, ensure that the Burp proxy is configured to intercept
    communications by going to the **Proxy** tab and selecting the **Intercept** subtab.
    Click on the **Intercept is on** button, as shown in the next screenshot. When
    this is completed, open a browser window and access the Mutillidae logon page
    by entering `<IP address>/mutillidae/index.php?page=login.php`. Enter variables
    in the name and password fields, and then click on the login button.
  prefs: []
  type: TYPE_NORMAL
- en: If you return to the Burp proxy, you will see that the information that the
    user entered into the form on the webpage was intercepted.
  prefs: []
  type: TYPE_NORMAL
- en: '![Testing security with client-side proxies](img/3121OS_09_14.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Click on the **Action** button and select the option **Send to Intruder**. Open
    the main **Intruder** tab, and you will see four subtabs—**Target**, **Positions**,
    **Payloads**, and **Options**, as shown in the following screenshot. If you select
    **Positions**, you will see that five payload positions were identified from the
    intercepted information.
  prefs: []
  type: TYPE_NORMAL
- en: '![Testing security with client-side proxies](img/3121OS_09_15.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This attack will use the sniper mode of the Burp proxy, which takes a single
    input from a list provided by the tester and sends this input to a single payload
    position at a time. For this example, we will target the username field, which
    we suspect is vulnerable based on the returned error message.
  prefs: []
  type: TYPE_NORMAL
- en: To define the payload position, we select the subtab **Payloads**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Testing security with client-side proxies](img/3121OS_09_16.jpg)'
  prefs: []
  type: TYPE_IMG
- en: To launch the attack, select **Intruder** from the top menu, and then select
    **Start Attack**. The proxy will iterate the wordlist against the selected payload
    positions as legitimate HTTP requests, and it will return the server's status
    codes. As you can see in the following screenshot, most options produce a status
    code of **200** (request succeeded); however, some of the data return a status
    code of **302** (request found; indicates that the requested resource is presently
    located under a different URI).
  prefs: []
  type: TYPE_NORMAL
- en: '![Testing security with client-side proxies](img/3121OS_09_17.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The **302** status indicates successful attacks, and the data obtained can be
    used to successfully log on to the target site.
  prefs: []
  type: TYPE_NORMAL
- en: Unfortunately, this is too brief of an overview of Burp proxy and its capabilities.
    The free version included with Kali will suffice for many testing tasks; however,
    serious testers (and attackers) should consider purchasing the commercial version.
  prefs: []
  type: TYPE_NORMAL
- en: Server exploits
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As they have an extensive "attack surface" (communication channels, client software,
    server operating systems, applications, middleware, and backend databases), web
    services are vulnerable to multiple attack types. The range of possible attacks
    would require their own book; therefore, we will only show a couple of types to
    highlight the capabilities of Kali.
  prefs: []
  type: TYPE_NORMAL
- en: For this example, we will demonstrate how Kali can be used to launch a denial-of-service
    (**DoS**) attack against a network server.
  prefs: []
  type: TYPE_NORMAL
- en: In general, attacking the operating system of a host system that provides web
    services follows the methodology previously described; however, their architecture
    is particularly vulnerable to DoS attacks.
  prefs: []
  type: TYPE_NORMAL
- en: Kali includes several tools that are described as stress-testing applications
    because they simulate high activity loads against a server in order to assess
    how well it will cope with the additional stress. If the server or its applications
    fail, then it has suffered a DoS.
  prefs: []
  type: TYPE_NORMAL
- en: Many of the tools rely on an IPv4 system's inability to handle the newer IPv6
    protocol (denail6, dos-new-ip6, flood_advertise6, and so on).
  prefs: []
  type: TYPE_NORMAL
- en: 'However, the most successful DoS attack tool—**Low Orbit Ion Cannon** (**LOIC**)—must
    be manually added to Kali using the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Using the `apt-get install` command, install the following packages and their
    dependencies: `mono-gmcs`, `mono-mcs`, `monodevelop`, and `liblog4net-cil-dev`.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Download the LOIC from GitHub ([https://github.com/NewEraCracker/LOIC/downloads](https://github.com/NewEraCracker/LOIC/downloads))
    into a separate folder. Extract the compressed files into the folder using the
    unzip command.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Navigate to the folder and compile the application using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE44]'
  prefs: []
  type: TYPE_PRE
- en: The compiled build of the application will be in the `/<path> bin/Debug/LOIC.exe`
    directory.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Once the attack parameters have been entered, LOIC can be launched against
    the target website. The attack is launched using the intuitive GUI interface,
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Server exploits](img/3121OS_09_18.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Application-specific attacks
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Application-specific attacks outnumber the attacks against specific operating
    systems; when one considers the misconfigurations, vulnerabilities, and logic
    errors that can affect each online application, it is surprising that any application
    can be considered "secure." We will highlight some of the more important attacks
    against web services.
  prefs: []
  type: TYPE_NORMAL
- en: Brute-forcing access credentials
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: One of the most common initial attacks against a website or its services is
    a brute-force attack against the access authentication—guessing the username and
    password. This attack has a high success rate because users tend to select easy-to-remember
    credentials or reuse credentials, and also because system administrators frequently
    don't control multiple access attempts.
  prefs: []
  type: TYPE_NORMAL
- en: 'Kali comes with hydra, a command-line tool, and hydra-gtk, which has a GUI
    interface. Both tools allow a tester to brute force or iterate possible usernames
    and passwords against a specified service. Multiple communication protocols are
    supported, including FTP, FTPS, HTTP, HTTPS, ICQ, IRC, LDAP, MySQL, Oracle, POP3,
    pcAnywhere, SNMP, SSH, VNC, and others. The following screenshot shows hydra using
    a brute-force attack to determine access credentials on an HTTP page:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Brute-forcing access credentials](img/3121OS_09_19.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Injection attacks against databases
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The most common and exploitable vulnerability in websites is the injection vulnerability,
    which occurs when the victim site does not monitor the user input, thereby allowing
    the attacker to interact with backend systems. An attacker can craft the input
    data to modify or steal contents from a database, place an executable onto the
    server, or issue commands to the operating system.
  prefs: []
  type: TYPE_NORMAL
- en: One of the most useful tools for assessing SQL injection vulnerabilities is
    **sqlmap**, a Python tool that automates the reconnaissance and exploitation of
    Firebird, Microsoft SQL, MySQL, Oracle, PostgreSQL, Sybase, and SAP MaxDB databases.
  prefs: []
  type: TYPE_NORMAL
- en: We'll demonstrate an SQL injection attack against the Mutillidae database. The
    first step is to determine the web server, the backend database management system,
    and the available databases.
  prefs: []
  type: TYPE_NORMAL
- en: 'Launch a Metasploitable virtual machine, and access the Mutillidae website.
    When this is completed, review the web pages to identify one that accepts user
    input (for example, the user login form that accepts username and password from
    a remote user); these pages may be vulnerable to SQL injection. Then, open Kali,
    and from a command prompt, enter the following (using the appropriate target IP
    address):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE45]'
  prefs: []
  type: TYPE_PRE
- en: 'Sqlmap will return data, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Injection attacks against databases](img/3121OS_09_20.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The most likely database to store the application''s data is the `owasp10`
    database; therefore, we will check for all tables of that database using the following
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE46]'
  prefs: []
  type: TYPE_PRE
- en: 'The returned data from executing that command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Injection attacks against databases](img/3121OS_09_21.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Of the six tables that were enumerated, one was titled `accounts`. We will
    attempt to dump the data from this part of the table. If successful, the account
    credentials will allow us to return to the database if further SQL injection attacks
    fail. To dump the credentials, use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE47]'
  prefs: []
  type: TYPE_PRE
- en: '![Injection attacks against databases](img/3121OS_09_22.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Similar attacks can be used against the database to extract credit card numbers.
  prefs: []
  type: TYPE_NORMAL
- en: Maintaining access with web backdoors
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Once a web server and its services have been compromised, it is important to
    ensure that secure access can be maintained. This is usually accomplished with
    the aid of a web shell—a small program that provides stealth backdoor access and
    allows the use of system commands to facilitate post-exploitation activities.
  prefs: []
  type: TYPE_NORMAL
- en: Kali comes with several web shells; here we will use a popular PHP web shell
    called **Weevely**.
  prefs: []
  type: TYPE_NORMAL
- en: 'Weevely simulates a Telnet session and allows the tester or attacker to take
    advantage of more than 30 modules for post-exploitation tasks, including the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Browsing the target filesystem
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: File transfer to and from the compromised system
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Performing audits for common server misconfigurations
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Brute-forcing SQL accounts through the target system
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Spawning reverse TCP shells
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Executing commands on remote systems that have been compromised, even if PHP
    security restrictions have been applied
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Finally, Weevely endeavors to hide communications in HTTP cookies to avoid
    detection. To create Weevely, issue the following command from the command prompt:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  prefs: []
  type: TYPE_PRE
- en: 'This will create the file `weevely.php` in the root directory. Executing commands
    on remote systems that have been compromised, even if PHP security restrictions
    have been applied:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Maintaining access with web backdoors](img/3121OS_09_23.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Using a file upload vulnerability or any other compromise, including ones that
    give access to the meterpreter file upload functions, upload `weevely.php` onto
    the compromised website.
  prefs: []
  type: TYPE_NORMAL
- en: 'To communicate with the web shell, issue the following command from the command
    prompt, ensuring that the target IP address, directory, and password variables
    are changed to reflect those of the compromised system:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE49]'
  prefs: []
  type: TYPE_PRE
- en: In the example shown in the following screenshot, we have verified that we are
    connected to the web shell using the `whoami` command (which identifies the correct
    directory) and the `ls` command in order to obtain a file list (which again confirms
    the source of the connection as `weevely.php`). The `cat /etc/password` command
    was used to view passwords.
  prefs: []
  type: TYPE_NORMAL
- en: '![Maintaining access with web backdoors](img/3121OS_09_24.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The web shell can also be used to establish a reverse shell connection back
    to the tester, using either Netcat or the Metasploit Framework as the local listener.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we examined websites and the services that they provide to
    authorized users from the perspective of an attacker. We applied the kill chain
    perspective to web services in order to understand the correct application of
    reconnaissance and vulnerability scanning.
  prefs: []
  type: TYPE_NORMAL
- en: Several different vulnerability scanners were presented; we focused on making
    and using modifications to existing scanners to support the assessment of websites
    and web services, the use of browser-based vulnerability scanners, and vulnerability
    scanners that are specifically designed to assess websites and their services.
    Only a select few exploits were reviewed, and we completed the chapter with an
    examination of a web shell that is specific for web services.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will learn how to identify and attack remote access
    communications that connect users to the web services.
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 10. Exploiting Remote Access Communications
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In [Chapter 9](ch09.html "Chapter 9. Reconnaissance and Exploitation of Web-based
    Applications"), *Reconnaissance and Exploitation of Web-based Applications*, we
    applied the kill chain methodology against web-based applications. We reviewed
    reconnaissance, vulnerability scanning, and exploitation methodologies that are
    particular to websites and other applications. We also reviewed the unique tools
    that are required for assessing web-based applications, especially client-side
    proxies and post-exploitation tools such as web shells.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we'll focus on compromising the remote access communications
    to the devices and applications that have proliferated over the Internet.
  prefs: []
  type: TYPE_NORMAL
- en: 'Attackers are taking advantage of the pervasiveness of these remote access
    communications to achieve the following goals:'
  prefs: []
  type: TYPE_NORMAL
- en: Exploit pre-existing communication channels to gain direct remote access to
    target systems
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Intercept communications
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Deny authenticated users access to regular communications and force them to
    use insecure channels that might be vulnerable to other attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Since most users feel they are using communications tools that are "secure"
    (even banks rely on SSL protocols to secure online banking), these attacks can
    have a significant impact on both the communication that is compromised as well
    as the victim's trust in other online communications.
  prefs: []
  type: TYPE_NORMAL
- en: This chapter will focus on the reconnaissance and exploit phases of the kill
    chain as they pertain to remote access communications. It will not cover subjects
    such as war dialing, voice over IP and related telephony issues, highly proprietary
    systems such as specialized kiosks, and complex applications that deserve their
    own book.
  prefs: []
  type: TYPE_NORMAL
- en: 'By the end of this chapter, you will have learned the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Exploiting operating system communications protocols (RDP and SSH)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Exploiting remote access applications (VNC)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring Kali for Secure Sockets Layerv2 scanning
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Reconnaissance and exploitation of Secure Sockets Layer, including man-in-the-middle
    and denial of service attacks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Attacking a virtual private network
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Exploiting operating system communication protocols
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Some protocols transmit access credentials in the clear (Telnet and FTP). Using
    a packet sniffer such as Wireshark will allow an attacker to intercept and reuse
    the credentials.
  prefs: []
  type: TYPE_NORMAL
- en: However, most remote access protocols, especially those embedded in the operating
    system, are now protected with access controls and encryption. Although this adds
    a degree of security, they are still subject to attacks that may occur due to
    misconfigurations or the use of poor encryption keys. In this section, we will
    examine other risks that can be exploited to compromise supposedly secure communication
    channels.
  prefs: []
  type: TYPE_NORMAL
- en: Compromising Remote Desktop Protocol
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Remote Desktop Protocol** (**RDP**) is a proprietary Microsoft communication
    protocol which allows a client to connect with another computer using a graphical
    interface. Although the protocol is encrypted, access to the server can be gained
    if the attacker guesses the username and password.'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It should be noted that the most common compromise of RDP is using social engineering.
    The user is contacted by a remote service technician who convinces the user that
    they need remote access to fix something on the user's system. Malware attacks
    that target the RDP protocol are also becoming more common.
  prefs: []
  type: TYPE_NORMAL
- en: From a tester's (or attacker's) perspective, the first step in compromising
    a target's RDP service is to locate the RDP server and characterize the strength
    of the cryptography that is in use. This reconnaissance is normally conducted
    using a tool such as `nmap`, configured to scan for the standard RDP port 3389.
  prefs: []
  type: TYPE_NORMAL
- en: 'The `nmap` tool now includes specialized scripts that provide additional details
    about RDP, including the configuration of the encryption. If time permits, and
    if stealth is not an issue, these should be used during the initial scanning stage.
    The command line to invoke the script that enumerates supported encryption protocols
    is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE50]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising Remote Desktop Protocol](img/3121OS_10_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Some RDP vulnerabilities have been identified (especially MS12-020), and these
    can be remotely exploited using crafted packets.
  prefs: []
  type: TYPE_NORMAL
- en: 'To determine whether the current version of RDP is vulnerable, use the appropriate
    `nmap` script, by invoking the following command line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE51]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising Remote Desktop Protocol](img/3121OS_10_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Once a vulnerable system has been identified using `nmap`, it can be exploited
    using the Metasploit Framework's `auxiliary/dos/windows/rdp/ms12_020_maxchannelids`
    module to cause a denial of service.
  prefs: []
  type: TYPE_NORMAL
- en: The most common method to compromise RDP is to use a brute-force attack based
    on a dictionary of the most common usernames and passwords (target-specific dictionaries
    can also be constructed to be target specific using tools such as **CeWL** and
    **crunch**; brute force attempts using these dictionaries are faster than attempts
    using generic dictionaries, and are stealthier because they generate less network
    traffic).
  prefs: []
  type: TYPE_NORMAL
- en: Kali provides several tools to brute-force access, including **hydra**, **medusa**,
    **ncrack**, and **patator**. Through testing, we have found `ncrack` to be the
    most reliable in terms of speed and effectiveness.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Lists of common usernames and passwords are available from several sources.
    Most cracking tools, especially `hydra` **,** `ncrack`, and `john` (John the Ripper),
    include lists in the application's home directory. Testers can also download lists
    of various types from online sources. Lists derived from compromised user accounts
    are particularly useful because they reflect the real-world usage of the authentication
    information. No matter what list you use, you may wish to personalize it for testing
    by adding names of the current and former employees (for usernames) or wordlists
    that have been created using tools such as CeWL, which crawls the target's website
    to create words of a defined length.
  prefs: []
  type: TYPE_NORMAL
- en: 'The `ncrack` tool is a high-speed authentication cracking tool that supports
    the FTP, HTTP(S), POP3, RDP, SMB, SSH, Telnet, and VNC protocols. It is invoked
    from the terminal window using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE52]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising Remote Desktop Protocol](img/3121OS_10_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The `ncrack` tool discovered the access credentials for all users in approximately
    1,700 seconds. However, the amount of time required will depend on the overall
    size of the dictionaries used and how many guesses must be made before we get
    a successful hit.
  prefs: []
  type: TYPE_NORMAL
- en: Compromising Secure Shell
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The **secure shell** (**SSH**) protocol is a network protocol that is used to
    establish an encrypted channel across an open network between a server and a client.
    In general, a public-private key pair allows users to log in to a system without
    requiring the password. The public key is present on all systems that require
    a secure connection, while the user keeps the private key secret. The authentication
    is based on the private key; SSH verifies the private key against the public key.
    On the target systems, the public key is verified against a list of authorized
    keys that are permitted to remotely access the system. This supposedly secure
    communication channel fails when the public key is not cryptographically strong
    and can be guessed.
  prefs: []
  type: TYPE_NORMAL
- en: Like RDP, SSH is vulnerable to a brute-force attack that guesses the user's
    access credentials. For this particular example, we'll use a tool called `hydra`.
    The `hydra` tool is probably the oldest brute-force tool and is definitely the
    most feature-rich tool. It also supports attacks against the greatest number of
    target protocols.
  prefs: []
  type: TYPE_NORMAL
- en: 'The `hydra` tool can be found by navigating to **Kali Linux** | **Password
    Attacks** | **Online Attacks**, and it can also be invoked directly from the command
    line. There are two versions of `hydra`: the command-line version (`hydra`) and
    the GUI version (hydra-gtk). For this example, we will invoke `hydra` from the
    command line using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE53]'
  prefs: []
  type: TYPE_PRE
- en: 'The command parameters are described in the following list:'
  prefs: []
  type: TYPE_NORMAL
- en: '`-s` designates the port to be used. Although it does not need to be entered
    when the default port is intended to be used, it is used to remove ambiguities
    and because it speeds up testing, in this case.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-v` and `-V` select the maximum verbosity of reports.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-L` selects the login, or username file.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-P` selects the password file.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-t` selects the number of parallel tasks or connections. The greater the number,
    the faster the testing will occur. However, if the number is too high, errors
    may be introduced and correct passwords will be missed.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following screen capture presents the verbose output of the initial brute-force
    attack:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising Secure Shell](img/3121OS_10_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: When a successful login is achieved using the dictionary, `hydra` reports the
    port, the protocol, the host, and the login credentials. It then continues to
    use the dictionaries to identify the other possible accounts. In the top-most
    line of the following screenshot, Hydra has correctly identified an SSH account
    with `DigitalDefence` as the `login` and `darkstar` as the `password`; the screenshot
    also shows the other attempts made by Hydra as it attempts to identify additional
    accounts.
  prefs: []
  type: TYPE_NORMAL
- en: '![Compromising Secure Shell](img/3121OS_10_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'If you know the password configuration, you can also use `hydra` to autocreate
    the password list on the fly, using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE54]'
  prefs: []
  type: TYPE_PRE
- en: 'The parameters used in the previous command are described in the following
    list:'
  prefs: []
  type: TYPE_NORMAL
- en: '`-x` directs Hydra to automatically create the passwords used in the brute-force
    attack. The passwords will be created according to the parameters that follow
    `-x`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`6:8` indicates a minimum password length of six characters and a maximum password
    length of eight characters.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`aA1` will automatically create the passwords using a combination of letters
    and numbers. It will use all lowercase letters (denoted by `a`) and all uppercase
    letters (denoted by `A`), and the numerals 0 to 9 (denoted by `1`).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can also add special characters to the generated list, however, you need
    to add single quotes around the `–x` option, as shown in the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE55]'
  prefs: []
  type: TYPE_PRE
- en: Exploiting third-party remote access applications
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Applications that bypass system protocols to provide remote access were quite
    popular at one time. Although they are presently being replaced with online services
    such as **GoToMyPC** **or LogMeIn**, they remain quite common. Examples of such
    programs include pcAnywhere and VNC.
  prefs: []
  type: TYPE_NORMAL
- en: It should be noted that instances of these tools may be present on the network
    due to the legitimate actions of a system administrator. However, they may also
    be present because the network has been compromised and the attacker wanted a
    means to remotely access the network.
  prefs: []
  type: TYPE_NORMAL
- en: In the following example, we'll compromise VNC using the built-in functionality
    of the Metasploit Framework.
  prefs: []
  type: TYPE_NORMAL
- en: Locate the remote access software on the target using `nmap`. As shown in the
    following screenshot, VNC is usually found on TCP port `5900`.![Exploiting third-party
    remote access applications](img/3121OS_10_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Activate the Metasploit Framework using the `msfconsole` command from a terminal
    window. From the `msf` prompt, configure it to compromise VNC, as shown in the
    following screenshot:![Exploiting third-party remote access applications](img/3121OS_10_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Initiate the `run` command, as shown in the following screenshot, and watch
    for a successful run:![Exploiting third-party remote access applications](img/3121OS_10_08.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Finally, once Metasploit has determined the credentials, validate them by logging
    in to the VNC client using `vncviewer`. From the command prompt in a terminal
    window, enter the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE56]'
  prefs: []
  type: TYPE_PRE
- en: 'This will connect to the remote host and prompt you to enter the appropriate
    credentials. When the authentication is successful, a new window will be opened,
    giving you remote access to the target system. Verify that you are on the target
    system by issuing the `whoami` query, as shown in the following screenshot, and
    request the system''s ID or IP address:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Exploiting third-party remote access applications](img/3121OS_10_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Attacking Secure Sockets Layer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Secure Sockets Layer** (**SSL**) and its successor, **Transport Layer Security**
    (**TLS**), are cryptographic protocols used to provide secure communications across
    the Internet. These protocols have been widely used in secure applications such
    as Internet messaging and e-mail, web browsing, and voice-over-IP.'
  prefs: []
  type: TYPE_NORMAL
- en: These protocols are ubiquitous across the Internet, however, they originated
    in the mid-1990s and are increasingly coming under attack as they age. SSL Version
    2.0 (Version 1.0 was never publicly released) contains a significant number of
    flaws that can be exploited, such as poor key control and a weakness to man-in-the
    middle attacks. Although most users have implemented Version 3.0 of that protocol
    or newer versions of TLS, misconfigured systems may still permit the use of the
    earlier insecure version.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring Kali for SSLv2 scanning
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before beginning the reconnaissance phase, verify that Kali has been configured
    to scan for SSL version 2 protocols. At the time of writing this book, this was
    not the case.
  prefs: []
  type: TYPE_NORMAL
- en: 'From a terminal window, enter the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE57]'
  prefs: []
  type: TYPE_PRE
- en: If this returns an `unknown option -ssl2` error (shown in the following screenshot),
    then additional configuration will be required.
  prefs: []
  type: TYPE_NORMAL
- en: '![Configuring Kali for SSLv2 scanning](img/3121OS_10_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'To apply the fix, you must re-patch the OpenSSL application using the following
    steps (ensure that the path used reflects the download directory used):'
  prefs: []
  type: TYPE_NORMAL
- en: 'Install **quilt**, a program used to manage multiple patches to an application''s
    source code, using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE58]'
  prefs: []
  type: TYPE_PRE
- en: 'Download the `openssl` source code, verify patches that have been applied,
    update the configuration files, and then rebuild the application. Use the following
    commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE59]'
  prefs: []
  type: TYPE_PRE
- en: 'Edit the /`openssl-1.0.1e/debian/patches/series` file, and delete the following
    line from the file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE60]'
  prefs: []
  type: TYPE_PRE
- en: 'Edit the /`openssl-1.0.1e/debian/rules` file, and delete the `no-ssl2` argument.
    Then, reapply patches to `openssl`. Use the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE61]'
  prefs: []
  type: TYPE_PRE
- en: 'When this is complete, rebuild the `openssl` package, and then reinstall it.
    This step can be performed with the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE62]'
  prefs: []
  type: TYPE_PRE
- en: Confirm that patches have been successfully applied by reissuing the command
    to connect using SSLv2, as shown in the following screenshot:![Configuring Kali
    for SSLv2 scanning](img/3121OS_10_11.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Kali scripts that rely on `openssl`, particularly `sslscan`, will need to be
    recompiled. To recompile, first download the source and then rebuild it. When
    this is complete, reinstall it using the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE63]'
  prefs: []
  type: TYPE_PRE
- en: Kali's issue with SSLv2 may be fixed in a future release, therefore, verify
    this before testing the SSL connectivity.
  prefs: []
  type: TYPE_NORMAL
- en: Reconnaissance of SSL connections
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The reconnaissance phase of the kill chain remains important when assessing
    the SSL connectivity, especially when reviewing the following items:'
  prefs: []
  type: TYPE_NORMAL
- en: The **x.509** certificate used to identify the parties involved in establishing
    the secure SSL connection
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The type of encryption being used
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The configuration information, such as whether automatic renegotiation of SSL
    sessions is permitted
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The SSL certificate can provide information that may be used to facilitate social
    engineering.
  prefs: []
  type: TYPE_NORMAL
- en: More frequently, a tester or attacker wants to determine whether the certificate
    is valid or not. Certificates that are invalid may result from an error in checking
    the signature, a broken certificate chain, the domain specified in the certificate
    does not match the system, or the certificate has expired, been revoked, or is
    known to have been compromised.
  prefs: []
  type: TYPE_NORMAL
- en: If a user has previously accepted an invalid certificate, they will most likely
    accept a new invalid certificate, making the attacker's job significantly easier.
  prefs: []
  type: TYPE_NORMAL
- en: 'The type of encryption used to secure an SSL connection is particularly important.
    Encryption ciphers are divided into the following categories:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Null ciphers**: These ciphers are used to verify the authenticity and/or
    integrity of a transmission. Because no encryption is applied, they do not provide
    any security.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Weak ciphers**: This is a term used to descript all of the ciphers with a
    key length of 128 bits or less. Ciphers that use the **Diffie-Hellman algorithm**
    for a key exchange may also be considered to be weak as they are vulnerable to
    man-in-the-middle attacks. The use of MD5 hashes may be considered to be weak
    due to collision attacks. Finally, recent attacks against RC4 have also called
    its continued use into question.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Strong ciphers**: These are those ciphers that exceed 128 bits. Presently,
    the accepted, most secure option is the AES encryption with a 256-bit key. If
    possible, this should be used with the Galois/Counter mode, a modern block cipher
    that supports both authentication and encryption.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SSL and TLS rely on cipher suites (specific combinations of authentication,
    encryption, and message authentication code algorithms) to establish the security
    settings for each connection. There are more than 30 such suites, and the complexity
    of selecting the best option for each security requirement frequently results
    in users defaulting to less secure options. Therefore, each SSL and TLC connection
    must be thoroughly tested.
  prefs: []
  type: TYPE_NORMAL
- en: To conduct reconnaissance against SSL connections, use the NSE modules of `nmap`
    or SSL-specific applications. The `nmap` NSE modules are described in the following
    table.
  prefs: []
  type: TYPE_NORMAL
- en: '| Nmap NSE module | Module Function |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `ssl-cert` | Retrieves a server''s SSL certificate. The amount of information
    returned depends on the verbosity level (none, `-v`, and `-vv`). |'
  prefs: []
  type: TYPE_TB
- en: '| `ssl-date` | Retrieves a target host''s date and time from its TLS ServerHello
    response. |'
  prefs: []
  type: TYPE_TB
- en: '| `ssl-enum-ciphers` | Repeatedly initiates SSL and TLS connections, each time
    trying a new cipher and recording if the host accepts or rejects it. Ciphers are
    shown with a strength rate. This is a highly intrusive scan, and may be blocked
    by the target. |'
  prefs: []
  type: TYPE_TB
- en: '| `ssl-google-cert-catalog` | Queries Google''s Certificate Catalogue for information
    that pertains to the SSL certificate retrieved from the target. It provides information
    on how recently, and for how long, Google has been aware of the certificate. If
    a certificate is not recognized by Google, it may be suspicious/false. |'
  prefs: []
  type: TYPE_TB
- en: '| `ssl-known-key` | Checks whether the SSL certificate used by a host has a
    fingerprint that matches a databases of compromised or faulty keys. Presently,
    it uses the LittleBlackBox database. However, any database of fingerprints can
    be used. |'
  prefs: []
  type: TYPE_TB
- en: '| `sslv2` | Determines whether the server supports the obsolete and less secure
    SSL Version 2 and which ciphers are supported. |'
  prefs: []
  type: TYPE_TB
- en: 'To invoke a single script from the command line, use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE64]'
  prefs: []
  type: TYPE_PRE
- en: 'In the following example, the `ssl-cert` script was invoked with the `-vv`
    option for maximum verbosity. The data on from this script is shown in the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Reconnaissance of SSL connections](img/3121OS_10_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'During the reconnaissance, a tester can elect to launch all SLL-specific modules
    using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE65]'
  prefs: []
  type: TYPE_PRE
- en: 'Kali''s reconnaissance and attack tools that are specific to SSL and TLS can
    be invoked from the command line or selected from the menu by navigating to **Kali
    Linux** | **Information Gathering** | **SSL Analysis**. The tools are summarized
    in the following table:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Tool | Function |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `sslcaudit` | Automates the testing of SSL and TLS clients to determine the
    resistance against man-in-the-middle attacks. |'
  prefs: []
  type: TYPE_TB
- en: '| `ssldump` | Conducts network protocol analysis of SSLv3 and TLS communications.
    If provided with the appropriate encryption key, it will decrypt SSL traffic and
    display it in the clear. |'
  prefs: []
  type: TYPE_TB
- en: '| `sslscan` | Queries SSL services to determine which ciphers are supported.
    Output includes the preferred SSL ciphers and is displayed in text and XML formats.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `sslsniff` | Enables man-in-the-middle attack conditions on all SSL connections
    over a particular LAN, dynamically generating certificates for the domains that
    are being accessed on the fly. |'
  prefs: []
  type: TYPE_TB
- en: '| `sslsplit` | Performs man-in-the-middle attacks against SSL and TLS networks.
    Connections are transparently intercepted through a network address translation
    engine and redirected to `sslsplit`, which terminates the original connection
    and initiates a new connection to the original destination while logging all the
    transmitted data. It supports plain TCP, SSL, HTTP/HTTPs, and IPv4 and IPv6. |'
  prefs: []
  type: TYPE_TB
- en: '| `sslstrip` | Designed to transparently hijack the HTTP traffic on a network,
    watch for HTTPS links, and redirect and then map these links to spoofed HTTP or
    HTTPS links. It also supports modes to supply a favicon that looks like a lock
    icon as well as selective logging of intercepted communications. |'
  prefs: []
  type: TYPE_TB
- en: '| `sslyze` | Analyzes the SSL configuration of a server. |'
  prefs: []
  type: TYPE_TB
- en: '| `tlssled` | Unifies the use and output of several other SSL-specific applications,
    checks for encryption strength, certificate parameters, and renegotiation capabilities.
    |'
  prefs: []
  type: TYPE_TB
- en: The most commonly used program is `sslscan`, which queries the SSL services
    in order to determine the certificate details and the supported ciphers. The output
    is in text and XML formats.
  prefs: []
  type: TYPE_NORMAL
- en: When testing a particular connection, use the `--no-failed` option, as shown
    in the following screenshot, to have `sslscan` show only the accepted cipher suites.
  prefs: []
  type: TYPE_NORMAL
- en: '![Reconnaissance of SSL connections](img/3121OS_10_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The `sslyze` python tool analyzes a server's SSL configuration and validates
    the certificate, tests for weak cipher suites, and identifies the configuration
    information that may support additional attacks. In the sample output, shown in
    the following screenshot, it has identified a certificate mismatch that could
    support some attack types.
  prefs: []
  type: TYPE_NORMAL
- en: '![Reconnaissance of SSL connections](img/3121OS_10_14.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Another SSL reconnaissance tool is `tlssled`, as shown in the following screenshot.
    It is very fast, simple to operate, and the output is user friendly.
  prefs: []
  type: TYPE_NORMAL
- en: '![Reconnaissance of SSL connections](img/3121OS_10_15.jpg)'
  prefs: []
  type: TYPE_IMG
- en: No matter what approach you use for the SSL reconnaissance, make sure that you
    cross validate your results by running at least two different tools. In addition,
    not all SSL configured devices will be online at the same time. Therefore, on
    large networks, make sure that you scan for the SSL vulnerabilities several times
    during the course of the testing.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: A new tool that is presently emerging from development is OWASP's O-Saft ([www.owasp.org/index.php/O-Saft](http://www.owasp.org/index.php/O-Saft)),
    which provides a comprehensive overview of the SSL configuration, ciphers, and
    certificate data.
  prefs: []
  type: TYPE_NORMAL
- en: Using sslstrip to conduct a man-in-the-middle attack
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Despite the security offered by the SSL protection, there are some effective
    attacks against the protocol. In 2009, Moxie Marlinspike demonstrated `sslstrip`,
    a tool that transparently hijacks the HTTP traffic on a network and redirects
    the traffic to look like HTTP or HTTPS links. It removes the SSL protection and
    returns the *secured* lock icon to the victim's browser so that the interception
    cannot be readily detected.
  prefs: []
  type: TYPE_NORMAL
- en: In short, `sslstrip` launches a man-in-the-middle attack against SSL, allowing
    the previously secured data to be intercepted.
  prefs: []
  type: TYPE_NORMAL
- en: 'To use `sslstrip`, you must first configure the intercept system into the forwarding
    mode using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE66]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, set up the `iptables` firewall to redirect the HTTP traffic to `sslstrip`
    using the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE67]'
  prefs: []
  type: TYPE_PRE
- en: In this example, the listening port has been set to port 5353.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that the configuration is complete, run `sslstrip` using the following
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE68]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous commands is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using sslstrip to conduct a man-in-the-middle attack](img/3121OS_10_16.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Minimize the active terminal window that is executing `sslstrip`, and open
    a new terminal window. Use `ettercap` to spoof ARP and redirect the traffic from
    the network or target system directly to the intercepting system using the following
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE69]'
  prefs: []
  type: TYPE_PRE
- en: Here, the `ettercap -T` switch selects the text-only interface, `-q` forces
    the console into the quiet mode, and the `–M` option activates the man-in-the-middle
    attack to hijack and redirect data packets. The `arp:remote` switch implements
    the ARP poisoning attack and places the attacker as a man-in-the-middle with the
    ability to view and modify packets in the transmission. The `remote` portion of
    the switch is required if you want to view the remote IP addresses and communications
    that pass through a gateway.
  prefs: []
  type: TYPE_NORMAL
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using sslstrip to conduct a man-in-the-middle attack](img/3121OS_10_17.jpg)'
  prefs: []
  type: TYPE_IMG
- en: If the target system goes to access SSL-secured content, their queries are directed
    through the gateway to the intercepting system.
  prefs: []
  type: TYPE_NORMAL
- en: From the user's perspective, they will be directed to the site and presented
    with a **There is a problem with the site's security certificate** security alert,
    prompting them with a decision to proceed. If they select **Yes**, they will be
    directed to their selected page. The lock icon in the lower-right corner of the
    browser will still indicate that SSL is engaged, indicating that their communications
    are secure.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the background, the `sslstrip` tool removes SSL, leaving raw content that
    can be viewed in the `ettercap` log, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using sslstrip to conduct a man-in-the-middle attack](img/3121OS_10_18.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This attack is only effective from the same Layer 2 network segment. However,
    it is successful on both wired and wireless networks. Although the ARP redirect
    can be applied against a network segment, such an attack will impact the network
    bandwidth, which may be detected. Therefore, it is most effective to direct this
    attack against single devices.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To disable the PREROUTING rule, replace `–A` with `–D`. To clear the firewall
    rules, use `iptables –t nat –F` (to flush the commands) and `iptables –t nat –L`
    (to verify that the tables have been cleared).
  prefs: []
  type: TYPE_NORMAL
- en: Denial-of-service attacks against SSL
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When an SSL connection is established, the server must complete a series of
    computationally intense calculations to initiate the handshake and start the encryption.
    This involves a small amount of computational effort on the part of the client
    and a more significant amount by the server.
  prefs: []
  type: TYPE_NORMAL
- en: If a client initiates an SSL connection but rejects the server's response, the
    SSL connection will not be established. However, if the SSL server is configured
    to automatically renegotiate the connection, the computational workload will result
    in a DoS.
  prefs: []
  type: TYPE_NORMAL
- en: Kali Linux has several tools that will allow you to determine whether automatic
    renegotiation is permitted, including `sslyze` and `tssled`.
  prefs: []
  type: TYPE_NORMAL
- en: 'If the automatic renegotiation is permitted, then entering the following command
    will allow a tester to assess the resilience to the DoS attack:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE70]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Denial-of-service attacks against SSL](img/3121OS_10_19.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Attacking an IPSec Virtual Private Network
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'A **virtual private network** (**VPN**), uses the Internet to provide secure
    (encrypted) communications between remote locations or users within the same network.
    There are two types of VPNs: **IPSec** and **SSL**.'
  prefs: []
  type: TYPE_NORMAL
- en: IPSec is the most commonly used protocol to establish secure connections between
    networks and connect hosts in virtual private networks.
  prefs: []
  type: TYPE_NORMAL
- en: 'Within IPSec, there are several subsidiary protocols that perform specific
    functions, such as the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Authentication Header** (**AH**): This provides proof of origin for IP packets,
    protecting them against replay attacks.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Encapsulation Security Protocol** (**ESP**): This protocol provides the origin
    authenticity, integrity, and confidentiality of the transmitted data.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Security Association**: This is the set of algorithms used to encrypt and
    authenticate the transmitted data. Because SA is associated with data transmission
    in one direction, two-way communications are secured by a pair of security associations.
    Security associations are established using **Internet Security Association and
    Key Management Protocol** (**ISAKMP**), which can be implemented by several means.
    When testing the security of VPN, one of the most vulnerable configurations relies
    on pre-shared secrets, **Internet Key Exchange** (**IKE**).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To assess the security of VPN, testers follow these basic steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Scan for the presence of VPN gateways.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Fingerprint the VPN gateway to determine the vendor and configuration details.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Look for vulnerabilities associated with the VPN vendor or related products.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Capture pre-shared keys.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Perform offline PSK cracking.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Check for the default user accounts.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Scanning for VPN gateways
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To scan for the presence of VPN gateways, use `nmap` or `ike-scan`. To use
    `nmap`, issue the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE71]'
  prefs: []
  type: TYPE_PRE
- en: In this example, `-sU` instructs `nmap` to scan the host range for possible
    targets using UDP packets (instead of TCP), `-Pn` ensures that `nmap` will not
    send a ping scan (which can alert the target about the scan and identify the tester),
    and `–p 500` identifies the specific port to be scanned.
  prefs: []
  type: TYPE_NORMAL
- en: The `nmap` tool does not locate all VPN gateways due to how it handles the IKE
    packets; the most effective tool is one that sends a correctly formatted IKE packet
    to the target system and displays the returned message.
  prefs: []
  type: TYPE_NORMAL
- en: 'The best tool to locate a VPN gateway is `ike-scan` (which can be found by
    navigating to **Kali Linux** | **Information Gathering** | **VPN Analysis**).
    The `ike-scan` command-line tool uses the IKE protocol to discover and fingerprint
    private networks. It also supports pre-shared key cracking in the IKE aggressive
    mode. To use `ike-scan` to locate targets, issue the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE72]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Scanning for VPN gateways](img/3121OS_10_20.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The `-M` switch returns each payload in a line, simplifying the output.
  prefs: []
  type: TYPE_NORMAL
- en: 'The `ike-scan` tool tests various transforms against the target device. A transform
    contains a number of attributes: the encryption algorithm (DES and 3DES), the
    hash algorithm (MD5 and SHA1), the authentication method (the pre-shared key),
    the Diffie-Hellman group (option one is 768 bit and option two is 1024 bit) and
    the lifetime (28,800 seconds). It will identify which transforms elicited a successful
    response.'
  prefs: []
  type: TYPE_NORMAL
- en: 'After completing `ike-scan` of each identified device, the program will return
    one of the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '`0 returned handshake; 0 returned notify`: This indicates that the target is
    not an IPSec gateway'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`0 returned handshake; 1 returned notify`: This indicates that although a VPN
    gateway is present, none of the transforms provided to it by `ike-scan` are acceptable'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`1 returned handshake; 0 returned notify`: As shown in the previous screenshot,
    this indicates that the target is configured for IPSec and will perform an IKE
    negotiation against one or more of the transforms that have been provided to it'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fingerprinting the VPN gateway
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'If you can establish a handshake with the VPN gateway, you can conduct the
    fingerprinting of the device to return the following information:'
  prefs: []
  type: TYPE_NORMAL
- en: The vendor and model
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The software version
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This information is used to identify a vendor-specific attack or fine tune a
    generic attack.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If VPN is hosted by a firewall, the fingerprinting will also identify the firewall
    in use.
  prefs: []
  type: TYPE_NORMAL
- en: Because IKE does not guarantee the reliability for transmitted packets, most
    VPN gateway vendors use a proprietary protocol to deal with traffic that appears
    to be lost. The `ike-scan` tool sends IKE probe packets to the VPN gateway, but
    it does not reply to the response that it receives. The server responds as if
    the packets have been lost and implements its backoff strategy to resend the packets.
    By analyzing the time difference between the packets and the amount of retries,
    `ike-scan` can fingerprint the vendor.
  prefs: []
  type: TYPE_NORMAL
- en: In the example shown in the following screenshot, the `–M` option causes each
    payload to be shown on a separate line, making the output easier to read. The
    `-showbackoff` option (as shown in the following screenshot) of `ike-scan` records
    the response time of all the packets that were sent and received and then records
    the delays for 60 seconds before displaying the results.
  prefs: []
  type: TYPE_NORMAL
- en: '![Fingerprinting the VPN gateway](img/3121OS_10_21.jpg)'
  prefs: []
  type: TYPE_IMG
- en: In the previous screenshot, the **Vendor ID** (**VID**) is an MD5 hash text
    string that is specific to the vendor and is used to recognize a proprietary communication
    or specific communications details.
  prefs: []
  type: TYPE_NORMAL
- en: The `ike-scan` tool can also be used to determine whether the gateway supports
    the aggressive mode. If it does, it can be difficult to establish the handshake
    with the server, because it will not respond until a valid ID is supplied as part
    of the identification payload.
  prefs: []
  type: TYPE_NORMAL
- en: Capturing pre-shared keys
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `ike-scan` tool can be used to push a VPN gateway into the aggressive mode.
    This is significant because the aggressive mode of IPSec does not protect the
    pre-shared keys. The authentication credentials are sent as cleartext, which can
    be captured and then cracked using offline tools.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following example, issued against a Cisco VPN concentrator, uses the following
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE73]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Capturing pre-shared keys](img/3121OS_10_22.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'If you wish to pipe the results to a text file for additional analysis and
    offline password cracking, use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE74]'
  prefs: []
  type: TYPE_PRE
- en: Performing offline PSK cracking
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before cracking the captured hash of the pre-shared key using an offline tool,
    edit the output file to include only the hash value (it should contain nine colon-separated
    values). The most effective tool to crack the key is `psk-crack`, which supports
    the dictionary, brute force, and hybrid-mode cracking.
  prefs: []
  type: TYPE_NORMAL
- en: '![Performing offline PSK cracking](img/3121OS_10_23.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Like all offline cracking exercises, success is a measure of the work and the
    effort involved (the time, computational effort, and investment of energy on power
    systems). A strong pre-shared key, such as the one shown in the previous screenshot,
    will take a long time to crack.
  prefs: []
  type: TYPE_NORMAL
- en: Identifying default user accounts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Like most other hardware devices, VPN gateways usually contain default user
    accounts at the time of the installation. These may not be changed by the administrator.
    Using the information gathered during the fingerprinting process, a tester can
    conduct a web search to identify the standard user accounts.
  prefs: []
  type: TYPE_NORMAL
- en: If the tester has access to a user's computer, the username credential is usually
    stored as plaintext in the system registry. Furthermore, if a tester has access
    to a system's memory, it is possible to obtain the password directly from the
    client system's memory dump.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**VulnVPN** ([www.rebootuser.com](http://www.rebootuser.com)) is a virtual
    operating system and vulnerable VPN server. It allows you to apply the tools described
    in this chapter to compromise the application and gain root access without damaging
    a production system.'
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we examined how to exploit common remote access applications,
    including ones that have been encrypted to provide additional security. We exploited
    operating system communications protocols (RDP and SSH) and applications such
    as VNC. We also learned how to conduct reconnaissance of secure socket layer connections
    and virtual private networks and attack types that reduce the effectiveness of
    encryption.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will see the result of combined attacks against specific
    communications channels with attacks against human beings. In examining the effectiveness
    of these client-side exploits, we will review several types of attacks as well
    as the **Browser Exploitation Framework** (**BeEF**) project.
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 11. Client-side Exploitation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The greatest challenge for an attacker or an effective penetration tester is
    to bypass a target's security controls to achieve a compromise. This can be difficult
    when targeting systems located on a network because the attacker usually needs
    to bypass firewalls, proxies, intrusion detection systems, and other elements
    of a defense-in-depth architecture.
  prefs: []
  type: TYPE_NORMAL
- en: A successful workaround strategy is to directly target the client-side applications.
    The user initiates the interaction with the client application, allowing attackers
    to take advantage of the existing trust that exists between the user and the application.
    The use of social engineering methodologies will enhance the success of client-side
    attacks.
  prefs: []
  type: TYPE_NORMAL
- en: Client-side attacks target systems that typically lack the security controls
    (especially, firewalls and intrusion detection systems) found on enterprise systems.
    If these attacks are successful and persistent communication is established, the
    client device can be used to launch attacks if it is reattached to the target's
    network.
  prefs: []
  type: TYPE_NORMAL
- en: 'By the end of this chapter, you will have learned how to attack client-side
    applications using the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Hostile script attacks (VBScript and PowerShell)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Cross-Site Scripting Framework
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Browser Exploitation Framework
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Attacking a system using hostile scripts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Client-side scripts, such as JavaScript, VBScript, and PowerShell, were developed
    to move application logic and actions from the server to the client''s computer.
    From an attacker''s or tester''s perspective, there are several advantages of
    using these scripts, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: They're already part of the target's natural operating environment; the attacker
    does not have to transfer large compilers or other helper files such as encryption
    applications to the target system.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Scripting languages are designed to facilitate computer operations such as configuration
    management and system administration. For example, they can be used to discover
    and alter system configurations, access the registry, execute programs, access
    network services and databases, and move binary files via HTTP or e-mail. Such
    standard scripted operations can be readily adopted for use by testers.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Because they are native to the operating system environment, they do not usually
    trigger antivirus alerts.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: They are easy to use since writing a script requires a simple text editor. There
    are no barriers to using scripts in order to launch an attack.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Historically, JavaScript was the scripting language of choice to launch attacks
    due to its widespread availability on most target systems. Because JavaScript
    attacks have been well characterized, we''ll focus on how Kali facilitates attacks
    using newer scripting languages: VBScript and PowerShell.'
  prefs: []
  type: TYPE_NORMAL
- en: Conducting attacks using VBScript
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Visual Basic Scripting Edition** (**VBScript)** is an **Active Scripting
    language** developed by Microsoft. It was designed to be a lightweight, Windows-native
    language that could execute small programs. VBScript has been installed by default
    on every desktop release of Microsoft Windows since Windows 98, making it an excellent
    target for client-side attacks.'
  prefs: []
  type: TYPE_NORMAL
- en: 'To launch an attack using VBScript, we''ll invoke Metasploit''s `msfpayload`
    from the command line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE75]'
  prefs: []
  type: TYPE_PRE
- en: 'Note that `V` designates that the output will be a VBS macro script. The output
    will appear as a text file with two specific parts, as shown in the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Conducting attacks using VBScript](img/3121OS_11_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: To use the script, open a Microsoft Office document and create a macro (the
    specific command will depend on the version of Microsoft Windows in use). Copy
    the first part of the text given in the following information box (from `Sub Auto_Open()`
    to the final `End Sub`) into the macro editor and save it with macros enabled.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE76]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, copy the shellcode into the actual document. A partial excerpt of the
    shellcode is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Conducting attacks using VBScript](img/3121OS_11_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The shellcode is recognizable as a script that may be used to perform an attack,
    so you may wish to hide or otherwise obfuscate the shellcode by minimizing the
    font size and making the color match the document's background.
  prefs: []
  type: TYPE_NORMAL
- en: The attacker must set up a listener on Metasploit. After entering `msfconsole`
    at a command prompt, the attacker will typically enter the following commands
    and set the options for host, port, and payload; in addition, the attacker will
    configure the connection to automatically migrate to the more stable `explorer.exe`
    process, as shown in the following command lines.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE77]'
  prefs: []
  type: TYPE_PRE
- en: When the file is sent to the target, it will launch a pop-up security warning
    when it is opened; therefore, attackers will use social engineering to force the
    intended victim to select the **Enable** option. One of the most common methods
    to do this is to embed the macro in a Microsoft Word document or Excel spreadsheet
    that has been configured to play a game.
  prefs: []
  type: TYPE_NORMAL
- en: Launching the document will create a reverse TCP shell back to the attacker,
    allowing the attacker to ensure a persistent connection with the target and conduct
    post-exploit activities.
  prefs: []
  type: TYPE_NORMAL
- en: To extend this attack methodology, we can convert any executable to VBScript
    using `exe2vba.rb` located at `/usr/share/metasploit-framework/tools`.
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, first create a backdoor using the Metasploit framework. Note that
    `X` designates that the backdoor will be created as an executable (`attack.exe`),
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Conducting attacks using VBScript](img/3121OS_11_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, execute `exe2.vba` to convert the executable to VBScript using the following
    command (ensure that correct pathnames are used):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE78]'
  prefs: []
  type: TYPE_PRE
- en: This will allow the executable to be placed in a Microsoft macro-enabled document
    and sent to a client. VBScript can be used to execute the reverse shell and to
    alter the system registry in order to ensure that the shell remains persistent.
    We have found attacks of this type to be one of the most effective ways to bypass
    network security controls and maintain a connection to a secured network.
  prefs: []
  type: TYPE_NORMAL
- en: 'From an attacker''s perspective, there are some significant advantages of using
    exploits based on VBScript (this continues to be a powerful tool). However, its
    use is rapidly being replaced by a more powerful scripting language: PowerShell.'
  prefs: []
  type: TYPE_NORMAL
- en: Attacking systems using Windows PowerShell
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Windows PowerShell is a command-line shell and scripting language intended to
    be used for system administration. Based on the .NET framework, it extends the
    capabilities that were available in VBScript. The language itself is quite extensible.
    Since it is built on .NET libraries, you can incorporate code from languages such
    as C# or VB.NET. You can also take advantage of third-party libraries. In spite
    of this extensibility, it is a concise language. VBScripts that require more than
    100 lines of code can be reduced to as little as 10 lines of PowerShell!
  prefs: []
  type: TYPE_NORMAL
- en: Perhaps, the best feature of PowerShell is that it is available by default on
    most modern Windows-based operating systems (Windows 7 and higher versions) and
    cannot be removed.
  prefs: []
  type: TYPE_NORMAL
- en: We will use PowerShell scripts included with the Metasploit Framework to support
    the attack phase of the kill chain.
  prefs: []
  type: TYPE_NORMAL
- en: 'To launch the attack, we will use the PowerShell Payload Web Delivery module
    of the Metasploit Framework. The purpose of this module is to rapidly establish
    a session on the target system. The attack does not write to the disk, so it is
    less likely to trigger detection by the client-side antivirus. Launching of the
    attack and the available module options are shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Attacking systems using Windows PowerShell](img/3121OS_11_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The Metasploit Framework will generate a one-line macro that can be embedded
    in a document and used to launch the attack, as shown in the following sample
    code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE79]'
  prefs: []
  type: TYPE_PRE
- en: 'Before the attack is completed, the attacker must prepare a listener for the
    incoming shell (`URIPATH` was generated randomly by Metasploit; make sure that
    the correct `URIPATH` is set for the listener). The commands to create a listener
    are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE80]'
  prefs: []
  type: TYPE_PRE
- en: A successful attack will create an interactive shell on the attacker's system.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'It is possible to make `psh_web_delivery` persistent using the `schtask` command.
    The following command will create a scheduled task, `MSOfficeMngmt`, which will
    implement `powershell.exe` (by default, located in the `Windows\system32` directory)
    at logon:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE81]'
  prefs: []
  type: TYPE_PRE
- en: Additional PowerShell scripts designed to support post-exploit activities can
    be found in Kali's PowerSploit directory. In spite of the flexibility of PowerShell,
    it has some disadvantages.
  prefs: []
  type: TYPE_NORMAL
- en: For example, if the document containing the macro is closed by the end user
    before a persistence mechanism can be applied, the connection is lost.
  prefs: []
  type: TYPE_NORMAL
- en: More importantly, scripts such as VBScript and PowerShell are only useful against
    Microsoft environments. To extend the reach of client-side attacks, we need to
    look for a common client-side vulnerability that can be exploited regardless of
    its operating system environment. One particular example of such a vulnerability
    is cross-site scripting.
  prefs: []
  type: TYPE_NORMAL
- en: The Cross-Site Scripting Framework
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Cross-Site Scripting** (**XSS**) vulnerabilities are reportedly the most
    common exploitable vulnerabilities found in websites. It is estimated that they
    are present in up to 80 percent of all applications.'
  prefs: []
  type: TYPE_NORMAL
- en: XSS vulnerabilities occur when an application, usually web-based, violates the
    concept of trust known as the **same-origin policy** and displays content that
    has been provided by a user that has not been sanitized to remove malicious statements.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are at least two primary types of XSS vulnerabilities: **non-persistent**
    and **persistent**.'
  prefs: []
  type: TYPE_NORMAL
- en: The most common type is non-persistent or reflected vulnerabilities. These occur
    when the data provided by the client is used immediately by the server to display
    a response. An attack of this vulnerability can occur via e-mail or a third-party
    website providing a URL that appears to reference a trusted website but contains
    the XSS attack code. If the trusted site is vulnerable to this particular attack,
    executing the link can cause the victim's browser to execute a hostile script
    that may lead to a compromise.
  prefs: []
  type: TYPE_NORMAL
- en: Persistent (stored) XSS vulnerabilities occur when the data provided by the
    attacker is saved by the server and then is permanently displayed on trusted web
    pages to other users during the course of their browsing. This commonly occurs
    with online message boards and blogs that allow users to post HTML-formatted messages.
    An attacker can place a hostile script on the web page that is not visible to
    incoming users, but which compromises visitors who access the affected pages.
  prefs: []
  type: TYPE_NORMAL
- en: Several tools exist on Kali Linux to find XSS vulnerabilities, including **xsser**
    and various vulnerability scanners. However, there are some tools that allow a
    tester to fully exploit an XSS vulnerability, demonstrating the gravity of the
    weakness.
  prefs: []
  type: TYPE_NORMAL
- en: 'The **Cross-Site Scripting Framework** (**XSSF**) is a multiplatform security
    tool that exploits XSS vulnerabilities to create a communication channel with
    the target, supporting attack modules that include:'
  prefs: []
  type: TYPE_NORMAL
- en: Conducting reconnaissance of a target browser (fingerprinting and previously
    visited URLs), the target host (detecting virtual machines, getting system info,
    registry keys, and wireless keys), and the internal network.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Sending an alert message pop up to the target. This simple "attack" can be used
    to demonstrate the XSS vulnerability, however, more complex alerts can mimic logon
    prompts and capture user authentication credentials.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Stealing cookies that enable an attacker to impersonate the target.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Redirecting the target to view a different web page. A hostile web page may
    automatically download an exploit onto the target system.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Loading PDF files or Java applets onto the target, or stealing data such as
    SD card contents from Android mobile devices.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Launching Metasploit attacks, including `browser_autopwn`, as well as denial-of-service
    attacks.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Launching social engineering attacks, including autocomplete theft, clickjacking,
    Clippy, fake flash updates, phishing, and tabnabbing.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In addition, the **XSSF Tunnel** function allows an attacker to impersonate
    the victim and browse websites using their credentials and session. This can be
    an effective method to access an internal corporate intranet.
  prefs: []
  type: TYPE_NORMAL
- en: The API is well documented, allowing new attack modules to be easily created.
    Because it is written in Ruby, the API integrates with the Metasploit Framework,
    allowing attackers to launch additional attacks.
  prefs: []
  type: TYPE_NORMAL
- en: 'To use XSSF, it must be installed and configured to support an attack using
    the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'XSSF does not come with Kali. First, the user must open a terminal window and
    set the appropriate directory using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE82]'
  prefs: []
  type: TYPE_PRE
- en: 'Install XSSF using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE83]'
  prefs: []
  type: TYPE_PRE
- en: 'Make sure that you use `svn export` instead of `svn checkout`, as the latter
    command will break the existing MSF `svn` files. An excerpt of a successful installation
    is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Cross-Site Scripting Framework](img/3121OS_11_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: From the Metasploit Framework console, load the XSSF plugin using the `load
    xssf` command, as shown in the following screenshot:![The Cross-Site Scripting
    Framework](img/3121OS_11_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Identify the XSSF commands, as shown in the following screenshot, by typing
    `helpxssf`:![The Cross-Site Scripting Framework](img/3121OS_11_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'From the console, access the URLs associated with the plugin using the following
    command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE84]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the previous command is given in the following screenshot,
    as you can see, several URLs are identified:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Cross-Site Scripting Framework](img/3121OS_11_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The most important URL is the XSSF server, which is located on the localhost.
    Several other URLs are identified, including the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '`Generic XSS injection`: This is the target that you are attempting to get
    the victim to click on or execute.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`XSSF test page`: XSSF provides access to a local test page that is susceptible
    to XSS attacks. This can be used to validate attacks and results before launching
    the attacks during actual testing.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`XSSF Tunnel Proxy`: XSSF allows an attacker to surf using the identity of
    a compromised host while retaining their security identity.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`XSSF logs page`: This logs attacks and the information received. Unfortunately,
    the log page provides a very dark background, and it is difficult to see the returned
    information. During testing, we usually access log information via the command
    line, which is cleaner and can be scripted.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`XSSF statistics page`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`XSSF help page`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We'll use the vulnerable web application, **Mutillidae**, to demonstrate that
    the XSSF. Mutillidae is part of the Metasploitable project, which can be downloaded
    from [http://sourceforge.net/projects/metasploitable/files/Metasploitable2/](http://sourceforge.net/projects/metasploitable/files/Metasploitable2/).
    Refer to [Appendix](apa.html "Appendix A. Installing Kali Linux"), *Installing
    Kali Linux* for notes on installing this vulnerable target.
  prefs: []
  type: TYPE_NORMAL
- en: Once Mutillidae is opened, navigate to the blog page; this page is known to
    be vulnerable to XSS (you can use a vulnerability scanning tool against Mutillidae
    to identify other potential insertion points).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To launch the attack against the target client, do not enter a regular posting
    into the blog. Instead, enter script elements that contain the the target URL
    and port:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE85]'
  prefs: []
  type: TYPE_PRE
- en: The following screenshot shows the placement of the attack code on the target
    website's blog page.
  prefs: []
  type: TYPE_NORMAL
- en: '![The Cross-Site Scripting Framework](img/3121OS_11_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'When this is entered and the victim clicks on **Save Blog Entry**, their system
    will be compromised. From the Metasploit Framework console, the tester can get
    information about each victim using the `xssf_victims` and `xssf_information`
    commands. On executing the `xssf_victims` command, information about each victim
    is displayed, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Cross-Site Scripting Framework](img/3121OS_11_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The most common XSS attack at this point is to send a brief and relatively
    innocuous message or *alert* to the client. Using the Metasploit Framework, this
    can be achieved relatively simply by entering the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE86]'
  prefs: []
  type: TYPE_PRE
- en: 'After reviewing the options, an alert can be rapidly sent from the command
    line, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Cross-Site Scripting Framework](img/3121OS_11_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The victim will see a message, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Cross-Site Scripting Framework](img/3121OS_11_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Generally, most testers and their clients validate cross-site scripting using
    such simple alert messages. These prove that a "vulnerability" exists.
  prefs: []
  type: TYPE_NORMAL
- en: However, simple alerts lack emotional impact. Frequently, they identify a real
    vulnerability, but the client does not respond and mediate the vulnerability because
    alert messages are not perceived to be a significant threat. Fortunately, XSSF
    allows testers to "up the ante" and demonstrate more sophisticated and dangerous
    attacks.
  prefs: []
  type: TYPE_NORMAL
- en: 'XSSF can be used to steal cookies by using the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE87]'
  prefs: []
  type: TYPE_PRE
- en: 'The execution of the `run` command is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Cross-Site Scripting Framework](img/3121OS_11_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'When the attack has been completed, the cookie can be found by reviewing the
    results on the XSSF logs page or directly from the command line using the command,
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Cross-Site Scripting Framework](img/3121OS_11_14.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Some other useful commands in `auxiliary/xssf/public/misc` include:'
  prefs: []
  type: TYPE_NORMAL
- en: '`check_connected`: This command checks whether the victim has opened any social
    networking sites (Gmail, Facebook, or Twitter)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`csrf`: It launches a cross-site request forgery attack'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`keylogger`: This command invokes a keylogger on the client side'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`load_applet` and `load_pdf`: These commands load hostile Java applets and
    PDF files on the client side and invoke them to launch preconfigured malicious
    software'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`redirect`: It redirects the client to a specified web page'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`webcam_capture`: This command captures images from the client''s webcam'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This is an incomplete list, but it shows the extent to which the tool has been
    developed. Also, there are some modules for network scanning and launching a denial-of-service
    attack, as well as some modules to ensure persistence after an attack has been
    completed.
  prefs: []
  type: TYPE_NORMAL
- en: 'XSSF can also be used with ettercap to compromise an internal network. For
    example, ettercap can be used to replace the `</head>` data with a link to the
    malicious page by placing the following code in a filter named `attack`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE88]'
  prefs: []
  type: TYPE_PRE
- en: 'The filter script must then be converted into a binary file using the following
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE89]'
  prefs: []
  type: TYPE_PRE
- en: 'To launch this attack against all of the users on a network, execute `ettercap`
    with the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE90]'
  prefs: []
  type: TYPE_PRE
- en: 'XSSF, especially when integrated into the Metasploit Framework, is a very powerful
    tool for exploiting XSS vulnerabilities. However, a new star has recently emerged
    that can help you to achieve similar attacks: the Browser Exploitation Framework.'
  prefs: []
  type: TYPE_NORMAL
- en: The Brower Exploitation Framework – BeEF
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'BeEF is an exploitation tool that focuses on a specific client-side application:
    the web browser.'
  prefs: []
  type: TYPE_NORMAL
- en: BeEF allows an attacker to inject a JavaScript code into a vulnerable HTML code
    using an attack such as XSS or SQL injection. This exploit code is known as **hook**.
    A compromise is achieved when the hook is executed by the browser. The browser
    (**zombie**) connects back to the BeEF application, which serves JavaScript commands
    or modules to the browser.
  prefs: []
  type: TYPE_NORMAL
- en: 'BeEF''s modules perform tasks such as the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Fingerprinting and the reconnaissance of compromised browsers. It can also be
    used as a platform to assess the presence of exploits and their behavior under
    different browsers.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that BeEF allows us to hook multiple browsers on the same client, as well
    as multiple clients across a domain, and then manage them during the exploitation
    and post-exploitation phases.
  prefs: []
  type: TYPE_NORMAL
- en: Fingerprinting the target host, including the presence of virtual machines.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Detecting software on the client (Internet Explorer only) and obtaining a list
    of the directories in the `Program Files` and `Program Files (x86)` directories.
    This may identify other applications that can be exploited to consolidate our
    hold on the client.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Taking photos using the compromised system's webcam; these photos have a significant
    impact in reports.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Conducting searches of the victim's data files and stealing data that may contain
    authentication credentials (clipboard content and browser cookies) or other useful
    information.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Implementing browser keystroke logging.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Conducting network reconnaissance using ping sweeps and fingerprint network
    appliances and scanning for open ports.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Launching attacks from the Metasploit Framework.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using the tunneling proxy extension to attack the internal network using the
    security authority of the compromised web browser.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Because BeEF is written in Ruby, it supports multiple operating systems (Linux,
    Windows, and OS X). More importantly, it is easy to customize new modules in BeEF
    and extend its functionality.
  prefs: []
  type: TYPE_NORMAL
- en: Installing and configuring the Browser Exploitation Framework
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'BeEF is not a part of the Kali distribution, however, it has been packaged
    with required dependencies to support automated installation in Kali. To install
    BeEF, use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE91]'
  prefs: []
  type: TYPE_PRE
- en: 'BeEF will be installed in the /`usr/share/beef-xss` directory. By default,
    it is not integrated with the Metasploit Framework. To integrate BeEF, you will
    need to perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Edit the main configuration file located at `/usr/share/beef-xss/config.yaml`
    to read:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE92]'
  prefs: []
  type: TYPE_PRE
- en: Edit the file located at `/usr/share/beef-xss/extensions/metasploit/config.yml`.
    You need to edit the lines `host`, `callback_host`, and `os 'custom', path` to
    include your IP address and the location for the Metasploit Framework A correctly
    edited `config.yml` file is shown in the following screenshot:![Installing and
    configuring the Browser Exploitation Framework](img/3121OS_11_15.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Start `msfconsole`, and load the `msgrpc` module, as shown in the following
    screenshot. Make sure that you include the password as well:![Installing and configuring
    the Browser Exploitation Framework](img/3121OS_11_16.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Start BeEF using the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE93]'
  prefs: []
  type: TYPE_PRE
- en: Confirm startup by reviewing the messages generated during program launch. They
    should indicate that **Successful connection with Metasploit** occurred, which
    will be accompanied with an indication that Metasploit exploits have been loaded.
    A successful program launch is shown in the following screenshot:![Installing
    and configuring the Browser Exploitation Framework](img/3121OS_11_17.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When you restart BeEF, use the `-x` switch to reset the database.
  prefs: []
  type: TYPE_NORMAL
- en: In this example, the BeEF server is running on `192.168.222.129` and the "hook
    URL" (the one that we want the target to activate) is `192.168.222.129:80/hook.js`.
  prefs: []
  type: TYPE_NORMAL
- en: Most of the administration and management of BeEF is done via the web interface.
    To access the control panel, go to `http://<IP Address>:3000/ui/panel`.
  prefs: []
  type: TYPE_NORMAL
- en: The default login credentials are `Username:beef` and `Password:beef`, as shown
    in the following screenshot, unless these were changed in `config.yaml`.
  prefs: []
  type: TYPE_NORMAL
- en: '![Installing and configuring the Browser Exploitation Framework](img/3121OS_11_18.jpg)'
  prefs: []
  type: TYPE_IMG
- en: A walkthrough of the BeEF browser
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'When the BeEF control panel is launched, it will present the **Getting Started**
    screen, featuring links to the online site as well as the demonstration pages
    that can be used to validate the various attacks. The BeEF control panel is shown
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![A walkthrough of the BeEF browser](img/3121OS_11_19.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'If you have hooked a victim, the interface will be divided into two panels:'
  prefs: []
  type: TYPE_NORMAL
- en: On the left-hand side of the panel, **Hooked Browsers**, the tester can see
    every connected browser listed with information about its host operating system,
    browser type, IP address, and installed plugins. Because BeEF sets a cookie to
    identify victims, it can refer back to this information and maintain a consistent
    list of victims.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The right-hand side of the panel is where all of the actions are initiated and
    the results are obtained. In the **Commands** tab, we see a categorized repository
    of the different attack vectors that can be used against hooked browsers. This
    view will differ based on the type and version of each browser.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'BeEF uses a color-coding scheme to characterize the commands on the basis of
    their usability against a particular target. The colors used are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Green**: This indicates that the command module works against the target
    and should be detected by the victim'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Orange**: This indicates that the command module works against the target,
    but it may be detected by the victim'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Gray**: This indicates that the command module is not yet verified against
    the target'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Red**: This indicates that the command module does not work against the target.
    It can be used, but its success is not guaranteed, and its use may be detected
    by the target'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Take these indicators with a grain of salt since variations in the client environment
    can make some commands ineffective, or may cause other unintended results.
  prefs: []
  type: TYPE_NORMAL
- en: 'To start an attack or hook a victim, we need to get the user to click on the
    hook URL, which takes the form of `<IP ADDRESS>:<PORT>/hook.js`. This can be achieved
    using a variety of means, including:'
  prefs: []
  type: TYPE_NORMAL
- en: The original XSS vulnerabilities
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Man-in-the-middle attacks (especially, those using **BeEF Shank**, **an ARP**
    spoofing tool that specifically targets intranet sites on internal networks)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Social engineering attacks, including the BeEF web cloner and mass e-mailer,
    custom hook point with iFrame impersonation, or the QR code generator
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Once the browser has been hooked, it is referred to as a zombie. Select the
    IP address of the zombie from the **Hooked Browsers** panel on the left-hand side
    of the command interface and then refer to the available commands.
  prefs: []
  type: TYPE_NORMAL
- en: In this example shown in the following screenshot, there are several different
    attacks and management options available for the hooked browser. One of the easiest
    attack options to use is the social engineering Clippy attack.
  prefs: []
  type: TYPE_NORMAL
- en: When **Clippy** is selected from the **Module Tree** under **Commands**, a specific
    **Clippy** panel is launched on the far right, as shown in the following screenshot.
    It allows you to adjust the image, the text delivered, and the executable that
    will be launched locally if the victim clicks on the supplied link. By default,
    the custom text informs the victim that their browser is out of date, offers to
    update it for them, downloads an executable (non-malicious), and then thanks the
    user for performing the upgrade. All of these options can be changed by the tester.
  prefs: []
  type: TYPE_NORMAL
- en: '![A walkthrough of the BeEF browser](img/3121OS_11_20.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'When Clippy is executed, the victim will see a message as shown in the following
    screenshot on their browser:'
  prefs: []
  type: TYPE_NORMAL
- en: '![A walkthrough of the BeEF browser](img/3121OS_11_21.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This can be a very effective social engineering attack. When testing with clients,
    we have had success rates (the client downloaded a non-malicious indicator file)
    of approximately 70 percent.
  prefs: []
  type: TYPE_NORMAL
- en: The prompt module works in a similar manner. Instead of sending a simple alert
    to the victim's browser, it sends a notification request prompting the victim
    to enter data. In many cases, if the victim is prompted for undefined data, they
    will automatically re-enter their password. The prompt can ask for specific data,
    or it can be used to direct the victim to a website to download a system patch
    that contains malware. The following screenshot shows one of the simplest, and
    most effective attacks for obtaining a user's password.
  prefs: []
  type: TYPE_NORMAL
- en: '![A walkthrough of the BeEF browser](img/3121OS_11_22.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'One of the more interesting attacks is Pretty Theft, which asks users for their
    username and password for popular sites. For example, the Pretty Theft option
    for Facebook can be configured by the tester, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![A walkthrough of the BeEF browser](img/3121OS_11_23.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'When the attack is executed, the victim is presented with a pop up that appears
    to be legitimate, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![A walkthrough of the BeEF browser](img/3121OS_11_24.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'In BeEF, the tester reviews the history log for the attack and can derive the
    username and password from the **data** field in the **Command results** column,
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![A walkthrough of the BeEF browser](img/3121OS_11_25.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Integrating BeEF and Metasploit attacks
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Both BeEF and the Metasploit Framework were developed using Ruby and can operate
    together to exploit a target. Because it uses client-side and server-side fingerprinting
    to characterize a target, `browser_autopwn` is one of the most successful attacks.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once the target has been hooked, start the Metasploit console and configure
    the attack using the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE94]'
  prefs: []
  type: TYPE_PRE
- en: 'Wait until all of the relevant exploits have finished loading. In the example
    shown in the following screenshot, 18 exploits are loaded. Note the target URL
    for the attack as well. In this example, the target URL is `http://192.168.43.130:8080/ICprp4Tnf4Z`:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Integrating BeEF and Metasploit attacks](img/3121OS_11_26.jpg)'
  prefs: []
  type: TYPE_IMG
- en: There are several methods to direct a browser to click on a targeted URL, however,
    if we have already hooked the target browser, we can use BeEF's `redirect` function.
    In the BeEF control panel, go to **Browser** | **Hooked Domain** | **Redirect
    Browser**. When prompted, use this module to point to the target URL and then
    execute the attack.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the Metasploit console, you will see the selected attacks being successively
    launched against the target. A successful attack will open a Meterpreter session,
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Integrating BeEF and Metasploit attacks](img/3121OS_11_27.jpg)'
  prefs: []
  type: TYPE_IMG
- en: To see the list of open sessions with the compromised target, type `sessions
    -l`. To interactively connect with a specific session, for example, session 1,
    type `sessions -i 1`.
  prefs: []
  type: TYPE_NORMAL
- en: Using BeEF as a tunneling proxy
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Tunneling is the process of encapsulating a payload protocol inside a delivery
    protocol, such as IP. Using tunneling, you can transmit incompatible protocols
    across a network, or you can bypass firewalls that are configured to block a particular
    protocol. BeEF can be configured to act as a tunneling proxy that mimics a reverse
    HTTP proxy: the browser session becomes the tunnel, and the hooked browser is
    the exit point. This configuration is extremely useful when an internal network
    has been compromised because the tunneling proxy can be used to:'
  prefs: []
  type: TYPE_NORMAL
- en: Browse authenticated sites in the security context (client-side SSL certificates,
    authentication cookies, NTLM hashes, and so on) of the victim's browser
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Spider the hooked domain using the security context of the victim's browser
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Facilitate the use of tools such as SQL injection
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To use the tunneling proxy, select the hooked browser that you wish to target
    and right-click on its IP address. In the pop-up box, as shown in the following
    screenshot, select the **Use as Proxy** option:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using BeEF as a tunneling proxy](img/3121OS_11_28.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Configure a browser to use the BeEF tunneling proxy as an HTTP proxy. By default,
    the address of the proxy is `127.0.0.1` and port is 6789.
  prefs: []
  type: TYPE_NORMAL
- en: If you visit a targeted website using the browser configured as the HTTP proxy,
    all raw request/response pairs will be stored in the BeEF database, which can
    be analyzed by navigating to **Rider** | **History** (an excerpt of the log is
    shown in the following screenshot).
  prefs: []
  type: TYPE_NORMAL
- en: '![Using BeEF as a tunneling proxy](img/3121OS_11_29.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Once an attack has been completed, there are some mechanisms to ensure that
    a persistent connection is retained, including:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Confirm close**: A module that presents the victim with a **Confirm Navigation
    - are you sure you want to leave this page** pop up when they try to close a tab.
    If the user elects to **Leave this Page**, it will not be effective, and the **Confirm
    Navigation** pop up will continue to present itself.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Pop-under module**: This is configured to autorun in `config.yaml`. This
    module attempts to open a small pop-under window to keep the browser hooked if
    the victim closes the main browser tab. This may be blocked by pop-up blockers.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**iFrame keylogger**: Rewrites all of the links on a web page to an iFrame
    overlay that is 100 percent of the height and width of the original. For maximum
    effectiveness, it should be attached to a JavaScript keylogger. Ideally, you would
    load the login page of the hooked domain.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Man-in-the-browser**: This module ensures that whenever the victim clicks
    on any link, the next page will be hooked as well. The only way to avoid this
    behavior is to type a new address in the address bar.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Finally, although BeEF provides an excellent series of modules to perform the
    reconnaissance, as well as the exploit and post-exploit phases of the kill chain,
    the known default activities of BeEF `(/hook.js` and server headers) are being
    used to detect attacks, reducing its effectiveness. Testers will have to obfuscate
    their attacks using techniques such as Base64 encoding, whitespace encoding, randomizing
    variables, and removing comments to ensure full effectiveness in the future.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we examined the attacks against systems that are generally
    isolated from protected networks. These client-side attacks focus on the vulnerabilities
    in specific applications. We reviewed hostile scripts, especially VBScript and
    PowerShell, which are particularly useful in testing and compromising Windows-based
    networks. We then examined the Cross-Site Scripting Framework, which can compromise
    XSS vulnerabilities, as well as the BeEF tool, which targets the vulnerabilities
    in a web browser. Both XSSF and BeEF integrate with reconnaissance, exploitation,
    and post-exploitation tools on Kali to provide comprehensive attack platforms.
  prefs: []
  type: TYPE_NORMAL
- en: This chapter concludes *Mastering Kali Linux for Advanced Penetration Testing*.
    We hope that this book has helped you to understand how attackers use tools such
    as Kali to compromise networks, and how you can use the same tools to understand
    your network's vulnerabilities and mediate them before your own network is compromised.
  prefs: []
  type: TYPE_NORMAL
- en: Appendix A. Installing Kali Linux
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Kali Linux is a Linux-based operating system that acts as a platform to support
    several hundred different applications used to audit the security of a network.
    Its complexity is matched by the diversity of methods to install and use it during
    testing. This chapter will cover some of the considerations to be made when installing
    Kali, and will focus on how to get a secure virtual machine up and running as
    quickly as possible. It will also examine how to set up and maintain an inexpensive
    site to test the material covered in this book.
  prefs: []
  type: TYPE_NORMAL
- en: Downloading Kali Linux
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are multiple options for downloading and installing Kali Linux. At the
    time of this publication, the most recent Version is release 1.06; however, Version
    1.07 is due for imminent release. The current version is available from the official
    website ([www.kali.org/downloads/](http://www.kali.org/downloads/)) in 32- and
    64-bit compilations.
  prefs: []
  type: TYPE_NORMAL
- en: '**Offensive Security** has made the preconfigured version of **Advanced RISC
    Machines** (**ARM**), processors (for example, Galaxy Note 10.1, Raspberry Pi,
    and Samsung Chromebooks) available for download; both ARMEL and ARMHL platforms
    are supported. In addition, premade VMware images are also available online at
    [http://www.offensive-security.com/kali-llnux-vmware-arm-image-download/](http://www.offensive-security.com/kali-llnux-vmware-arm-image-download/).'
  prefs: []
  type: TYPE_NORMAL
- en: After you have downloaded the appropriate image, ensure that the SHA1 checksum
    file was generated by Kali (it will be signed using the official Kali encryption
    key, which is available online to verify the authenticity of the download), and
    inspect the SHA1 checksum to verify the integrity of the image. Verification tools
    are built into Linux and OSX operating systems; however, you will have to use
    a third-party tool such as **hashtab** ([http://www.implbits.com/HashTab/HashTabWindows.aspx](http://www.implbits.com/HashTab/HashTabWindows.aspx))
    for Windows operating systems.
  prefs: []
  type: TYPE_NORMAL
- en: If you wish to build a custom version of Kali, especially one that features
    an alternate desktop or toolset, you can use the live-build scripts available
    at [http://docs.kali.org/live-build/generate-updated-kali-iso](http://docs.kali.org/live-build/generate-updated-kali-iso).
  prefs: []
  type: TYPE_NORMAL
- en: Basic Installation of Kali Linux
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Once you have obtained a suitable distribution of Kali Linux, it must be installed
    for use. The following installation options are available:'
  prefs: []
  type: TYPE_NORMAL
- en: Install to an i386, AMD64, or ARM system hard drive. Kali Linux will be the
    sole host operating system when the device boots up.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dual-boot a system. Usually, this option is selected when using an MS Windows
    operating system. During boot-up, the user has the option to boot the system as
    Kali Linux or as the Windows operating system. This offers more flexibility than
    installing Kali directly to the hard drive; however, it does make switching back
    and forth between the two systems difficult.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Install directly to a DVD drive or a USB device. This is especially useful if
    the host system can be configured to boot from the USB device; however, additional
    configuration changes are required if the USB device needs to be *persistent*
    (retains all changes to the based operating system, applications, and data that
    are made during the testing process).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Install as a virtual machine using products such as VMware or VirtualBox. We
    have found this to be the most flexible option to support penetration testing.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Kali supports two types of network installs—the **mini ISO** install and the
    **network PXE** install. The mini ISO installs a truncated Kali distribution on
    a system and then relies on a fast network connection to install the remainder
    of the applications needed for an effective final product. The network PXE install
    supports terminals (no CD-ROM and no USB ports) during the booting process, obtaining
    the IP address information and installing Kali.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Kali can now be used from the cloud—a 64-bit minimal image of Kali is available
    from the Amazon EC2 marketplace ([https://aws.amazon.com/marketplace/pp/B00HW50E0M](https://aws.amazon.com/marketplace/pp/B00HW50E0M)).
    The Kali image is free, and users are only charged for regular AWS usage.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Due to Amazon's regulations, this version of Kali does not use the root account
    by default. Once you have obtained your SSH key from Amazon, you have to connect
    to the Kali instance as a user, and then sudo to root. You may have to download
    additional tools to support testing. Finally, you have to inform Amazon that it
    is being used for legitimate security testing and not as an attack tool.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Kali Linux to a virtual machine
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this book, Kali was configured as a **virtual machine** (**VM**). A VM has
    the following advantages when used for penetration testing:'
  prefs: []
  type: TYPE_NORMAL
- en: A common test VM can be developed and maintained, ensuring that testers are
    familiar with the toolset and their impact on typical target systems.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMs facilitate rapid switching between the host and guest operating systems,
    allowing the tester to move between Windows and Linux platforms in order to find
    the optimum mix of tools for testing.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMs are mobile—they can be moved to different systems and operating platforms.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMs can be retained in a library to facilitate regression testing. After a toolset
    has been used to validate the security of a network or system, testers are often
    asked if their methodology and tools would have detected a particular vulnerability
    present at the time of testing. Testers can go back and retest for the vulnerability
    using the archived VM to determine whether it would have been detected or the
    network was at a risk of attacks.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Although premade VMs are available for download, most testers create their own
    using validated ISO images (the process of installing Kali to a VM is almost identical
    to installing it to a hard drive or media, such as a USB key). Kali supports both
    VMware and Oracle VirtualBox VMs.
  prefs: []
  type: TYPE_NORMAL
- en: 'In general, the process is simple and guided by application wizards that walk
    you through the process. When using VMware, for example, the process would be
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Select the **Create a New Virtual Machine** icon to create a new virtual machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose to create the VM using an ISO image.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the guest operating system.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the name and location for the ISO image.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the disk space; the minimum used should be 12 GB, but set aside at least
    20-25 GB. A minimum of 1 GB memory should be made available to the VM; however,
    if you are testing a large network and will be using multithreaded tools, you
    may wish to increase this to at least 3 GB.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Review the hardware configuration.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Make sure that the VM is configured to be visible only to the host operating
    system, especially if it has not been updated. If you are configuring a VM to
    use as a target, beware that if it is visible to the Internet, your test platform
    may be compromised by an external attacker.
  prefs: []
  type: TYPE_NORMAL
- en: Start the VM. The boot menu will provide several options; select **Graphical
    Install**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Follow the prompts to select the normal language, time zone, hostname, and set
    root password.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When setting the disk partition, and if you're not using the dual boot option,
    you can set the full partition as the virtual disk. It is recommended that you
    select this option for full disk encryption at this time.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The VM application will complete partitioning, write the changes to the disk,
    and then install the system files. After prompting for some additional configuration
    information, the VM will reboot.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: At this point, the system is live. Configure to support penetration testing
    as described in [Chapter 1](ch01.html "Chapter 1. Starting with Kali Linux"),
    *Starting with Kali Linux*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Preconfigured distributions of Kali usually rely on the default username and
    password and may have pregenerated SSH host keys. These should be changed as soon
    as possible.
  prefs: []
  type: TYPE_NORMAL
- en: Full disk encryption and nuking the master key
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Penetration testers typically have sensitive information in their possession—a
    successful test can reveal flaws in a client's network, and even the tools used
    to conduct a penetration test may be classified as illegal in some jurisdictions.
    Therefore, testers frequently secure their systems using full-disk encryption.
  prefs: []
  type: TYPE_NORMAL
- en: 'During the partitioning phase of installation to a hard drive or virtual machine,
    Kali can be set to use full-disk encryption using a combination of **Logical Volume
    Management** (**LVM**) and the **Linux Unified Key Setup** (**LUKS**), which is
    the standard application for Linux hard drive encryption. This is shown in the
    following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Full disk encryption and nuking the master key](img/3121OS_Appendix_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Access to the encrypted drive requires a passphrase, and it is recommended that
    the passphrase have a length of 20 or more characters. Unfortunately, given the
    recent emergence of state-sponsored surveillance, there are concerns that testers
    could be compelled to give their passphrase to a government agent, removing the
    benefits of encryption.
  prefs: []
  type: TYPE_NORMAL
- en: The solution is to provide a passphrase that will nuke, or destroy, the master
    key. This will ensure confidentiality, making it impossible to decrypt the drive.
    This capability was recently added to Kali Linux release 1.06.
  prefs: []
  type: TYPE_NORMAL
- en: Kali Linux incorporates LUKS, which is a platform-independent encryption specification
    that allows a user to encrypt partitions on a hard drive. LUKS allows multiple
    user keys to decrypt the master key, allowing multiple users to encrypt and decrypt
    the data, and permits the use of backup keys.
  prefs: []
  type: TYPE_NORMAL
- en: When a LUKS-encrypted container is created, a random master key is generated.
    This master key is encrypted using the passphrase. The advantage of this approach
    is that the passphrase is not directly linked to the data—if two identical volumes
    are encrypted and the same passphrase is used, the master keys remain unique to
    their volume and cannot be swapped.
  prefs: []
  type: TYPE_NORMAL
- en: This means that if the master key is lost or destroyed, it is impossible to
    recover the encrypted data. This property allows us to nuke the recovery of an
    encrypted volume or hard drive by deliberately wiping the master key if a specific
    passphrase is entered. The emergency self-destruction functionality was added
    to Kali Linux release 1.06 and can be implemented using the cryptsetup utility.
  prefs: []
  type: TYPE_NORMAL
- en: 'To use the nuke functionality:'
  prefs: []
  type: TYPE_NORMAL
- en: Install Kali with the **Full Disk Encryption** option. Before Kali is installed,
    all partitions will be erased; this will result in a slow installation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Verify the LUKS header information for the encrypted hard drive using the following
    command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE95]'
  prefs: []
  type: TYPE_PRE
- en: '**Key Slot 0**, associated with the password for the disk encryption, is enabled.
    The remaining key slots are unused. The execution of the previous command is given
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Full disk encryption and nuking the master key](img/3121OS_Appendix_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Add the `Nuke` key using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE96]'
  prefs: []
  type: TYPE_PRE
- en: 'The system will prompt you for the existing passphrase to validate identity
    and then will ask you the new passphrase to be used for the nuke option. Be careful—it
    does not prompt the user to repeat the passphrase twice in order to guard against
    a miskey during entry. The execution of the previous command is shown in the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Full disk encryption and nuking the master key](img/3121OS_Appendix_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: To confirm that the nuke key has been enabled, review the list of available
    key slots, using the command shown in the following screenshot:![Full disk encryption
    and nuking the master key](img/3121OS_Appendix_04.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`Key slot 1` is now enabled; it contains the nuke key.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Back up the keys using the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE97]'
  prefs: []
  type: TYPE_PRE
- en: 'Once the master key file has been backed up, encrypt it and transfer it off
    the system for secure storage. Several applications are available for encryption
    (for example, 7 Zip, bcrypt, ccrypt, and GnuPG), or you can use an internal command
    such as `openssl`. A sample command is as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE98]'
  prefs: []
  type: TYPE_PRE
- en: When the backup file has been secured, your system is protected against forced
    password extraction. If the nuke password is entered, the local copy of the master
    key will be destroyed, making it impossible to access the encrypted files.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you dump the LUKS headers after issuing the nuke password, you will see
    an output as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Full disk encryption and nuking the master key](img/3121OS_Appendix_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'What if you want to restore a drive that you were forced to nuke? As long as
    you can retrieve the encrypted header from the remote storage location, this is
    a simple matter; you will be able to decrypt the hard drive and recover your data.
    Once the encrypted header has been decrypted (using the appropriate decryption
    command based on the method used to protect the file), enter the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE99]'
  prefs: []
  type: TYPE_PRE
- en: 'This will generate the following warning:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE100]'
  prefs: []
  type: TYPE_PRE
- en: When you are prompted, type `YES`. This will replace the header and allow you
    to decrypt the hard drive.
  prefs: []
  type: TYPE_NORMAL
- en: Setting up a test environment
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before testing a production environment, it is important for the tester to fully
    understand how to use the testing tools, the impact that they will have on the
    target system, and how to interpret the data in relation to the activities performed
    against the target.
  prefs: []
  type: TYPE_NORMAL
- en: 'Testing controlled environments frequently produces results that are different
    from same tests when they are run on a production system for several reasons,
    including the following:'
  prefs: []
  type: TYPE_NORMAL
- en: The operating system in the target environment differs from the operating system
    in the test environment, including different versions of the operating system.
    (XP is clearly different from Windows 8.1, but there are also differences between
    Windows 8.1 Pro and Enterprise versions or between 32-bit and 64-bit operating
    system.) Operating system modifications to support local languages can also have
    a significant impact on the presence of vulnerabilities.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The target environment has different service packs, patches, or upgrades applied.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The target environment has different third-party applications installed; these
    can conflict with network traffic, introduce new vulnerabilities, or impact a
    tester's ability to exploit the existing vulnerabilities.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Targets configured as virtual machines in a host environment may react differently
    from target systems installed directly on bare metal.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Targets are protected by various network and system devices and applications.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To obtain the best possible results, testers (and attackers) typically use a
    two-stage testing process. Testers first perform the attack using a well-defined
    virtual machine (such as Windows XP) to determine the most effective attack tools
    and methodologies; once this simple test case is proven, testers revalidate the
    attack using a more complex virtual or physical network that mirrors the target
    network as closely as possible.
  prefs: []
  type: TYPE_NORMAL
- en: Vulnerable operating systems and applications
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Testers usually maintain a library of the current and historical operating systems.
  prefs: []
  type: TYPE_NORMAL
- en: When testing Microsoft operating systems, WinXP is used as the *reference standard*
    to test vulnerabilities. Although Windows XP will be deprecated in 2014 and no
    longer supported by Microsoft, it will remain on many networks in servers and
    workstations as well as embedded in devices such as printers and point-of-sale
    terminals.
  prefs: []
  type: TYPE_NORMAL
- en: When testing vulnerable Windows operating systems, a subscription to MSDN ([http://msdn.microsoft.com/en-ca/subscriptions/aa336858](http://msdn.microsoft.com/en-ca/subscriptions/aa336858))
    is invaluable in order to gain access to current Microsoft products to test in
    the lab.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Do not use operating systems downloaded from public file-sharing services such
    as Torrent sites. DigitalDefence recently evaluated 40 downloads of Microsoft
    operating systems from Torrent sites—every download was infected with a backdoor
    to permit remote access to an attacker.
  prefs: []
  type: TYPE_NORMAL
- en: 'To test older third-party Windows applications that possess specific vulnerabilities,
    testers can access online repositories that retain old copies of the applications;
    many of these include exploitable vulnerabilities. Examples of such repositories
    can be seen at the following links:'
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.oldapps.com](http://www.oldapps.com)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[www.oldversion.com](http://www.oldversion.com)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Due to their open source nature, multiple versions of Unix-like operating systems
    (Linux, BSD, and Solaris) are available for download and testing.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following projects will allow you to test Unix operating system installations
    with known vulnerabilities, you can access:'
  prefs: []
  type: TYPE_NORMAL
- en: Damn Vulnerable Linux ([http://sourceforge.net/projects/virtualhacking/files/os/dvl/](http://sourceforge.net/projects/virtualhacking/files/os/dvl/))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: LAMPSecurity ([http://sourceforge.net/projects/lampsecurity/](http://sourceforge.net/projects/lampsecurity/))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Metasploitable2 ([http://sourceforge.net/projects/virtualhacking/files/os/metasploitable/](http://sourceforge.net/projects/virtualhacking/files/os/metasploitable/))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Older Unix applications with known vulnerabilities are usually available for
    download at the application's website.
  prefs: []
  type: TYPE_NORMAL
- en: 'Complex environments for testing (operating system and vulnerable applications)
    can be downloaded from the VulnHub repository at [http://vulnhub.com](http://vulnhub.com).
    These images are usually accompanied by walk-throughs that demonstrate various
    ways to exploit the images. Some of the images include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '**bWAPP**: This provides several ways to deface a sample website'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VulnVPN**: This allows the tester to exploit the VPN service in order to
    access the server and internal services and gain root access'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VulnVoIP**: This allows the tester to practice reconnaissance and allows
    the exploitation of a VoIP network'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Finally, testers will want to take advantage of some of the vulnerable web-based
    applications that are available for testing.
  prefs: []
  type: TYPE_NORMAL
- en: 'One of the most common testing targets is the Linux image called Metasploitable.
    The base operating system has multiple vulnerabilities; in addition, it loads
    vulnerable web applications when it starts. To access the applications, open Metasploitable
    as a VM and then start a separate VM with Kali Linux. In the Kali VM, open a browser
    and enter the IP address of the Metasploitable VM. You will see the menu options,
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Vulnerable operating systems and applications](img/3121OS_Appendix_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The web-based applications can be useful to support enterprise testing as well
    as specific attacks against web applications. The five applications are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**TWiki**: This is a wiki application that supports enterprise collaboration
    during the testing process; it uses structured content to create simple workflow
    systems'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**phpmyadmin**: Allows remote administration of MySQL databases over the Web'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**webdav**: The **Web-based Distributed Authoring and Versioning** set of extensions
    to the HTTP protocol, which allows users to collaboratively edit and manage files
    on remote web servers'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Mutillidae**: A vulnerable web-hacking application composed of PHP scripts
    that are vulnerable to the top 10 vulnerabilities of OWASP'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: As you can see in the following screen excerpt, the top 10 vulnerabilities are
    available in a drop-down menu. For example, selecting the option **A2 - Cross
    Site Scripting** (**XSS**) gives you access to submenus matched to specific vulnerability
    types (**Reflected**, **Persistent**, **DOM Injection**, and so on).
  prefs: []
  type: TYPE_NORMAL
- en: '![Vulnerable operating systems and applications](img/3121OS_Appendix_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The database specified in the `Mutillidae` configuration file is incorrect,
    and you may receive multiple errors for operations that require database access.
    To fix these, log in to Metasploitable2 and edit the `/var/www/mutillidae/config.inc`
    file; change the `dbname` field from `metasploit` to `owasp10`.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, the Metasploitable framework launches the **Damn Vulnerable Web Application**
    (**DVWA**) that provides a different set of challenges to practice attacks against
    specific vulnerabilities.![Vulnerable operating systems and applications](img/3121OS_Appendix_08.jpg)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Other vulnerable web-based apps that have been well characterized include the
    following:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Hackxor**: This is a web application hacking game that forces players to
    progress through a story to solve challenges related to various vulnerabilities
    ([http://hackxor.sourceforge.net/cgi-bin/index.pl](http://hackxor.sourceforge.net/cgi-bin/index.pl)).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Foundstone**: This has released a series of vulnerable web applications,
    including a bank, bookstore, casino, shipping, and a travel site ([www.mcafee.com/us/downloads/free-tools/index.aspx](http://www.mcafee.com/us/downloads/free-tools/index.aspx)).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**LAMPSecurity**: This provides a series of vulnerable VMs designed to teach
    Linux, Apache, PHP, and database security ([http://sourceforge.net/projects/lampsecurity/files/](http://sourceforge.net/projects/lampsecurity/files/)).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**OWASP Broken Web Applications Project**: This is a collection of vulnerable
    web applications ([http://code.google.com/p/owaspbwa/](http://code.google.com/p/owaspbwa/)).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**WebGoat**: This is an insecure J2EE web application that attempts to provide
    a realistic testing environment. It is maintained by OWASP ([https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project](https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project)).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Web Security Dojo**: This training application released by Maven Security
    ([https://www.mavensecurity.com/web_security_dojo/](https://www.mavensecurity.com/web_security_dojo/)),
    contains several target images, including Damn Vulnerable Web App, Google''s Gruyere,
    Hackme''s Casino, OWASP''s Insecure Web App and WebGoat, w3af''s test website,
    and several vulnerability-specific targets. It also contains a toolset to support
    exploitation.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
