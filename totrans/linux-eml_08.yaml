- en: Chapter 8. Busting Spam with SpamAssassin
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第8章。使用SpamAssassin打击垃圾邮件
- en: Spam, or unsolicited commercial e-mail (UCE) as it is sometimes called, is the
    scourge of the Internet. Spam has increased relentlessly over the last ten years
    and now accounts for over half of all Internet bandwidth. One in six consumers
    have acted on spam e-mails, so there is a strong business case for keeping spam
    out of your users' inboxes. There are a variety of different spam solutions, ranging
    from outsourcing your spam entirely to no action at all. However, if you have
    your own e-mail server, you can add spam filtering very easily.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 垃圾邮件，或者有时被称为不受欢迎的商业电子邮件（UCE），是互联网的祸害。在过去的十年里，垃圾邮件不断增加，现在占据了超过一半的互联网带宽。六分之一的消费者已经对垃圾邮件采取了行动，因此有充分的商业理由将垃圾邮件从用户的收件箱中清除出去。有各种不同的垃圾邮件解决方案，从完全外包您的垃圾邮件到完全不采取任何行动。然而，如果您有自己的电子邮件服务器，您可以非常容易地添加垃圾邮件过滤。
- en: SpamAssassin is a very popular open source anti-spam tool. It won a Linux New
    Media Award-2006 as the "Best Linux-based Anti-spam Solution", and is considered
    by many to be the best free, open source, anti-spam tool, and better than many
    commercial products. In fact, several commercial products and services are based
    on SpamAssassin or previous versions of it.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin是一个非常受欢迎的开源反垃圾邮件工具。它赢得了2006年Linux New Media奖，被评为“最佳基于Linux的反垃圾邮件解决方案”，被许多人认为是最好的免费、开源的反垃圾邮件工具，比许多商业产品更好。事实上，有几个商业产品和服务都是基于SpamAssassin或其先前版本的。
- en: 'In this chapter, you will learn:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学习：
- en: Why spam is difficult to deal with and why spam filters requires regular updates
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么垃圾邮件很难处理，为什么垃圾邮件过滤器需要定期更新
- en: How to download, install, and configure SpamAssassin
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何下载、安装和配置SpamAssassin
- en: How to filter incoming e-mails with SpamAssassin.
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用SpamAssassin过滤传入的电子邮件。
- en: How to configure SpamAssassin to work on per-user or per-server basis
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何配置SpamAssassin以在每个用户或每个服务器的基础上运行
- en: How to configure popular e-mail clients to recognize the tags that SpamAssassin
    places in e-mails
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何配置流行的电子邮件客户端以识别SpamAssassin放置在电子邮件中的标记
- en: How to customize SpamAssassin to update new rules set automatically to keep
    your system's spam detection well tuned.
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何自定义SpamAssassin以自动更新新规则集，以保持系统的垃圾邮件检测良好。
- en: How to integrate spam filtering with virus recognition using amavisd
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用amavisd集成垃圾邮件过滤和病毒识别
- en: Why filter e-mail
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为什么过滤电子邮件
- en: If you don't receive any spam, there may be no need to filter spam. However,
    once one spam message has been received, it is invariably followed by many more.
    Spammers can sometimes detect if a spam e-mail is viewed, using techniques such
    as Web bugs, which are tiny images in HTML e-mails that are fetched from web servers,
    and then know that an e-mail address is valid and vulnerable. If spam is filtered,
    the initial e-mail may never get seen, and consequently the spammer may not then
    target the e-mail address with further spam.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有收到任何垃圾邮件，可能没有必要过滤垃圾邮件。然而，一旦收到一封垃圾邮件，通常会接着收到更多。垃圾邮件发送者有时可以检测出是否查看了垃圾邮件，使用诸如Web
    bug之类的技术，这些技术是HTML电子邮件中的微小图像，从Web服务器获取，然后知道电子邮件地址是有效的和易受攻击的。如果垃圾邮件被过滤，最初的电子邮件可能永远不会被看到，因此垃圾邮件发送者可能不会再以垃圾邮件的形式攻击该电子邮件地址。
- en: Despite legal efforts against spam, it is actually on the increase. In Europe
    and the US, the recent legislation against spam (Directive 2002/58/EC and bill
    number S.877 respectively) have had little effect and spam is still on the increase
    in both regions.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管针对垃圾邮件的法律行动，实际上垃圾邮件还在增加。在欧洲和美国，最近针对垃圾邮件的立法（2002/58/EC指令和S.877法案）几乎没有效果，垃圾邮件在这两个地区仍在增加。
- en: The main reason for this is that spam is a very good business model. It is very
    cheap to send spam, as little as one thousandth of a cent per e-mail, and it takes
    a very low hit rate before a profit is made. The spammer needs to turn just one
    spam in a hundred thousand or so into a sale to make a profit. As a result, there
    are many spammers and spam is used to promote a wide range of goods. Spamming
    costs are also negligible due to use of malware that uses innocent computers to
    send spam on their behalf.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 这主要原因是垃圾邮件是一个非常好的商业模式。发送垃圾邮件的成本非常低，每封邮件只需千分之一美分，只需低得多的点击率就可以获利。垃圾邮件发送者只需要将十万封垃圾邮件中的一封变成销售，就可以获利。因此，有很多垃圾邮件发送者，垃圾邮件被用来推广各种商品。由于使用恶意软件利用无辜的计算机代表他们发送垃圾邮件，垃圾邮件成本也是微不足道的。
- en: In contrast, the costs of spam to the recipient are remarkably high. Estimates
    have varied, from 10 cents per spam received, through 1,000 dollars per employee
    per year, up to a total cost of 140 billion dollars globally in 2007 alone. This
    cost is mainly labor—distracting people from their work by clogging their inboxes
    and forcing them to deal with many extra e‑mails. Spam interferes with day-to-day
    work and can include material that is offensive to most people. Companies have
    a duty to protect their employees from such content. Spam filtering is a very
    cheap way of minimizing the costs and protecting the workforce.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，垃圾邮件对收件人的成本非常高。估计各种各样，从每封收到的垃圾邮件10美分，每年每名员工1,000美元，到仅在2007年全球总成本高达1400亿美元。这个成本主要是劳动力——通过堵塞收件箱和迫使他们处理许多额外电子邮件，分散人们的工作。垃圾邮件干扰日常工作，可能包括大多数人都觉得冒犯的内容。公司有责任保护员工免受这种内容的侵害。垃圾邮件过滤是一种非常廉价的方式，可以最大程度地减少成本并保护劳动力。
- en: Spam is a moving target
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 垃圾邮件是一个不断变化的目标
- en: Spam isn't static. It changes on a day-to-day basis, as spammers add new methods
    to their arsenal and anti-spammers develop countermeasures. Due to this, the anti-spam
    tools that work best are those that are updated frequently. It's a similar predicament
    to antivirus software—virus definitions need to be updated regularly or new viruses
    won't be detected.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 垃圾邮件并不是静态的。它每天都在变化，因为垃圾邮件发送者增加了新的方法到他们的武器库中，而反垃圾邮件者则制定了对策。因此，最好的反垃圾邮件工具是那些经常更新的工具。这与防病毒软件类似——病毒定义需要定期更新，否则新病毒将无法被检测到。
- en: SpamAssassin is regularly updated. In addition to new releases of the software,
    there is a vigorous community creating, critiquing, and testing new anti-spam
    rules. These rules can be downloaded automatically for up-to-date protection against
    spam.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s discuss some of the measures used by SpamAssassin to fight spam:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: '**Open relays:** These are e-mail servers that allow spammers to send e-mails
    even though they are not connected to the owner of the server in any way. To counter
    this, the anti-spam community has developed **blocklists**, also known as **blacklists**,
    which can be used by anti-spam software to detect spam. These were mentioned in
    Chapter 5 as a list that your e-mail server should not appear on, as it may limit
    legitimate e-mail traffic. Any e-mail that has passed through a server on a blocklist
    is treated more suspiciously than one that has not. SpamAssassin uses a number
    of blocklists to test e-mails.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Keyword filters:** These are useful tools against spam. Spammers tend to
    repeat the same words and phrases again and again. Rules to detect these phrases
    are used extensively by SpamAssassin. These make up the bulk of the tests, and
    the user community rules mentioned previously are normally of this form. They
    allow specific words, phrases, or sequences of letters, numbers, and punctuation
    to be detected.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Blacklists and whitelists:** These are used to list known senders of spam
    and sources of good e-mail respectively. E-mails from an address on a blacklist
    are probably spam and are treated accordingly, while e-mails from addresses on
    a whitelist will be less likely to be treated as spam. SpamAssassin allows the
    user to enter blacklists and whitelists manually, and also builds up an automatic
    whitelist and blacklist based on the e-mails that it processes.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Statistical filters:** These are automated systems that give the probability
    that an e-mail is spam. This filtration is based on what the filter has seen previously
    as both spam and non-spam. They generally work by finding words that are present
    in one type of e-mail but not the other, and using this knowledge to determine
    which type a new e-mail is. SpamAssassin has a statistical filter called the **Bayesian
    filter** that can be very effective in improving detection rates.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Content databases:** These are mass e-mail detection systems. A lot of e-mail
    servers receive and submit e-mails to central servers. If the same e-mail is sent
    to thousands of recipients, it is probably a spam. The content databases prevent
    confidential e-mails from being sent to the server, by using a technique called
    **hashing** that also lowers the amount of data sent to the server. SpamAssassin
    can integrate with several content databases, notably Vipul''s Razor ([http://razor.sourceforge.net/](http://razor.sourceforge.net/)),
    Pyzor ([http://sourceforge.net/apps/trac/pyzor/](http://sourceforge.net/apps/trac/pyzor/)),
    and the **Distributed Checksum Clearinghouse**, that is, **DCC** ([http://www.rhyolite.com/dcc/](http://www.rhyolite.com/dcc/)).'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**URL blocklists:** These are similar to open relay blocklists, but list the
    websites used by spammers. In nearly all spams, a web address is given. A database
    of these is built so that spam e-mails can be quickly detected. This is a very
    efficient and effective tool against spam. By default, SpamAssassin uses **Spam
    URI Realtime BlockLists** (**SURBLs**), without any further configuration required.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Spam filtering options
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Spam can be filtered on the server or the client. The two approaches are explained
    next. In the first scenario, spam is filtered on the client.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: '![Spam filtering options](img/8648_08_01.jpg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
- en: Mail is processed by the MTA.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The e-mail is then placed in the appropriate user's inbox.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The e-mail client reads all new e-mail from the inbox.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The e-mail client then passes the e-mail to the filter.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When the filter returns the results, the client can display the valid e-mail
    and either discard spam or file it in a separate folder.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In this approach, the spam filtering is always done by the client and is always
    done when new e‑mail is processed. Often when the user may be present, so he or
    she may either experience a delay before e-mail is visible or there may be a period
    where spam e-mail is present in the inbox before the client software can filter
    the spam from view. The amount of spam filtering that can be performed on the
    client may be limited. In particular, the network tests such as open relay blocklists
    or SURBLs might be too time consuming or complex to perform on the user's PC.
    As spam is a moving target, updating many client PCs can become a difficult administrative
    task.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种方法中，垃圾邮件过滤始终由客户端完成，并且始终在处理新电子邮件时完成。通常当用户可能在场时，他或她可能会在电子邮件可见之前经历延迟，或者在客户端软件可以过滤垃圾邮件之前，收件箱中可能存在垃圾邮件的时间段。可以在客户端上执行的垃圾邮件过滤量可能有限。特别是，诸如开放中继阻止列表或SURBL之类的网络测试可能太耗时或复杂，无法在用户的个人电脑上执行。由于垃圾邮件是一个不断变化的目标，更新许多客户端个人电脑可能成为一项困难的管理任务。
- en: In the second scenario, the spam filtering is performed on the e-mail server.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二种情况下，垃圾邮件过滤是在电子邮件服务器上执行的。
- en: '![Spam filtering options](img/8648_08_02.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![垃圾邮件过滤选项](img/8648_08_02.jpg)'
- en: Incoming e-mail is received by the MTA.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 传入的电子邮件由MTA接收。
- en: It is then passed on to the spam filter.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后将其传递给垃圾邮件过滤器。
- en: The results are then sent back to the MTA.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后将结果发送回MTA。
- en: Depending on the results, the MTA places the e-mail in the appropriate user's
    inbox (**4a**), or in a separate folder for spam (**4b**).
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据结果，MTA将电子邮件放入适当用户的收件箱（**4a**），或者放入一个单独的垃圾邮件文件夹（**4b**）。
- en: The e-mail client accesses e-mails in the user's inbox and it can also access
    the spam folder if required.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 电子邮件客户端可以访问用户的收件箱中的电子邮件，如果需要，也可以访问垃圾邮件文件夹。
- en: 'This approach has several advantages:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法有几个优点：
- en: The spam filtering is done when the e-mail is received, which may be any time
    of the day. The user is less likely to be inconvenienced by delays.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 垃圾邮件过滤是在收到电子邮件时完成的，可能是一天中的任何时间。用户不太可能因延迟而感到不便。
- en: The server can specialize in spam filtering. It may use external services such
    as open relay blocklists, online content databases, and SURBLs.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器可以专门用于垃圾邮件过滤。它可以使用诸如开放中继阻止列表、在线内容数据库和SURBL之类的外部服务。
- en: Configuration is centralized, which will ease setup (for example, firewalls
    may need to be configured to use online spam tests) and also maintenance (updating
    of rules or software).
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置是集中的，这将简化设置（例如，防火墙可能需要配置为使用在线垃圾邮件测试）以及维护（更新规则或软件）。
- en: 'On the other hand, the disadvantages include:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，缺点包括：
- en: A single point of failure now exists. However, with care, a broken spam filtering
    service can be configured around. If the service is not available, e-mail will
    still be delivered but spam will not be filtered.
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 现在存在一个单点故障。但是，经过小心配置，可以围绕一个破损的垃圾邮件过滤服务。如果服务不可用，电子邮件仍将被传递，但垃圾邮件将不会被过滤。
- en: All spam must be processed by one service. If this service is not scalable,
    large volumes of e-mail may affect mail delivery times, resulting in poor or intermittent
    filtering, or possibly even the loss of e-mail service.
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有垃圾邮件必须由一个服务处理。如果此服务不可扩展，大量的电子邮件可能会影响邮件传递时间，导致过滤效果不佳或间歇性过滤，甚至可能导致电子邮件服务丢失。
- en: Introduction to SpamAssassin
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍SpamAssassin
- en: Spam filtering actually involves two phases—detecting the spam and then doing
    something with it. SpamAssassin is a spam detector and it modifies the e-mail
    it processes by putting in headers to mark whether it is spam. It is up to the
    MTA or the mail delivery agent in the e-mail system to react to the headers that
    SpamAssassin creates in an e-mail, to filter it out. However, it's possible that
    another part of the e-mail system could perform this task.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，垃圾邮件过滤涉及两个阶段——检测垃圾邮件，然后对其进行处理。SpamAssassin是一个垃圾邮件检测器，它通过放置标头来修改它处理的电子邮件，以标记它是否是垃圾邮件。由MTA或电子邮件系统中的邮件传递代理对SpamAssassin在电子邮件中创建的标头做出反应，以过滤它。但是，电子邮件系统的另一部分也可能执行此任务。
- en: '![Introduction to SpamAssassin](img/8648_08_03.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![介绍SpamAssassin](img/8648_08_03.jpg)'
- en: The previous figure gives a schematic representation of SpamAssassin. At the
    heart of SpamAssassin is its **Rules Engine** that determines which rules are
    called. Rules trigger whether the various tests are used, including the Bayesian
    Filter, the network tests, and the auto-whitelists.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的图示给出了SpamAssassin的示意图。SpamAssassin的核心是其**规则引擎**，确定调用哪些规则。规则触发各种测试的使用，包括贝叶斯过滤器、网络测试和自动白名单。
- en: SpamAssassin uses various databases to do its work, and these are shown too.
    The rules and scores are text files. Default rules and scores are included in
    the SpamAssassin distribution and, as we will see, both system administrators
    and users can add rules or change the scores of existing rules by adding them
    to files in specific locations. The Bayesian filter (which is a major part of
    SpamAssassin, and will be covered later) uses a database of statistical data based
    on previous spam and non-spam e-mails. The **Auto-Blacklist/Whitelist** also creates
    its own database.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin使用各种数据库来完成其工作，这些也显示出来。规则和分数是文本文件。SpamAssassin分发中包含默认规则和分数，正如我们将看到的，系统管理员和用户都可以通过将它们添加到特定位置的文件中来添加规则或更改现有规则的分数。贝叶斯过滤器（这是SpamAssassin的一个重要部分，稍后将介绍）使用基于先前垃圾邮件和非垃圾邮件电子邮件的统计数据的数据库。**自动黑名单/白名单**也创建自己的数据库。
- en: Downloading and installing SpamAssassin
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 下载和安装SpamAssassin
- en: SpamAssassin is slightly different from most of the software that is used in
    this book. It is written in a language called **Perl**, which has its own distribution
    method called **CPAN** (**Comprehensive Perl Archive Network)**. CPAN is a large
    website of Perl software (normally, Perl modules), and the term CPAN is also the
    name of the software used to download those modules and install them. Though SpamAssassin
    is provided as a package by many Linux distributions, we strongly recommend that
    you install it from source rather than use a package. This way, you will get the
    latest version of SpamAssassin rather than the one that was current when your
    Linux distributer created its release.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin与本书中使用的大多数软件略有不同。它是用一种称为**Perl**的语言编写的，它有自己的分发方法称为**CPAN**（**Comprehensive
    Perl Archive Network**）。CPAN是一个大型的Perl软件网站（通常是Perl模块），术语CPAN也是用于下载这些模块并安装它们的软件的名称。尽管SpamAssassin作为一个软件包由许多Linux发行版提供，但我们强烈建议您从源代码安装它，而不是使用软件包。这样，您将获得最新版本的SpamAssassin，而不是在您的Linux发行商创建其发布时的版本。
- en: Most Perl users will build Perl modules using CPAN and experience no difficulties.
    CPAN can automatically locate and install any dependencies (other components that
    are required to make the desired component work properly). From a Perl point of
    view, using CPAN to install Perl modules is like using the `rpm` or `apt-get`
    commands in Linux. The basics are very simple and, once a system is configured,
    it generally works every time.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数Perl用户将使用CPAN构建Perl模块并且不会遇到困难。CPAN可以自动定位和安装任何依赖项（使所需组件正常工作所需的其他组件）。从Perl的角度来看，使用CPAN安装Perl模块就像在Linux中使用`rpm`或`apt-get`命令一样。基本操作非常简单，一旦系统配置好了，通常每次都能正常工作。
- en: However, learning and configuring a new way of installing software may put off
    some people. A SpamAssassin release is distributed in source form, but administrators
    of **Red Hat Package Manager** (**RPM**) based systems can easily convert the
    latest SpamAssassin release into rpm format and then the regular `rpm` command
    can be used to install the package. The Debian repository is updated fairly quickly
    when SpamAssassin is updated and the regular `apt-get` commands can be used to
    install SpamAssassin. We strongly advise you to install via `apt-get`, CPAN, or
    using the `rpmbuild` command as described next, in preference to using an RPM
    provided by a distributor.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，学习和配置一种新的软件安装方式可能会让一些人望而却步。SpamAssassin的发布以源代码形式分发，但基于**Red Hat Package Manager**（**RPM**）的系统的管理员可以轻松地将最新的SpamAssassin发布转换为rpm格式，然后可以使用常规的`rpm`命令来安装软件包。当SpamAssassin更新时，Debian存储库也会相当快地更新，可以使用常规的`apt-get`命令来安装SpamAssassin。我们强烈建议您优先使用`apt-get`、CPAN或使用下面描述的`rpmbuild`命令来安装，而不是使用发行商提供的RPM。
- en: As SpamAssassin is a Perl Module, it appears on CPAN first. In fact, it is only
    released when it arrives at CPAN. Users of CPAN can download the latest version
    of SpamAssassin literally minutes after it has been released.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 由于SpamAssassin是一个Perl模块，它首先出现在CPAN上。事实上，只有到达CPAN时才会发布。CPAN的用户可以在发布几分钟后下载最新版本的SpamAssassin。
- en: Support is also easier to obtain if SpamAssassin is built from source. Some
    distributors make unusual decisions when creating their RPM of SpamAssassin or
    may modify certain default values. These make obtaining support more difficult.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如果从源代码构建SpamAssassin，支持也更容易获得。一些发行商在创建他们的SpamAssassin的RPM时可能会做出不寻常的决定，或者可能修改某些默认值。这使得获得支持更加困难。
- en: RPMs also take time to be delivered. Distributors need time to build and test
    new versions of software before they release them, and most software packages
    are not updated as quickly as SpamAssassin. So, Linux distributions may not provide
    the latest software, and what is provided can be several versions out of date.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: RPM包也需要时间交付。发行商需要时间来构建和测试软件的新版本，然后才能发布它们，大多数软件包的更新速度不如SpamAssassin快。因此，Linux发行版可能不提供最新的软件，提供的软件可能已经过时了几个版本。
- en: Using CPAN
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用CPAN
- en: 'The prerequisites for installing SpamAssassin 3.2.5 using CPAN are as follows:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 使用CPAN安装SpamAssassin 3.2.5的先决条件如下：
- en: '**Perl version 5.6.1 or later:** Most modern Linux distributions will include
    this as a part of the base package.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Perl版本5.6.1或更高版本：**大多数现代Linux发行版将其作为基本软件包的一部分。'
- en: '**Several Perl modules:** The current version of SpamAssassin needs the Digest::SHA1,
    HTML::Parser, and the Net::DNS modules. CPAN will install these if you configure
    it to follow dependencies, but there are many additional Perl modules that are
    optional and should be installed to get the best spam detection. CPAN will issue
    warnings with the module names, which will enable you to identify and install
    them.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**多个Perl模块：**当前版本的SpamAssassin需要Digest::SHA1、HTML::Parser和Net::DNS模块。如果配置CPAN以遵循依赖关系，CPAN将安装这些模块，但还有许多可选的Perl模块应该安装以获得最佳的垃圾邮件检测。CPAN将发出带有模块名称的警告，这将使您能够识别并安装它们。'
- en: '**C compiler:** This may not be installed by default and may have to be added
    using the `rpm` command. The compiler used will normally be called `gcc`.'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**C编译器：**这可能不会默认安装，可能需要使用`rpm`命令添加。通常使用的编译器将被称为`gcc`。'
- en: '**Internet connection:** CPAN will attempt to download the modules using `HTTP`
    or `FTP`, so the network should be configured to allow this.'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Internet连接：**CPAN将尝试使用`HTTP`或`FTP`下载模块，因此网络应该配置为允许此操作。'
- en: Configuring CPAN
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置CPAN
- en: If you've used CPAN before, you can skip to the next section, *Installing SpamAssassin
    Using CPAN*.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您以前使用过CPAN，可以跳到下一节，*使用CPAN安装SpamAssassin*。
- en: If a proxy server is required for Internet traffic, CPAN (and other Perl modules
    and scripts) will use the `http_proxy` environment variable. If the proxy requires
    a username and password, these need to be specified using environment variables.
    As CPAN is normally run as `root`, these commands should be entered as `root:`
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Internet流量需要代理服务器，CPAN（以及其他Perl模块和脚本）将使用`http_proxy`环境变量。如果代理需要用户名和密码，则需要使用环境变量指定这些信息。由于CPAN通常以`root`身份运行，这些命令应该以`root`身份输入：
- en: '[PRE0]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Next, enter this command:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，输入以下命令：
- en: '[PRE1]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: If the output is similar to the following, the CPAN module is already installed
    and configured, and you can skip to the next section, *Installing SpamAssassin
    Using CPAN*.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 如果输出类似于以下内容，则CPAN模块已安装并配置，您可以跳过下一节*使用CPAN安装SpamAssassin*。
- en: '[PRE2]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: If the output prompts for manual configuration, as shown next, the CPAN module
    is installed but not configured.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 如果输出提示手动配置，如下所示，CPAN模块已安装但未配置。
- en: '[PRE3]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: During configuration, the CPAN Perl module prompts for answers to around 30
    questions. For most of the questions, selecting the default value is the best
    response. This initial configuration must be completed before the CPAN Perl module
    can be used. The questions are mainly about the location of various utilities,
    and the defaults can be chosen by pressing Enter. The only question for which
    we should change the default is the one about building prerequisite modules. If
    we configure CPAN to follow dependencies, it will install the required modules
    without prompting.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置期间，CPAN Perl模块会提示回答大约30个问题。对于大多数问题，选择默认值是最佳响应。必须在使用CPAN Perl模块之前完成此初始配置。这些问题主要是关于各种实用程序的位置，可以通过按Enter选择默认值。我们应该更改默认值的唯一问题是关于构建先决模块的问题。如果我们配置CPAN以遵循依赖关系，它将在不提示的情况下安装所需的模块。
- en: '[PRE4]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Once CPAN is configured, exit the shell by typing `exit` and pressing *Enter*.
    We are now ready to use CPAN to install SpamAssassin.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 配置CPAN后，通过输入`exit`并按*Enter*退出shell。我们现在准备使用CPAN安装SpamAssassin。
- en: Installing SpamAssassin using CPAN
  id: totrans-80
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用CPAN安装SpamAssassin
- en: 'To install SpamAssassin, enter the CPAN shell by typing the following command:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装SpamAssassin，请输入以下命令进入CPAN shell：
- en: '[PRE5]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'If the CPAN module is correctly configured, the following output (or something
    similar) will appear:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 如果CPAN模块已正确配置，则将显示以下输出（或类似内容）：
- en: '[PRE6]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Now, at the `cpan` prompt, enter the following command:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在`cpan`提示符处，输入以下命令：
- en: '[PRE7]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The CPAN module will query an online database to find the latest version of
    SpamAssassin and its dependencies, and then install them. Dependencies will be
    installed before SpamAssassin. The following is the sample output:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: CPAN模块将查询在线数据库以查找SpamAssassin及其依赖项的最新版本，然后安装它们。在安装SpamAssassin之前将安装依赖项。以下是示例输出：
- en: '[PRE8]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: SpamAssassin may require the user to respond to a few questions. The responses
    provided might affect the module configuration or only be part of the testing
    performed before installation.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin可能需要用户回答一些问题。提供的答案可能会影响模块配置，或者只是安装前执行的测试的一部分。
- en: '[PRE9]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'SpamAssassin, as with many Perl modules, is very flexible. It can make use
    of features if they are available, and will work even if they are not. When using
    CPAN, you may see messages such as the following:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 与许多Perl模块一样，SpamAssassin非常灵活。如果可用，它可以利用功能，即使没有也可以工作。在使用CPAN时，您可能会看到以下消息：
- en: '[PRE10]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: If you install the modules mentioned, SpamAssassin will make use of them and
    this will improve e-mail filtering. You can abort the installation of SpamAssassin
    and install the modules using cpan `install Module::Name` commands.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 如果安装了提到的模块，SpamAssassin将使用它们，这将改善电子邮件过滤。您可以中止SpamAssassin的安装，并使用cpan `install
    Module::Name`命令安装模块。
- en: 'If you let the build process complete, it will test the capabilities of the
    C compiler, configure and build the module, create documentation, and test SpamAssassin.
    At the end of the build, the output should be similar to the following:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 如果让构建过程完成，它将测试C编译器的功能，配置和构建模块，创建文档并测试SpamAssassin。在构建结束时，输出应类似于以下内容：
- en: '[PRE11]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: This indicates that SpamAssassin has been installed correctly. If SpamAssassin
    installation was successful, you can skip to the *Testing the Installation* section.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 这表明SpamAssassin已经正确安装。如果SpamAssassin安装成功，您可以跳过*测试安装*部分。
- en: 'If the installation failed, the output may look like this:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 如果安装失败，输出可能如下所示：
- en: '[PRE12]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: If the output does not end with the `/usr/bin/make install -- OK` message, an
    error has occurred. Firstly, you should examine all the output for possible warnings
    and error messages, especially for prerequisite packages. If this does not assist,
    then avenues for support are described in the section *Testing the installation*.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 如果输出不以`/usr/bin/make install -- OK`消息结束，则发生错误。首先，您应该检查所有输出以查找可能的警告和错误消息，特别是先决软件包。如果这没有帮助，那么支持途径将在*测试安装*部分中描述。
- en: Using the rpmbuild utility
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用rpmbuild实用程序
- en: 'If a version of Linux based on the Red Hat Package Manager format is used,
    SpamAssassin can be installed using the `rpmbuild` command. Download the SpamAssassin
    source from [http://www.cpan.org/modules/01modules.index.html](http://www.cpan.org/modules/01modules.index.html)
    into a working directory, then issue the following command to build SpamAssassin:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用基于Red Hat软件包管理器格式的Linux版本，则可以使用`rpmbuild`命令安装SpamAssassin。从[http://www.cpan.org/modules/01modules.index.html](http://www.cpan.org/modules/01modules.index.html)下载SpamAssassin源代码到工作目录，然后发出以下命令构建SpamAssassin：
- en: '[PRE13]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '[PRE14]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'It is possible that the installation will fail due to missing dependencies.
    These are Perl modules that SpamAssassin uses, and which are installed separately.
    Error messages often hint at the name of the dependency, as in the following installation:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 由于缺少依赖关系，安装可能会失败。这些是SpamAssassin使用的Perl模块，需要单独安装。错误消息通常会暗示依赖项的名称，如以下安装中所示：
- en: '[PRE15]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '[PRE16]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: In this case, the Perl modules `Digest::SHA1, HTML::Parser`, and `Net::DNS`
    are needed. The solution is to install it using CPAN. In some cases, SpamAssassin
    may require particular versions of packages, which may require the installed versions
    to be upgraded.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，需要Perl模块`Digest::SHA1, HTML::Parser`和`Net::DNS`。解决方案是使用CPAN安装它。在某些情况下，SpamAssassin可能需要特定版本的软件包，这可能需要升级已安装的版本。
- en: When installing SpamAssassin using CPAN, all the dependencies are installed
    automatically. However, while using the `rpmbuild` command, the dependencies need
    to be installed manually. Using CPAN is generally less troublesome than `rpmbuild`.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 使用CPAN安装SpamAssassin时，所有依赖项都会自动安装。但是，使用`rpmbuild`命令时，需要手动安装依赖项。使用CPAN通常比`rpmbuild`更不麻烦。
- en: Using pre-built RPMs
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用预构建的RPM
- en: SpamAssassin is packaged with many Linux distributions, and packages of new
    releases of SpamAssassin are often made available from other sources. As mentioned
    earlier, RPMs are not the recommended method of installing SpamAssassin but are
    more reliable than building from source on unusual platforms.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin打包在许多Linux发行版中，并且通常可以从其他来源获得SpamAssassin的新版本的软件包。如前所述，RPM不是安装SpamAssassin的推荐方法，但比在不寻常的平台上从源代码构建更可靠。
- en: 'To install an RPM, simply download or locate it on the distribution CD, and
    install it using the `rpm` command. The following command can be used to install
    the RPM for SpamAssassin:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装RPM，只需下载或在发行CD上找到它，并使用`rpm`命令安装它。以下命令可用于安装SpamAssassin的RPM：
- en: '[PRE17]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Graphical installers can also be used to install SpamAssassin RPMs. The RPMs
    listed on the SpamAssassin website are usually the latest version of SpamAssassin
    and are complete. If these cannot be installed, the RPM provided by the Linux
    distribution should be installed instead.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以使用图形安装程序来安装SpamAssassin的RPM。SpamAssassin网站上列出的RPM通常是最新版本的SpamAssassin，并且是完整的。如果无法安装这些RPM，则应安装Linux发行版提供的RPM。
- en: Testing the installation
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试安装
- en: It is worth performing a few tests to ensure that SpamAssassin is installed
    correctly and the environment is complete. If you want to test a particular user
    account, you should log in to that account to perform the test.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 值得进行一些测试，以确保SpamAssassin已正确安装并且环境是完整的。如果要测试特定用户帐户，应登录到该帐户执行测试。
- en: SpamAssassin includes a sample spam e-mail and a sample non-spam e-mail. It
    can be tested by processing the sample e-mails. These e-mails are in the root
    of the SpamAssassin distribution directory. If you used CPAN to install SpamAssassin
    using the `root` user, then the path to this directory may be similar to `~root/.cpan/build/Mail-SpamAssassin-3.2.5/`,
    where `3.2.5` is the version of SpamAssassin installed. If the files cannot be
    located, download the SpamAssassin source from [http://www.cpan.org/modules/01modules.index.html](http://www.cpan.org/modules/01modules.index.html)
    and unpack the source into a temporary directory. The sample e-mails are in the
    root of the unpacked source.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin包括一个样本垃圾邮件和一个样本非垃圾邮件。可以通过处理样本电子邮件来进行测试。这些电子邮件位于SpamAssassin分发目录的根目录。如果您使用CPAN以`root`用户安装SpamAssassin，则该目录的路径可能类似于`~root/.cpan/build/Mail-SpamAssassin-3.2.5/`，其中`3.2.5`是安装的SpamAssassin版本。如果找不到文件，请从[http://www.cpan.org/modules/01modules.index.html](http://www.cpan.org/modules/01modules.index.html)下载SpamAssassin源代码并将源代码解压缩到临时目录。样本电子邮件位于解压后源代码的根目录中。
- en: To test SpamAssassin, change to the directory containing `sample-spam.txt` and
    use the following commands. Example results are shown after each command.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 要测试SpamAssassin，请切换到包含`sample-spam.txt`的目录，并使用以下命令。每个命令后都显示了示例结果。
- en: '[PRE18]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '[PRE20]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '[PRE21]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The output from the command using `sample-nonspam.txt` should have `X-Spam-Status:
    No`, and that using `sample-spam.txt` should have `X-Spam-Flag: YES` and `X-Spam-Status:
    Yes`.'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '使用`sample-nonspam.txt`命令的输出应该是`X-Spam-Status: No`，使用`sample-spam.txt`命令的输出应该是`X-Spam-Flag:
    YES`和`X-Spam-Status: Yes`。'
- en: 'SpamAssassin can verify its configuration files with the `--lint` flag and
    report any errors. By default, a clean installation of SpamAssassin should not
    have any errors, but once a site is customized, some rules may fail. In the following
    example, a `score` entry does not match a rule:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin可以使用`--lint`标志验证其配置文件并报告任何错误。默认情况下，干净的SpamAssassin安装不应该有任何错误，但一旦网站被定制，一些规则可能会失败。在下面的示例中，`score`条目与规则不匹配：
- en: '[PRE22]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '[PRE23]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: If the output includes warnings, something has gone wrong. It's worth fixing
    SpamAssassin before going on and using it. The best places to visit are the SpamAssassin
    Wiki ([http://wiki.apache.org/spamassassin/](http://wiki.apache.org/spamassassin/)),
    the archives of the SpamAssassin mailing lists ([http://wiki.apache.org/spamassassin/MailingLists](http://wiki.apache.org/spamassassin/MailingLists)),
    and your favorite search engine. As with most open source projects, the developers
    are volunteers and appreciate users who search for the solution to their problem
    before posting a plea for help, as most problems have been encountered many times
    before.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 如果输出包含警告，那么出现了问题。在继续使用之前，值得修复SpamAssassin。最好的参考资料是SpamAssassin Wiki（[http://wiki.apache.org/spamassassin/](http://wiki.apache.org/spamassassin/)）、SpamAssassin邮件列表的存档（[http://wiki.apache.org/spamassassin/MailingLists](http://wiki.apache.org/spamassassin/MailingLists)）以及您喜欢的搜索引擎。与大多数开源项目一样，开发人员是志愿者，他们欣赏那些在发布求助请求之前搜索解决方案的用户，因为大多数问题以前已经遇到过很多次。
- en: Modified e-mails
  id: totrans-127
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修改后的电子邮件
- en: 'In addition to the e-mail headers mentioned, SpamAssassin will modify an e-mail
    if it is thought to be spam. It takes the original e-mail and converts it to an
    e-mail attachment with a simple e-mail around it. SpamAssassin always wraps an
    e-mail if it detects a potential virus or other dangerous content. In its default
    configuration, it will add an envelope e-mail around the spam, but this can be
    turned off if desired. Consult the SpamAssassin documentation regarding the `report_safe`
    directive. The envelope e‑mail looks like this:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 除了提到的电子邮件标题之外，如果认为是垃圾邮件，SpamAssassin还会修改电子邮件。它会将原始电子邮件转换为一个简单的电子邮件附件。如果检测到潜在病毒或其他危险内容，SpamAssassin总是会包装电子邮件。在其默认配置中，它会在垃圾邮件周围添加一个信封电子邮件，但如果需要，可以关闭此功能。请参阅SpamAssassin文档中的`report_safe`指令。信封电子邮件如下所示：
- en: '![Modified e-mails](img/8648_08_04.jpg)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![修改后的电子邮件](img/8648_08_04.jpg)'
- en: Using SpamAssassin
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用SpamAssassin
- en: Now that SpamAssassin is installed, we need to configure the system to use it.
    SpamAssassin can be used in many ways. It can be integrated into the MTA for maximum
    performance; it can run as a daemon or a simple script to avoid complexity; it
    can use separate settings for each user or use a single set of settings for all
    users; and it can be used for all accounts or just for the chosen ones. In this
    book, we will discuss using SpamAssassin in three ways.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 现在SpamAssassin已安装，我们需要配置系统来使用它。SpamAssassin可以以多种方式使用。它可以集成到MTA中以获得最大性能；它可以作为守护程序运行或作为简单脚本以避免复杂性；它可以为每个用户使用单独的设置或为所有用户使用单一设置；它可以用于所有帐户或仅用于选择的帐户。在本书中，我们将讨论三种使用SpamAssassin的方法。
- en: The first method is with Procmail. This is the simplest method to configure
    and is suitable for low-volume sites, for example, less than 10,000 e-mails a
    day.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 第一种方法是使用Procmail。这是配置最简单的方法，适用于低流量站点，例如每天少于10,000封电子邮件。
- en: The second method is to use SpamAssassin as a daemon. This is more efficient,
    and can still be used with Procmail, if desired.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 第二种方法是将SpamAssassin作为守护程序使用。这更有效，并且如果需要的话，仍然可以与Procmail一起使用。
- en: The third method is to integrate SpamAssassin with a content filter such as
    amavisd. This offers performance advantages, but occasionally the content filter
    does not work with the latest release of SpamAssassin. Problems, if any, are usually
    resolved quickly.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 第三种方法是将SpamAssassin与诸如amavisd之类的内容过滤器集成。这提供了性能优势，但有时内容过滤器与最新版本的SpamAssassin不兼容。如果有任何问题，通常会很快解决。
- en: Note
  id: totrans-135
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'To help you get the most out of SpamAssassin, Packt Publishing has published
    *SpamAssassin: A practical guide to integration and configuration*, (ISBN 1-904811-12-4)
    by Alistair McDonald.'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '为了帮助您充分利用SpamAssassin，Packt Publishing出版了*SpamAssassin: A practical guide to
    integration and configuration*，作者是Alistair McDonald（ISBN 1-904811-12-4）。'
- en: Using SpamAssassin with Procmail
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Procmail与SpamAssassin
- en: Procmail was covered in Chapters 6 and 7\. If you have at least a basic understanding
    of Procmail, then what follows here should be easy to understand. If you jumped
    to this chapter and you don't know about Procmail, then it would probably be worthwhile
    reading Chapter 6, which discusses the basics of Procmail before continuing here.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: Procmail在第6章和第7章中有所涉及。如果你对Procmail有基本的了解，那么接下来的内容应该很容易理解。如果你直接跳到这一章而不了解Procmail，那么最好先阅读第6章，该章节讨论了Procmail的基础知识。
- en: Before we configure the system to use SpamAssassin, let's consider what SpamAssassin
    does. SpamAssassin is *not* an e-mail filter. A filter is something that changes
    the destination of an e-mail. SpamAssassin adds e-mail headers to an e-mail message
    to indicate if it is spam or not.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们配置系统使用SpamAssassin之前，让我们考虑一下SpamAssassin的作用。SpamAssassin *不是*一个电子邮件过滤器。过滤器是改变电子邮件目的地的东西。SpamAssassin会向电子邮件消息添加电子邮件头，以指示它是否是垃圾邮件。
- en: 'Consider an e-mail with headers like this:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个具有以下头部的电子邮件：
- en: '[PRE24]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: SpamAssassin will add header lines.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin将添加头部行。
- en: '[PRE25]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: SpamAssassin doesn't change the destination of the e-mail, all it does is add
    headers that enable something else to change the destination of the e-mail.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin不会改变电子邮件的目的地，它只是添加头部，以便其他东西改变电子邮件的目的地。
- en: The best indication that an e-mail is spam is the `X-Spam-Flag`. If this is
    `YES`, SpamAssassin considers the mail to be spam and it can be filtered by Procmail.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 判断一封电子邮件是否是垃圾邮件的最佳指标是`X-Spam-Flag`。如果是`YES`，SpamAssassin认为该邮件是垃圾邮件，并且可以被Procmail过滤。
- en: SpamAssassin also assigns a score to each e-mail the higher the score, the more
    likely that the e-mail is spam. The threshold that determines if an e-mail is
    spam can be configured on a system-wide or per-user basis. The default of `5.0`
    is a sensible default if you are using an unmodified installation of SpamAssassin
    without any custom rulesets.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin还为每封电子邮件分配一个分数，分数越高，该邮件是垃圾邮件的可能性就越大。确定一封电子邮件是否是垃圾邮件的阈值可以在系统范围或每个用户的基础上进行配置。如果您使用未经修改的SpamAssassin安装和没有自定义规则集，则默认值`5.0`是一个明智的默认值。
- en: Global procmailrc file
  id: totrans-147
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 全局procmailrc文件
- en: Let's suppose that we want to check all incoming e-mail for spam using SpamAssassin.
    Commands in the `/etc/procmailrc` file are run for all users, so executing SpamAssassin
    here is ideal.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们想要使用SpamAssassin检查所有传入的电子邮件是否为垃圾邮件。`/etc/procmailrc`文件中的命令将为所有用户运行，因此在这里执行SpamAssassin是理想的。
- en: The following simple recipe will run SpamAssassin for all users when placed
    in `/etc/procmailrc:`
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 将以下简单的配方放置在`/etc/procmailrc`中，将为所有用户运行SpamAssassin：
- en: '[PRE26]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'To place all spam in an individual spam folder, ensure that the `global/etc/procmailrc`
    file has a line specifying a default destination. For example:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 要将所有垃圾邮件放在单独的垃圾邮件文件夹中，请确保`global/etc/procmailrc`文件中有一行指定默认目的地。例如：
- en: '[PRE27]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'If not, then add a line specifying `DEFAULT`. To filter spam into a folder,
    add a recipe similar to the following:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不是，则添加一行指定`DEFAULT`。要将垃圾邮件过滤到文件夹中，请添加类似以下的配方：
- en: '[PRE28]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: This assumes that each user has a folder called `SPAM` already configured.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 这假设每个用户已经配置了一个名为`SPAM`的文件夹。
- en: 'To place all the spam in a single, central folder, use an absolute path to
    the destination in the recipe:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 要将所有垃圾邮件放在一个单一的中央文件夹中，请在配方中使用目的地的绝对路径：
- en: '[PRE29]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: This will place all spam in a single folder, which can be reviewed by the system
    administrator. As regular e-mail may occasionally be wrongly detected as spam,
    the folder should not be world-readable, which leads to a more generalized statement.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 这将把所有垃圾邮件放在一个单独的文件夹中，可以由系统管理员进行审核。由于常规电子邮件偶尔会被错误地检测为垃圾邮件，因此该文件夹不应该是全世界可读的，这导致了一个更普遍的陈述。
- en: Note
  id: totrans-159
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: SpamAssassin will be run under the system account used by Postfix. This means
    that the Bayesian database and the auto-whitelists and blacklists will be shared
    by all users. From a security point of view, it's important that the various databases
    that SpamAssassin creates are not world-writable.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin将在由Postfix使用的系统帐户下运行。这意味着贝叶斯数据库和自动白名单和黑名单将被所有用户共享。从安全的角度来看，重要的是SpamAssassin创建的各种数据库不可被全世界写入。
- en: 'SpamAssassin stores user-specific files in the `~/.spamassassin/` directory.
    Here is a list of files that *may* be present for a user:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: SpamAssassin将用户特定文件存储在`~/.spamassassin/`目录中。以下是用户可能存在的文件列表：
- en: '| Files | Contents |'
  id: totrans-162
  prefs: []
  type: TYPE_TB
  zh: '| 文件 | 内容 |'
- en: '| --- | --- |'
  id: totrans-163
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `auto-whitelist``aauto-whitelist.db``aauto-whitelist.dir``aauto-whitelist.pag`
    | SpamAssassin creates a database of users who send ham (non-spam messages) and
    uses it to predict whether an e-mail from a particular sender is spam or ham.
    These files are used to track users. |'
  id: totrans-164
  prefs: []
  type: TYPE_TB
  zh: '| `auto-whitelist``aauto-whitelist.db``aauto-whitelist.dir``aauto-whitelist.pag`
    | SpamAssassin创建一个用户发送非垃圾邮件的数据库，并使用它来预测特定发件人的电子邮件是垃圾邮件还是非垃圾邮件。这些文件用于跟踪用户。|'
- en: '| `bayes_journal``bayes_seen``bayes_toks` | SpamAssassin uses a statistical
    technique called Bayesian analysis. These files are used for this feature. |'
  id: totrans-165
  prefs: []
  type: TYPE_TB
  zh: '| `bayes_journal``bayes_seen``bayes_toks` | SpamAssassin使用一种称为贝叶斯分析的统计技术。这些文件用于此功能。'
- en: '| `user_prefs` | This file allows global settings to be overridden for a particular
    user. This file can contain configuration settings, rules, and scores. |'
  id: totrans-166
  prefs: []
  type: TYPE_TB
  zh: '| `user_prefs` | 此文件允许为特定用户覆盖全局设置。该文件可以包含配置设置、规则和分数。'
- en: Some of them may contain confidential data for example, regular contacts will
    appear in the auto-whitelist files. Careful use of permissions will ensure that
    the files are not readable by regular user accounts.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 其中一些可能包含机密数据，例如，常规联系人将出现在自动白名单文件中。谨慎使用权限将确保这些文件不可被普通用户帐户读取。
- en: Using SpamAssassin on a per-user basis
  id: totrans-168
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在每个用户的基础上使用SpamAssassin
- en: Perhaps some users don't receive spam, or there may be issues with users sharing
    whitelists and Bayesian databases. SpamAssassin can be run on an individual basis
    by moving the recipes to the `~/.procmailrc` of specific users. This should increase
    the filtering performance for each user, but increases disk space usage for each
    user and requires setting up each individual user account by modifying its `~/.procmailrc`.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 也许有些用户不会收到垃圾邮件，或者用户共享白名单和贝叶斯数据库可能存在问题。SpamAssassin可以通过将配方移动到特定用户的`~/.procmailrc`来在个人基础上运行。这应该提高每个用户的过滤性能，但会增加每个用户的磁盘空间使用量，并需要通过修改其`~/.procmailrc`设置每个单独的用户帐户。
- en: 'A typical user''s `.procmailrc` might look like this:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 典型用户的`.procmailrc`可能如下所示：
- en: '[PRE30]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: As suggested, e-mail may sometimes be wrongly detected as spam. It's worthwhile
    reviewing spam to ensure that legitimate e-mails have not been wrongly classified.
    If the user receives a lot of spam, then wading through it all is time consuming,
    tedious, and error prone. Procmail can filter spam by checking the spam score
    written in the e-mail headers by SpamAssassin.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 如建议的，有时电子邮件可能被错误地检测为垃圾邮件。值得回顾垃圾邮件，以确保合法的电子邮件没有被错误分类。如果用户收到大量垃圾邮件，那么浏览所有这些邮件是耗时、乏味且容易出错的。Procmail可以通过检查SpamAssassin在电子邮件标题中写入的垃圾邮件分数来过滤垃圾邮件。
- en: The low-scoring spam (for example, scoring up to 9) can be placed in one folder
    called `Probable_Spam`, while higher scoring e-mails (which are more likely to
    be spam) can be placed a folder called `Certain_Spam`.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 低分垃圾邮件（例如，得分高达9分）可以放在一个名为`Probable_Spam`的文件夹中，而得分更高的垃圾邮件（更有可能是垃圾邮件）可以放在一个名为`Certain_Spam`的文件夹中。
- en: 'To do this, we use the `X-Spam-Level` header, which SpamAssassin creates. This
    is simply the number of asterisks, related to the `X-Spam-Level` value. By moving
    e-mail with more than a certain number of asterisks to the `Certain_Spam` folder,
    the remaining spam is "Probable Spam". E-mail that is marked with `X-Spam-Flag:
    NO`, is obviously not spam.'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '为此，我们使用SpamAssassin创建的`X-Spam-Level`标题。这只是与`X-Spam-Level`值相关的星号数量。通过将具有超过一定数量星号的电子邮件移动到`Certain_Spam`文件夹，其余的垃圾邮件就是“Probable
    Spam”。标有`X-Spam-Flag: NO`的电子邮件显然不是垃圾邮件。'
- en: 'The following `.procmailrc` file will filter high scoring spam separately from
    low scoring spam and non spam:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 以下的`.procmailrc`文件将高分垃圾邮件与低分垃圾邮件和非垃圾邮件分开过滤：
- en: '[PRE31]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Using SpamAssassin as a daemon with Postfix
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用SpamAssassin作为Postfix的守护程序
- en: A daemon is a background process; one that waits for work, processes it, and
    then waits for more work. Using this approach actually improves performance (as
    long as there is sufficient memory) because responsiveness is improved—the program
    is always ready and waiting and does not have to be loaded each time spam tagging
    is required.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 守护程序是一个后台进程；它等待工作，处理工作，然后等待更多工作。使用这种方法实际上提高了性能（只要有足够的内存），因为响应性得到了改善——程序始终准备好并等待，不需要每次需要标记垃圾邮件时加载。
- en: 'To use SpamAssassin as a daemon, a user account should be added—it''s dangerous
    to run any service as `root`. As `root`, enter the following commands to make
    a user and a group called spam:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 要将SpamAssassin作为守护程序使用，应添加一个用户帐户——以`root`身份运行任何服务都是危险的。作为`root`，输入以下命令以创建名为spam的用户和组：
- en: '[PRE32]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: To configure Postfix to run SpamAssassin, use SpamAssassin as a daemon. The
    Postfix `master.cf` file must be changed. Edit the file and locate the line that
    begins with`'smtp inet'`. Amend the line to add `-o content_filter=spamd` to the
    end.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置Postfix运行SpamAssassin，使用SpamAssassin作为守护程序。必须更改Postfix的`master.cf`文件。编辑文件并找到以`'smtp
    inet'`开头的行。修改该行以在末尾添加`-o content_filter=spamd`。
- en: '[PRE33]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Add the following lines to the end of the file:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在文件末尾添加以下行：
- en: '[PRE34]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: If the text is spread across several lines, any continuing line must begin with
    spaces as shown. The changes to the file define a filter called `spamd` that runs
    the `spamc` client for each message and also specifies that the filter should
    be run whenever an e-mail is received via SMTP.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 如果文本跨越多行，则任何继续的行必须以所示的空格开头。对文件的更改定义了一个名为`spamd`的过滤器，该过滤器为每条消息运行`spamc`客户端，并且还指定应在通过SMTP接收电子邮件时运行该过滤器。
- en: On this line, `spamd` is the name of the filter and matches the name used in
    the `content_filter` line. The `user=` portion specifies the user context that
    should be used to run the command. The `argv=` portion describes the program that
    should be run. The other flags are used by Procmail and their presence is important.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 在此行上，`spamd`是过滤器的名称，并与`content_filter`行中使用的名称匹配。`user=`部分指定应用于运行命令的用户上下文。`argv=`部分描述应运行的程序。Procmail使用其他标志，它们的存在很重要。
- en: Using SpamAssassin with amavisd-new
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**amavisd-new** is an interface between MTAs and content checkers. Despite
    its name, amavisd-new is a well-established open source package that is well maintained.
    Content checkers scan e-mail for viruses and/or spam. amavisd-new is slightly
    different. Just like like `spamd`, it is written in Perl and runs as a daemon,
    but instead of accessing SpamAssassin via the `spamc` or `spamassassin` clients,
    it loads SpamAssassin into memory and accesses the SpamAssassin functions directly.
    It is therefore closely coupled to SpamAssassin and may need to be upgraded at
    the same time as SpamAssassin.'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: Unlike other Perl-based applications and utilities, amavisd-new is not available
    from CPAN. However, it is available in source form and RPM form for many distributions
    of Linux, and is also available for debian-based repositories. Details of versions
    available are listed on [http://www.ijs.si/software/amavisd/#download](http://www.ijs.si/software/amavisd/#download).
    We recommend that if the version of SpamAssassin that your distributor offers
    is up-to-date, then you should use their package of both SpamAssassin and amavisd.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
- en: Installing amavisd-new from package
  id: totrans-190
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To install amavisd-new from package, use the `rpm` command for RPM-based distributions.
    amavisd-new has many dependencies, all of which are Perl modules. Each version
    may have different dependencies, which are listed in the install file that is
    a part of the package. The Perl prerequisites for version 2.6.2 are as follows:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: To view the prerequisites for a particular version of amavisd-new, download
    the source and unpack it as shown here, and read the install file.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Several of the dependencies may be installed already, as they are also used
    by SpamAssassin.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
- en: Installation prerequisites
  id: totrans-196
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Some RPM-based Linux distributions may automatically install the prerequisites
    as dependencies. For other distributions, all the prerequisites must be downloaded
    from CPAN and installed. This is easiest to accomplish with the `cpan` command.
    An alternative method is to download the source code for each prerequisite individually
    and install it with the following commands:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Installing from source
  id: totrans-199
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'amavisd-new has no makefile, configuration script, or installation routine.
    To install it, the sole executable script is copied to `/usr/local/bin`, and its
    attributes modified to ensure it cannot be modified by non-root users:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: The sample `amavisd.conf` file should be copied to `/etc` and its attributes
    should also be modified.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: amavisd-new must be configured to run as a daemon, and so the sample `init`
    script should be copied to the appropriate directory.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE40]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: The `init` script should also be added to the system startup. Most Linux distributions
    use the `chkconfig` command to do this.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: Creating a user account for amavisd-new
  id: totrans-208
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To create a user account, first create a dedicated group using the `groupadd`
    command and then use the `useradd` command to add the user.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: Configuring amavisd-new
  id: totrans-211
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Several changes need to be made to the `/etc/amavisd.conf` file. This file
    will be parsed as Perl source, and syntax is important. Each line should end in
    a semicolon, and the casing is important. The following variable declaration lines
    should be changed to contain the following values:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: Ensure that the correct domain is specified for `$mydomain`. The number `5`
    specified for `$max_servers` is the number of daemons that will be run concurrently.
    If you have a modest amount of e-mail, for example less than ten messages a second,
    the default will be sufficient.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
- en: 'Within `/etc/amavisd.conf`, there is a section on SpamAssassin-related configuration
    settings:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE44]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: These three settings are used with the SpamAssassin score level associated with
    the e-mail being processed. The `$sa_tag_level_deflt` setting is the threshold
    at which ham is separated from spam and the `X-Spam-Status` and `X-Spam-Level`
    headers are added to an e-mail.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
- en: E-mails that score below this threshold do not have headers added, while e-mails
    above the threshold will have headers added. The `$sa_kill_level_deflt` setting
    is the threshold at which spam e-mail is rejected.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
- en: 'The default configuration is to reject spam. To forward spam to another e-mail
    address, locate the line specifying `$final_spam_destiny` or add one if it is
    not present, and make it read as follows:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE45]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: The recipient of the spam has to be defined. Locate the line that specifies
    `$spam_quarantine_to`, and alter it or add one to contain an e-mail address. The
    `$mydomain` variable, which was configured earlier in this step, can be used to
    refer to the domain—remember to prefix the `@` symbol with a backslash.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE46]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Now, amavisd-new should be started. Most Linux distributions use the following
    command:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE47]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: Configuring Postfix to run amavisd-new
  id: totrans-225
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Edit `/etc/postfix/master.cf` and locate this line:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Add these lines after it:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE49]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: In the `smtp-amavis` line, the number `5` specifies the number of instances
    that can be used at once. This should correspond to the `$max_servers` entry specified
    in the `amavisd.conf` file.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
- en: 'Edit `/etc/postfix/main.cf` and add the following line near the end of the
    file:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE50]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Restart Postfix with the `postfix reload` command:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE51]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: Configuring e-mail clients
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Instead of placing spam in a separate folder by using Procmail, this can be
    performed by the e-mail client. Most e-mail clients allow rules or filters to
    be created. These typically come into action when new e-mail is read or a folder
    is opened.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
- en: 'Rules in an e-mail client run on the value of an e-mail header. It is best
    to use the `X‑Spam-Flag` and search for the value `YES`. The procedure to move
    tagged messages to a separate folder is outlined as follows:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
- en: Create a folder or mailbox for holding spam e-mail. The folder name should be
    intuitive, for example `Spam`.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Create a rule to be run when e-mails arrive. The rule should look for the text
    `X‑Spam-Flag` in the message headers.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The action on the rule should be to move the e-mail to the `Spam` folder created
    in the first step.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the filter is created, send test messages, both spam and non-spam, to check
    that the filter works properly.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Microsoft Outlook
  id: totrans-242
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Microsoft Outlook is popular in large organizations. It integrates well with
    IMAP servers. Follow the next steps to configure Outlook to filter spam, based
    on the `X‑Spam‑Flag` in e-mail headers:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-244
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: These instructions are based on Outlook as shipped with Microsoft Office XP;
    other versions have similar configuration details.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: Create a folder to store the spam. Click on the **Inbox** in the folder list
    to select it, right-click and select **New Folder** from the menu. Choose Spam,
    or another meaningful name and then click **OK**.![Microsoft Outlook](img/8648_08_05.jpg)
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Tools** menu and select **Rules and Alerts**. Click on **New
    Rule** to create a new rule.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Microsoft Outlook](img/8648_08_06.jpg)'
  id: totrans-248
  prefs: []
  type: TYPE_IMG
- en: Select **Check messages when they arrive** from under **Start from a blank rule**.
    Click **Next**.
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Check with specific words in the message header. This will allow Outlook to
    check the X-Spam-Flag e-mail header. Click on specific words to select the correct
    phrase.
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Microsoft Outlook](img/8648_08_07.jpg)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
- en: 'In the next dialog, carefully enter **X-Spam-Flag: YES** and click **Add**.
    Then press **OK**, and click **Next**.'
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Microsoft Outlook](img/8648_08_08.jpg)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
- en: The next window offers a choice of actions. Choose **move it to the specified
    folder** and click on **specified**, which will display a list of folders.
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Microsoft Outlook](img/8648_08_09.jpg)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
- en: Choose the folder created earlier and press **OK**. Click **Finish**. There
    are no exceptions, so click **Next** again.
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The Rules Wizard allows the rule to be run immediately on any existing messages
    in the Inbox. To do this, make sure that the checkbox next to **Turn on this rule
    is checked**.
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, click **Finish** and the rule is created and run on all messages in
    the Inbox.
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Microsoft Outlook Express
  id: totrans-259
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Outlook Express is shipped with most versions of Windows up to and including
    Windows XP. It provides POP3 connectivity and many features such as HTML e-mail.
    Some e-mail clients, including Outlook Express, do not allow filtering on every
    e-mail header, but only on certain specific headers such as the `From:` and `Subject:`
    headers. By default, SpamAssassin writes only additional headers, but it can be
    configured to alter the `Subject, From`, or `To` headers of an e-mail. To do this,
    the `/etc/spamassassin/local.cf` file should be altered. This change can also
    be made on a per-user basis by editing `~user/.spamassassin/user_prefs`.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following line to the file:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE52]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: This will change the header of the e-mail to `*****SPAM*****`. The tag can be
    altered if desired.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that SpamAssassin configuration is complete, Outlook Express can be configured
    to act on the modified message subject. Follow these steps:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
- en: Create a folder for the Spam. To do this, select the **File** menu, click on
    **Folder**, and then on **New**. Type in **Spam**, or another descriptive name,
    as the folder name, and then click **OK**.
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Tools** menu, then select **Message Rules**, and then **New**.
    On the next window, ensure that the conditions include **Where the Subject line
    contains specific words**, and the actions include **Move it to the specified
    folder**.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Microsoft Outlook Express](img/8648_08_10.jpg)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
- en: Click on **contains specific words**, and enter *******SPAM*******, or the alternative
    phrase chosen when configuring SpamAssassin. Click **OK**.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Microsoft Outlook Express](img/8648_08_11.jpg)'
  id: totrans-269
  prefs: []
  type: TYPE_IMG
- en: Click on **specified** in the next line of the **Rule Description**. Select
    the folder created and click **OK**.![Microsoft Outlook Express](img/8648_08_12.jpg)
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The rule is summarized. Give it a meaningful name, such as Spam, then click
    **OK** to save it.
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Mozilla Thunderbird
  id: totrans-272
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Mozilla Thunderbird is a free, open source e-mail client with most of the features
    of Microsoft Outlook. It is available free at [www.mozilla.org/products/thunderbird/](http://www.mozilla.org/products/thunderbird/).
    It has full filtering capabilities. To configure it, follow these steps:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
- en: Create a folder to store the spam. Click on the **File** menu and select **New**
    | **Folder**. Choose a location (the inbox should be fine) and a name, such as
    **Spam**. Click **OK**.
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Mozilla Thunderbird](img/8648_08_13.jpg)'
  id: totrans-275
  prefs: []
  type: TYPE_IMG
- en: Click on the **Tools** menu and select **Message Filters**. Click on the **New**
    button to create a new filter.
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Mozilla Thunderbird](img/8648_08_14.jpg)'
  id: totrans-277
  prefs: []
  type: TYPE_IMG
- en: In the next dialog, choose a name for the filter such as **Spam**. Then select
    the **Match any of the following** button. In the left list, type **X-Spam-Status**,
    in the middle list select **is**, and in the right select **Yes**. In the box
    below, click on **Move Message to**, and select the folder created in the first
    step.![Mozilla Thunderbird](img/8648_08_15.jpg)
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **OK**, and the rule summary will show the rule. Press **Run Now** to
    test the rule.
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Mozilla Thunderbird](img/8648_08_16.jpg)'
  id: totrans-280
  prefs: []
  type: TYPE_IMG
- en: Customizing SpamAssassin
  id: totrans-281
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: SpamAssassin is very configurable. Almost every setting can be configured on
    a system-wide or user-specific basis.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
- en: Reasons to customize
  id: totrans-283
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If SpamAssassin is so good, then why configure it? Well, there are several reasons
    why it's worth improving spam filtering with SpamAssassin.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
- en: SpamAssassin by default (that is, when installed but not customized) typically
    manages to detect over 80% of spam. After adding a few customizations, the detection
    rate can be greater than 95%.
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Everyone's spam is different and one user's spam might look like another user's
    ham. By trying to be general, SpamAssassin may fail to filter spam for every user.
  id: totrans-286
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Some of the features of SpamAssassin are disabled by default. By enabling them,
    the spam recognition rate is increased.
  id: totrans-287
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following configuration options are discussed in this chapter:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
- en: '**Altering the scores for rules:** This allows rules to be disabled, poor rules
    to be given less weight, and better rules to be given a higher weight.'
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Obtaining and using new rules:** This can improve spam detection.'
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Adding e-mail addresses to white and blacklists:** This allows the e-mail
    from specified senders to always be treated as ham, no matter what the content
    is, or the opposite.'
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Enabling SpamAssassin''s Bayesian filter:** This can increase filtering accuracy
    from 80% to 95% or more.'
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Rules and scores
  id: totrans-293
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The configuration files for standard, sitewide, and user-specific settings
    are saved in different directories as follows:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
- en: Standard configuration settings are stored in `/usr/share/spamassassin`.
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Site-wide customizations and settings are stored in `/etc/mail/spamassassin/`.
    All files matching `*.cf` are examined by SpamAssassin.
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User-specific settings are stored in `~/.spamassassin/local.cf`.
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The bulk of the standard configuration files is devoted to simple rules and
    their scores.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
- en: A rule is typically a match for letters, numbers, or other printing characters.
    Rules are written using a technique called regular expressions, or regex for short.
    This is a shorthand method of specifying that certain combinations of characters
    will trigger the rule. A rule might try to detect a particular word, such as "Rolex",
    or it might look for particular words in certain orders, such as "buy Rolex online".
    The rules are stored in text files.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
- en: Default files are stored in `/usr/share/spamassassin`. These are files that
    are shipped with SpamAssassin and may change with each release. It's best not
    to modify these files or place new files in this directory, as an upgrade to SpamAssassin
    will overwrite these files. Most of the rules that SpamAssassin uses, and the
    scores applied to each rule, are defined within files in this directory.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
- en: The defaults can be overwritten by sitewide configuration files. These are placed
    in `/etc/mail/spamassassin`. SpamAssassin will read all files matching `*.cf`
    in this directory. Settings made here can overrule those in the default files.
    They can include defining new rules and new rule scores.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
- en: User-specific customizations can be placed in the `~/.spamassassin/local.cf`
    file. Settings made here can override sitewide settings defined in `/etc/mail/spamassassin`,
    and default settings in `/usr/share/spamassassin/`. New rules may be defined here,
    and scores for existing rules can be overridden.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
- en: SpamAssassin first reads all the files in `/usr/share/spamassassin` in alphanumerical
    order; `10_misc.cf` will be read before `23_bayes.cf`. SpamAssassin then reads
    all the `.cf` files in `/etc/mail/spamassassin/`, again in alphanumeric order.
    Finally, SpamAssassin reads `~user/.spamassassin/user_prefs`. If a rule or score
    is defined in two files, the setting in the last file read is used. This allows
    the administrator to override the defaults and a user to override the sitewide
    settings.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
- en: Each line in a rules file can be blank or contain a comment or a command. The
    hash or pound (#) symbol is used for comments. Rules generally have three parts,
    the rule definition, a textual description, and the score or series of scores.
    Convention dictates that all rule scores for rules provided by SpamAssassin should
    be located together in a separate file. That file is `/usr/share/spamassassin/50_scores.cf`.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
- en: Altering rule scores
  id: totrans-305
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The simplest configuration change is to change a rule score. There are two
    reasons why this might be done:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
- en: A rule is very good at detecting spam, but the rule has a low score. E-mails
    that fire the rule are not being detected as spam.
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A rule is acting on non spam. As a result, e-mails that fire the rule are wrongly
    being detected as spam.
  id: totrans-308
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The rules that give a positive result when SpamAssassin is run are listed in
    the `X-Spam-Status:` header of the e-mail:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE53]'
  id: totrans-310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: The rules applied to the e-mail are listed after `tests=`. If one continually
    appears in e-mail that should be marked as spam, but isn't, then the score for
    the rule should be increased. If a rule often fires in e-mail that is wrongly
    classified as spam, the score should be decreased.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
- en: To find the current score, use the `grep` utility in all the locations where
    a score can be defined.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE54]'
  id: totrans-313
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: '[PRE55]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: In the previous example, the rule has a default score that is overridden in
    `/etc/mail/spamassassin/local_scores.cf`.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
- en: 'The original score for the rule had four values. SpamAssassin changes the scores
    it uses, depending on whether network tests (for example, those that test open
    relays) are in use and whether the Bayesian Filter is in use. Four scores are
    listed, which are used in the following circumstances:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
- en: '|   | **Bayesian filter not in use** | **Bayesian filter in use** |'
  id: totrans-317
  prefs: []
  type: TYPE_TB
- en: '| **External tests not in use** | 1st score | 3rd score |'
  id: totrans-318
  prefs: []
  type: TYPE_TB
- en: '| **External tests in use** | 2nd score | 4th score |'
  id: totrans-319
  prefs: []
  type: TYPE_TB
- en: If only one score is given, as overridden in `/etc/mail/spamassassin/ local_scores.cf`,
    it is used in all circumstances.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
- en: 'In the previous example, the system administrator has overridden the default
    score in `/etc/mail/spamassassin/local_scores.cf` with a single value in `/etc/mail/spamassassin/local_scores.cf`.
    To change this value for a particular user, their `~/.spamassassin/local.cf` might
    read:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE56]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: This changes the score used from `4.34`, set in `/etc/mail/spamassassin/ local_scores.cf`,
    to `1.2`. To disable the rule entirely, the score can be set to zero.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE57]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: Endless hours can be spent configuring rule scores. SpamAssassin includes tools
    to recalculate optimal rule scores, by examining existing e-mails, both spam and
    non spam. They are covered in detail in the book *SpamAssassin* published by Packt.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
- en: Using other rulesets
  id: totrans-326
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: SpamAssassin has a large following, and the design of SpamAssassin has made
    it easy to add new rulesets, which are sets of rules and default scores for those
    rules. There are many different rulesets available. Most are based on a particular
    theme, for example finding the names of drugs often sold with spam or telephone
    numbers found in spam e-mails. Most custom rulesets are listed on the Custom Rulesets
    page of the SpamAssassin Wiki at [http://wiki.apache.org/spamassassin/CustomRulesets](http://wiki.apache.org/spamassassin/CustomRulesets).
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
- en: As the battle against spam is so aggressive, rulesets have been developed that
    may possibly be uploaded daily. SpamAssassin provides this ability with the `sa-update`
    utility. You can choose to use `sa-update` on a regular basis, or to download
    a particular ruleset and keep it, or to manually update the rulesets that you
    choose. To obtain the best results in filtering spam, use of `sa-update` is recommended.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
- en: 'If you wish to install rulesets manually, the Wiki page gives a general description
    of each ruleset and a URL to download it. Once a ruleset has been chosen, we install
    it as follows:'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
- en: In a browser, follow the link on the SpamAssassin Wiki page. In most cases,
    the link will be to a file with a name matching `*.cf`, and a browser will open
    it as a text file.
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Save the file using the browser (normally, the **File** menu has a **Save as**
    option).
  id: totrans-331
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Copy the file to `/etc/mail/spamassassin`—the rules will be automatically run
    if the file is placed in this location.
  id: totrans-332
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Check that the file has scores in it, otherwise the rules will not be used.
  id: totrans-333
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Monitor spam performance to ensure that legitimate e-mail is not being detected
    as spam.
  id: totrans-334
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Adding rules to SpamAssassin will increase the memory used by SpamAssassin,
    and the time that it takes to process e-mails. It is best to be cautious and add
    new rulesets gradually, to ensure that the effect on the machine is understood.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
- en: You may manually monitor the ruleset and update it on your system using the
    same process.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
- en: If you choose to use `sa-update`, you should plan your use of it. sa-update
    can use several channels, which are basically sources of rulesets. By default,
    the channel updates.spamassassin.org is used; another popular channel is the OpenProtect
    channel, called [saupdates.openprotect.com](http://saupdates.openprotect.com).
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
- en: 'To enable `sa-update`, it must be run regularly, for example via cron. Add
    a cron entry to your system calling the following commands, to update the base
    rulesets:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE58]'
  id: totrans-339
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'If you use an additional channel, the command might look like:'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE59]'
  id: totrans-341
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Tip
  id: totrans-342
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To protect against DNS poisoning and impersonation, SpamAssassin allows digital
    signing of rulesets. To use a signed ruleset, use the`—gpgkey`—parameter to`sa-update`.
    The correct value to use with the`—gpgkey` parameter will be described in the
    SpamAssassin wiki page for the ruleset.
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
- en: Whitelists and blacklists
  id: totrans-344
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: SpamAssassin is very good at detecting spam, but there is always a risk of errors.
    By using a list of e-mail addresses that are known spam producers (a blacklist),
    e-mails from spammers who consistently use the same e-mail addresses or domains
    can be filtered out. With a list of e-mail addresses that are legitimate e-mail
    senders (a whitelist), e-mails from regular or important correspondents are guaranteed
    to be filtered as ham. This prevents the delay or non delivery of important e-mails
    that may otherwise be marked as spam.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
- en: Blacklists that list individual e-mail addresses have limited use spammers normally
    use different or random e-mail addresses for each spam run. However, some spammers
    use the same domain for multiple runs. As SpamAssassin allows wildcards in its
    blacklisting, entire domains can be blacklisted. This is more useful for filtering
    out spam.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
- en: Manual whitelisting and blacklisting involves adding configuration directives
    to the global configuration file `/etc/mail/spamassassin/local.cf` and/or in `~/.spamassassin/user_prefs`.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
- en: The whitelist and blacklist entries allow the `?` and `*` characters to be used
    to match a single character or many characters respectively. So, if a whitelist
    entry read `*@domain.com`, then `joe@domain.com` and `bill@domain.com` would both
    match. For an entry that read `*@yahoo?.com, joe@yahoo1.com` and `bill@yahoo2.com`
    would match, but `billy@yahoo22.com` would not match. `*@yahoo*.com` would match
    all three examples.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
- en: The whitelist and blacklists rules do not immediately cause an e-mail to be
    tagged as spam or ham, even though the scores are heavily weighted. The default
    score for the `USER_IN_WHITELIST` rule is `-100.0`. It is technically possible
    that an e-mail may match a whitelist entry and still trigger enough other tests
    to result in it being marked as spam. Although in practice, this is unlikely to
    occur, unless the scores have been changed from the defaults.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
- en: To blacklist an e-mail address or whole domain, use the `blacklist_from` directive.
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE60]'
  id: totrans-351
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: To whitelist an e-mail address or domain, use the `whitelist_from` directive.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE61]'
  id: totrans-353
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: SpamAssassin has more complex rules for managing white and blacklists, as well
    as an automatic whitelist/blacklist. Both blacklists and whitelists can be specified
    as discrete items `(blacklist joe@domain.com` and `bill@another.com)` or as wildcards
    (blacklist every `joe`, and blacklist everyone from `domain.com`). The wildcards
    are particularly powerful, and care should be taken to ensure that legitimate
    e-mail is not rejected.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
- en: Bayesian filtering
  id: totrans-355
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This uses a statistical technique to determine if an e-mail is spam, based on
    previous e-mails of both types. Before it will work, it needs to be trained with
    e-mail that is known spam and also e-mail that is known non spam. It is important
    that the e-mail is correctly categorized, otherwise the effectiveness of the filter
    will be reduced. The learning process is done on the e-mail server, and the sample
    e-mails should be stored in an accessible location.
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
- en: The `sa-learn` command is used to train the Bayesian filter with e-mail messages
    that are known ham or spam. The SpamAssassin installation routine will have placed
    `sa-learn` in the path, normally in `/usr/bin/sa-learn`.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
- en: 'It is used on the command line and is passed a directory, file, or series of
    files. For this to work, the e-mail has to be stored on the server or exported
    from the client in a suitable format. SpamAssassin recognizes `mbox` format, and
    many e-mail clients use a compatible format. To use `sa-learn`, a directory or
    series of directories can be passed in to the command:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE62]'
  id: totrans-359
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: '[PRE63]'
  id: totrans-360
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: If the `mbox` format is used, the `mbox` flag should be used so that SpamAssassin
    searches the file for more than one e-mail.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE64]'
  id: totrans-362
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: '[PRE65]'
  id: totrans-363
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: If SpamAssassin has already learned from an e-mail, `sa-learn` detects this
    and will not process it twice. In the example above, 100 of the 175 e-mails had
    been processed already and were ignored on this run. The remaining 75 e-mails
    had not been processed before.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
- en: If `sa-learn` is passed a number of messages, there may be no feedback for some
    time. The `--showdots` flag provides feedback in the form of dots (.) whenever
    an e-mail is processed.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE66]'
  id: totrans-366
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: '[PRE67]'
  id: totrans-367
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: Once SpamAssassin has learned enough e-mails, it will begin to use the Bayesian
    filter automatically. It can be kept up-to-date by using the auto-learn feature.
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
- en: Auto-learning should not be used without additional user input. There are two
    reasons for doing this.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
- en: SpamAssassin occasionally gets spam detection wrong, and e-mail that is spam
    may be learned as an example of non spam. Auto-learning would confuse the Bayesian
    filter and decrease its effectiveness.
  id: totrans-370
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The score threshold that an e-mail is auto-learned at is higher than that for
    detection as spam. In other words, an e-mail may be detected as spam, but not
    auto-learned. In this case, the rest of SpamAssassin is doing a fairly good job
    of detecting border-line spam (those with scores close to the threshold for spam),
    but the Bayesian filter is not being taught the e-mails.
  id: totrans-371
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To use automatic learning, set the `bayes_auto_learn` flag to `1`. This can
    be configured sitewide in the `/etc/mail/spamassassin/local.cf` file, or can be
    overridden in a user's `~/.spamassassin/user_prefs` file. Two other configuration
    flags also affect auto-learning, and are the thresholds for learning ham and spam.
    These values are in the same units as SpamAssassin's score for each e-mail.
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE68]'
  id: totrans-373
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: When auto-learning is enabled, any e-mail that is assigned a score of less than
    `bayes_auto_learn_threshold_nonspam`, is learned as ham. Any e-mail that is assigned
    a value greater than `bayes_auto_learn_threshold_spam`, is learned as spam.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
- en: It is recommended that the `bayes_auto_learn_threshold_nonspam` threshold is
    kept low (close to or below zero). This will avoid the situation where a spam
    e-mail that escapes detection is used as an example to train the Bayesian filter.
    Keeping the `bayes_auto_learn_threshold_spam` threshold high is to some extent
    a matter of choice; however, it should be above the scores of any e-mails that
    have been wrongly classified as spam in the past. This may occur up to a score
    of `10` for the default spam threshold of `5`. Therefore, using an auto-learn
    threshold of less than `10` for spam may cause non spam to be accidentally learned
    as spam. If this happens, the Bayesian database will begin to lose effectiveness,
    and future Bayesian results will be compromised.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
- en: 'SpamAssassin keeps the Bayesian database in three files in the `.spamassassin`
    directory within a user''s home directory. The format used is usually Berkeley
    DB format and the files are named as follows:'
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE69]'
  id: totrans-377
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: The `bayes_journal` file is used as a temporary storage area. Sometimes it is
    not present. This file is generally relatively small, with a size of around 10
    KB. The `bayes_seen` and `bayes_toks` files can each be several megabytes in size.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
- en: Other SpamAssassin features
  id: totrans-379
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This chapter has only scratched the surface of SpamAssassin''s capabilities.
    If spam is a problem for an organization, SpamAssassin will reward further study.
    Some of the other features that it contains are as follows:'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
- en: '**Network tests:** SpamAssassin can integrate with Open Relay Databases. (The
    3.x distribution contains tests for over 30 databases, although not all of them
    are enabled by default.) Open Relay tests do not require a fast machine or lots
    of RAM, and so are relatively cheap tests to use. They have a fairly successful
    detection rate.'
  id: totrans-381
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**External content databases:** SpamAssassin can integrate with external content
    databases. These work in a participating network. All the participants send details
    of all the e-mails they receive to central servers. If the e-mails have been sent
    many times before, the e-mail is probably a spam that has been sent to many users.
    The services are designed so that no confidential data is sent.'
  id: totrans-382
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Whitelist and blacklist:** SpamAssassin includes an automatic whitelist and
    blacklist, which work in a similar way to the manual lists described earlier.
    This is particularly effective at preventing regular correspondents from having
    their e-mail wrongly detected as spam.'
  id: totrans-383
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Creating new rules:** New rules can be written and developed. Creating rules
    is not particularly difficult, with a little imagination and a suitable source
    of spam. System Administrators can rid their users of any persistent spam that
    fails to be detected with the default SpamAssassin rules.'
  id: totrans-384
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Customizable headers:** The headers that SpamAssassin adds to e-mails can
    be customized, and new headers can be written. SpamAssassin will also attempt
    to detect viruses and Trojan software, and will wrap an e-mail address like that
    in a special envelope e-mail.'
  id: totrans-385
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Multiple installations:** SpamAssassin can be installed on multiple machines,
    serving one or more e-mail servers. In very high volume e-mail systems, many spam
    servers may be run, each only processing spam. This leads to a high-throughput,
    high-availability service.'
  id: totrans-386
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Customizable rule scores:** SpamAssassin includes tools to customize rule
    scores, based on samples of the spam and legitimate e-mail received at an organization.
    This helps to improve the filtering rate. With SpamAssasin 3.0, the tools were
    improved significantly, and the procedure to perform this is much less time consuming
    than it was in earlier versions.'
  id: totrans-387
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Summary
  id: totrans-388
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, you have seen how SpamAssassin can be obtained and installed.
    Three different methods of using SpamAssassin were presented, with suggestions
    on which option to choose for a particular installation.
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
- en: Configuration of popular e-mail clients was also covered, namely Microsoft Outlook,
    Microsoft Outlook Express, and Mozilla Thunderbird.
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
