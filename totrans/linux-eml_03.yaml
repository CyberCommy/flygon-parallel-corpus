- en: Chapter 3. Incoming Mail with POP and IMAP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Now that you have a functioning e-mail server, the next stage is to give users
    access to their e-mail. In this chapter, you will learn the following:'
  prefs: []
  type: TYPE_NORMAL
- en: What POP and IMAP are, and how to choose which of them you should implement
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to install and configure Courier-IMAP, which can provide both POP and IMAP
    functionality
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to configure e-mail servers to be accessible to clients
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to configure popular e-mail clients to use the services provided by your
    e-mail server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Choosing between POP and IMAP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Postfix will receive e-mail and deliver it to the user's inbox, but additional
    software is required to allow users to read their e-mail with ease. There are
    two standards for retrieval of e-mail from a host. The first is called **Post
    Office Protocol** (**POP**). POP3 is the most commonly used version of POP. This
    is normally used to download e-mail from the server, store it in a client application,
    and remove the e-mail from the server. This is often used by Internet Service
    Providers. The e-mail is subsequently manipulated by the client application, for
    example, Windows Live Mail or Mozilla Thunderbird.
  prefs: []
  type: TYPE_NORMAL
- en: The second protocol is called **Internet Message Access Protocol** (**IMAP**).The
    IMAP system is usually used when you want a copy of each e-mail to stay on the
    server. IMAP allows users to create folders for e-mail and to move or copy e-mail
    between the folders. The client application accesses the e-mail on the server,
    but does not have to store it on the client machine.The e-mail server must be
    able to store all of the e-mails for all of its users, and the amount of data
    will generally grow larger over time. Users rarely delete e-mail. Therefore, IMAP
    is more frequently used in large organizations with centralized IT facilities.
  prefs: []
  type: TYPE_NORMAL
- en: A program called **e-mail client** handles retrieving mail from a mail server
    on behalf of a user, and the program that the e-mail client talks to is called
    an **e-mail server**. There are many POP3 and IMAP servers. Some perform only
    one of the tasks. The Courier-IMAP suite of software contains both, a POP3 and
    an IMAP server, and is covered in detail in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: 'Courier-IMAP operates by accessing the `maildir` of the user. An overview of
    the operation is shown in the following image:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Choosing between POP and IMAP](img/8648_03_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Downloading and installing Courier-IMAP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Courier** is a suite of programs and includes a full-fledged MTA. This book
    assumes that the MTA used is **Postfix**. It is important that only the POP3 and
    IMAP components of Courier are installed and configured—an e-mail system would
    be very unstable if there were two MTAs operating at once.'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The term "Courier" is often used to refer to the complete suite of Courier software,
    including the MTA. Courier-IMAP is normally used to refer to the IMAP and POP3
    portions of the server. The **Courier Authentication Library** is another Courier
    module that is required by Courier-IMAP. Ensure that you install only the Courier
    Authentication Library and Courier-IMAP.
  prefs: []
  type: TYPE_NORMAL
- en: There are a couple of ways to install Courier-IMAP. Courier-IMAP **Redhat Package
    Managers** (**RPMs**) for several different distributions of Linux are available.
    These will either be available from the manufacturer of the distribution, or may
    have been built by a third party, typically an enthusiast or developer of Courier.
    If your Linux distribution is based on RPM, but a package of Courier-IMAP is not
    available in RPM, then it has to be built from source.
  prefs: []
  type: TYPE_NORMAL
- en: If your distribution of Linux is based on the Debian software package format,
    a package of Courier-IMAP will probably be available. If not, then Courier-IMAP
    will have to be built from source.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Courier-IMAP from a distribution repository
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: It is best to use a package built by your Linux distributor, if at all possible.
    Any package they provide should be stable, perform well, and use the default paths
    and file locations to suit the rest of your software. If your distribution has
    a package manager, then you should use that as it will install any packages that
    Courier-IMAP requires automatically.
  prefs: []
  type: TYPE_NORMAL
- en: It is important to get a package that matches the distribution in use. Packages
    meant for a different distribution may not work correctly and may also make existing
    software unstable.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Courier-IMAP from RPM
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: It is important to get an RPM that matches the distribution in use. An RPM meant
    for another distribution may not work correctly, and may also make existing software
    unstable.
  prefs: []
  type: TYPE_NORMAL
- en: If your Linux distribution includes a graphical frontend to manage packages
    (such as gnorpm), it is best to use that because it will manage any dependencies
    between packages automatically.
  prefs: []
  type: TYPE_NORMAL
- en: To locate an RPM of Courier-IMAP, first check if one is provided by your Linux
    distributor. If so, then download and use it. If the distributor does not provide
    a package, it is possible that a suitable package may be provided by another organization
    or individual. To check this, search the Web. There is a database of RPMs available
    at [www.rpmfind.net](http://www.rpmfind.net), and searching for `courier-imap`
    coupled with the name of the distribution (for example, Fedora or Mandriva) will
    locate any suitable packages. It is best to use a package designed for a particular
    version of a distribution. For example, a package for Mandriva Linux 2008.1 should
    not be used for Mandriva Linux 2009.1\. If you are not sure then it is best to
    install Courier-IMAP from source as described in the next section.
  prefs: []
  type: TYPE_NORMAL
- en: If you are not able to use a frontend to RPM, then to install Courier-IMAP from
    RPM, firstly download the RPM and change to the directory containing the file
    using the command prompt. As root, use the `rpm` command to install the RPM.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The RPM command may fail if all of the prerequisite software is not present.
    In this case, the output will name the software required. The appropriate package
    can be downloaded and installed using the `rpm` command as seen earlier. Once
    all the prerequisite software has been installed, you can install Courier-IMAP
    using the `rpm` command as explained before.
  prefs: []
  type: TYPE_NORMAL
- en: 'If the `rpm` command was used to install Courier-IMAP, it can also be used
    to uninstall it. The command will be as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Installing Courier-IMAP using the Debian package format
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If your Linux distribution includes a graphical frontend to manage packages
    (such as gnorpm), then you can use that, if you are comfortable doing so.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can use the following command on any Debian-based system to install Courier-IMAP:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Installing Courier-IMAP from source
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Installing Courier-IMAP from source is not a difficult task on a modern Linux
    distribution. On older versions of Linux, and on other UNIX platforms such as
    AIX, Solaris, and HP-UX, problems may arise, particularly if the rest of the system's
    software is not up to date.
  prefs: []
  type: TYPE_NORMAL
- en: Prerequisites
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The following are the prerequisites to install Courier-IMAP:'
  prefs: []
  type: TYPE_NORMAL
- en: '**A working C++ compiler:** We recommend the **GNU C++ Compiler**, which is
    a part of the **GNU Compiler Collection** (**GCC**), which in turn is part of
    virtually every Linux distribution and is available free for most platforms. If
    an RPM or other package of GCC is available (and it almost certainly will be),
    it should be used in preference to building GCC from source.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**A** `make` **utility:** We recommend the GNU `make` utility, which will be
    available with most Linux distributions or can be downloaded from [http://gcc.gnu.org/](http://gcc.gnu.org/).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**The GNU linker:** This is available at [www.gnu.org/software/binutils/](http://www.gnu.org/software/binutils/).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**GNU** Libtool: This is available at[www.gnu.org/software/libtool/](http://www.gnu.org/software/libtool/).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Berkeley DB library or gdbm library:** These are libraries that allow programs
    to make databases in files. Again, these should be available in packaged form,
    but can be downloaded from [www.sleepycat.com/](http://www.sleepycat.com/) and
    [http://www.gnu.org/software/gdbm/gdbm.html](http://www.gnu.org/software/gdbm/gdbm.html)
    respectively. One or both of these will almost certainly be installed already.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Courier-IMAP source code.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To install Courier-IMAP successfully, all these prerequisites must be installed
    first.
  prefs: []
  type: TYPE_NORMAL
- en: Building the Courier Authentication Library
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: There are two phases to installing Courier-IMAP. First, the Courier Authentication
    Library, often called `Courier-authlib`, must be built. Once this is done, Courier-IMAP
    can be installed.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Although instructions to install Courier-IMAP are given here, it is always a
    good idea to read the `README, READ.ME` or `INSTALL` files that are supplied with
    the package. If problems are encountered while installing the software, then always
    check that the problem is not mentioned in any of the supplied documentation.
  prefs: []
  type: TYPE_NORMAL
- en: The `Courier-authlib` source can be downloaded from [www.courier-mta.org/authlib/](http://www.courier-mta.org/authlib/).
    As with many open source packages, the Courier Authentication Library uses a configuration
    script to detect system capabilities, then uses the `make` command to build and
    install the software.
  prefs: []
  type: TYPE_NORMAL
- en: 'To build the Courier Authentication Library, enter the following commands.
    You should see responses similar to the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: After the commands execute successfully, the Courier Authentication Library
    will be installed. Before it can be started, some configuration is required.
  prefs: []
  type: TYPE_NORMAL
- en: 'Note that if you are using Red Hat Linux or one of its derivatives such as
    Fedora Core or CentOS, then the `./configure` script detects this and suggests
    that you use an RPM or the `--with-redhat` parameter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: In this case, pass the `--with-redhat` parameter to `./configure:`
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Configuring the Courier Authentication Library
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Several decisions need to be made once the authentication library is installed.
  prefs: []
  type: TYPE_NORMAL
- en: 'The Courier Authentication Library provides the system administrator with flexibility
    in authenticating users. Authentication is when a user proves his/her identity,
    typically by providing a valid username and corresponding password. The following
    authentication methods are available:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Authentication method | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `authshadow` | By default, most Linux distributions hold user passwords in
    the `/etc/shadow` system file. Using `authshadow` for authentication validates
    passwords against system accounts. This is suitable only when users have system
    accounts, that is, they can log onto the machine using telnet or `ssh`. |'
  prefs: []
  type: TYPE_TB
- en: '| `authpwd` | On older systems, passwords were stored in the `/etc/passwd`
    file. The `authpwd` module allows users to be authenticated against their system
    password. Again, users must have system accounts. |'
  prefs: []
  type: TYPE_TB
- en: '| `authuserdb` | Unlike `authshadow` where each user needs a system account,
    `authuserdb` stores user details separately from the system accounts. This allows
    a **virtual mailbox** facility, where users can be defined without having real
    accounts on the machine. A number of scripts are used to administer the database,
    which is usually held in `/etc/userdb`. (Many distributions place it in `/etc/courier/authlib/userdb.)`
    |'
  prefs: []
  type: TYPE_TB
- en: '| `authmysql` | This is similar to `authuserdb`, but uses a MySQL database
    instead of the files used in `authuserdb`. MySQL is a popular relational database
    provided by most Linux distributions, and offers both advantages and disadvantages
    over the other methods. Using a relational database such as MySQL adds complexity
    to an e-mail server, but it is possible that the authentication will be quicker
    and a relational database will allow the data to be shared with other applications
    (if required). |'
  prefs: []
  type: TYPE_TB
- en: '| `authpam` | Authentication is provided by the **Programmable Access Method
    (PAM)** library. PAM is a commonly used library and is provided by most Linux
    distributions. PAM is flexible, and can in turn authenticate users from a variety
    of sources, including the system password database (typically the `/etc/passwd`
    file). |'
  prefs: []
  type: TYPE_TB
- en: '| `authcustom` | This allows the system administrators to develop their own
    custom authentication method. |'
  prefs: []
  type: TYPE_TB
- en: 'Choosing an authentication method can be a difficult decision. Here are some
    guidelines:'
  prefs: []
  type: TYPE_NORMAL
- en: If all users have system accounts, then `authshadow, authpwd`, or `authpam`
    can be used. If PAM is already installed and configured, it should be used in
    preference to the others.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If a virtual e-mail system is required, use either `authdb` or `authmysql`.
    For small sites, there is little advantage in choosing `authmysql` over `authdb`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this book, only simple authentication with `authshadow` or `authpwd` is covered.
    Although if PAM is installed and configured, no additional configuration will
    be required. `authuserdb` and `authmysql` require further configuration, which
    is described in the documentation for the authentication library.
  prefs: []
  type: TYPE_NORMAL
- en: The `/usr/local/etc/courier/authlib` directory contains the configuration files
    for the Courier Authentication Library. For security purposes, it's best to make
    the whole directory readable only by users who are members of the `mail` group.
    The default `authdaemonrc` file can be copied from the installation directory.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'To complete the configuration as the root user, edit the `/usr/local/etc/courier/authlib/authdaemonrc`
    file and alter the following entries:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: In the line beginning with `authmodulelist`, enter the module(s) that you wish
    to use.
  prefs: []
  type: TYPE_NORMAL
- en: The `daemons=` line lists how many processes should run, waiting to authenticate
    users. Unless there are a very high number of users, a value between `3` to `5`
    should suffice. The larger the number of daemons, the more memory will be used
    by the authentication library. There will also be less memory available for other
    processes, which may affect overall system performance.
  prefs: []
  type: TYPE_NORMAL
- en: 'The `authdaemonvar` line lists where the Courier Authentication Library places
    its runtime files, in particular the socket used to connect to it. The directory
    listed here (in this example it is `/var/lib/courier/authdaemon)` should exist
    and be only readable by the root user. Use the following commands as `root` to
    create the directory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: For security purposes, it's best to make the `authdaemonrc` file readable only
    by certain users.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: The authentication daemon needs to be started when the system boots. Typically,
    a script is placed in `/etc/init.d/` to enable easy starting and stopping of a
    daemon. A sample script is included with the source of the authentication library
    in `/courier-authlib.sysvinit`. This file should be placed in `/etc/init.d`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'The service can, in future, be started and stopped with the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: Initially, the daemon should be run directly from the command line. If there
    are any errors, they will be displayed.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: In the example just shown, the `/usr/local/etc/authlib/authdaemonrc` file was
    missing because the default `authdaemonrc` file was not copied from the installation
    directory.
  prefs: []
  type: TYPE_NORMAL
- en: If the service was started correctly, it can be stopped by passing the `stop`
    parameter.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: Consult the documentation for distribution to get the service to start automatically
    when Linux boots. On Red Hat systems, the `service` command can be used to configure
    a service to start automatically.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: For other distributions, the `chkconfig` command might be used.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: Resolving errors
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Errors can be generated at each phase of the build. Errors while running the
    `configure` script will probably relate to a missing dependency. Check the `README`
    and `INSTALL` files supplied with the software and ensure that all dependencies
    are installed. If the problem is not obvious from the error message generated,
    an Internet search for the exact error message may find a solution.
  prefs: []
  type: TYPE_NORMAL
- en: An error at build time is unusual, as most errors will be prevented by the `configure`
    script. Again, the error message should provide a good clue to the source of the
    error and use of an Internet search engine may pay off.
  prefs: []
  type: TYPE_NORMAL
- en: Runtime errors are generally due to erroneous configuration. There are few configuration
    options with the Courier Authentication Library, but errors can occur.
  prefs: []
  type: TYPE_NORMAL
- en: 'If an answer can''t be found, there is a Courier mailing list that can be approached
    for help. As always, first search list archives for your problem and consult the
    FAQ. For Courier-IMAP, the mailing list is at [http://lists.sourceforge.net/lists/listinfo/courier-imap/](http://lists.sourceforge.net/lists/listinfo/courier-imap/),
    searchable list archives are available at: [http://sourceforge.net/mailarchive/forum.php?forum_id=7307/](http://sourceforge.net/mailarchive/forum.php?forum_id=7307/),
    and the FAQ is available at [http://www.courier-mta.org/FAQ.html](http://www.courier-mta.org/FAQ.html).'
  prefs: []
  type: TYPE_NORMAL
- en: Building Courier-IMAP
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Courier-IMAP source code is available in a tarball a package of all the
    files, similar to a ZIP file. This can be downloaded from [http://www.courier-mta.org/imap/](http://www.courier-mta.org/imap/),
    but be careful to download the source for Courier-IMAP and not for the Courier
    MTA.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Although details are given here on how to install Courier-IMAP, it is always
    a good idea to read the `README, READ.ME` or `INSTALL` files that are supplied
    with the package. If problems are encountered when installing the software, always
    check that the problem is not mentioned in any of the supplied documentation.
  prefs: []
  type: TYPE_NORMAL
- en: To install Courier-IMAP, a few commands must be entered. As with much software
    provided in source form, a configuration script is run first. The configuration
    script checks the software installed on our machine and configures the software
    so that it will build correctly.
  prefs: []
  type: TYPE_NORMAL
- en: When Courier-IMAP is used as an IMAP server, by default it assumes that its
    clients are going to follow the IMAP standard exactly. Unfortunately this is generally
    not the case and, if Courier-IMAP expected the clients to conform to the IMAP
    standard exactly, mail may not be delivered to the e-mail client. The Courier-IMAP
    developers recognize this, and have built the capability to work with non-standard
    clients by passing the `--enable-workarounds-for-imap-client-bugs` flag to the
    configure script.
  prefs: []
  type: TYPE_NORMAL
- en: Courier-IMAP includes a special `check` functionality while building it. Unfortunately,
    using `--enable-workarounds-for-imap-client-bugs` prevents the check from working
    successfully. As the `check` functionality is useful, we will build the software
    twice. First without the `--enable-workarounds-for-imap-client-bugs`, then run
    `check`, and then build again with the flag, and install the software.
  prefs: []
  type: TYPE_NORMAL
- en: To build Courier-IMAP, enter the following commands. Choose a suitable directory
    to build the software. In this example, we choose `/tmp`, and the software unpacks
    itself into the `courier-imap-3.0.8` directory. As noted in the case of the Courier
    Authentication Library, the configure script will detect when a Red Hat-derived
    Linux Distribution is being used and the `--with-redhat` flag can be passed to
    configure.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: If the output appears similar to that shown, Courier-IMAP has been successfully
    installed and you may skip the next section on error handling.
  prefs: []
  type: TYPE_NORMAL
- en: Handling errors
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It is possible that the `configure` command will fail. Configuration attempts
    to detect existing software, and ensures that Courier-IMAP works with it, but
    occasionally there are errors.
  prefs: []
  type: TYPE_NORMAL
- en: '![Handling errors](img/8648_03_2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'In this example, the `configure` command assumed that `vpopmail` was installed,
    and failed when it couldn''t find parts of `vpopmail`. In reality, `vpopmail`
    was not installed, and could not be detected. We get the following from the `INSTALL`
    file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: 'This suggests that the `authvchkpw` is used for `vpopmail`. Further up the
    `INSTALL` file we read:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: Upon checking the `/etc/passwd` file, we find that there is an account for `vpopmail`
    which explains the detection. The lack of `vpopmail` files explains the failure
    of the `configure` script. In the `INSTALL` file, the parameters to the configure
    script are described.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'The solution, therefore, is to use the `--without-authvchkpw` option:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: Most problems can be solved in a similar way. It is best not to be put off by
    terms and names that aren't understood. Without understanding anything about `vpopmail`
    and just by searching for the term `"vpopmail"` (which was mentioned in the original
    error message), it is possible to resolve the error by reading the documentation.
  prefs: []
  type: TYPE_NORMAL
- en: If you can't find an answer, there is a Courier mailing list that can be approached
    for help. Details are given in the *Resolving errors* section.
  prefs: []
  type: TYPE_NORMAL
- en: Using POP3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As mentioned in the introduction, POP3 is typically used when e-mail is to be
    stored on a client computer. It is most often used when there is an intermittent
    connection to the e-mail server, for example, while using a dial-up line to access
    an e-mail account at an ISP. This approach has the advantage that the e-mail is
    always available to the client, who can work when not connected to the e-mail
    server. E-mails can be read, and replies created for, when the user is next on
    line.
  prefs: []
  type: TYPE_NORMAL
- en: The main disadvantage of using POP3 is that e-mail is generally only available
    on the client PC. If the client PC fails, or is stolen, the e-mail is lost, unless
    a backup has been made.
  prefs: []
  type: TYPE_NORMAL
- en: POP3 clients can be configured to keep e-mail on the POP3 server for other clients
    to access, but IMAP is more often used in this situation.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring Courier-IMAP for POP3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The configuration files are located in `/usr/lib/courier-imap/etc/courier-imap/`,
    if Courier-IMAP was built from source. If you are using a packaged distribution,
    they may be located in `/etc/courier-imap`. The `pop3d` file contains the settings
    for the POP3 server.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you are using a packaged distribution of Courier-IMAP, the configuration
    files can be found with the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'Edit the file and locate and alter the following settings:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Setting | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `PIDFILE` | The `pop3d` daemon keeps track of the process ID that it uses.
    It specifies a valid path and a name that suggests the use of the file. Typically,
    this might be `/var/run/pop3d.pid`. Ensure that the variable points to an existing
    directory (such as `/var/run)` or create the directory specified. |'
  prefs: []
  type: TYPE_TB
- en: '| `MAXDAEMONS` | This specifies the maximum number of `pop3d` process that
    can run at one time. This number limits the number of users that can connect at
    one time. A number higher than the expected number of users may be wasteful, but
    users attempting to connect are also included in this number. Set this to a number
    around the maximum number of users who may connect at one time, or a little higher.
    Note that this is the maximum number of processes started, not the initial number
    of processes. |'
  prefs: []
  type: TYPE_TB
- en: '| `MAXPERIP` | This specifies the maximum number of connections from each IP
    address. A low number such as 4 prevents malicious acts such as denial-of-service
    attacks, where an attempt is made to use up all the connections on the mail server.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `POP3AUTH` | If the Courier Authentication Library daemon is used, set this
    to blank, otherwise set it to indicate the type of login authentication performed.
    For versions prior to 4.0, this should be set to `LOGIN`. |'
  prefs: []
  type: TYPE_TB
- en: '| `PORT` | This specifies the port that the daemon listens on. The standard
    port is `110`, and a different one should only be chosen if all client software
    is configured to use the non‑standard port. |'
  prefs: []
  type: TYPE_TB
- en: '| `ADDRESS` | This specifies the IP address to listen on. If the machine has
    multiple network interfaces, Courier-IMAP can be configured to listen only on
    one of the addresses. A value of `0` indicates that all network interfaces should
    be used. |'
  prefs: []
  type: TYPE_TB
- en: '| `TCPDOPTS` | These are options to be used. Typical ones used include `nodnslookup`
    that prevents the POP3 daemon from attempting to resolve the name of each connection,
    and `-noidentlookup` that prevents it from attempting an `ident` query for the
    incoming connection. Specifying both of these settings can decrease the time taken
    to authenticate a user connection. |'
  prefs: []
  type: TYPE_TB
- en: '| `MAILDIRPATH` | This is the path to a typical user''s `maildir`. Specify
    the appropriate value for your system, for example, `.maildir`. |'
  prefs: []
  type: TYPE_TB
- en: 'A sample `pop3d` configuration file is shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: Once the POP3 server has been configured, it is time to test it. If you are
    using a distribution-supplied version of Courier-IMAP, use the distributors' startup
    script called `/etc/init.d/courier-imap`. This will attempt to start `imapd` as
    well as `pop3d`, but as most of the configuration will have been done by the distributors,
    IMAP should start successfully.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you are using Courier-IMAP version 4.0 or later, then `courier-authdaemon`
    must be running before the POP3 or IMAP services. Ensure that you start them as
    described previously.
  prefs: []
  type: TYPE_NORMAL
- en: 'To start the POP3 service for testing, run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: Once the POP3 and IMAP services are configured correctly, they can be started
    automatically when the machine boots. This is explained in the *Testing the IMAP
    service* section. The instructions can be followed, even if IMAP is not required.
  prefs: []
  type: TYPE_NORMAL
- en: Testing the POP3 Service
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The easiest way to test a service such as POP3 is by using the **telnet** utility
    and connecting to the appropriate port. This avoids any problems there may be
    with network connectivity or client configuration. POP3 uses port `110`, so connect
    telnet to port `110` on the local machine.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: Connection closed by foreign host.
  prefs: []
  type: TYPE_NORMAL
- en: The POP3 protocol is based on text commands, and so it is easy to emulate a
    client with telnet. Initially, use the `USER` and `PASS` commands to authenticate
    a user. If the user is authenticated correctly, the `STAT` command lists all e-mails
    and their combined size in bytes. `LIST` lists each e-mail and its size. The `RETR`
    command retrieves (or lists) an e-mail when the e-mail number is specified with
    the command. The `DELE` command (not shown in the example) will delete an e-mail
    from the server.
  prefs: []
  type: TYPE_NORMAL
- en: Now that POP3 is working, it is time to configure an e-mail client to collect
    e-mails.
  prefs: []
  type: TYPE_NORMAL
- en: Retrieving E-mail via POP3 with Windows Live Mail
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Windows Live Mail is a popular e-mail client, available for download for versions
    of Windows from XP onwards. It includes the ability to connect to POP3-and IMAP-enabled
    servers. It is available for download at [http://download.live.com/wlmail](http://download.live.com/wlmail).
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are the steps to configure it:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Start Windows Live Mail by locating it in the Start menu hierarchy: **Start
    | All Programs | Windows Live | Windows Live Mail**. When it is run for the first
    time, the interface will automatically display the wizard to create new account.
    Otherwise, click on **Add e-mail account** in the navigation bar.![Retrieving
    E-mail via POP3 with Windows Live Mail](img/8648_03_3.jpg)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The first page of the new account wizard will be displayed.![Retrieving E-mail
    via POP3 with Windows Live Mail](img/8648_03_4.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the full e-mail address in `username@domain` format. You may decide whether
    you want to enter the password—if you do not check **Remember password**, you
    will be prompted for the password every time you start Windows Live Mail. The
    **Display Name** should be your first and last name—this will appear on outgoing
    e-mails. There is no need to check the **Manually configure server settings for
    e-mail account** checkbox.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Next**. The next page of the wizard requires some server details.![Retrieving
    E-mail via POP3 with Windows Live Mail](img/8648_03_5.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The default is for a **POP3** server. The **Incoming server** should be the
    name (or IP address) of the mail server. The default **Port** of **110** can be
    kept unchanged. Do not check the box for an SSL connection, and keep the authentication
    method as **Clear text authentication**. The **Login ID** should be kept as the
    username part of the e-mail address entered in the first screen. The **Outgoing
    server** should be as provided for **Incoming server**, and the remainder of the
    form can be left with the default values.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Press **Next**. You will be presented with a confirmation screen.![Retrieving
    E-mail via POP3 with Windows Live Mail](img/8648_03_6.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When you click on **Finish**, Windows Live Mail will attempt to connect to the
    e-mail server and download e-mail.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If there are any errors, then right-click the account in the navigation pane,
    and select **Properties**. You can then check and modify any settings.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now that POP3 has been successfully configured, it is time to move on to IMAP.
  prefs: []
  type: TYPE_NORMAL
- en: Using IMAP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As mentioned in the introduction, with IMAP, the mail is held on the server
    and might not be held on the client. This makes it ideal for organizations with
    a central administrative function, as it eases backups and also allows users to
    change the client computers they work at. However, this also means that the disk
    storage required to store an entire organizations e-mail will inevitably increase
    over time. This is particularly true when large attachments are sent or received.
    If users rely on being able to access their mailbox, they will be inconvenienced
    if the mail server is unavailable during their working hours. Some e-mail clients
    can be configured to make copies of e-mails, and so avoid interruption. By using
    IMAPs ability to create folders and move e-mails between them, this can sometimes
    be achieved in a relatively straightforward manner.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring Courier for IMAP
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After Courier-IMAP has been installed, either from package or from source as
    described earlier, it needs to be configured before it can be used.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you have configured and tested POP3 as described earlier, you should stop
    the Courier-IMAP daemons while you configure IMAP. If you are using a version
    of Courier-IMAP greater than 4.0, then you can leave the authentication daemon
    running.
  prefs: []
  type: TYPE_NORMAL
- en: If Courier-IMAP was built from source, the configuration files are located in
    `/usr/lib/courier-imap/etc/courier-imap/`. In a packaged distribution, they may
    be located in `/etc/courier-imap`. The `imapd` file contains the settings for
    the IMAP server.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you are using a packaged distribution of Courier-IMAP, the configuration
    files can be found with this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: 'Once the file has been located, it can be modified as appropriate. Here are
    the main configuration directives:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Setting | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `PIDFILE` | The `imapd` daemon keeps track of the process ID that it uses.
    It specifies a valid path and a name, which suggests the use of the file. Typically,
    this might be `/var/run/imapd.pid`. Ensure that the setting points to a valid
    directory. |'
  prefs: []
  type: TYPE_TB
- en: '| `MAXDAEMONS` | This specifies the maximum number of `imapd` processes that
    can run at a time. This number limits the number of users that can connect at
    one time. A number higher than the expected number of users may be wasteful, but
    users attempting to connect are also included in this number. Set this to a number
    around the maximum number of users who may connect at one time, or a little higher.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `PORT` | This specifies the port that the daemon listens on. The standard
    port is `143`, and a different one should only be chosen if all client software
    is configured to use the non‑standard port. |'
  prefs: []
  type: TYPE_TB
- en: '| `ADDRESS` | This specifies the IP address to listen on. If the machine has
    multiple network interfaces, Courier-IMAP can be configured to listen only on
    one of the addresses. A value of `0` indicates that all network interfaces should
    be used. |'
  prefs: []
  type: TYPE_TB
- en: '| `TCPDOPTS` | These are options to be used. Typical ones include `-nodnslookup`
    that prevents the IMAP daemon from attempting to resolve the name of each connection,
    and `-noidentlookup` that prevents it from attempting an `ident` query for the
    incoming connection. Specifying both of these settings can decrease the time taken
    to authenticate a user connection. |'
  prefs: []
  type: TYPE_TB
- en: '| `MAILDIRPATH` | This is the path to a typical user''s `maildir`. Specify
    the appropriate value for your system, for example, `.maildir`. |'
  prefs: []
  type: TYPE_TB
- en: '| `MAXPERIP` | This specifies the maximum number of connections from each IP
    address. A low number prevents malicious acts such as denial-of-service attacks,
    where an attempt is made to use up all the connections on the mail server. Some
    e-mail clients make multiple connections to a server, and so a low value such
    as `5` may affect operation of client software. |'
  prefs: []
  type: TYPE_TB
- en: '| `IMAP_CAPABILITY` | This describes the IMAP capabilities that the server
    reports to clients. It should be left on the default setting. |'
  prefs: []
  type: TYPE_TB
- en: '| `IMAP_EMPTYTRASH` | This specifies how long e-mail messages should be kept
    in certain folders. Messages older than the date specified are automatically deleted
    when the user logs in or logs out. This can be used to automatically delete e-mail
    from the `Trash` folder after a certain period. This works for all folders, so
    e-mail in the `Sent items` folder could be deleted after a longer period has expired.For
    example, `IMAP_EMPTYTRASH=Trash:7,Sent:30` specifies that e-mails in the `Trash`
    folder are deleted after 7 days, and those in the `Sent` folder will be deleted
    after 30 days.If very large numbers of e-mails are present in the folders specified,
    performance will suffer, as each file will be checked every time the user logs
    in or logs out of the IMAP server. In this case, it would be better to disable
    this setting and run a separate script regularly to remove old files. |'
  prefs: []
  type: TYPE_TB
- en: '| `IMAP_IDLETIMEOUT` | This is the length of time (in seconds) that a client
    can be idle for (not make any request to the server), before the connection is
    closed. Values lower than the default of 60 may result in client connections being
    terminated prematurely, but a well-written client will reconnect without notifying
    the user. Higher values should be used if users report problems. |'
  prefs: []
  type: TYPE_TB
- en: '| `IMAP_TRASHFOLDERNAME` | This specifies the folder to be used when e-mail
    is deleted. |'
  prefs: []
  type: TYPE_TB
- en: '| `SENDMAIL` | This specifies the path to `sendmail`, for sending e-mail. You
    should ensure that this points to the executable file installed by Postfix in
    [Chapter 2](ch02.html "Chapter 2. Setting up Postfix"). |'
  prefs: []
  type: TYPE_TB
- en: 'Here is a sample `imapd` configuration file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: Testing the IMAP service
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To start the IMAP service for testing, run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: 'The easiest way to test a service such as IMAP is by using the telnet utility
    and connecting to the appropriate port. This avoids any problems with network
    connectivity or client configuration. IMAP uses port `143`, so telnet to port
    `143` on the local machine:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: Each command is prefixed with an identifier—here we use incremental numbers.
    The first command asks the IMAP server to list its capabilities. The second command
    is a user login, and includes the username and password. If this is successful,
    then the final namespace command shows that the server has accepted the login
    and the client can determine where in the folder hierarchy the user is placed.
  prefs: []
  type: TYPE_NORMAL
- en: This is enough to confirm that the user can log in and issue commands. The whole
    IMAP command set is quite large and complex, and does not lend itself to be used
    by telnet.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once the POP3 and IMAP services are configured correctly, they can be started
    automatically when the machine boots. If you have installed from a package, then
    the distributor will probably have created a suitable startup script in `/etc/init.d`.
    Depending on the distribution, this may start when the machine boots. For Red
    Hat Linux, the command will be:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: 'For other distributions, the `chkconfig` command might be used:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: Now that IMAP is configured correctly, it is time to configure an e-mail client.
  prefs: []
  type: TYPE_NORMAL
- en: Retrieving mail via IMAP with Mozilla Thunderbird
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Mozilla Thunderbird is a popular open source e-mail client and can be downloaded
    from [http://www.mozilla.org/](http://www.mozilla.org/). It can be used with a
    variety of operating systems, including Windows and Linux.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here are steps to configure it to connect to a Courier-IMAP server:'
  prefs: []
  type: TYPE_NORMAL
- en: From the main Thunderbird screen, select **Tools | Account Settings**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Retrieving mail via IMAP with Mozilla Thunderbird](img/8648_03_7.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Click on the **Add Account...** button. On the next screen, choose **E-mail
    Account** and then click **Next**. The identity screen opens. Enter your user
    name and e-mail address, then click **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Retrieving mail via IMAP with Mozilla Thunderbird](img/8648_03_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: On the **Server Information** screen, select **IMAP** as the server type, and
    enter the name or the IP address of the server for incoming e-mail. Then click
    the **Next** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Retrieving mail via IMAP with Mozilla Thunderbird](img/8648_03_9.jpg)'
  prefs: []
  type: TYPE_IMG
- en: On the next screen, enter the **Incoming User Name**. This will normally be
    the Linux account name.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Retrieving mail via IMAP with Mozilla Thunderbird](img/8648_03_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Finally, provide a useful tag for the e-mail account in the **Account Name**
    field, in case another account is defined in the future. Click **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Retrieving mail via IMAP with Mozilla Thunderbird](img/8648_03_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: On the next screen, the details are summarized. Click **Finish** to save the
    account details and to exit the **Account Wizard**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Retrieving mail via IMAP with Mozilla Thunderbird](img/8648_03_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Finally, the **Account Settings** screen is shown, listing the account you just
    defined. Click **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Retrieving mail via IMAP with Mozilla Thunderbird](img/8648_03_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: To retrieve messages, click on **File | Get New Messages**, and select the account
    you just created from the menu.
  prefs: []
  type: TYPE_NORMAL
- en: Thunderbird will prompt you for the password. Enter the correct password and
    press *Enter*. Thunderbird will then connect to Courier-IMAP and retrieve details
    of all the e-mail. If you click on an e-mail, Thunderbird will retrieve it using
    the IMAP protocol.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter we saw the two mail protocols for retrieving e-mail, POP3 and
    IMAP, and explained some strengths and weaknesses. We then covered Courier-IMAP,
    which can provide both POP3 and IMAP services, and advised you to use a package
    from your Linux distributor. We also described how to build it from source, should
    this be required. We then discussed how to configure and test both the POP3 and
    IMAP services, including configuration of popular e-mail clients.
  prefs: []
  type: TYPE_NORMAL
