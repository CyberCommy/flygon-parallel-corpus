- en: Assessing Authorization Checks
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Testing for directory traversal
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing for **Local File Include** (**LFI**)
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing for **Remote File Include** (**RFI**)
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing for privilege escalation
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing for insecure direct object reference
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This chapter covers the basics of authorization, including an explanation of
    how an application uses roles to determine user functions. Web penetration testing
    involves key assessments to determine how well the application validates functions
    assigned to a given role, and we will learn how to use Burp to perform such tests.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: Software requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To complete the recipes in this chapter, you will need the following:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: OWASP broken web applications (VM)
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: OWASP mutillidae link
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Burp Proxy Community or Professional ([https://portswigger.net/burp/](https://portswigger.net/burp/))
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Firefox browser configured to allow Burp to proxy traffic ([https://www.mozilla.org/en-US/firefox/new/](https://www.mozilla.org/en-US/firefox/new/))
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `wfuzz` wordlist repository from GitHub ([https://github.com/xmendez/wfuzz](https://github.com/xmendez/wfuzz))
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing for directory traversal
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Directory traversal attacks are attempts to discover or forced browse to unauthorized
    web pages usually designed for administrators of the application. If an application
    does not configure the web document root properly and does not include proper
    authorization checks for each page accessed, a directory traversal vulnerability
    could exist. In particular situations, such a weakness could lead to system command
    injection attacks or the ability of an attacker to perform arbitrary code execution.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Using OWASP Mutillidae II as our target application, let's determine whether
    it contains any directory traversal vulnerabilities.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Ensure Burp and the OWASP BWA VM are running and that Burp is configured in
    the Firefox browser used to view the OWASP BWA applications.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: From the OWASP BWA Landing page, click the link to the OWASP Mutillidae II application.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the Firefox browser on the login screen of OWASP Mutillidae II. From the
    top menu, click **Login**.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Find the request you just performed within the **Proxy** | **HTTP history**
    table. Look for the call to the `login.php` page. Highlight the message, move
    your cursor into the **Raw** tab of the **Request** tab, right-click, and click
    on **Send to Intruder**:'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00181.jpeg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
- en: Switch over to the **Intruder** | **Positions** tab, and clear all Burp-defined
    payload markers by clicking the **Clear $** button on the right-hand side.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Highlight the value currently stored in the `page` parameter (`login.php`),
    and place a payload marker around it using the **Add  §** button:'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00182.jpeg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
- en: 'Continue to the **Intruder** | **Payloads** tab, and select the following wordlist
    from the `wfuzz` repository: `admin-panels.txt`**. **The location of the wordlist
    from the GitHub repository follows this folder structure: `wfuzz`/`wordlist`/`general`/`admin-panels.txt`.'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Load** button within the **Payload Options [Simple list]** section
    of the **Intruder** | **Payloads****,** tab and a popup will display, prompting
    for the location of your wordlist.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Browse to the location where you downloaded the `wfuzz` repository from GitHub.
    Continue to search through the `wfuzz` folder structure (`wfuzz`/`wordlist`/`general`/) until
    you reach the `admin-panels.txt` file, and then select the file by clicking**Open**:'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00183.jpeg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
- en: 'Scroll to the bottom and uncheck (by default, it is checked) the option **URL-encode
    these characters**:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00184.jpeg)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
- en: 'You are now ready to begin the attack. Click the **Start attack** button at
    the top right-hand corner of the **Intruder** | **Positions** page:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The attack results table will appear. Allow the attacks to complete. There are
    137 payloads in the `admin-panels.txt` wordlist. Sort on the **Length** column
    from ascending to descending order, to see which of the payloads hit a web page.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: 'Notice the payloads that have larger response lengths. This looks promising! 
    Perhaps we have stumbled upon some administration pages that may contain fingerprinting
    information or unauthorized access:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00185.jpeg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
- en: 'Select the first page in the list with the largest length, **administrator.php**.
    From the attack results table, look at the **Response** | **Render** tab, and
    notice the page displays the PHP version and the system information:'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00186.jpeg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
- en: How it works...
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Without even being logged in, we were able to force browse to an area of the
    web application that was unmapped. The term *unmapped* means the application itself
    had no direct link to this secret configuration page. However, using Burp Intruder
    and a wordlist containing commonly known administration file names, we were able
    to discover the page using the directory traversal attack.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Testing for Local File Include (LFI)
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Web servers control access to privileged files and resources through configuration
    settings. Privileged files include files that should only be accessible by system
    administrators. For example, the `/etc/passwd` file on UNIX-like platforms or
    the `boot.ini` file on Windows systems.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: A **LFI** attack is an attempt to access privileged files using directory traversal
    attacks. LFI attacks include different styles including the **dot-dot-slash attack**
    (**../**), **directory brute-forcing**, **directory** **climbing**, or **backtracking**.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Using OWASP Mutillidae II as our target application, let's determine whether
    it contains any LFI vulnerabilities.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Ensure Burp and OWASP BWA VM are running and that Burp is configured in the
    Firefox browser used to view the OWASP BWA applications.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: From the OWASP BWA Landing page, click the link to the OWASP Mutillidae II application.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the Firefox browser to the login screen of OWASP Mutillidae II. From the
    top menu, click **Login**.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Find the request you just performed within the **Proxy** | **HTTP history**
    table. Look for the call to the `login.php` page. Highlight the message, move
    your cursor into the **Raw** tab of the **Request** tab, right-click, and **Send
    to Intruder**.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Switch over to the **Intruder** | **Positions** tab, and clear all Burp-defined
    payload markers by clicking the **Clear §** button on the right-hand side.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Highlight the value currently stored in the `page` parameter (`login.php`),
    and place a payload marker around it using the **Add  §** button on the right-hand
    side.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Continue to the **Intruder** | **Payloads** tab.  Select the following wordlist
    from the `wfuzz` repository: `Traversal.txt`**. **The location of the wordlist
    from the GitHub repository follows this folder structure: `wfuzz`/`wordlist`/`injections`/`Traversal.txt`.'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Load** button within the **Payload Options [Simple list]** section
    of the **Intruder** | **Payloads** tab. A popup will display, prompting for the
    location of your wordlist.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Browse to the location where you downloaded the `wfuzz` repository from GitHub.
    Continue to search through `wfuzz` folder structure until you reach the `admin-panels.txt`
    file. Select the file and click **Open**:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00187.jpeg)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
- en: Scroll to the bottom and uncheck (by default, it is checked) the option **URL-encode
    these characters**.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You are now ready to begin the attack.  Click the **Start attack** button at
    the top-right-hand corner of the **Intruder** | **Positions** page.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The attack results table will appear. Allow the attacks to complete. Sort on
    the **Length** column from ascending to descending order, to see which of the
    payloads hit a web page. Notice the payloads with larger lengths; perhaps we gained
    unauthorized access to the system configuration files!
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00188.jpeg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
- en: 'Select the Request #2 in the list. From the attack results table, look at the **Response **|
    **Render** tab and notice the page displays the host file from the system!'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在列表中选择请求＃2。从攻击结果表中，查看**响应** | **渲染**选项卡，并注意页面显示了系统中的主机文件！
- en: '![](img/00189.jpeg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00189.jpeg)'
- en: 'Continue scrolling down the list of requests in the attack results table. Look
    at request #6, and then look at the **Response** | **Render** tab and notice the
    page displays the `/etc/passwd` file from the system!'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 继续向下滚动攻击结果表中的请求列表。查看请求＃6，然后查看**响应** | **渲染**选项卡，并注意页面显示了系统中的`/etc/passwd`文件！
- en: '![](img/00190.jpeg)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00190.jpeg)'
- en: How it works...
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Due to poorly protected file permissions and lack of application authorization
    checks, attackers are able to read privileged local files on a system containing
    sensitive information.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 由于文件权限受到不良保护和应用程序授权检查不足，攻击者能够读取系统中包含敏感信息的特权本地文件。
- en: Testing for Remote File Inclusion (RFI)
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试远程文件包含（RFI）
- en: '**Remote File Inclusion** (**RFI**) is an attack attempting to access external
    URLs and remotely located files. The attack is possible due to parameter manipulation
    and lack of server-side checks. These oversights allow parameter changes to redirect
    the user to locations that are not whitelisted or sanitized with proper data validation.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '**远程文件包含**（**RFI**）是一种试图访问外部URL和远程文件的攻击。由于参数操纵和缺乏服务器端检查，攻击是可能的。这些疏忽允许参数更改将用户重定向到未列入白名单或未经适当数据验证的位置。'
- en: Getting ready
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 做好准备
- en: Using OWASP Mutillidae II as our target application, let's determine whether
    it contains any RFI vulnerabilities.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 使用OWASP Mutillidae II作为我们的目标应用程序，让我们确定它是否包含任何RFI漏洞。
- en: How to do it...
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: Ensure Burp and OWASP BWA VM are running and that Burp is configured in the
    Firefox browser used to view the OWASP BWA applications.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 确保Burp和OWASP BWA VM正在运行，并且已在用于查看OWASP BWA应用程序的Firefox浏览器中配置了Burp。
- en: From the OWASP BWA Landing page, click the link to the OWASP Mutillidae II application.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从OWASP BWA登陆页面，点击链接到OWASP Mutillidae II应用程序。
- en: Open the Firefox browser to the login screen of OWASP Mutillidae II. From the
    top menu, click **Login**.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开Firefox浏览器，转到OWASP Mutillidae II的登录界面。从顶部菜单中，点击**登录**。
- en: 'Find the request you just performed within the **Proxy** | **HTTP history**
    table. Look for the call to the `login.php` page:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**代理** | **HTTP历史**表中找到您刚刚执行的请求。寻找对`login.php`页面的调用：
- en: '![](img/00191.jpeg)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00191.jpeg)'
- en: 'Make a note of the `page` parameter that determines the page to load:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 记下确定要加载的页面的`page`参数：
- en: '![](img/00192.jpeg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00192.jpeg)'
- en: Let's see if we can exploit this parameter by providing a URL that is outside
    the application. For demonstration purposes, we will use a URL that we control
    in the OWASP BWA VM. However, in the wild, this URL would be attacker-controlled
    instead.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看是否可以通过提供应用程序外部的URL来利用此参数。出于演示目的，我们将在OWASP BWA VM中使用我们控制的URL。但是，在野外，这个URL将由攻击者控制。
- en: Switch to the **Proxy** | **Intercept** tab, and press the **Intercept is on**
    button.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到**代理** | **拦截**选项卡，并按下**拦截已打开**按钮。
- en: 'Return to the Firefox browser, and reload the login page. The request is paused
    and contained within the **Proxy** | **Intercept** tab:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到Firefox浏览器，并重新加载登录页面。请求被暂停，并包含在**代理** | **拦截**选项卡中：
- en: '![](img/00193.jpeg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00193.jpeg)'
- en: Now let's manipulate the value of the `page` parameter from `login.php` to a
    URL that is external to the application. Let's use the login page to the **GetBoo**
    application. Your URL will be specific to your machine's IP address, so adjust
    accordingly. The new URL will be `http://<your_IP_address>/getboo/`
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在让我们将`login.php`的`page`参数值操纵为应用程序外部的URL。让我们使用登录页面到**GetBoo**应用程序。您的URL将特定于您机器的IP地址，因此请相应调整。新的URL将是`http://<your_IP_address>/getboo/`
- en: 'Replace the `login.php` value with `http://<your_IP_address>/getboo/` and click
    the **Forward** button:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`login.php`的值替换为`http://<your_IP_address>/getboo/`，然后点击**Forward**按钮：
- en: '![](img/00194.jpeg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00194.jpeg)'
- en: Now press the **Intercept is on** again to toggle the intercept button to **OFF
    (Intercept is off)**.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在再次按下**拦截已打开**按钮，以切换拦截按钮为**关闭（拦截已关闭）**。
- en: Return to the Firefox browser, and notice the page loaded is the **GetBoo**
    index page within the context of the Mutillidae application!
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到Firefox浏览器，并注意加载的页面是Mutillidae应用程序上的**GetBoo**索引页面！
- en: '![](img/00195.jpeg)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00195.jpeg)'
- en: How it works...
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The `page` parameter does not include proper data validation to ensure the values
    provided to it are whitelisted or contained to a prescribed list of acceptable
    values. By exploiting this weakness, we are able to dictate values to this parameter,
    which should not be allowed.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '`page`参数没有包括适当的数据验证，以确保提供给它的值被列入白名单或包含在可接受值的规定列表中。通过利用这种弱点，我们能够指定这个参数的值，这是不应该被允许的。'
- en: Testing for privilege escalation
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试特权升级
- en: Developer code in an application must include authorization checks on assigned
    roles to ensure an authorized user is not able to elevate their role to a higher
    privilege. Such privilege escalation attacks occur by modifying the value of the
    assigned role and replacing the value with another. In the event that the attack
    is successful, the user gains unauthorized access to resources or functionality
    normally restricted to administrators or more-powerful accounts.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序中的开发人员代码必须包括对分配角色的授权检查，以确保授权用户无法将其角色提升到更高的特权。这种特权升级攻击是通过修改分配角色的值并用另一个值替换来发生的。如果攻击成功，用户将未经授权地访问通常限制为管理员或更强大帐户的资源或功能。
- en: Getting ready
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 做好准备
- en: Using OWASP Mutillidae II as our target application, let's log in as a regular
    user, John, and determine whether we can escalate our role to admin.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 使用OWASP Mutillidae II作为我们的目标应用程序，让我们以普通用户John的身份登录，并确定我们是否可以将我们的角色提升为管理员。
- en: How to do it...
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: Ensure Burp and OWASP BWA VM are running and that Burp is configured in the
    Firefox browser used to view the OWASP BWA applications.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 确保Burp和OWASP BWA VM正在运行，并且已在用于查看OWASP BWA应用程序的Firefox浏览器中配置了Burp。
- en: From the OWASP BWA Landing page, click the link to the OWASP Mutillidae II application.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从OWASP BWA登陆页面，点击链接到OWASP Mutillidae II应用程序。
- en: Open the Firefox browser to the login screen of OWASP Mutillidae II. From the
    top menu, click **Login**.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开Firefox浏览器到OWASP Mutillidae II的登录界面。从顶部菜单中，点击**登录**。
- en: 'At the login screen, log in with these credentials—username: `john` and password:
    `monkey`.'
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在登录界面，使用以下凭据登录—用户名：`john`和密码：`monkey`。
- en: 'Switch to Burp''s **Proxy** | **HTTP history** tab. Find the `POST` and subsequent
    `GET` requests you just made by logging in as `john`:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到Burp的**代理** | **HTTP历史**选项卡。通过以`john`登录，找到您刚刚进行的`POST`和随后的`GET`请求：
- en: '![](img/00196.jpeg)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00196.jpeg)'
- en: Look at the `GET` request from the listing; notice the cookie name/value pairs
    shown on the **Cookie:** line.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看列表中的`GET`请求；注意**Cookie:**行上显示的cookie名称/值对。
- en: The name/value pairs of most interest include `username=john` and `uid=3`. What
    if we attempt to manipulate these values to a different role?
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 最感兴趣的名称/值对包括`username=john`和`uid=3`。如果我们尝试将这些值操纵到不同的角色会发生什么？
- en: '![](img/00197.jpeg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00197.jpeg)'
- en: Let's attempt to manipulate the parameters `username` and the `uid` stored in
    the cookie to a different role. We will use Burp's **Proxy** | **Intercept** to
    help us perform this attack.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们尝试操纵存储在cookie中的`username`和`uid`参数到不同的角色。我们将使用Burp的**代理** | **拦截**来帮助我们执行此攻击。
- en: Switch to the **Proxy** | **Intercept** tab, and press the **Intercept is on**
    button. Return to the Firefox browser and reload the login page.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到**代理** | **拦截**选项卡，然后按下**拦截已打开**按钮。返回到Firefox浏览器并重新加载登录页面。
- en: The request is paused within the **Proxy** | **Intercept** tab. While it is
    paused, change the value assigned to the username from `john` to `admin`. Also,
    change the value assigned to the `uid` from `3` to `1`*:*
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**代理** | **拦截**选项卡中暂停请求。在暂停时，将分配给用户名的值从`john`更改为`admin`。同时，将分配给`uid`的值从`3`更改为`1`。
- en: '![](img/00198.jpeg)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00198.jpeg)'
- en: Click the **Forward** button, and press the **Intercept is on** again to toggle
    the intercept button to **OFF (Intercept is off)**.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**转发**按钮，然后再次按下**拦截已打开**以切换拦截按钮为**关闭（拦截已关闭）**。
- en: 'Return to the Firefox browser, and notice we are now logged in as an admin!
    We were able to escalate our privileges from a regular user to an admin, since
    the developer did not perform any authorization checks on the assigned role:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到Firefox浏览器，注意我们现在以管理员身份登录！我们能够从普通用户升级到管理员，因为开发人员没有对分配的角色执行任何授权检查：
- en: '![](img/00199.jpeg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00199.jpeg)'
- en: How it works...
  id: totrans-114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: There are several application issues associated with the privilege escalation
    attack shown in this recipe. Any actions related to account provisioning (that
    is, role assignments) should only be allowed by administrators. Without proper
    checks in place, users can attempt to escalate their provisioned roles. Another
    issue exemplified in this recipe is the sequential user ID number (for example,
    `uid=3`). Since this number is easily guessable and because most applications
    start with administrator accounts, changing the digit from `3` to `1` seemed a
    probable guess for association with the admin account.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中显示的特权升级攻击中存在几个应用程序问题。与帐户配置（即角色分配）相关的任何操作都应该只允许管理员执行。如果没有适当的检查，用户可以尝试升级他们的配置角色。在这个示例中展示的另一个问题是顺序用户ID号（例如，`uid=3`）。由于这个数字很容易被猜到，并且因为大多数应用程序都从管理员帐户开始，将数字从`3`更改为`1`似乎是与管理员帐户相关的一个可能的猜测。
- en: Testing for Insecure Direct Object Reference (IDOR)
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试不安全的直接对象引用（IDOR）
- en: Allowing unauthorized direct access to files or resources on a system based
    on user-supplied input is known as **Insecure Direct Object Reference** (**IDOR**).
    This vulnerability allows the bypassing of authorization checks placed on such
    files or resources. IDOR is a result of unchecked user supplied input to retrieve
    an object without performing authorization checks in the application code.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 基于用户提供的输入允许未经授权直接访问文件或资源的系统被称为**不安全的直接对象引用**（**IDOR**）。这种漏洞允许绕过对这些文件或资源放置的授权检查。IDOR是由于在应用程序代码中未经检查的用户提供的输入来检索对象而未执行授权检查的结果。
- en: Getting ready
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: Using OWASP Mutillidae II as our target application, let's manipulate the value
    of the `phpfile` parameter to determine whether we can make a call to a direct
    object reference on the system, such as `/etc/passwd` file.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 使用OWASP Mutillidae II作为我们的目标应用程序，让我们操纵`phpfile`参数的值，以确定我们是否可以调用系统上的直接对象引用，例如`/etc/passwd`文件。
- en: How to do it...
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'From the Mutillidae menu, select **OWASP 2013** | **A4 – Insecure Direct Object
    References** | **Source Viewer**:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从Mutillidae菜单中，选择**OWASP 2013** | **A4 – 不安全的直接对象引用** | **源代码查看器**：
- en: '![](img/00200.jpeg)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00200.jpeg)'
- en: 'From the **Source Viewer** page, using the default file selected in the drop-down
    box (`upload-file.php`), click the **View File** button to see the contents of
    the file displayed below the button:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**源代码查看器**页面，使用下拉框中选择的默认文件（`upload-file.php`），点击**查看文件**按钮以查看文件内容显示在按钮下方：
- en: '![](img/00201.jpeg)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00201.jpeg)'
- en: Switch to Burp's **Proxy** | **HTTP history** tab. Find the `POST` request you
    just made while viewing the `upload-file.php` file. Note the `phpfile` parameter
    with the value of the file to display. What would happen if we change the value
    of this parameter to something else?
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到Burp的**代理** | **HTTP历史**选项卡。找到您刚刚在查看`upload-file.php`文件时所做的`POST`请求。注意带有要显示的文件值的`phpfile`参数。如果我们将此参数的值更改为其他内容会发生什么？
- en: '![](img/00202.jpeg)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00202.jpeg)'
- en: Let's perform an IDOR attack by manipulating the value provided to the `phpfile`
    parameter to reference a file on the system instead. For example, let's try changing
    the `upload-file.php` value to `../../../../etc/passwd` via Burp's **Proxy** |
    **Intercept** functionality.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们通过操纵提供给`phpfile`参数的值来执行IDOR攻击，以引用系统上的文件。例如，让我们尝试通过Burp的**代理** | **拦截**功能将`upload-file.php`的值更改为`../../../../etc/passwd`。
- en: To perform this attack, follow these steps.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要执行此攻击，请按照以下步骤进行。
- en: Switch to the **Proxy** |**Intercept** tab, and press the **Intercept is on**
    button.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到**代理** | **拦截**选项卡，并按下**拦截已开启**按钮。
- en: Return to the Firefox browser and reload the login page. The request is paused
    and contained within the **Proxy** | **Intercept** tab.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到Firefox浏览器并重新加载登录页面。请求被暂停，并包含在**代理** | **拦截**选项卡中。
- en: 'As the request is paused, change the value assigned to the `phpfile` parameter
    to the value `../../../../etc/passwd` instead:'
  id: totrans-131
  prefs:
  - PREF_OL
  - PREF_OL
  type: TYPE_NORMAL
  zh: 由于请求被暂停，将`phpfile`参数分配的值更改为`../../../../etc/passwd`：
- en: '![](img/00203.jpeg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00203.jpeg)'
- en: Click the **Forward** button. Now press the **Intercept is on** button again
    to toggle the intercept button to **OFF (Intercept is off)**.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**转发**按钮。现在再次按下**拦截已开启**按钮，将拦截按钮切换为**关闭（拦截已关闭）**。
- en: Return to the Firefox browser. Notice we can now see the contents of the `/etc/passwd`
    file!
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到Firefox浏览器。注意我们现在可以看到`/etc/passwd`文件的内容！
- en: '![](img/00204.jpeg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00204.jpeg)'
- en: How it works...
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 工作原理...
- en: Due to lack of proper authorization checks on the `phpfile` parameter within
    the application code, we are able to view a privileged file on the system. Developers
    and system administrators provide access controls and checks prior to the revealing
    of sensitive files and resources. When these access controls are missing, IDOR
    vulnerabilities may be present.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 由于应用程序代码中对`phpfile`参数缺乏适当的授权检查，我们能够查看系统上的特权文件。开发人员和系统管理员在揭示敏感文件和资源之前提供访问控制和检查。当这些访问控制缺失时，可能存在IDOR漏洞。
