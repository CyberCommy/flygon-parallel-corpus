- en: 'Chapter 12: Appendix'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This chapter presents a set of solutions for all the questions that were asked
    in the previous chapters. If you have already answered these questions, you can
    check the accuracy of your answers. If you were unable to find a solution at the
    time, you can refer to the answers given here for the respective chapters.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: 'Chapter 1: Exploring the Microsoft Azure Cloud'
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You can virtualize compute, network, and storage resources. Of course, at the
    end of the day, you'll still need hardware somewhere in the world to run the hypervisors,
    and possibly a cloud platform on top of that.
  id: totrans-3
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Virtualization emulates hardware, and containers emulate an operating system
    where multiple containers run on an underlying operating system. In virtualization,
    each virtual machine has its own kernel; they don't use the hypervisor/hardware
    kernel. In hardware virtualization, everything is transformed into software. In
    container virtualization, only processes are isolated.
  id: totrans-4
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: It depends; do you develop your application on the same platform? If so, then
    PaaS is the service type for you; otherwise, use IaaS. SaaS provides an application;
    it's not a hosting platform.
  id: totrans-5
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: It depends. Azure is compliant with and helps you to comply with legal rules
    and security/privacy policies. Plus, there is the concept of different regions
    if there are concerns about having data in other parts of the world. But there
    are always exceptions—most of the time, company policies or governmental rulings.
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: It is very important for scalability, performance, and redundancy.
  id: totrans-7
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: It's a cloud-based identity management service for controlling access to your
    cloud and on-premises hybrid environment. It lets you sign in and access both
    cloud and on-premises environments instead of using your own AD servers and managing
    them.
  id: totrans-8
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Chapter 2: Getting Started with the Azure Cloud'
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: It helps with automation. Besides that, the web-based portal changes frequently,
    and the command-line interface is much more stable. In our opinion, it also gives
    you a better understanding of the underlying technology, thanks to its more or
    less strict workflow.
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: It provides access for storing all your data objects. You'll need one for boot
    diagnostics and data for Azure Cloud Shell. More details can be found in *Chapter
    4*, *Managing Azure*.
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The storage account must be globally unique in Azure.
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: An offer is a group of related images offered by a publisher, such as Ubuntu
    Server. An image is a specific image.
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A stopped Azure virtual machine keeps resources allocated, such as dynamic public
    IP addresses, and incurs costs, whereas a deallocated virtual machine frees all
    resources so it stops incurring resource costs. However, both incur storage costs.
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Key-based authentication helps in automation as it can be used without exposing
    secrets/passwords in your scripts.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Both a public and a private key will be created (if they are still necessary)
    and stored in your home directory (`~/.ssh`); the public key will be added to
    the `authorized_keys` file in the virtual machine
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Chapter 3: Basic Linux Administration'
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '`for user in Lisa John Karel Carola; useradd $user; done`.'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Execute `passwd <user>` and enter `welc0meITG` and it will ask you to enter
    the password again to confirm, so enter `welc0meITG` again.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`getent<user>`.'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`groupadd finance;` `groupadd staff`.'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`groupmems -g <group_name> -a <user_name>`; alternatively, `usermod –a –G <group_name>
    <user_name>`.'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To create the directory and set group ownership, execute the following:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Similarly, for `finance`, execute these commands:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '`chmod –R g+r /home/finance`.'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The default get access control list (`getfacl -d`) will list the ACL of a user.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Chapter 4: Managing Azure'
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You don''t need anything when you create a virtual machine using the Azure
    portal. When you use the command line, you need virtual networks with the following:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A resource group
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: Azure **Virtual Network** (**VNet**)
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: A configured subnet
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: A network security group
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: A public IP address
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: A network interface
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: You need name services such as Diagnostics and Monitoring, which require a storage
    account.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Sometimes (for instance, for a storage account), the name must be unique. A
    prefix combined with a randomly generated number is a nice way to make the name
    recognizable and unique.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To define the IP range that can be used within a virtual network.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To create one or more subnets within the virtual network that can be isolated
    or routed to each other, without going outside the virtual network.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A network security group provides ACLs for the network and provides port-forwarding
    to the virtual machines or containers.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Traffic from the virtual machine to the internet is sent via **Source Network
    Address Translation** (**SNAT**). This means that the IP address of the originating
    packet is replaced with the public IP address, which is required for TCP/IP for
    outbound and inbound routing.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A dynamically allocated public IP address will be released when the virtual
    machine is deallocated. When the virtual machine starts again, it will get another
    IP address. You can create and assign static public IP address when it is mandatory
    to keep the same IP address even after the service IP address changes.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Chapter 5: Advanced Linux Administration'
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Linux kernel.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`systemd-udevd`.'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`ls /sys/class/net` and `ip link show`.'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The Azure agent for Linux.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`ls /sys/class/net` and `lsblk`. The `lsscsi` command can be helpful as well.'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: It is a good idea to use `RAID0` to improve performance and allow improved throughput
    compared to using just a single disk.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: At the filesystem level, using `mdadm)` or **Logical Volume Manager** (**LVM**)
    (not covered in this chapter).
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Create the RAID, format it, and make a mount point:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Create a unit file, `/etc/systemd/system/mnt-myraid.mount`:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Start and enable it at boot:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Chapter 6: Managing Linux Security and Identities'
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Using the `firewall-cmd` file or by deploying `/etc/firewalld` directory.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The `--permanent` parameter makes it persistent across reboots and executes
    during start up configuration.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In Linux, you can restrict access using ACLs in systemd. Some applications also
    provide other host allow/deny options. In Azure, you have network security groups
    and the Azure Firewall service.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Discretionary access control** (**DAC**) is used for restricting access based
    on users/groups and permissions on files. **Mandatory access control** (**MAC**)
    further restricts access based on classification labels for each resource object.'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If someone gained access illegally to an application or system, with DAC, there
    is no way to prevent further access, especially for files with the same user/group
    owner and files with permissions for others.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Every device will have a unique MAC address and you can find your virtual machine's
    MAC address using `ipconfig/ all` and then look for Physical Address.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'MAC frameworks that utilize Linux Security Modules are as follows:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: 'SELinux: Red Hat–based distributions and SUSE'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: 'AppArmor: Ubuntu and SUSE'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: 'The lesser-known TOMOYO (SUSE): Not covered in this book'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: Besides the fact that SELinux can protect more resource objects, AppArmor works
    directly with paths, while SELinux protects the whole system with fine-grained
    access control.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You need the following prerequisites before joining an AD domain:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Kerberos client for authorization
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: '`realm`, `adcli`, and the `net` command'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: 'Chapter 7: Deploying Your Virtual Machines'
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We use automated deployment to save time, to get a reproducible environment
    quickly up and running, and to avoid manual errors.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Besides the answer to the previous question, a standardized working environment
    makes team-based application development possible.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Scripting is very flexible. Scripts are easier to create and can be invoked
    manually anytime. The automation process can be triggered by events such as adding
    code to Git using `git push` or the stopping/starting of your virtual machines.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure Resource Manager is the most important one. In addition, you can use Terraform,
    Ansible, and PowerShell.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Vagrant deploys a workload in Azure; Packer creates a custom image that you
    can deploy.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'For multiple reasons, the most important ones are the following:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Security, to harden the image using CIS standards
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: When customization is needed for a standard image
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: Not dependent on the offerings of a third party
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: Capture an existing virtual machine
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: Convert a snapshot to an image
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: 'You can create your own image by building your own VHD file. The following
    are the options for doing so:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Create a virtual machine in Hyper-V or VirtualBox, which is a free hypervisor
    available for Windows, Linux, and macOS.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: Create your virtual machine in VMware Workstation or KVM and use it in Linux
    qemu-img to convert the image.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: 'Chapter 8: Exploring Continuous Configuration Automation'
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Example scripts are available on GitHub at [https://github.com/PacktPublishing/Hands-On-Linux-Administration-on-Azure---Second-Edition/tree/master/chapter12/solutions_chapter08](https://github.com/PacktPublishing/Hands-On-Linux-Administration-on-Azure---Second-Edition/tree/master/chapter12/solutions_chapter08).
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: 'Chapter 9: Container Virtualization in Azure'
  id: totrans-90
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You can use containers for packaging and distributing your applications, which
    can be platform-independent. Containers remove the need for virtual machine and
    operating system management and help you achieve high availability and scalability.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Containers are not suitable if you have a huge monolithic application that requires
    all the resources of the underlying virtual machines.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Linux containers** (**LXCs**) are an optimal solution that can be provisioned
    in Azure.'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tools such as Buildah make it possible to create virtual machines that can be
    used in every solution. Rkt (pronounced "rocket") also supports the Docker format.
    The Open Container Initiative is working very hard to create standards to make
    the creation of virtual machines even easier.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can develop everything in Azure or you can develop locally and then push
    to a remote environment.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: It's container platform–agnostic, and the Buildah tool is easier to use than
    other tools. You can explore further at [https://github.com/containers/buildah](https://github.com/containers/buildah).
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Containers can be built, replaced, stopped, and destroyed on demand without
    any impact upon the application or data, so it's not recommended to store any
    data in the container. Instead, store it in a volume.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Chapter 10: Working with Azure Kubernetes Service'
  id: totrans-98
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A pod is a group of containers with shared resources, such as storage and network,
    as well as a specification for how to run the containers.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A good reason to create a multiple-container pod is to support co-located, co-managed
    helper processes for your primary application.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There are multiple methods available, including Draft and Helm, which were discussed
    in the chapter in addition to **Azure Kubernetes Service** (**AKS**).
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can use `kubectl` to update your application in AKS. In addition, you can
    also use Helm and Draft.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You don't need to do it yourself manually; it will be done automatically by
    AKS.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will need an iSCSI solution and a clustered filesystem when you want to
    read/write simultaneously from multiple containers.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Example code is provided on GitHub at [https://github.com/MicrosoftDocs/azure-docs/blob/master/articles/aks/azure-disks-dynamic-pv.md](https://github.com/MicrosoftDocs/azure-docs/blob/master/articles/aks/azure-disks-dynamic-pv.md).
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Chapter 11: Troubleshooting and Monitoring Your Workloads'
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You can access your virtual machine using Azure Serial Console as root without
    a password unless it's specifically blocked.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To collect all the standard output, syslog messages, and related messages from
    the kernel, systemd processes, and units.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'syslog uses the following list of severities (per application):'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`Alert`: Action must be taken immediately.'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: '`Critical`: Critical conditions.'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '`Error`: Error conditions.'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: '`Warning`: Warning conditions.'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: '`Notice`: Normal but significant conditions.'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: '`Informational`: Informational messages.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: '`Debug`: Debug-level messages.'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '`调试`：调试级别的消息。'
- en: 0-Emergency, 1-Alert, 2-Critical, 3-Error, 4-Warning, 5-Notice, 6-Informational,
    7-Debug.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 0-紧急，1-警报，2-关键，3-错误，4-警告，5-通知，6-信息，7-调试。
- en: Use `logger` or `systemd-cat`. You can use it if an application or script doesn't
    have syslog support. Another option is to add logging entries as a part of your
    change management.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`logger`或`systemd-cat`。如果应用程序或脚本不支持syslog，则可以使用它。另一个选项是将日志条目作为变更管理的一部分添加。
- en: The Azure Log Analytics service is used to view the metrics of a virtual machine.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure Log Analytics服务用于查看虚拟机的指标。
- en: There are several shortcomings of the `top` utility; for instance, you can't
    see short-lived processes. The `atop` and `dstat` utilities are solutions to this
    problem.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`top`实用程序有几个缺点；例如，您无法看到短暂的进程。`atop`和`dstat`实用程序是解决这个问题的解决方案。'
- en: '`sysstat` utilities provide historical data; `dstat` provides real-time monitoring.'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`sysstat`实用程序提供历史数据；`dstat`提供实时监控。'
- en: It makes the collection of data coming from `tcpdump` of your Azure virtual
    machine (workstation) easier to read and it has great analysis potential.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它使得来自Azure虚拟机（工作站）的`tcpdump`数据的收集更易于阅读，并具有很大的分析潜力。
